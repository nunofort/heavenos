     1                                  ;**********************************************************************
     2                                  ; Copyright 2006, Nuno Miguel (codingheaven@gmail.com) 
     3                                  ; All rights reserved. 
     4                                  ;
     5                                  ; See the LICENSE file
     6                                  ;
     7                                  ; The origin of this software must not be misrepresented, either by
     8                                  ; explicit claim or by omission.  Since few users ever read sources,
     9                                  ; credits must appear in the documentation.
    10                                  ;
    11                                  ; CODE IMPROVEMENTS by:
    12                                  ;	Nuno Miguel (codingheaven@gmail.com)	
    13                                  ;
    14                                  ;       
    15                                  ;
    16                                  ;
    17                                  ;
    18                                  ;***********************************************************************
    19                                  
    20                                  
    21                                  ;=============================================================;
    22                                  ; HeavenOS Micro-Kernel V0.1.4
    23                                  ; In the future, Version Number should be only on VERSION file 							               ;
    24                                  ;=============================================================;
    25                                  ;    500 - 9FFFF Free Memory < 1MB (Conventional 640K)                        ;
    26                                  ; 100000 - ?     Free Memory >= 1MB (Extended)                                ;
    27                                  ;-----------------------------------------------------------------------------;
    28                                  
    29                                  [BITS 16]
    30                                  ;[ORG 0x00000500]
    31                                  ;[ORG 0x00010000]
    32                                  [ORG 0x00001000]
    33                                  ;-----------------------------------------------------------------------------;
    34                                  ; 16 BITS CODE                                                                ;
    35                                  ;-----------------------------------------------------------------------------;
    36                                  
    37                                  ; set ES to video address
    38 00000000 B800B8                  mov ax, 0xB800
    39 00000003 8EC0                    mov es, ax
    40                                  
    41                                  ;;; RM_Clear_Screen
    42 00000005 B9A00F                  mov cx, 0x0fa0
    43 00000008 BF0000                  mov di, 0
    44                                  next_char0:
    45 0000000B 2666C70500000000        mov dword [es:di], 0
    46 00000013 81C70400                add di, 4
    47 00000017 39CF                    cmp di, cx
    48 00000019 75F0                    jne next_char0
    49                                  
    50                                  ;;; RM_Write_Message
    51 0000001B B800B8                  mov ax, 0xB800
    52 0000001E 8EC0                    mov es, ax
    53                                  ;; RM_Write_Boot_Mensage
    54 00000020 BF4201                  mov di, 160*0x02 + 2*0x01
    55 00000023 BE[F158]                mov si, kernel_msg
    56 00000026 B403                    mov ah, 0x03
    57                                  next_char1:
    58 00000028 8A04                    mov al, byte [si]
    59 0000002A 268905                  mov word [es:di], ax
    60 0000002D 47<rept>                times 2 inc di
    61 0000002F 46                      inc si
    62 00000030 803C00                  cmp byte [si],0
    63 00000033 75F3                    jne next_char1
    64                                  
    65                                  check_keyboard:
    66 00000035 E460                    in   al, 0x60                
    67 00000037 3C1C                    cmp  al, 0x1C    	; check ENTER key           
    68 00000039 75FA                    jne  check_keyboard      
    69                                  
    70                                  ;---------------------------------------------------------------------------;
    71                                  ; INITIALIZATION STAGE FOR THE 32-BIT PM SWITCH                             ;
    72                                  ;---------------------------------------------------------------------------;
    73 0000003B FA                      cli     ; disable interrupts
    74                                  
    75                                  ; Enable A20 on PS/2 compatibles
    76                                  ;in      al,0x92
    77                                  ;or      al,2
    78                                  ;out     0x92,al
    79                                  
    80                                  ; Enable A20 on AT compatibles > 1MB
    81 0000003C B0D1                    mov     al,0xD1
    82 0000003E E664                    out     0x64,al
    83 00000040 B0DF                    mov     al,0xDF
    84 00000042 E660                    out     0x60,al
    85                                  
    86 00000044 0F0116[C30D]            lgdt [gdt_ptr]			; Load GDT into GDTR
    87                                  
    88                                  ; switch to PM
    89 00000049 0F20C0                  mov     eax, cr0                ; Get Control Register 0
    90 0000004C 660D01000000            or      eax, 0x01               ; set PE bit (bit 0) in (e)ax
    91 00000052 0F22C0                  mov     cr0, eax                ; Switch to Protected Mode
    92                                  
    93                                  ; setting regs
    94 00000055 B81000                  mov ax, 0x0010
    95 00000058 8EC0                    mov es, ax      ; extra segment
    96 0000005A 8ED8                    mov ds, ax      ; data segment
    97 0000005C 8ED0                    mov ss, ax      ; stack segment -> grows down in memory
    98 0000005E 8EE0                    mov fs, ax
    99 00000060 8EE8                    mov gs, ax
   100 00000062 66BC00500000            mov esp, 0x5000         ; stack pointer
   101 00000068 66BD00500000            mov ebp, 0x5000         ; base pointer
   102                                  
   103 0000006E 66EA[5B570000]0800      jmp dword 0x0008:kernel_start 
   104                                  
   105                                  ;---------------------------------------------------------------------------;
   106                                  ; 32-BIT CODE                                                              ;
   107                                  ;---------------------------------------------------------------------------;
   108                                  [BITS 32]
   109                                  
   110                                  %include "cpu.inc"
   111                              <1> 
   112                              <1> ; Detect CPU Type (only processor family)
   113                              <1> %macro CPU_family		1
   114                              <1>   pushfd                  ;At least an 80386. Save flags twice:
   115                              <1>   pushfd                  ;first for later restoration,
   116                              <1>   pop     eax             ;second to get them
   117                              <1>   or      eax,240000h     ;set ID and AC flags
   118                              <1>   push    eax
   119                              <1>   popfd                   ;tell flag register about it
   120                              <1>   pushfd                  ;did the CPU take the bait?
   121                              <1>   pop     eax
   122                              <1>   shr     eax,10h
   123                              <1>   and     al,24h          ;isolate ID and AC bits
   124                              <1>   jz      %%_3            ;can't set either flag ===>
   125                              <1>                           ;must be an 80386
   126                              <1>   cmp     al,4            ;can't set ID bit?
   127                              <1>   jz      %%_4            ;no: must be an 80486
   128                              <1>   mov     ax,1            ;Pentium or Pentium Pro
   129                              <1>   CPUID                   ;get CPU ID
   130                              <1>   mov     al,ah           ;forget about model and stepping
   131                              <1>                           ;numbers
   132                              <1>   and     al,0fh          ;isolate ID
   133                              <1>   jmp     short %%_4
   134                              <1> %%_3:
   135                              <1>   mov     al,3            ;80386
   136                              <1> %%_4:
   137                              <1>   popfd                   ;restore flags
   138                              <1>   mov byte [%1], al 
   139                              <1> %endmacro
   140                              <1> 
   141                              <1> %macro CPU_check_cpuid	1
   142                              <1> mov dword  [%1], 0
   143                              <1> cli
   144                              <1> pushfd      		; Save EFLAGS to stack
   145                              <1> pop eax    		; Store EFLAGS in EAX
   146                              <1> mov ebx, eax    	; Save in EBX for testing later
   147                              <1> xor eax, 00200000h   	; Switch bit 21
   148                              <1> push eax    		; Copy changed value to stack
   149                              <1> popfd    		; Save changed EAX to EFLAGS
   150                              <1> pushfd    		; Push EFLAGS to top of stack
   151                              <1> pop eax    		; Store EFLAGS in EAX
   152                              <1> cmp eax, ebx    	; See if bit 21 has changed
   153                              <1> jz %%no_cpuid  		; If no change, no CPUID
   154                              <1> mov dword [%1], 1
   155                              <1> %%no_cpuid:
   156                              <1> sti
   157                              <1> %endmacro
   158                              <1> 
   159                              <1> ; i586+ Processors only
   160                              <1> ; return 'GenuineIntel' OR 'AuthenticAMD'
   161                              <1> CPU_signature:
   162 00000076 BF[AD000000]        <1> mov edi, CPU_SIGNATURE 
   163 0000007B 31C0                <1> xor eax, eax    ; eax = 0 (level 0), EBX:EDX:ECX have CPU SIGNATURE on return
   164 0000007D 0FA2                <1> CPUID		
   165 0000007F 26891F              <1> mov dword [es:edi+0], ebx
   166 00000082 26895704            <1> mov dword [es:edi+4], edx
   167 00000086 26894F08            <1> mov dword [es:edi+8], ecx
   168 0000008A CB                  <1> retf
   169                              <1> 
   170                              <1> ; i586+ Processor only
   171                              <1> CPU_id:
   172 0000008B 31C0                <1> xor eax, eax		; eax = 0 (level 0)
   173 0000008D 0FA2                <1> CPUID			; return EAX = maximum available level
   174 0000008F 3D00000000          <1> cmp eax, 0
   175 00000094 7412                <1> je exit_id
   176 00000096 B801000000          <1> mov eax, 1		; level 1
   177 0000009B 0FA2                <1> CPUID			; return EAX
   178                              <1> 			; Processor Type(INTEL only)
   179                              <1> 			; bits 13..12 = 0 - normal
   180                              <1> 			;               1 - overdrive system
   181                              <1> 			;               2 - dual system
   182                              <1> 			; bits 11..8 = Family
   183                              <1> 			; bits 7..4 = Model
   184                              <1> 			; bits 3..0 = stepping/revision
   185                              <1> 			; return EDX = processor feature flags
   186                              <1> 			; bit 23 = MMX support!
   187 0000009D A3[D2000000]        <1> mov dword [CPU_ID], eax
   188 000000A2 8915[D6000000]      <1> mov dword [CPU_FLAGS], edx
   189                              <1> exit_id:
   190 000000A8 CB                  <1> retf
   191                              <1> 
   192                              <1> ; i586+ Processor only
   193                              <1> %macro CPU_extended_id		1
   194                              <1> mov eax, 0x80000000	; first extended level
   195                              <1> CPUID			; return EAX = maximum available extended level
   196                              <1> mov %1, eax
   197                              <1> ; extended levels return information specific to the processor
   198                              <1> ; 3DNow support or Processor Name !
   199                              <1> %endmacro
   200                              <1> 
   201                              <1> %macro CPU_detect		1
   202                              <1> ; %1 = return STEPPING
   203                              <1> mov esi, CPU_UNKNOWN_STRING
   204                              <1> mov dword [CPU_STRING], esi 
   205                              <1> mov esi, CPU_AMD_SIGNATURE
   206                              <1> mov edi, CPU_SIGNATURE
   207                              <1> %%next_amd:
   208                              <1> mov ebx, dword [ds:esi]
   209                              <1> mov eax, dword [ds:edi]
   210                              <1> add esi, 4
   211                              <1> add edi, 4
   212                              <1> cmp eax, ebx
   213                              <1> jne %%skip_amd
   214                              <1> cmp edi, CPU_SIGNATURE+12
   215                              <1> jne %%next_amd
   216                              <1> mov esi, CPU_AMD_ID
   217                              <1> jmp short %%cpu_find
   218                              <1> %%skip_amd:
   219                              <1> mov esi, CPU_INTEL_SIGNATURE
   220                              <1> mov edi, CPU_SIGNATURE
   221                              <1> %%next_intel:
   222                              <1> mov ebx, dword [ds:esi]
   223                              <1> mov eax, dword [ds:edi]
   224                              <1> add esi, 4
   225                              <1> add edi, 4
   226                              <1> cmp eax, ebx
   227                              <1> jne %%cpu_end_detect
   228                              <1> cmp edi, CPU_SIGNATURE+12
   229                              <1> jne %%next_intel
   230                              <1> mov esi, CPU_INTEL_ID
   231                              <1> %%cpu_find
   232                              <1> mov ebx, dword [CPU_ID]
   233                              <1> mov al, 00001111b
   234                              <1> and al, bl
   235                              <1> mov byte [%1], al
   236                              <1> shr ebx, 4
   237                              <1> %%next_cpu:
   238                              <1> mov ax, word [ds:esi]
   239                              <1> add esi,33 
   240                              <1> cmp ax, bx
   241                              <1> je %%cpu_found 
   242                              <1> cmp word [ds:esi], 0xFFFF
   243                              <1> je %%cpu_end_detect
   244                              <1> jmp short %%next_cpu
   245                              <1> %%cpu_found:
   246                              <1> sub esi, 31
   247                              <1> mov dword [CPU_STRING], esi 
   248                              <1> %%cpu_end_detect:
   249                              <1> %endmacro
   250                              <1> 
   251                              <1> ;===========================================================================;
   252                              <1> ; CPU ID (low 16 bits of EAX)                                               ;
   253                              <1> ;===========================================================================;
   254 000000A9 00000000            <1> CPU_STRING        	DD      0x00000000 ; COOL Pointer!!! :)
   255 000000AD 202020202020202020- <1> CPU_SIGNATURE		DB '            ',0
   256 000000B6 20202000            <1>
   257 000000BA 41757468656E746963- <1> CPU_AMD_SIGNATURE	DB 'AuthenticAMD'
   258 000000C3 414D44              <1>
   259 000000C6 47656E75696E65496E- <1> CPU_INTEL_SIGNATURE	DB 'GenuineIntel'
   260 000000CF 74656C              <1>
   261 000000D2 00000000            <1> CPU_ID			DD 0
   262 000000D6 00000000            <1> CPU_FLAGS		DD 0
   263 000000DA 556E6B6E6F776E2050- <1> CPU_UNKNOWN_STRING	DB 'Unknown Processor Description',0
   264 000000E3 726F636573736F7220- <1>
   265 000000EC 446573637269707469- <1>
   266 000000F5 6F6E00              <1>
   267                              <1> ; TODO : colocar info sobre cpu's 386 e 486
   268                              <1> ; guardar o valor do EDX em memoria depois do reset
   269                              <1> ;---------------------------------------------------------------------------;
   270                              <1> ; AMD                                                                       ;
   271                              <1> ;---------------------------------------------------------------------------;
   272                              <1> CPU_AMD_ID:
   273 000000F8 4000                <1> 				DW 0000000001000000b
   274 000000FA 416D343836206F7220- <1> 				DB 'Am486 or Am5x86 Processor     ',0
   275 00000103 416D35783836205072- <1>
   276 0000010C 6F636573736F722020- <1>
   277 00000115 20202000            <1>
   278 00000119 4100                <1> 				DW 0000000001000001b
   279 0000011B 416D343836206F7220- <1> 				DB 'Am486 or Am5x86 Processor     ',0
   280 00000124 416D35783836205072- <1>
   281 0000012D 6F636573736F722020- <1>
   282 00000136 20202000            <1>
   283 0000013A 5000                <1> 				DW 0000000001010000b
   284 0000013C 414D442D4B3528746D- <1> 				DB 'AMD-K5(tm) Processor (Model 0)',0
   285 00000145 292050726F63657373- <1>
   286 0000014E 6F7220284D6F64656C- <1>
   287 00000157 20302900            <1>
   288 0000015B 5100                <1> 				DW 0000000001010001b
   289 0000015D 414D442D4B35205072- <1> 				DB 'AMD-K5 Processor (Model 1)    ',0
   290 00000166 6F636573736F722028- <1>
   291 0000016F 4D6F64656C20312920- <1>
   292 00000178 20202000            <1>
   293 0000017C 5200                <1> 				DW 0000000001010010b
   294 0000017E 414D442D4B35205072- <1> 				DB 'AMD-K5 Processor (Model 2)    ',0
   295 00000187 6F636573736F722028- <1>
   296 00000190 4D6F64656C20322920- <1>
   297 00000199 20202000            <1>
   298 0000019D 5300                <1> 				DW 0000000001010011b
   299 0000019F 414D442D4B35205072- <1> 				DB 'AMD-K5 Processor (Model 3)    ',0
   300 000001A8 6F636573736F722028- <1>
   301 000001B1 4D6F64656C20332920- <1>
   302 000001BA 20202000            <1>
   303 000001BE 5600                <1> 				DW 0000000001010110b
   304 000001C0 414D442D4B36205072- <1> 				DB 'AMD-K6 Processor (Model 6)    ',0
   305 000001C9 6F636573736F722028- <1>
   306 000001D2 4D6F64656C20362920- <1>
   307 000001DB 20202000            <1>
   308 000001DF 5700                <1> 				DW 0000000001010111b
   309 000001E1 414D442D4B36205072- <1> 				DB 'AMD-K6 Processor (Model 7)    ',0
   310 000001EA 6F636573736F722028- <1>
   311 000001F3 4D6F64656C20372920- <1>
   312 000001FC 20202000            <1>
   313 00000200 5800                <1> 				DW 0000000001011000b
   314 00000202 414D442D4B362D3220- <1> 				DB 'AMD-K6-2 Processor (Model 8)  ',0
   315 0000020B 50726F636573736F72- <1>
   316 00000214 20284D6F64656C2038- <1>
   317 0000021D 29202000            <1>
   318 00000221 5900                <1> 				DW 0000000001011001b
   319 00000223 414D442D4B362D4949- <1> 				DB 'AMD-K6-III Processor (Model 9)',0
   320 0000022C 492050726F63657373- <1>
   321 00000235 6F7220284D6F64656C- <1>
   322 0000023E 20392900            <1>
   323 00000242 6100                <1> 				DW 0000000001100001b
   324 00000244 414D44204174686C6F- <1> 				DB 'AMD Athlon(tm) Model 1        ',0
   325 0000024D 6E28746D29204D6F64- <1>
   326 00000256 656C20312020202020- <1>
   327 0000025F 20202000            <1>
   328 00000263 6200                <1> 				DW 0000000001100010b
   329 00000265 414D44204174686C6F- <1> 				DB 'AMD Athlon(tm) Model 2        ',0
   330 0000026E 6E28746D29204D6F64- <1>
   331 00000277 656C20322020202020- <1>
   332 00000280 20202000            <1>
   333 00000284 6400                <1> 				DW 0000000001100100b
   334 00000286 414D44204174686C6F- <1> 				DB 'AMD Athlon(tm) Model 4        ',0
   335 0000028F 6E28746D29204D6F64- <1>
   336 00000298 656C20342020202020- <1>
   337 000002A1 20202000            <1>
   338 000002A5 6300                <1> 				DW 0000000001100011b
   339 000002A7 414D44204475726F6E- <1> 				DB 'AMD Duron(tm) Processor       ',0
   340 000002B0 28746D292050726F63- <1>
   341 000002B9 6573736F7220202020- <1>
   342 000002C2 20202000            <1>
   343 000002C6 FFFF                <1> 				DW 0xFFFF
   344                              <1> ;---------------------------------------------------------------------------;
   345                              <1> ; INTEL                                                                     ;
   346                              <1> ;---------------------------------------------------------------------------;
   347                              <1> ; RESERVED(2 bits) TYPE(2 bits) FAMILY(4 bits) MODEL(4 bits) STEPPING(4 bits)
   348                              <1> CPU_INTEL_ID:
   349 000002C8 4000                <1> 				DW 0000000001000000b
   350 000002CA 496E74656C34383628- <1> 				DB 'Intel486(tm) DX Processor     ',0
   351 000002D3 746D29204458205072- <1>
   352 000002DC 6F636573736F722020- <1>
   353 000002E5 20202000            <1>
   354 000002E9 4100                <1> 				DW 0000000001000001b
   355 000002EB 496E74656C34383628- <1> 				DB 'Intel486(tm) DX Processor     ',0
   356 000002F4 746D29204458205072- <1>
   357 000002FD 6F636573736F722020- <1>
   358 00000306 20202000            <1>
   359 0000030A 4200                <1> 				DW 0000000001000010b
   360 0000030C 496E74656C34383620- <1> 				DB 'Intel486 SX Processor         ',0
   361 00000315 53582050726F636573- <1>
   362 0000031E 736F72202020202020- <1>
   363 00000327 20202000            <1>
   364 0000032B 4300                <1> 				DW 0000000001000011b
   365 0000032D 496E74656C34383620- <1> 				DB 'Intel486 DX2(tm) Processor    ',0
   366 00000336 44583228746D292050- <1>
   367 0000033F 726F636573736F7220- <1>
   368 00000348 20202000            <1>
   369 0000034C 4500                <1> 				DW 0000000001000101b
   370 0000034E 496E74656C34383620- <1> 				DB 'Intel486 SX2(tm) Processor    ',0
   371 00000357 53583228746D292050- <1>
   372 00000360 726F636573736F7220- <1>
   373 00000369 20202000            <1>
   374 0000036D 4400                <1> 				DW 0000000001000100b
   375 0000036F 496E74656C34383620- <1> 				DB 'Intel486 SL Processor         ',0
   376 00000378 534C2050726F636573- <1>
   377 00000381 736F72202020202020- <1>
   378 0000038A 20202000            <1>
   379 0000038E 4700                <1> 				DW 0000000001000111b
   380 00000390 496E74656C44583220- <1> 				DB 'IntelDX2 Write-Back Processor ',0
   381 00000399 57726974652D426163- <1>
   382 000003A2 6B2050726F63657373- <1>
   383 000003AB 6F722000            <1>
   384 000003AF 4800                <1> 				DW 0000000001001000b
   385 000003B1 496E74656C44583428- <1> 				DB 'IntelDX4(tm) Processor        ',0
   386 000003BA 746D292050726F6365- <1>
   387 000003C3 73736F722020202020- <1>
   388 000003CC 20202000            <1>
   389 000003D0 4801                <1> 				DW 0000000101001000b
   390 000003D2 496E74656C44583420- <1> 				DB 'IntelDX4 OverDrive Processor  ',0
   391 000003DB 4F7665724472697665- <1>
   392 000003E4 2050726F636573736F- <1>
   393 000003ED 72202000            <1>
   394 000003F1 5100                <1> 				DW 0000000001010001b
   395 000003F3 50656E7469756D2036- <1> 				DB 'Pentium 60/66 Mhz             ',0
   396 000003FC 302F3636204D687A20- <1>
   397 00000405 202020202020202020- <1>
   398 0000040E 20202000            <1>
   399 00000412 5200                <1> 				DW 0000000001010010b
   400 00000414 5037352F39302F3130- <1> 				DB 'P75/90/100/120/133/166/200 Mhz',0
   401 0000041D 302F3132302F313333- <1>
   402 00000426 2F3136362F32303020- <1>
   403 0000042F 4D687A00            <1>
   404 00000433 5101                <1> 				DW 0000000101010001b
   405 00000435 50656E7469756D204F- <1> 				DB 'Pentium OverDrive 60/66 Mhz   ',0
   406 0000043E 766572447269766520- <1>
   407 00000447 36302F3636204D687A- <1>
   408 00000450 20202000            <1>
   409 00000454 5201                <1> 				DW 0000000101010010b
   410 00000456 502037352F39302F31- <1> 				DB 'P 75/90/100/120/133 OverDrive ',0
   411 0000045F 30302F3132302F3133- <1>
   412 00000468 33204F766572447269- <1>
   413 00000471 76652000            <1>
   414 00000475 5301                <1> 				DW 0000000101010011b
   415 00000477 50656E7469756D204F- <1> 				DB 'Pentium OverDrive for Intel486',0
   416 00000480 766572447269766520- <1>
   417 00000489 666F7220496E74656C- <1>
   418 00000492 34383600            <1>
   419 00000496 5400                <1> 				DW 0000000001010100b
   420 00000498 50656E7469756D2031- <1> 				DB 'Pentium 166/200 Mhz MMX(tm)   ',0
   421 000004A1 36362F323030204D68- <1>
   422 000004AA 7A204D4D5828746D29- <1>
   423 000004B3 20202000            <1>
   424 000004B7 5401                <1> 				DW 0000000101010100b
   425 000004B9 502037352F39302F31- <1> 				DB 'P 75/90/100/120/133 OD MMX(tm)',0
   426 000004C2 30302F3132302F3133- <1>
   427 000004CB 33204F44204D4D5828- <1>
   428 000004D4 746D2900            <1>
   429 000004D8 6100                <1> 				DW 0000000001100001b
   430 000004DA 50656E7469756D2050- <1> 				DB 'Pentium Pro Processor         ',0
   431 000004E3 726F2050726F636573- <1>
   432 000004EC 736F72202020202020- <1>
   433 000004F5 20202000            <1>
   434 000004F9 6300                <1> 				DW 0000000001100011b
   435 000004FB 50656E7469756D2049- <1> 				DB 'Pentium II Processor, model 3 ',0
   436 00000504 492050726F63657373- <1>
   437 0000050D 6F722C206D6F64656C- <1>
   438 00000516 20332000            <1>
   439 0000051A 6500                <1> 				DW 0000000001100101b
   440 0000051C 50656E7469756D2049- <1> 				DB 'Pentium II Processor, model 5 ',0
   441 00000525 492050726F63657373- <1>
   442 0000052E 6F722C206D6F64656C- <1>
   443 00000537 20352000            <1>
   444 0000053B 6600                <1> 				DW 0000000001100110b
   445 0000053D 50656E7469756D2043- <1> 				DB 'Pentium Celeron, model 6      ',0
   446 00000546 656C65726F6E2C206D- <1>
   447 0000054F 6F64656C2036202020- <1>
   448 00000558 20202000            <1>
   449 0000055C 6700                <1> 				DW 0000000001100111b
   450 0000055E 50656E7469756D2049- <1> 				DB 'Pentium III Processor, model 7',0
   451 00000567 49492050726F636573- <1>
   452 00000570 736F722C206D6F6465- <1>
   453 00000579 6C203700            <1>
   454 0000057D 6800                <1> 				DW 0000000001101000b
   455 0000057F 50656E7469756D2049- <1> 				DB 'Pentium III Processor, model 8',0
   456 00000588 49492050726F636573- <1>
   457 00000591 736F722C206D6F6465- <1>
   458 0000059A 6C203800            <1>
   459 0000059E 6A00                <1> 				DW 0000000001101010b
   460 000005A0 50656E7469756D2049- <1> 				DB 'Pentium III Xeon, model A     ',0
   461 000005A9 49492058656F6E2C20- <1>
   462 000005B2 6D6F64656C20412020- <1>
   463 000005BB 20202000            <1>
   464 000005BF 6301                <1> 				DW 0000000101100011b
   465 000005C1 50656E7469756D2049- <1> 				DB 'Pentium II OverDrive Processor',0
   466 000005CA 49204F766572447269- <1>
   467 000005D3 76652050726F636573- <1>
   468 000005DC 736F7200            <1>
   469 000005E0 F000                <1> 				DW 0000000011110000b
   470 000005E2 496E74656C2050656E- <1> 				DB 'Intel Pentium 4 Processor     ',0
   471 000005EB 7469756D2034205072- <1>
   472 000005F4 6F636573736F722020- <1>
   473 000005FD 20202000            <1>
   474 00000601 FFFF                <1> 				DW 0xFFFF
   475                              <1> 
   476                              <1> 
   477                                  
   478                                  %include "util.inc"
   479                              <1> 
   480                              <1> %macro number_to_text	3	
   481                              <1> ; %1 = number
   482                              <1> ; %2 = base N (if N=16(div 16) do 4 shift's to right, for speedup this)
   483                              <1> ; %3 = string address
   484                              <1> mov edi, %3
   485                              <1> mov esi, UTIL_HEX_DIGITS
   486                              <1> mov eax, %1
   487                              <1> mov ebx, %2
   488                              <1> %%divide:
   489                              <1> xor edx, edx
   490                              <1> div ebx
   491                              <1> mov cl, byte [ds:esi+edx]
   492                              <1> mov byte [ds:edi], cl
   493                              <1> dec edi
   494                              <1> cmp eax, ebx
   495                              <1> jge %%divide
   496                              <1> cmp eax, 0
   497                              <1> je %%end
   498                              <1> mov cl, byte [ds:esi+eax]
   499                              <1> mov byte [es:edi], cl
   500                              <1> %%end:
   501                              <1> %endmacro
   502                              <1> 
   503                              <1> %macro copy_str		2	
   504                              <1> mov esi, %1
   505                              <1> mov edi, %2
   506                              <1> %%next_byte:
   507                              <1> mov al, byte [es:esi]
   508                              <1> mov byte [es:edi], al
   509                              <1> inc esi
   510                              <1> inc edi
   511                              <1> cmp byte [es:esi], 0
   512                              <1> jne %%next_byte
   513                              <1> %endmacro
   514                              <1> 
   515                              <1> %macro cmp_str       3
   516                              <1> ; %1 = Test String
   517                              <1> ; %2 = Right String
   518                              <1> ; %3 = 0(false) or 1(true)
   519                              <1> mov dword %3, 0
   520                              <1> mov edi, %1
   521                              <1> mov esi, %2
   522                              <1> %%next_cmp:
   523                              <1> mov al, byte [ds:edi]
   524                              <1> mov bl, byte [es:esi]
   525                              <1> cmp al, bl
   526                              <1> jne %%no_string
   527                              <1> inc edi
   528                              <1> inc esi
   529                              <1> cmp al, 0
   530                              <1> jne %%next_cmp
   531                              <1> mov dword %3, 1
   532                              <1> %%no_string    
   533                              <1> %endmacro
   534                              <1> 
   535                              <1> %macro clean_str	1
   536                              <1> mov edi, %1
   537                              <1> mov al, 32
   538                              <1> %%next_clean:
   539                              <1> mov byte [es:edi], al
   540                              <1> inc edi
   541                              <1> cmp byte [es:edi], 0
   542                              <1> jne %%next_clean
   543                              <1> %endmacro
   544                              <1> 
   545                              <1> %macro get_bit		2
   546                              <1> mov eax, %1
   547                              <1> mov ebx, %2
   548                              <1> shr eax, ebx
   549                              <1> and eax, 1
   550                              <1> mov %1, eax
   551                              <1> %endmacro
   552                              <1> 
   553 00000603 303132333435363738- <1> UTIL_HEX_DIGITS			DB '0123456789ABCDEF'
   554 0000060C 39414243444546      <1>
   555                              <1> ; char(48+digit)
   556                                  %include "dma.inc"
   557                              <1> 
   558                              <1> ;                    DMA Channel   Page    Address  Count
   559                              <1> ;                    ------------------------------------
   560                              <1> ;                         0         87h       0h      1h
   561                              <1> ;                         1         83h       2h      3h
   562                              <1> ;                         2         81h       4h      5h
   563                              <1> ;                         3         82h       6h      7h
   564                              <1> ;                         4         8Fh      C0h     C2h
   565                              <1> ;                         5         8Bh      C4h     C6h
   566                              <1> ;                         6         89h      C8h     CAh
   567                              <1> ;                         7         8Ah      CCh     CEh
   568                              <1> ;
   569                              <1> ;      (Note: Channels 4-7 are 16-bit DMA channels.  See below for more info.)
   570                              <1> 
   571                              <1> ;
   572                              <1> ; REGISTER (08h/D0h)
   573                              <1> ;
   574                              <1> ; Status Register
   575                              <1> ; 7-bit -> (1=DMA request/0=no DMA request) of channel (3/7)
   576                              <1> ; 6-bit -> (1=DMA request/0=no DMA request) of channel (2/6)
   577                              <1> ; 5-bit -> (1=DMA request/0=no DMA request) of channel (1/5)
   578                              <1> ; 4-bit -> (1=DMA request/0=no DMA request) of channel (0/4)
   579                              <1> ; 3-bit -> (1=transfer complete/0=transfer not complete) of channel (3/7)
   580                              <1> ; 2-bit -> (1=transfer complete/0=transfer not complete) of channel (2/6)
   581                              <1> ; 1-bit -> (1=transfer complete/0=transfer not complete) of channel (1/5)
   582                              <1> ; 0-bit -> (1=transfer complete/0=transfer not complete) of channel (0/4)
   583                              <1> ;
   584                              <1> ; Command Register ( byte )
   585                              <1> ; 7-bit -> 0 active low(standard)		1 active high
   586                              <1> ; 6-bit -> 0 active high(standard)		1 active low
   587                              <1> ; 5-bit -> 0 late write(standard)		1 extended write
   588                              <1> ; 4-bit -> 0 rotating priority			1 fixed priority(standard)
   589                              <1> ; 3-bit -> 0 normal mode(standard)		1 compressed mode
   590                              <1> ; 2-bit -> 0 DMA controller enabled		1 DMA controller disabled
   591                              <1> ; 1-bit -> 0 Address Hold disabled(standard) 	1 Address Hold enabled
   592                              <1> ; 0-bit -> 0 No (from/to)Memory transfer(standard)  1 (from/to)Memory transfer  
   593                              <1> ; For Memory-to-Memory transfers only channels 0(source) and 1(target) 
   594                              <1> ; are available 
   595                              <1> ;
   596                              <1> 
   597                              <1> %macro DMA_status	1
   598                              <1> xor dx, dx
   599                              <1> mov dl, [DMA_COMMAND_REGISTER]
   600                              <1> in al, dx
   601                              <1> mov %1, al
   602                              <1> %endmacro
   603                              <1> 
   604                              <1> %macro DMA_command	1
   605                              <1> xor dx, dx
   606                              <1> mov dl, [DMA_COMMAND_REGISTER]
   607                              <1> mov al, %1
   608                              <1> out dx, al
   609                              <1> %endmacro
   610                              <1> 
   611                              <1> %macro DMA_disable	0
   612                              <1> DMA_command 	00010100b 
   613                              <1> %endmacro
   614                              <1> 
   615                              <1> %macro DMA_enable	0
   616                              <1> DMA_command	00010000b 
   617                              <1> %endmacro
   618                              <1> 
   619                              <1> ;DMA Write Request Register (09h/D2h):
   620                              <1> ;==================================
   621                              <1> ;
   622                              <1> ;    MSB                             LSB
   623                              <1> ;      x   x   x   x     x   x   x   x
   624                              <1> ;      -------------------   -   -----
   625                              <1> ;               |            |     |     00 - Select channel 0
   626                              <1> ;               |            |     \---- 01 - Select channel 1
   627                              <1> ;               |            |           10 - Select channel 2
   628                              <1> ;               |            |           11 - Select channel 3
   629                              <1> ;               |            |
   630                              <1> ;               |            \----------  0 - Device turn it on
   631                              <1> ;               |                         1 - Needs to be turned on
   632                              <1> ;               |                             (when memory-to-memory)
   633                              <1> ;               \----------------------- xx - Don't care
   634                              <1> ;
   635                              <1> 
   636                              <1> %macro DMA_request	1
   637                              <1> xor dx, dx
   638                              <1> mov dl, [DMA_REQUEST_REGISTER]
   639                              <1> mov al, %1
   640                              <1> out dx, al
   641                              <1> %endmacro
   642                              <1> 
   643                              <1> ;Mask Register (0Ah/D4h):
   644                              <1> ;=====================
   645                              <1> ;
   646                              <1> ;    MSB                             LSB
   647                              <1> ;      x   x   x   x     x   x   x   x
   648                              <1> ;      -------------------   -   -----
   649                              <1> ;               |            |     |     00 - Select channel 0/4 mask bit
   650                              <1> ;               |            |     \---- 01 - Select channel 1/5 mask bit
   651                              <1> ;               |            |           10 - Select channel 2/6 mask bit
   652                              <1> ;               |            |           11 - Select channel 3/7 mask bit
   653                              <1> ;               |            |
   654                              <1> ;               |            \----------  0 - Clear mask bit
   655                              <1> ;               |                         1 - Set mask bit
   656                              <1> ;               |
   657                              <1> ;               \----------------------- xx - Don't care
   658                              <1> ;
   659                              <1> 
   660                              <1> %macro DMA_mask		0
   661                              <1> xor dx, dx
   662                              <1> mov dl, [DMA_MASK_REGISTER]
   663                              <1> out dx, al
   664                              <1> %endmacro
   665                              <1> 
   666                              <1> %macro DMA_disable_channel	1
   667                              <1> mov al, %1
   668                              <1> or al, 0x04
   669                              <1> DMA_mask	
   670                              <1> %endmacro
   671                              <1> 
   672                              <1> %macro DMA_enable_channel	1
   673                              <1> mov al, %1
   674                              <1> DMA_mask
   675                              <1> %endmacro
   676                              <1> 
   677                              <1> %macro DMA_set_mode	4
   678                              <1> mov al, 0
   679                              <1> or al, %1
   680                              <1> or al, %2
   681                              <1> or al, %3
   682                              <1> or al, %4
   683                              <1> or al, [DMA_CHANNEL]
   684                              <1> mov [DMA_MODE], al
   685                              <1> %endmacro
   686                              <1> 
   687                              <1> ;Mode Register (0Bh/D6h):
   688                              <1> ;=====================
   689                              <1> ;
   690                              <1> ;    MSB                             LSB
   691                              <1> ;      x   x   x   x     x   x   x   x
   692                              <1> ;      \---/   -   -     -----   -----
   693                              <1> ;        |     |   |       |       |     00 - Channel 0/4 select
   694                              <1> ;        |     |   |       |       \---- 01 - Channel 1/5 select
   695                              <1> ;        |     |   |       |             10 - Channel 2/6 select
   696                              <1> ;        |     |   |       |             11 - Channel 3/7 select
   697                              <1> ;        |     |   |       |
   698                              <1> ;        |     |   |       |             00 - Verify transfer
   699                              <1> ;        |     |   |       \------------ 01 - Write transfer
   700                              <1> ;        |     |   |                     10 - Read transfer
   701                              <1> ;        |     |   |
   702                              <1> ;        |     |   \-------------------- 0 - Non-autoinitialized
   703                              <1> ;        |     |                         1 - Autoinitialized 
   704                              <1> ;        |     |                         
   705                              <1> ;        |     \------------------------  0 - Address increment select
   706                              <1> ;        |
   707                              <1> ;        |                               00 - Demand mode
   708                              <1> ;        \------------------------------ 01 - Single mode
   709                              <1> ;                                        10 - Block mode
   710                              <1> ;					 11 - Cascade mode
   711                              <1> ;
   712                              <1> 
   713                              <1> %macro DMA_mode		1
   714                              <1> xor dx, dx
   715                              <1> mov dl, [DMA_MODE_REGISTER]
   716                              <1> mov al, %1
   717                              <1> out dx, al
   718                              <1> %endmacro
   719                              <1> 
   720                              <1> ;DMA clear selected channel (0Ch/D8h):
   721                              <1> ;==================================
   722                              <1> ;
   723                              <1> ;    Outputting a zero to this port stops all DMA processes that are currently
   724                              <1> ;happening as selected by the mask register(0Ah/D4h).
   725                              <1> ;
   726                              <1> 
   727                              <1> %macro DMA_clear	1
   728                              <1> xor dx, dx
   729                              <1> mov dl, [DMA_CLEAR_REGISTER]
   730                              <1> mov al, %1
   731                              <1> mov ax, 0
   732                              <1> out dx, ax 
   733                              <1> %endmacro
   734                              <1> 
   735                              <1> %macro DMA_page		1
   736                              <1> xor dx, dx
   737                              <1> mov dl, [DMA_PAGE_REGISTER]
   738                              <1> mov eax, %1
   739                              <1> shr eax, 16
   740                              <1> ;;;and eax, 0xFF ; get 8-bit segment(page) value
   741                              <1> out dx, al
   742                              <1> %endmacro
   743                              <1> 
   744                              <1> %macro DMA_address	1
   745                              <1> xor dx, dx
   746                              <1> mov dl, [DMA_ADDRESS_REGISTER]
   747                              <1> mov eax, %1
   748                              <1> ;;;and eax, 0xFFFF ; get 16-bit offset value
   749                              <1> out dx, al
   750                              <1> mov al, ah
   751                              <1> out dx, al
   752                              <1> %endmacro
   753                              <1> 
   754                              <1> %macro DMA_count	1
   755                              <1> xor dx, dx
   756                              <1> mov dl, [DMA_COUNT_REGISTER]
   757                              <1> mov ax, %1
   758                              <1> dec ax
   759                              <1> out dx, al
   760                              <1> mov al, ah
   761                              <1> out dx, al
   762                              <1> %endmacro
   763                              <1> 
   764                              <1> %macro DMA_set_registers        1
   765                              <1> mov esi, DMA_REGISTERS
   766                              <1> mov eax, 3
   767                              <1> xor ebx, ebx
   768                              <1> mov bl, %1
   769                              <1> mul ebx
   770                              <1> add esi, eax
   771                              <1> mov al, byte [ds:esi]
   772                              <1> mov [DMA_ADDRESS_REGISTER], al
   773                              <1> mov al, byte [ds:esi+1]
   774                              <1> mov [DMA_COUNT_REGISTER], al
   775                              <1> mov al, byte [ds:esi+2]
   776                              <1> mov [DMA_PAGE_REGISTER], al
   777                              <1> ;;; DMA 1 (8-bit)
   778                              <1> mov byte [DMA_COMMAND_REGISTER], 0x08
   779                              <1> mov byte [DMA_REQUEST_REGISTER], 0x09
   780                              <1> mov byte [DMA_MASK_REGISTER], 0x0A
   781                              <1> mov byte [DMA_MODE_REGISTER], 0x0B
   782                              <1> mov byte [DMA_CLEAR_REGISTER], 0x0C
   783                              <1> cmp bl, 4
   784                              <1> jl %%skip_set
   785                              <1> ;;; DMA 2 (16-bit)
   786                              <1> mov byte [DMA_COMMAND_REGISTER], 0xD0
   787                              <1> mov byte [DMA_REQUEST_REGISTER], 0xD2
   788                              <1> mov byte [DMA_MASK_REGISTER], 0xD4
   789                              <1> mov byte [DMA_MODE_REGISTER], 0xD6
   790                              <1> mov byte [DMA_CLEAR_REGISTER], 0xD8
   791                              <1> sub byte [DMA_CHANNEL], 0x04
   792                              <1> %%skip_set:
   793                              <1> %endmacro
   794                              <1> 
   795                              <1> ; CHARNEL
   796                              <1> ; BUFFER ADDRESS
   797                              <1> ; BUFFER LENGTH
   798                              <1> %macro DMA_setup	3
   799                              <1> mov al, %1
   800                              <1> mov [DMA_CHANNEL], al 
   801                              <1> mov eax, %2
   802                              <1> mov [DMA_BUFFER_ADDRESS], eax
   803                              <1> mov eax, %3
   804                              <1> mov [DMA_BUFFER_LENGTH], eax
   805                              <1> DMA_set_registers	[DMA_CHANNEL]	; Set register ports
   806                              <1> DMA_set_mode		DMA_MODE_SINGLE, DMA_ADDRESS_INCREMENT, DMA_SINGLE_CYCLE, DMA_TRANSFER_WRITE
   807                              <1> ; DMA_MODE_BLOCK
   808                              <1> ; DMA_AUTO_INIT => sound card
   809                              <1> cli					; Disable interrupts
   810                              <1> DMA_status      	[DMA_STATE1]
   811                              <1> ;DMA_disable				; Disable DMA 8237A
   812                              <1> DMA_disable_channel	[DMA_CHANNEL]	; Disable channel
   813                              <1> DMA_mode		[DMA_MODE]	; Set DMA mode
   814                              <1> DMA_clear		0		; Clear flip-flop (support 16-bit)
   815                              <1> DMA_address		[DMA_BUFFER_ADDRESS] 	; set address
   816                              <1> DMA_page		[DMA_BUFFER_ADDRESS] 	; set page
   817                              <1> DMA_count		[DMA_BUFFER_LENGTH]	; set length (max. 65536)
   818                              <1> DMA_enable_channel	[DMA_CHANNEL]	; Enable channel
   819                              <1> DMA_enable				; Enable DMA 8237A
   820                              <1> DMA_status      	[DMA_STATE2]
   821                              <1> sti					; Enable Interrupts
   822                              <1> %endmacro
   823                              <1> 
   824                              <1> ; before
   825                              <1> ; 00000100
   826                              <1> ; after
   827                              <1> ; 00000000 ; channel 2 busy
   828                              <1> ;
   829                              <1> ;==============================================================================
   830                              <1> ; DMA 8237A (Direct Memory Access)
   831                              <1> ;==============================================================================
   832 00000613 00000000            <1> DMA_BUFFER_ADDRESS	DD	0		; 20-bit address
   833 00000617 00000000            <1> DMA_BUFFER_LENGTH	DD	0
   834 0000061B 00                  <1> DMA_CHANNEL		DB	0
   835 0000061C 00                  <1> DMA_MODE		DB	0
   836 0000061D 00                  <1> DMA_STATE1		DB	0
   837 0000061E 00                  <1> DMA_STATE2		DB	0
   838                              <1> ;;; SPECIFIC REGISTERS
   839 0000061F 00                  <1> DMA_ADDRESS_REGISTER	DB	0
   840 00000620 00                  <1> DMA_COUNT_REGISTER	DB	0
   841 00000621 00                  <1> DMA_PAGE_REGISTER	DB	0
   842                              <1> ;;; GENERIC REGISTERS
   843 00000622 00                  <1> DMA_COMMAND_REGISTER	DB	0
   844 00000623 00                  <1> DMA_REQUEST_REGISTER	DB	0
   845 00000624 00                  <1> DMA_MASK_REGISTER	DB	0
   846 00000625 00                  <1> DMA_MODE_REGISTER	DB	0
   847 00000626 00                  <1> DMA_CLEAR_REGISTER	DB	0
   848                              <1> ;			ADDRESS	COUNT	PAGE
   849                              <1> DMA_REGISTERS:
   850 00000627 000187              <1> 		DB	0x00,	0x01,	0x87		; CHANNEL 0
   851 0000062A 020383              <1> 		DB	0x02,	0x03, 	0x83		; CHANNEL 1
   852 0000062D 040581              <1> 		DB	0x04,	0x05,	0x81		; CHANNEL 2
   853 00000630 060782              <1> 		DB	0x06,	0x07,	0x82		; CHANNEL 3
   854 00000633 C0C28F              <1> 		DB	0xC0,	0xC2,	0x8F		; CHANNEL 4
   855 00000636 C4C68B              <1> 		DB	0xC4,	0xC6,	0x8B		; CHANNEL 5
   856 00000639 C8CA89              <1> 		DB	0xC8,	0xCA,	0x89		; CHANNEL 6
   857 0000063C CCCE8A              <1> 		DB	0xCC,	0xCE,	0x8A		; CHANNEL 7
   858                              <1> 
   859                              <1> ; Mode Selection (bits 7:6)
   860                              <1> DMA_MODE_DEMAND		equ	0		; 00
   861                              <1> DMA_MODE_SINGLE		equ	64		; 01
   862                              <1> DMA_MODE_BLOCK		equ	128		; 10
   863                              <1> DMA_MODE_CASCADE	equ	192		; 11
   864                              <1> 
   865                              <1> ; Address Increment/Decrement (bit 5)
   866                              <1> DMA_ADDRESS_INCREMENT	equ	0		; 0
   867                              <1> DMA_ADDRESS_DECREMENT	equ	32		; 1
   868                              <1> 
   869                              <1> ; AutoInitialization enable (bit 4)
   870                              <1> DMA_SINGLE_CYCLE	equ	0		; 0
   871                              <1> DMA_AUTO_INIT		equ	16		; 1
   872                              <1> 
   873                              <1> ; Transfer Type (bits 3:2)
   874                              <1> DMA_TRANSFER_VERIFY	equ	0		; 00
   875                              <1> DMA_TRANSFER_WRITE	equ	4		; 01
   876                              <1> DMA_TRANSFER_READ	equ	8		; 10
   877                              <1> 
   878                              <1> ;=============================================================================
   879                                  %include "pic.inc"
   880                              <1> 
   881                              <1> %macro PIC_init1	1
   882                              <1> mov al, %1				; bit0 = 1, init4 is espected?
   883                              <1> 					; bit1 = 0, cascaded PIC's?
   884                              <1> 					; bit2..3 = 0
   885                              <1> 					; bit4 = 1
   886                              <1> 					; bit5..7 = 0
   887                              <1> out PIC_MASTER_PORT0,al
   888                              <1> out PIC_SLAVE_PORT0,al
   889                              <1> %endmacro
   890                              <1> 
   891                              <1> ; set base vector number for IRQ's
   892                              <1> %macro PIC_init2	2
   893                              <1> mov al, %1				; bit0..2 = 0
   894                              <1> 					; bit3..7 = address of IRQ0 in IDT
   895                              <1> 					;           desc (multiple of 8h)
   896                              <1> 					; for IRQn = INT (desc+n) is called 
   897                              <1> out PIC_MASTER_PORT1,al			; For master PIC
   898                              <1> mov al, %2				; bit3..7 = address of IRQ8 in IDT
   899                              <1> out PIC_SLAVE_PORT1,al			; For slave PIC
   900                              <1> %endmacro
   901                              <1> 
   902                              <1> ; if bit 1 of init1 was cleared,
   903                              <1> ; establish the connection between the PIC's
   904                              <1> %macro PIC_init3	2
   905                              <1> mov al, %1				; bitn = 0, IRQn connected to peripheral
   906                              <1> 					; bitn = 1, IRQn connected to Slave PIC
   907                              <1> 					; IRQ2 usually connected to Slave PIC
   908                              <1> 					
   909                              <1> out PIC_MASTER_PORT1,al
   910                              <1> mov al, %2				; bit0..2 = IRQ Number of the master
   911                              <1> 					; to which the slave is connected
   912                              <1> 					; usually IRQ Number 2
   913                              <1> 					; bit3..7 = 0
   914                              <1> out PIC_SLAVE_PORT1,al
   915                              <1> %endmacro
   916                              <1> 
   917                              <1> ; if bit 0 of init1 was set
   918                              <1> %macro PIC_init4	1
   919                              <1> mov al, %1				; bit0 = 1, working on 80x86 CPU?
   920                              <1> 					; bit1 = 0, manual EOI
   921                              <1> 					; End of Interruption by Software?
   922                              <1> 					; bit2..7 = 0
   923                              <1> out PIC_MASTER_PORT1,al
   924                              <1> out PIC_SLAVE_PORT1,al
   925                              <1> %endmacro
   926                              <1> 
   927                              <1> %macro PIC_master_set_irqs	1
   928                              <1> mov al, %1				; bitn = 0, IRQn enabled?
   929                              <1> 					; with IRQ2 also Slave PIC is set!
   930                              <1> out PIC_MASTER_PORT1,al			
   931                              <1> %endmacro
   932                              <1> 
   933                              <1> %macro PIC_slave_set_irqs	1
   934                              <1> mov al, %1				; bitn = 0, IRQn enabled?
   935                              <1> out PIC_SLAVE_PORT1,al
   936                              <1> %endmacro
   937                              <1> 
   938                              <1> %macro PIC_master_get_irqs	1
   939                              <1> in al, PIC_MASTER_PORT1
   940                              <1> mov %1, al				; bitn = 0, IRQn enabled?
   941                              <1> 					; with IRQ2 also Slave PIC is set!
   942                              <1> %endmacro
   943                              <1> 
   944                              <1> %macro PIC_slave_get_irqs	1
   945                              <1> in al, PIC_SLAVE_PORT1
   946                              <1> mov %1, al				; bitn = 0, IRQn enabled?
   947                              <1> %endmacro
   948                              <1> 
   949                              <1> ; for manual EOI from the Interrupt Routine
   950                              <1> ; send a "End of Interrupt" command to the PIC
   951                              <1> %macro PIC_eoi_cmd		0
   952                              <1> mov al, 0x20				; EOI Command
   953                              <1> out PIC_SLAVE_PORT0,al			; when IRQ comes from slave PIC
   954                              <1> out PIC_MASTER_PORT0,al			; when IRQ comes from master PIC
   955                              <1> ; the two cases have to be done, when the IRQ comes from slave PIC,
   956                              <1> ; since the IRQ of the slave are sent through IRQ2 of the master
   957                              <1> %endmacro
   958                              <1> 
   959                              <1> PIC_setup:
   960                              <1> PIC_init1	00010001b
   961 0000063F B011                <2> mov al, %1
   962                              <2> 
   963                              <2> 
   964                              <2> 
   965                              <2> 
   966 00000641 E620                <2> out PIC_MASTER_PORT0,al
   967 00000643 E6A0                <2> out PIC_SLAVE_PORT0,al
   968                              <1> ; IRQ0 = IDT Entry 32
   969                              <1> PIC_init2	00100000b, 00101000b
   970 00000645 B020                <2> mov al, %1
   971                              <2> 
   972                              <2> 
   973                              <2> 
   974 00000647 E621                <2> out PIC_MASTER_PORT1,al
   975 00000649 B028                <2> mov al, %2
   976 0000064B E6A1                <2> out PIC_SLAVE_PORT1,al
   977                              <1> PIC_init3	00000100b, 00000010b
   978 0000064D B004                <2> mov al, %1
   979                              <2> 
   980                              <2> 
   981                              <2> 
   982 0000064F E621                <2> out PIC_MASTER_PORT1,al
   983 00000651 B002                <2> mov al, %2
   984                              <2> 
   985                              <2> 
   986                              <2> 
   987 00000653 E6A1                <2> out PIC_SLAVE_PORT1,al
   988                              <1> PIC_init4	00000001b
   989 00000655 B001                <2> mov al, %1
   990                              <2> 
   991                              <2> 
   992                              <2> 
   993 00000657 E621                <2> out PIC_MASTER_PORT1,al
   994 00000659 E6A1                <2> out PIC_SLAVE_PORT1,al
   995                              <1> ; Disable all IRQ's except Timer IRQ0, Keyboard IRQ1, Floppy IRQ6 and RTC IRQ8
   996                              <1> PIC_master_set_irqs	10111000b
   997 0000065B B0B8                <2> mov al, %1
   998                              <2> 
   999 0000065D E621                <2> out PIC_MASTER_PORT1,al
  1000                              <1> PIC_slave_set_irqs	11111110b
  1001 0000065F B0FE                <2> mov al, %1
  1002 00000661 E6A1                <2> out PIC_SLAVE_PORT1,al
  1003 00000663 CB                  <1> retf
  1004                              <1> 
  1005                              <1> ;=======================================================================;
  1006                              <1> ; PIC-8259 (Programmable Interrupt Controller)				;
  1007                              <1> ;=======================================================================;
  1008                              <1> PIC_MASTER_PORT0	equ	0x20
  1009                              <1> PIC_MASTER_PORT1	equ	0x21
  1010                              <1> PIC_SLAVE_PORT0		equ	0xA0
  1011                              <1> PIC_SLAVE_PORT1		equ	0xA1
  1012                              <1> 
  1013                              <1> 
  1014                                  %include "floppy.inc"
  1015                              <1> ;NEC PD765  -  Floppy Disk Controller  -  8272A
  1016                              <1> ;
  1017                              <1> ;       PS/2 FDC Diskette Status Register A at 3F0h
  1018                              <1> ;
  1019                              <1> ;        76543210  3F0h  PS/2 Disk Status Register A (read-only)
  1020                              <1> ;                 direction
  1021                              <1> ;                write protect
  1022                              <1> ;               index
  1023                              <1> ;              head 1 select
  1024                              <1> ;             track 0
  1025                              <1> ;            step
  1026                              <1> ;           second drive installed
  1027                              <1> ;          interrupt pending
  1028                              <1> ;
  1029                              <1> ;       PS/2 FDC Diskette Status Register B at 3F1h
  1030                              <1> ;
  1031                              <1> ;        76543210  3F1h  PS/2 Disk Status Register B (read-only)
  1032                              <1> ;                 motor enable 0
  1033                              <1> ;                motor enable 1
  1034                              <1> ;               write enable
  1035                              <1> ;              read data (toggles w/positive transition in -RD DATA)
  1036                              <1> ;             write data (toggles w/positive transition in WR DATA)
  1037                              <1> ;            drive select
  1038                              <1> ;          reserved
  1039                              <1> ;
  1040                              <1> ;       FDC Digital Output Register at 3F2h  (all systems)
  1041                              <1> ;
  1042                              <1> ;        76543210  port 3F2h  (write only)
  1043                              <1> ;                floppy drive select (0=A, 1=B, 2=floppy C, ...)
  1044                              <1> ;               1 = FDC enable, 0 = hold FDC at reset
  1045                              <1> ;              1 = DMA & I/O interface enabled  (reserved PS/2)
  1046                              <1> ;             1 = turn floppy drive A motor on
  1047                              <1> ;            1 = turn floppy drive B motor on
  1048                              <1> ;           1 = turn floppy drive C motor on; (reserved PS/2)
  1049                              <1> ;          1 = turn floppy drive D motor on; (reserved PS/2)
  1050                              <1> ;
  1051                              <1> ;        - used to control drive motors, drive selection, and feature enable
  1052                              <1> ;        - PS/2 only uses bit 0 for floppy drive select; bit 1 is reserved
  1053                              <1> ;        - PS/2 only uses bits 5 & 4 for  motor enable; bits 7&6 are reserved
  1054                              <1> ;        - all DOR bits are cleared during controller reset
  1055                              <1> ;
  1056                              <1> ;       FDC Main Status Register at 3F4h  (all systems)
  1057                              <1> ;
  1058                              <1> ;        76543210  port 3F4h  (read only)
  1059                              <1> ;                 floppy drive 0 in seek mode/busy
  1060                              <1> ;                floppy drive 1 in seek mode/busy
  1061                              <1> ;               floppy drive 2 in seek mode/busy (reserved PS/2)
  1062                              <1> ;              floppy drive 3 in seek mode/busy (reserved PS/2)
  1063                              <1> ;             FDC read or write command in progress
  1064                              <1> ;            FDC is in non-DMA mode
  1065                              <1> ;           I/O direction;  1 = FDC to CPU; 0 = CPU to FDC
  1066                              <1> ;          data reg ready for I/O to/from CPU (request for master)
  1067                              <1> ;
  1068                              <1> ;       FDC Command Status Register 0 at 3F5h  (all systems)
  1069                              <1> ;
  1070                              <1> ;        76543210  Command Status Register 0 at port 3F5h
  1071                              <1> ;                unit selected at interrupt (0=A, 1=B, 2=...)
  1072                              <1> ;               head number at interrupt (head 0 or 1)
  1073                              <1> ;              not ready on read/write or SS access to head 1
  1074                              <1> ;             equipment check (see note)
  1075                              <1> ;            set to 1 when FDD completes a seek command
  1076                              <1> ;          last command status (see below)
  1077                              <1> ;
  1078                              <1> ;        Bits
  1079                              <1> ;         76  Last Command Status
  1080                              <1> ;         00  command terminated successfully
  1081                              <1> ;         01  command execution started but terminated abnormally
  1082                              <1> ;         10  invalid command issued
  1083                              <1> ;         11  command terminated abnormally due to a change in state of
  1084                              <1> ;             the Ready Signal from the FDC  (reserved on PS/2)
  1085                              <1> ;
  1086                              <1> ;        - equipment check can occur if FDD signals a fault or track zero is
  1087                              <1> ;          not found after 77 steps on a recalibrate command
  1088                              <1> ;        - PS/2 only uses bits 1-0 for drive (values are 01b and 10b)
  1089                              <1> ;
  1090                              <1> ;        FDC Command Status Register 1 at 3F5h  (all systems)
  1091                              <1> ;
  1092                              <1> ;        76543210  Command Status Register 1 at port 3F5h
  1093                              <1> ;                 FDC cannot find ID address mark (see reg 2)
  1094                              <1> ;                write protect detected during write
  1095                              <1> ;               FDC cannot find sector ID
  1096                              <1> ;              unused (always zero)
  1097                              <1> ;             over-run;  FDC not serviced in reasonable time
  1098                              <1> ;            data error (CRC) in ID field or data field
  1099                              <1> ;           unused (always zero)
  1100                              <1> ;          end of cylinder; sector# greater than sectors/track
  1101                              <1> ;
  1102                              <1> ;        - bit 0 of Status Register 1 and bit 4 of Status Register 2 are
  1103                              <1> ;          related and mimic each other
  1104                              <1> ;
  1105                              <1> ;        FDC Command Status Register 2 at 3F5h  (all systems)
  1106                              <1> ;
  1107                              <1> ;        76543210  Command Status Register 2 at port 3F5h
  1108                              <1> ;                 missing address mark in data field
  1109                              <1> ;                bad cylinder, ID not found and Cyl Id=FFh
  1110                              <1> ;               scan command failed, sector not found in cylinder
  1111                              <1> ;              scan command equal condition satisfied
  1112                              <1> ;             wrong cylinder detected
  1113                              <1> ;            CRC error detected in sector data
  1114                              <1> ;           sector with deleted data address mark detected
  1115                              <1> ;          unused (always zero)
  1116                              <1> ;
  1117                              <1> ;        - bit 0 of Status Register 1 and bit 4 of Status Register 2 are
  1118                              <1> ;          related and mimic each other
  1119                              <1> ;
  1120                              <1> ;        FDC Command Status Register 3 at 3F5h (FDD status, all systems)
  1121                              <1> ;
  1122                              <1> ;        76543210  Floppy Disk Drive Status at port 3F5h
  1123                              <1> ;                FDD unit selected status (0=A, 1=B, 2=...)
  1124                              <1> ;               FDD side head select status (0=head 0, 1=head 1)
  1125                              <1> ;              FDD two sided status signal
  1126                              <1> ;             FDD track zero status signal
  1127                              <1> ;            FDD ready status signal
  1128                              <1> ;           FDD write protect status signal
  1129                              <1> ;          FDD fault status signal
  1130                              <1> ;
  1131                              <1> ;        PS/2 FDC Digital Input Register at 3F7h
  1132                              <1> ;
  1133                              <1> ;        76543210  3F7h  PS/2 Digital Input Register (read only)
  1134                              <1> ;                 high density select
  1135                              <1> ;           reserved
  1136                              <1> ;          diskette change
  1137                              <1> ;
  1138                              <1> ;        PS/2 FDC Configuration Control Register at 3F7h
  1139                              <1> ;
  1140                              <1> ;        76543210  3F7h  PS/2 Config. Control Register (write only)
  1141                              <1> ;                DRC1, DRC0  (see below)
  1142                              <1> ;          reserved
  1143                              <1> ;
  1144                              <1> ;        DRC1 DRC0
  1145                              <1> ;          0   0    500000 bit per second mode
  1146                              <1> ;          0   1    reserved
  1147                              <1> ;          1   0    250000 bit per second mode
  1148                              <1> ;          1   1    reserved
  1149                              <1> ;
  1150                              <1> ;        - Digital Input Register is used to sense the state of the
  1151                              <1> ;          (-diskette change) and the (-high density select) signals
  1152                              <1> ;        - Configuration Control Register is used to set the transfer rate
  1153                              <1> ;
  1154                              <1> ;
  1155                              <1> ;FDC Programming Considerations
  1156                              <1> ;
  1157                              <1> ;        Three phases of command execution:
  1158                              <1> ;
  1159                              <1> ;        1.  Command phase; commands are sent from the CPU to the FDC via
  1160                              <1> ;            port 3F5h;  bit 6 of the Status Register at 3F4h must be zero
  1161                              <1> ;        2.  Execution phase; FDC executes instruction & generates INT 6
  1162                              <1> ;        3.  Result phase; status and other information is available to CPU;
  1163                              <1> ;            INT 6 sets bit 7 of BIOS Data Area location 40:3E which can
  1164                              <1> ;            be polled for completion status
  1165                              <1> ;
  1166                              <1> ;
  1167                              <1> ;        Example of a read operation:
  1168                              <1> ;
  1169                              <1> ;        1. turn disk motor on and set delay time for drive spin up
  1170                              <1> ;        2. perform seek operation;  wait for disk interrupt
  1171                              <1> ;        3. prepare DMA chip to move data to memory
  1172                              <1> ;        4. send read command and wait for transfer complete interrupt
  1173                              <1> ;        5. read status information
  1174                              <1> ;        6. turn disk motor off
  1175                              <1> ;
  1176                              <1> ;Floppy Diskette Controller Operations (15 commands)
  1177                              <1> ;
  1178                              <1> ;        Read Data          D7  D6  D5  D4  D3  D2  D1  D0
  1179                              <1> ;
  1180                              <1> ;        command byte 0:    MT  MF  SK   0   0   1   1   0
  1181                              <1> ;        command byte 1:     ?   ?   ?   ?   ?  HD  US1 US0
  1182                              <1> ;        command byte 2:    cylinder number
  1183                              <1> ;        command byte 3:    head number
  1184                              <1> ;        command byte 4:    sector number
  1185                              <1> ;        command byte 5:    bytes per sector
  1186                              <1> ;        command byte 6:    end of track (last sector in track)
  1187                              <1> ;        command byte 7:    gap 3 length
  1188                              <1> ;        command byte 8:    data length (if cmd byte 5==0)
  1189                              <1> ;        result byte 0:     status register 0
  1190                              <1> ;        result byte 1:     status register 1
  1191                              <1> ;        result byte 2:     status register 2
  1192                              <1> ;        result byte 3:     cylinder number
  1193                              <1> ;        result byte 4:     head number
  1194                              <1> ;        result byte 5:     sector number
  1195                              <1> ;        result byte 6:     bytes per sector
  1196                              <1> ;
  1197                              <1> ;        Write Data         D7  D6  D5  D4  D3  D2  D1  D0
  1198                              <1> ;
  1199                              <1> ;        command byte 0:    MT  MF   0   0   0   1   0   1
  1200                              <1> ;        command byte 1:     ?   ?   ?   ?   ?  HD  US1 US0
  1201                              <1> ;        command byte 2:    cylinder number
  1202                              <1> ;        command byte 3:    head number
  1203                              <1> ;        command byte 4:    sector number
  1204                              <1> ;        command byte 5:    bytes per sector
  1205                              <1> ;        command byte 6:    end of track (last sector in track)
  1206                              <1> ;        command byte 7:    gap 3 length
  1207                              <1> ;        command byte 8:    data length (if cmd byte 5==0)
  1208                              <1> ;        result byte 0:     status register 0
  1209                              <1> ;        result byte 1:     status register 1
  1210                              <1> ;        result byte 2:     status register 2
  1211                              <1> ;        result byte 3:     cylinder number
  1212                              <1> ;        result byte 4:     head number
  1213                              <1> ;        result byte 5:     sector number
  1214                              <1> ;        result byte 6:     bytes per sector
  1215                              <1> ;
  1216                              <1> ;        Read a Track       D7  D6  D5  D4  D3  D2  D1  D0
  1217                              <1> ;        (Diagnostic)
  1218                              <1> ;        command byte 0:     0  MF  SK   0   0   0   1   0
  1219                              <1> ;        command byte 1:     ?   ?   ?   ?   ?  HD  US1 US0
  1220                              <1> ;        command byte 2:    cylinder number
  1221                              <1> ;        command byte 3:    head number
  1222                              <1> ;        command byte 4:    sector number
  1223                              <1> ;        command byte 5:    bytes per sector
  1224                              <1> ;        command byte 6:    end of track (last sector in track)
  1225                              <1> ;        command byte 7:    gap 3 length
  1226                              <1> ;        command byte 8:    data length (if cmd byte 5==0)
  1227                              <1> ;        result byte 0:     status register 0
  1228                              <1> ;        result byte 1:     status register 1
  1229                              <1> ;        result byte 2:     status register 2
  1230                              <1> ;        result byte 3:     cylinder number
  1231                              <1> ;        result byte 4:     head number
  1232                              <1> ;        result byte 5:     sector number
  1233                              <1> ;        result byte 6:     bytes per sector
  1234                              <1> ;
  1235                              <1> ;        Format a Track     D7  D6  D5  D4  D3  D2  D1  D0
  1236                              <1> ;        (Write Sector IDs)
  1237                              <1> ;        command byte 0:     0  MF   0   0   1   1   0   1
  1238                              <1> ;        command byte 1:     ?   ?   ?   ?   ?  HD  US1 US0
  1239                              <1> ;        command byte 2:    bytes per sector
  1240                              <1> ;        command byte 3:    sectors per track
  1241                              <1> ;        command byte 4:    gap 3 length
  1242                              <1> ;        command byte 5:    filler pattern to write in each byte
  1243                              <1> ;        result byte 0:     status register 0
  1244                              <1> ;        result byte 1:     status register 1
  1245                              <1> ;        result byte 2:     status register 2
  1246                              <1> ;        result byte 3:     cylinder number
  1247                              <1> ;        result byte 4:     head number
  1248                              <1> ;        result byte 5:     sector number
  1249                              <1> ;        result byte 6:     bytes per sector
  1250                              <1> ;
  1251                              <1> ;        Recalibrate        D7  D6  D5  D4  D3  D2  D1  D0
  1252                              <1> ;
  1253                              <1> ;        command byte 0:     0   0   0   0   0   1   1   1
  1254                              <1> ;        command byte 1:     ?   ?   ?   ?   ?   0  US1 US0
  1255                              <1> ;	 returns nothing
  1256                              <1> ;
  1257                              <1> ;        Seek               D7  D6  D5  D4  D3  D2  D1  D0
  1258                              <1> ;
  1259                              <1> ;        command byte 0:     0   0   0   0   1   1   1   1
  1260                              <1> ;        command byte 1:     ?   ?   ?   ?   ?  HD  US1 US0
  1261                              <1> ;        command byte 2:    new cylinder number
  1262                              <1> ;        returns nothing
  1263                              <1> ;
  1264                              <1> 
  1265                              <1> ;%include "dma.inc"
  1266                              <1> ;%include "tss.inc"
  1267                              <1> 
  1268                              <1> %macro FLOPPY_read_main_status		0
  1269                              <1> mov dx,FLOPPY_MAIN_STATUS_REGISTER
  1270                              <1> in al,dx
  1271                              <1> ; status in AL
  1272                              <1> %endmacro
  1273                              <1> 
  1274                              <1> %macro FLOPPY_digital_output_write	1
  1275                              <1> mov dx, FLOPPY_DIGITAL_OUTPUT_REGISTER
  1276                              <1> mov al, %1
  1277                              <1> out dx, al
  1278                              <1> %endmacro
  1279                              <1> 
  1280                              <1> %macro FLOPPY_digital_input_read	0
  1281                              <1> mov dx, FLOPPY_DIGITAL_INPUT_REGISTER
  1282                              <1> in al,dx
  1283                              <1> ; status in AL
  1284                              <1> %endmacro
  1285                              <1> 
  1286                              <1> %macro FLOPPY_config_control_write	1
  1287                              <1> mov dx, FLOPPY_CONFIG_CONTROL_REGISTER
  1288                              <1> mov al, %1
  1289                              <1> out dx, al
  1290                              <1> %endmacro
  1291                              <1> 
  1292                              <1> %macro FLOPPY_wait_fdc	0	
  1293                              <1> %%wait_fdc:
  1294                              <1> FLOPPY_read_main_status
  1295                              <1> test al, 0x80	; 8th bit is set ?
  1296                              <1> jz %%wait_fdc
  1297                              <1> %endmacro
  1298                              <1> 
  1299                              <1> %macro FLOPPY_command_write	1
  1300                              <1> FLOPPY_wait_fdc
  1301                              <1> mov dx, FLOPPY_COMMAND_STATUS_REGISTER
  1302                              <1> mov al, %1
  1303                              <1> out dx, al
  1304                              <1> %endmacro
  1305                              <1> 
  1306                              <1> %macro FLOPPY_command_read	1
  1307                              <1> FLOPPY_wait_fdc
  1308                              <1> mov dx, FLOPPY_COMMAND_STATUS_REGISTER
  1309                              <1> in al, dx
  1310                              <1> mov byte [%1], al
  1311                              <1> %endmacro
  1312                              <1> 
  1313                              <1> %macro FLOPPY_turn_on	0
  1314                              <1> FLOPPY_digital_output_write	00011100b	; enable motor A, DMA, FDC, Drive A
  1315                              <1> ;FLOPPY_digital_output_write	00010100b	; enable motor A, Non-DMA, FDC, Drive A
  1316                              <1> TIMER_rtc_msdelay		1000		; Waiting while motor speeds up
  1317                              <1> %endmacro
  1318                              <1> 
  1319                              <1> %macro FLOPPY_turn_off	0
  1320                              <1> FLOPPY_digital_output_write	00001100b	; disable motor A, DMA, FDC, Drive A
  1321                              <1> ;FLOPPY_digital_output_write	00000100b	; disable motor A, Non-DMA, FDC, Drive A
  1322                              <1> TIMER_rtc_msdelay		1000		; Waiting while motor speeds up
  1323                              <1> %endmacro
  1324                              <1> 
  1325                              <1> %macro FLOPPY_calibrate	0
  1326                              <1> FLOPPY_command_write    00000111b
  1327                              <1> FLOPPY_command_write    00000000b		; (00) Drive A
  1328                              <1> FLOPPY_wait_int					; wait for interrupt
  1329                              <1> ; no result
  1330                              <1> %endmacro
  1331                              <1> 
  1332                              <1> %macro FLOPPY_seek		2
  1333                              <1> FLOPPY_command_write    00001111b	; Seek
  1334                              <1> ;FLOPPY_command_write    10001111b	; Seek Relative
  1335                              <1> FLOPPY_command_write    %1       	; Drive/Head
  1336                              <1> FLOPPY_command_write    %2       	; Cyl
  1337                              <1> FLOPPY_wait_int				; wait for interrupt
  1338                              <1> ;TIMER_rtc_msdelay		300	; delay for head positioning
  1339                              <1> ; no result
  1340                              <1> %endmacro
  1341                              <1> 
  1342                              <1> %macro FLOPPY_read_track	3
  1343                              <1> FLOPPY_seek             %1, %2
  1344                              <1> DMA_setup       2,  0x90000+(512*18*2*%2)+(512*18*%3), 512*18
  1345                              <1> ;;; COMMAND PHASE
  1346                              <1> FLOPPY_command_write    01100010b       ; M(2heads), FM, SK, READ TRACK
  1347                              <1> FLOPPY_command_write    %1		; head, drive
  1348                              <1> FLOPPY_command_write    %2            	; cylinder(track)
  1349                              <1> FLOPPY_command_write    %3            	; head 
  1350                              <1> FLOPPY_command_write    0x01            ; sector 1, not used (ignored)
  1351                              <1> FLOPPY_command_write	0x02		; bytes/sector = 512
  1352                              <1> FLOPPY_command_write	0x12		; sectors/track = 18
  1353                              <1> FLOPPY_command_write	0x1B		; GAP 3 for 1.44 = 27
  1354                              <1> FLOPPY_command_write	0xFF		; sector size is not zero
  1355                              <1> FLOPPY_wait_int				; Waiting for interrupt
  1356                              <1> ;;; RESULT PHASE (We really need this stuff!)
  1357                              <1> FLOPPY_command_read	FLOPPY_RESULT0
  1358                              <1> FLOPPY_command_read	FLOPPY_RESULT1
  1359                              <1> FLOPPY_command_read	FLOPPY_RESULT2
  1360                              <1> FLOPPY_command_read	FLOPPY_RESULT3
  1361                              <1> FLOPPY_command_read	FLOPPY_RESULT4
  1362                              <1> FLOPPY_command_read	FLOPPY_RESULT5
  1363                              <1> FLOPPY_command_read	FLOPPY_RESULT6
  1364                              <1> 
  1365                              <1> ;TIMER_rtc_msdelay		1000	; delay for head positioning
  1366                              <1> %endmacro
  1367                              <1> 
  1368                              <1> %macro FLOPPY_read_data		4	
  1369                              <1> FLOPPY_seek             %1, %2
  1370                              <1> ;;; Setup DMA before this..512*18 each time
  1371                              <1> FLOPPY_command_write 	01100110b	; FM, SK, READ DATA 
  1372                              <1> FLOPPY_command_write	%1		; head, drive
  1373                              <1> FLOPPY_command_write	%2		; cylinder(track)
  1374                              <1> FLOPPY_command_write	%3		; head
  1375                              <1> FLOPPY_command_write	%4		; sector
  1376                              <1> FLOPPY_command_write	0x02		; bytes/sector = 512
  1377                              <1> FLOPPY_command_write	0x12		; sectors/track = 18
  1378                              <1> FLOPPY_command_write	0x1B		; GAP 3 for 1.44 = 27
  1379                              <1> FLOPPY_command_write	0xFF		; sector size is not zero
  1380                              <1> FLOPPY_wait_int				; Waiting for interrupt
  1381                              <1> FLOPPY_command_read	FLOPPY_RESULT0
  1382                              <1> FLOPPY_command_read	FLOPPY_RESULT1
  1383                              <1> FLOPPY_command_read	FLOPPY_RESULT2
  1384                              <1> FLOPPY_command_read	FLOPPY_RESULT3
  1385                              <1> FLOPPY_command_read	FLOPPY_RESULT4
  1386                              <1> FLOPPY_command_read	FLOPPY_RESULT5
  1387                              <1> FLOPPY_command_read	FLOPPY_RESULT6
  1388                              <1> %endmacro
  1389                              <1> 
  1390                              <1> %macro FLOPPY_interrupt_status	0
  1391                              <1> FLOPPY_command_write 	00001000b	; check interrupt status 
  1392                              <1> FLOPPY_command_read	FLOPPY_RESULT0
  1393                              <1> FLOPPY_command_read	FLOPPY_RESULT1
  1394                              <1> %endmacro
  1395                              <1> 
  1396                              <1> %macro FLOPPY_wait_int	0
  1397                              <1> %%wait_int:				; we are waiting for interrupt event 
  1398                              <1> cmp byte [FLOPPY_INTERRUPT], 1
  1399                              <1> jne %%wait_int
  1400                              <1> mov byte [FLOPPY_INTERRUPT], 0
  1401                              <1> %endmacro
  1402                              <1> 
  1403                              <1> ;%1 START_TRACK
  1404                              <1> ;%2 START_HEAD
  1405                              <1> ;%3 START_ADDRESS
  1406                              <1> ;%4 LENGTH
  1407                              <1> %macro FLOPPY_copy_to_address	 0	
  1408                              <1> FLOPPY_turn_on                          ; Turn on A floppy drive motor
  1409                              <1> FLOPPY_config_control_write	0	; Setting Data Transfer to 500 KBits/sec
  1410                              <1> FLOPPY_calibrate			; Calibrate Command
  1411                              <1> ;;;DMA_setup       2,  0x90000, 512*18*6
  1412                              <1> FLOPPY_read_track       0, 0, 0     ; Send "Read Track" Command
  1413                              <1> FLOPPY_read_track       4, 0, 1
  1414                              <1> FLOPPY_read_track       0, 1, 0
  1415                              <1> FLOPPY_read_track       4, 1, 1
  1416                              <1> FLOPPY_read_track       0, 2, 0
  1417                              <1> FLOPPY_read_track       4, 2, 1
  1418                              <1> FLOPPY_turn_off                          ; Turn off A floppy drive motor
  1419                              <1> %endmacro
  1420                              <1> 
  1421                              <1> ; TODO: after a "read/write command" we should check 
  1422                              <1> ;       if the operation was successfull !
  1423                              <1> ;       FLOPPY_interrupt_status ST0 bit 7 and 6 = 00 when success
  1424                              <1> ;============================================================================;
  1425                              <1> ; FDC 8272A (Floppy Disk Controller)                                         ;
  1426                              <1> ;============================================================================;
  1427 00000664 00                  <1> FLOPPY_INTERRUPT		DB	0
  1428                              <1> ; "read interrupt state", "read media/drive state" commands
  1429 00000665 00                  <1> FLOPPY_RESULT0			DB	0
  1430 00000666 00                  <1> FLOPPY_RESULT1			DB	0
  1431 00000667 00                  <1> FLOPPY_RESULT2			DB	0
  1432 00000668 00                  <1> FLOPPY_RESULT3			DB	0
  1433 00000669 00                  <1> FLOPPY_RESULT4			DB	0
  1434 0000066A 00                  <1> FLOPPY_RESULT5			DB	0
  1435 0000066B 00                  <1> FLOPPY_RESULT6			DB	0
  1436 0000066C 00                  <1> FLOPPY_MAIN_STATE		DB	0
  1437                              <1> FLOPPY_MAIN_STATUS_REGISTER	equ	0x3F4
  1438                              <1> FLOPPY_COMMAND_STATUS_REGISTER	equ	0x3F5
  1439                              <1> FLOPPY_DIGITAL_OUTPUT_REGISTER	equ	0x3F2
  1440                              <1> FLOPPY_DIGITAL_INPUT_REGISTER	equ	0x3F7
  1441                              <1> FLOPPY_CONFIG_CONTROL_REGISTER	equ	0x3F7
  1442 0000066D 00                  <1> FLOPPY_TEMP_VALUE		DB	0
  1443                              <1> FLOPPY_DPT_ADDRESS		equ 0x78	; BIOS Offset
  1444                              <1> FLOPPY_DRIVE_PARAMETER_TABLE:
  1445 0000066E 00                  <1> 				DB	0	; srt_hut
  1446 0000066F 00                  <1> 				DB	0	; dma_hlt
  1447 00000670 00                  <1> 				DB	0	; motor_w
  1448 00000671 00                  <1> 				DB	0	; sec_size
  1449 00000672 00                  <1> 				DB	0	; eot
  1450 00000673 00                  <1> 				DB	0	; gap_rw
  1451 00000674 00                  <1> 				DB	0	; dtl
  1452 00000675 00                  <1> 				DB	0	; gap_f
  1453 00000676 00                  <1> 				DB	0	; fill_char
  1454 00000677 00                  <1> 				DB	0	; hst
  1455 00000678 00                  <1> 				DB	0	; mot_start
  1456 00000679 00                  <1> 				DB	0	; not used, only for help
  1457                              <1> ;===========================================================================
  1458                              <1> 
  1459                                  %include "pit.inc"
  1460                              <1> ; Put IRQ0(Timer) routine on the IDT
  1461                              <1> 
  1462                              <1> %macro PIT_write_command	1
  1463                              <1> mov al, %1
  1464                              <1> out PIT_COMMAND_PORT, al
  1465                              <1> %endmacro
  1466                              <1> 
  1467                              <1> %macro PIT_read_counter		1	
  1468                              <1> jmp short $+2		; this slow I/O on fast processors
  1469                              <1> in al, %1
  1470                              <1> ; return al
  1471                              <1> %endmacro
  1472                              <1> 
  1473                              <1> %macro PIT_write_counter	1
  1474                              <1> ; al = value
  1475                              <1> jmp short $+2		; this slow I/O on fast processors
  1476                              <1> out %1, al
  1477                              <1> %endmacro
  1478                              <1> 
  1479                              <1> PIT_setup:
  1480                              <1> PIT_write_command       PIT_TIMER_COMMAND_WRITE_MODE_2
  1481 0000067A B034                <2> mov al, %1
  1482 0000067C E643                <2> out PIT_COMMAND_PORT, al
  1483 0000067E 66B89C2E            <1> mov ax, 11932
  1484                              <1> PIT_write_counter       PIT_TIMER_PORT
  1485                              <2> 
  1486 00000682 EB00                <2> jmp short $+2
  1487 00000684 E640                <2> out %1, al
  1488 00000686 86C4                <1> xchg al, ah
  1489                              <1> PIT_write_counter       PIT_TIMER_PORT
  1490                              <2> 
  1491 00000688 EB00                <2> jmp short $+2
  1492 0000068A E640                <2> out %1, al
  1493 0000068C CB                  <1> retf
  1494                              <1> 
  1495                              <1> ;=======================================================================;
  1496                              <1> ; PIT-8253/8254 (Programmable Interval Timer)				;
  1497                              <1> ;=======================================================================;
  1498                              <1> ; 65536 ticks/cycle * 18.2 cycles/sec
  1499                              <1> ; 65535,65534,65533,...1,0,65535,65534,...
  1500                              <1> SEC_PIT_FREQUENCY			equ	1193200	; Hz (ticks/second)
  1501                              <1> MSEC_PIT_FREQUENCY			equ	1193	; Hz (ticks/msecond)
  1502                              <1> X_PIT_FREQUENCY				equ	6553
  1503                              <1> ; 50 ticks/s = 23864
  1504                              <1> ; 100 ticks/s = 11932
  1505                              <1> PIT_COMMAND_PORT 		equ	0x43
  1506                              <1> PIT_TIMER_PORT			equ	0x40
  1507                              <1> PIT_TIMER_COMMAND_READ		equ	0x00
  1508                              <1> PIT_TIMER_COMMAND_WRITE_MODE_2	equ	0x34
  1509                              <1> PIT_TIMER_COMMAND_WRITE_MODE_3	equ	0x36
  1510                              <1> 
  1511                              <1> ;-----------------------------------------------------------------------;
  1512                              <1> ;The timers are clocked at 1,193,180Hz.
  1513                              <1> ;The frequency of the interrupts is CLK / CountValue.
  1514                              <1> ;The only count value for which there is an whole number of ticks
  1515                              <1> ;per second is 59,659 which results in exactly 20 ticks per second.
  1516                              <1> ;The possible frequency range goes from 18.2Hz - 1.29MHz.
  1517                              <1> ;
  1518                              <1> ; 1,193,180Hz / (65536 OR 0) = 18.206 ticks per second
  1519                              <1> ; Real Time Counter (8253/8254 PIT-Programmable Interval Timer)
  1520                              <1> ;
  1521                              <1> ;PORT(1st PIT)  PORT(2nd PIT)   REGISTER                ACCESS_TYPE
  1522                              <1> ;040h                   048h    counter0                read/write
  1523                              <1> ;041h                   049h    counter1                read/write
  1524                              <1> ;042h                   04ah    counter2                read/write
  1525                              <1> ;043h                   04bh    ControlRegister 	write-only
  1526                              <1> ;
  1527                              <1> ;Control Register
  1528                              <1> ;
  1529                              <1> ;Bits  76   54   321    0
  1530                              <1> ;    | SC | RW | MODE | BCD |
  1531                              <1> ;
  1532                              <1> ;SC: Selector counter
  1533                              <1> ;       00=counter0     10=counter2
  1534                              <1> ;       01=counter1     11=invalid on 8253, 
  1535                              <1> ;			read-back command on 8254(read counter)
  1536                              <1> ;RW: read/write
  1537                              <1> ;       00=counter latch instruction(read counter)
  1538                              <1> ;       01=read/write low counter byte only
  1539                              <1> ;       10=read/write high counter byte only
  1540                              <1> ;       11=read/write low counter byte first, then high counter byte
  1541                              <1> ;MODE: PIT counting mode
  1542                              <1> ;       000=mode0       010=mode2       100=mode4
  1543                              <1> ;       001=mode1       011=mode3       101=mode5
  1544                              <1> ;BCD: counting format
  1545                              <1> ;       0=binary counting with 16bits (values 0h...ffffh)
  1546                              <1> ;       1=counting with binary coded decimals (values 0...9999)
  1547                              <1> ;------------------------------------------------------------------------;
  1548                                  %include "cmos.inc"
  1549                              <1> 
  1550                              <1> %macro	CMOS_read_address	2
  1551                              <1> cli
  1552                              <1> ;in al, 0x70     ; read old byte from port 0x70
  1553                              <1> ;and al, 0xE0    ; clear the five low-order bits
  1554                              <1> ;or al, %1	; write CMOS Address to al
  1555                              <1> mov al, %1
  1556                              <1> out 0x70,al     ; Wake up CMOS PORT
  1557                              <1> xor eax, eax	; clean eax 
  1558                              <1> jmp short $+2   ; Some delay...
  1559                              <1> in al,0x71      ; Reads Value.
  1560                              <1> mov %2, eax  
  1561                              <1> sti
  1562                              <1> %endmacro
  1563                              <1> 
  1564                              <1> ; For RTC you must first read the STATUS register A, bit 7 to be 0
  1565                              <1> %macro CMOS_rtc_ready	0
  1566                              <1> %%rtc_check
  1567                              <1> CMOS_read_address               CMOS_RTC_STATUS_REGA_ADDRESS, [CMOS_TEMP_VALUE]
  1568                              <1> mov eax, [CMOS_TEMP_VALUE]
  1569                              <1> shr eax, 7
  1570                              <1> and eax, 1
  1571                              <1> cmp eax, 1
  1572                              <1> je %%rtc_check
  1573                              <1> %endmacro
  1574                              <1> 
  1575                              <1> ;TODO: get PC information from CMOS
  1576                              <1> ;===========================================================================;
  1577                              <1> ; CMOS                                                                      ;
  1578                              <1> ;===========================================================================;
  1579 0000068D 00000000            <1> CMOS_TEMP_VALUE			DD	0
  1580                              <1> CMOS_TIME_SECOND_ADDRESS	equ	0x00
  1581                              <1> CMOS_TIME_MINUTE_ADDRESS	equ	0x02
  1582                              <1> CMOS_TIME_HOUR_ADDRESS		equ     0x04
  1583                              <1> CMOS_DATE_DAYOFWEEK_ADDRESS	equ	0x06
  1584                              <1> CMOS_DATE_DAYOFMONTH_ADDRESS	equ	0x07
  1585                              <1> CMOS_DATE_MONTH_ADDRESS		equ	0x08
  1586                              <1> CMOS_DATE_YEAR_ADDRESS		equ	0x09
  1587                              <1> CMOS_RTC_STATUS_REGA_ADDRESS	equ	0x0A
  1588                              <1> CMOS_RTC_STATUS_REGB_ADDRESS	equ	0x0B
  1589                              <1> CMOS_RTC_STATUS_REGC_ADDRESS	equ	0x0C
  1590                              <1> CMOS_RTC_STATUS_REGD_ADDRESS	equ	0x0D
  1591 00000691 204D6F6E2054756520- <1> CMOS_DATE_DAYS_OF_WEEK          DB ' Mon Tue Wed Thu Fri Sat Sun'
  1592 0000069A 576564205468752046- <1>
  1593 000006A3 726920536174205375- <1>
  1594 000006AC 6E                  <1>
  1595 000006AD 204A616E2046656220- <1> CMOS_DATE_MONTHS_OF_YEAR        DB ' Jan Feb Mar Apr Mai Jun Jul Aug Set Oct Nov Dec'
  1596 000006B6 4D617220417072204D- <1>
  1597 000006BF 6169204A756E204A75- <1>
  1598 000006C8 6C2041756720536574- <1>
  1599 000006D1 204F6374204E6F7620- <1>
  1600 000006DA 446563              <1>
  1601                              <1> 
  1602                                  %include "rtc.inc"
  1603                              <1> 
  1604                              <1> ; Using CMOS Port
  1605                              <1> 
  1606                              <1> %macro RTC_read_register	2	
  1607                              <1> mov dx, 0x70
  1608                              <1> mov al, %1
  1609                              <1> out dx, al
  1610                              <1> jmp short $+2
  1611                              <1> mov dx, 0x71
  1612                              <1> in al, dx
  1613                              <1> mov byte [%2], al
  1614                              <1> %endmacro
  1615                              <1> 
  1616                              <1> %macro RTC_write_register	2
  1617                              <1> mov dx, 0x70
  1618                              <1> mov al, %1
  1619                              <1> out dx, al
  1620                              <1> jmp short $+2 
  1621                              <1> mov dx, 0x71
  1622                              <1> mov al, %2
  1623                              <1> out dx, al
  1624                              <1> %endmacro
  1625                              <1> 
  1626                              <1> %macro RTC_int_enable	0
  1627                              <1> ;cli
  1628                              <1> ;pushf
  1629                              <1> RTC_read_register 	0x0A, RTC_VALUE
  1630                              <1> and byte [RTC_VALUE], 0xF0
  1631                              <1> ;;; clears bit0-bit3
  1632                              <1> or byte [RTC_VALUE], 0x06
  1633                              <1> RTC_write_register	0x0A, [RTC_VALUE]
  1634                              <1> ;;; 1024 interrupts per second (0110 bit0-bit3)
  1635                              <1> RTC_read_register	0x0B, RTC_VALUE
  1636                              <1> or byte [RTC_VALUE], 0x40
  1637                              <1> RTC_write_register	0x0B, [RTC_VALUE]
  1638                              <1> ;;; RTC INT Enabled (bit6)
  1639                              <1> ;popf
  1640                              <1> ;sti
  1641                              <1> %endmacro
  1642                              <1> 
  1643                              <1> %macro RTC_int_disable	0
  1644                              <1> mov al, 0x0B
  1645                              <1> out 0x70, al
  1646                              <1> jmp short $+2
  1647                              <1> in al, 0x71
  1648                              <1> and al, 0xBF
  1649                              <1> out 0x71, al
  1650                              <1> %endmacro
  1651                              <1> 
  1652                              <1> 
  1653 000006DD 00                  <1> RTC_VALUE	DB	0
  1654                                  %include "timer.inc"
  1655                              <1> 
  1656                              <1> ;%include "pit.inc"
  1657                              <1> ;%include "rtc.inc"
  1658                              <1> 
  1659                              <1> %macro TIMER_read	1
  1660                              <1> PIT_write_command	0x06
  1661                              <1> PIT_read_counter	PIT_TIMER_PORT
  1662                              <1> mov ah, al
  1663                              <1> PIT_read_counter	PIT_TIMER_PORT
  1664                              <1> xchg al, ah
  1665                              <1> mov word [%1], ax
  1666                              <1> %endmacro
  1667                              <1> 
  1668                              <1> %macro TIMER_pit_msdelay		1
  1669                              <1> xor ebx, ebx
  1670                              <1> mov ebx, %1
  1671                              <1> mov eax, X_PIT_FREQUENCY
  1672                              <1> mul ebx 
  1673                              <1> xchg ebx, eax
  1674                              <1> mov eax, [TIMER_PIT_TICKS]
  1675                              <1> add eax, ebx
  1676                              <1> xchg ebx, eax
  1677                              <1> %%check_pit:
  1678                              <1> mov eax, [TIMER_PIT_TICKS]
  1679                              <1> TIMER_read	TIMER_PIT_COUNTER
  1680                              <1> add eax, dword [TIMER_PIT_COUNTER]
  1681                              <1> cmp eax, ebx
  1682                              <1> jl %%check_pit
  1683                              <1> %endmacro
  1684                              <1> 
  1685                              <1> %macro TIMER_rtc_msdelay		1
  1686                              <1> mov eax, [TIMER_RTC_TICKS]
  1687                              <1> xor ebx, ebx
  1688                              <1> mov ebx, %1
  1689                              <1> add eax, ebx
  1690                              <1> xchg eax, ebx
  1691                              <1> ;mov ebx, 1024
  1692                              <1> ;mul ebx
  1693                              <1> ;RTC_enable
  1694                              <1> %%check_rtc:
  1695                              <1> mov eax, [TIMER_RTC_TICKS]
  1696                              <1> cmp eax, ebx
  1697                              <1> jl %%check_rtc  
  1698                              <1> ;RTC_disable
  1699                              <1> %endmacro
  1700                              <1> 
  1701 000006DE 0000                <1> TIMER_PIT_COUNTER	DW	0
  1702 000006E0 00000000            <1> TIMER_PIT_TICKS		DD	0
  1703 000006E4 00000000            <1> TIMER_RTC_TICKS		DD	0
  1704                                  %include "video.inc"
  1705                              <1> ;------------------------------------------------------------
  1706                              <1> ;Port-Index:  -               Port: Write/03c2h Read/03cch
  1707                              <1> ;usage:       d7   Vertical sync polarity
  1708                              <1> ;             d6   Horizontal sunc polarity
  1709                              <1> ;             d5   Odd /even page
  1710                              <1> ;             d4   Disable video
  1711                              <1> ;             d3   Clock select 1
  1712                              <1> ;             d2   Clock select 0
  1713                              <1> ;             d1   Enable/Disable display RAM
  1714                              <1> ;             d0   I/O address select
  1715                              <1> ;Description: Sync polarity: Bits are set as below for VGA displays
  1716                              <1> ;             that use sync polarity to determine screen resolution.
  1717                              <1> ;             Many newer multiple frequency displays are insensitive
  1718                              <1> ;             to sync polarity
  1719                              <1> ;
  1720                              <1> ;             d7 d6      Resolution
  1721                              <1> ;             0  0       Invalid
  1722                              <1> ;             0  1       400 lines
  1723                              <1> ;             1  0       350 lines
  1724                              <1> ;             1  1       480 lines
  1725                              <1> ;
  1726                              <1> ;             I/O address select: When set to zero, selects the
  1727                              <1> ;             monochrome I/O address space (3bx). When set to one,
  1728                              <1> ;             it selects the color I/O address space (3dx)
  1729                              <1> ;
  1730                              <1> ;------------------------------------------------------------
  1731                              <1> ;Port-Index: -                Port: 03c2h ; read only
  1732                              <1> ;usage:      d7    Vertical Retrace Interrupt pendling
  1733                              <1> ;            d6    Feature connector bit 1
  1734                              <1> ;            d5    Feature connector bit 0
  1735                              <1> ;            d4    Switch sense
  1736                              <1> ;            d0-d3 Unused
  1737                              <1> ;
  1738                              <1> ;Description: d7 uses IRQ2
  1739                              <1> ;
  1740                              <1> ;------------------------------------------------------------
  1741                              <1> ;Port-Index: -                Port: 03bah,03dah ; read only
  1742                              <1> ;usage:      d3  Vertical retrace
  1743                              <1> ;            d0  Horizontal retrace
  1744                              <1> ;
  1745                              <1> ;------------------------------------------------------------
  1746                              <1> ;Port-Index: -                Port: 03c3h,46e8h
  1747                              <1> ;usage:      d7-d1  Reserved
  1748                              <1> ;            d0     VGA enable/disable (03c3h only)
  1749                              <1> ;
  1750                              <1> ;Description: Disables access to display memmory and the other
  1751                              <1> ;             VGA's ports
  1752                              <1> ;
  1753                              <1> ;------------------------------------------------------------
  1754                              <1> ;Port-Index: 00h              Port: 03d4h, 03b4h
  1755                              <1> ;usage:      Horizontal total
  1756                              <1> ;Description: Total number of characters in horizontal scan minus
  1757                              <1> ;             five ( including blanked and border characters)
  1758                              <1> ;
  1759                              <1> ;------------------------------------------------------------
  1760                              <1> ;Port-Index: 01h              Port: 03d4h, 03b4h
  1761                              <1> ;usage:      Horizontal display enable
  1762                              <1> ;Description: Total number of characters displayed in horizontal
  1763                              <1> ;             scan minus one.
  1764                              <1> ;------------------------------------------------------------
  1765                              <1> ;Port-Index: 02h              Port: 03d4h, 03b4h
  1766                              <1> ;usage:      Start horizontal blanking
  1767                              <1> ;Description: Character at which blanking starts
  1768                              <1> ;
  1769                              <1> ;------------------------------------------------------------
  1770                              <1> ;Port-Index: 03h              Port: 03d4h, 03b4h
  1771                              <1> ;usage:      End horizontal blanking
  1772                              <1> ;            d7    Test
  1773                              <1> ;            d6    Skew control
  1774                              <1> ;            d5    Skew control
  1775                              <1> ;            d0-d4 End blanking
  1776                              <1> ;Description: End blanking: is five LSB bits of six-bit value,
  1777                              <1> ;             which define the character at which blanking stops.
  1778                              <1> ;             The MSB bit of this value is in register index 5.
  1779                              <1> ;
  1780                              <1> ;------------------------------------------------------------
  1781                              <1> ;Port-Index: 04h              Port: 03d4h, 03b4h
  1782                              <1> ;usage:      Start horizontal retrace
  1783                              <1> ;Description: Character at which horizontal retrace starts
  1784                              <1> ;
  1785                              <1> ;------------------------------------------------------------
  1786                              <1> ;Port-Index: 05h              Port: 03d4h, 03b4h
  1787                              <1> ;usage:      End horizontal retrace
  1788                              <1> ;            d7    End horizontal blanking bit 5
  1789                              <1> ;            d6    Horizontal retrace delay
  1790                              <1> ;            d5    Horizontal retrace delay
  1791                              <1> ;            d0-d4 End horizontal retrace
  1792                              <1> ;Description: End horizontal retrace: defines the character at
  1793                              <1> ;             which horizontal retrace ends
  1794                              <1> ;
  1795                              <1> ;------------------------------------------------------------
  1796                              <1> ;Port-Index: 06h              Port: 03d4h, 03b4h
  1797                              <1> ;usage:      Vertical total
  1798                              <1> ;Description: Total number of horizontal scan lines minus two
  1799                              <1> ;             (including blanked and border characters). MSB bits
  1800                              <1> ;             of this value are in register index 7
  1801                              <1> ;
  1802                              <1> ;------------------------------------------------------------
  1803                              <1> ;Port-Index: 07h              Port: 03d4h, 03b4h
  1804                              <1> ;usage:      Overflow register
  1805                              <1> ;            d7  Vertical retrace start (bit 9)
  1806                              <1> ;            d6  Vertical display enable end (bit 9)
  1807                              <1> ;            d5  Vertical total (bit 9)
  1808                              <1> ;            d4  Line compare (bit 8)
  1809                              <1> ;            d3  Start vertical blank (bit 8)
  1810                              <1> ;            d2  Vertical retrace start (bit 8)
  1811                              <1> ;            d1  Vertical display enable end (bit 8)
  1812                              <1> ;            d0  Vertical total (bit 8)
  1813                              <1> ;------------------------------------------------------------
  1814                              <1> ;Port-Index: 08h              Port: 03d4h, 03b4h
  1815                              <1> ;usage:      Preset row scan
  1816                              <1> ;            d7    Unused
  1817                              <1> ;            d6    Byte panning control
  1818                              <1> ;            d5    Byte panning control
  1819                              <1> ;            d0-d4 Preset row scan
  1820                              <1> ;Description: Byte panning control: is used to control byte
  1821                              <1> ;             panning. This register together with attribute
  1822                              <1> ;             controller register 13h allows for up to 31 pixels of
  1823                              <1> ;             panning in double word modes
  1824                              <1> ;             Preset row scan: Which character scan line is the
  1825                              <1> ;             first to be displayed
  1826                              <1> ;------------------------------------------------------------
  1827                              <1> ;Port-Index: 09h              Port: 03d4h, 03b4h
  1828                              <1> ;usage:      Maximum scan line/Character height
  1829                              <1> ;            d7    double scan
  1830                              <1> ;            d6    bit d9 of line compare register
  1831                              <1> ;            d5    bit d9 of start vertical blank register
  1832                              <1> ;            d0-d4 Maximum scan line
  1833                              <1> ;Description: d0-d5=Character height-1,  only in textmodes
  1834                              <1> ;------------------------------------------------------------
  1835                              <1> ;Port-Index: 0ah              Port: 03d4h, 03b4h
  1836                              <1> ;usage:      Cursor start
  1837                              <1> ;            d7,d6 Reserved (0)
  1838                              <1> ;            d5    Cursor off
  1839                              <1> ;            d4-d0 Cursor start
  1840                              <1> ;Description:
  1841                              <1> ;------------------------------------------------------------
  1842                              <1> ;Port-Index: 0bh              Port: 03d4h, 03b4h
  1843                              <1> ;usage:      Cursor end
  1844                              <1> ;            d7    reserved
  1845                              <1> ;            d6,d5 Cursor skew
  1846                              <1> ;            d4-d0 Cursor end
  1847                              <1> ;Description:
  1848                              <1> ;------------------------------------------------------------
  1849                              <1> ;Port-Index: 0ch              Port: 03d4h, 03b4h
  1850                              <1> ;usage:      Start address high
  1851                              <1> ;------------------------------------------------------------
  1852                              <1> ;Port-Index: 0dh              Port: 03d4h, 03b4h
  1853                              <1> ;usage:      Start address low
  1854                              <1> ;Description: Determine the offset in display memory to be
  1855                              <1> ;             displayed on the upper-left corner on the screen
  1856                              <1> ;------------------------------------------------------------
  1857                              <1> ;Port-Index: 0eh              Port: 03d4h, 03b4h
  1858                              <1> ;usage:      Cursor location (high byte)
  1859                              <1> ;-----------------------CURSOR LOCATION----------------------
  1860                              <1> ;Port-Index: 0fh              Port: 03d4h, 03b4h
  1861                              <1> ;usage:      Cursor location (low byte)
  1862                              <1> ;Description: Where the cursor is displayed on screen
  1863                              <1> ;------------------------------------------------------------
  1864                              <1> ;Port-Index: 10h              Port: 03d4h, 03b4h
  1865                              <1> ;usage:      Vertical retrace start
  1866                              <1> ;Description: 8 bits out of 10
  1867                              <1> ;------------------------------------------------------------
  1868                              <1> ;Port-Index: 11h              Port: 03d4h, 03b4h
  1869                              <1> ;usage:      Vertical retrace end
  1870                              <1> ;            d7    Write protect CRTC register 0 to 7
  1871                              <1> ;            d6    refresh cycle select
  1872                              <1> ;            d5    enable vertical interrupt (when 0)
  1873                              <1> ;            d4    Clear vertical interrupt (when 0)
  1874                              <1> ;            d0-d3 Vertical retrace end
  1875                              <1> ;------------------------------------------------------------
  1876                              <1> ;Port-Index: 12h              Port: 03d4h, 03b4h
  1877                              <1> ;usage:      Vertical display enable end
  1878                              <1> ;Description: eight LSB bits out of ten-bit value which define
  1879                              <1> ;             scan line minus one at which the display ends.
  1880                              <1> ;             The other two are in CRTC register index 7
  1881                              <1> ;------------------------------------------------------------
  1882                              <1> ;Port-Index: 13h              Port: 03d4h, 03b4h
  1883                              <1> ;usage:      Offset / Logical screen width
  1884                              <1> ;Description: Logical screen width between successive scan lines
  1885                              <1> ;------------------------------------------------------------
  1886                              <1> ;Port-Index: 14h              Port: 03d4h, 03b4h
  1887                              <1> ;usage:      Underline location register
  1888                              <1> ;            d7    Reserved
  1889                              <1> ;            d6    Double word mode
  1890                              <1> ;            d5    count by 4
  1891                              <1> ;            d0-d4 Underline location
  1892                              <1> ;Description: Underline location: Monochrome textmode only
  1893                              <1> ;------------------------------------------------------------
  1894                              <1> ;Port-Index: 15h              Port: 03d4h, 03b4h
  1895                              <1> ;usage:      Start vertical blanking
  1896                              <1> ;Description: eight LSB bits of ten-bit value minus one which
  1897                              <1> ;             define at which scan line the vertical blanking
  1898                              <1> ;             starts. The other two bits are in CRTC registers
  1899                              <1> ;             index 7 and 9
  1900                              <1> ;------------------------------------------------------------
  1901                              <1> ;Port-Index: 16h              Port: 03d4h, 03b4h
  1902                              <1> ;usage:      End vertical blanking
  1903                              <1> ;Description: eight LSB bits of a value which determine the scan
  1904                              <1> ;             line after which vertical blanking ends.
  1905                              <1> ;------------------------------------------------------------
  1906                              <1> ;Port-Index: 17h              Port: 03d4h, 03b4h
  1907                              <1> ;usage:      Mode control register
  1908                              <1> ;            d7  Enable vertical and hoizontal retrace
  1909                              <1> ;            d6  Byte mode (1), word mode (0)
  1910                              <1> ;            d5  Address wrap
  1911                              <1> ;            d4  Reserved
  1912                              <1> ;            d3  count by 2
  1913                              <1> ;            d2  multiple vertical by 2 (use half in
  1914                              <1> ;                CRTC (8,10,12,14,18)
  1915                              <1> ;            d1  Select row scan counter (not used)
  1916                              <1> ;            d0  compatibilty mode support (enable interleave)
  1917                              <1> ;------------------------------------------------------------
  1918                              <1> ;Port-Index: 18h              Port: 03d4h, 03b4h
  1919                              <1> ;usage:      Line compare register
  1920                              <1> ;Description: Split screen,  8 bit value out of a ten-bit value
  1921                              <1> ;------------------------------------------------------------
  1922                              <1> ;Port-Index: 00h              Port: 03c4h
  1923                              <1> ;usage:      Reset register
  1924                              <1> ;            d7-d2 Reserved
  1925                              <1> ;            d1    Synchronous reset
  1926                              <1> ;            d0    Asynchronous reset
  1927                              <1> ;Description: Synchr. when set to zero, will halt and reset
  1928                              <1> ;             the sequencer at the end of its current cycle
  1929                              <1> ;             Asyncht. when set to zero, will immediatly halt
  1930                              <1> ;             and reset the sequencer. Data can be loss.
  1931                              <1> ;------------------------------------------------------------
  1932                              <1> ;Port-Index: 01h              Port: 03c4h
  1933                              <1> ;usage:      Clock mode register
  1934                              <1> ;            d7,d6 Reserved
  1935                              <1> ;            d5    display off
  1936                              <1> ;            d4    Allow 32-bit Fetch (not used in standard modes)
  1937                              <1> ;            d3    Divide dot clock by 2 (used in some 320*200 modes)
  1938                              <1> ;            d2    Allow 16-bit fetch (used in mon graphics modes)
  1939                              <1> ;            d1    Reserved
  1940                              <1> ;            d0    Enable (0) 9 dot characters (mono text and 400-line)
  1941                              <1> ;Description: Display off: Will blank screen and give the cpu
  1942                              <1> ;             uninterrupted access the display memory.
  1943                              <1> ;------------------------------------------------------------
  1944                              <1> ;Port-Index: 02h              Port: 03c4h
  1945                              <1> ;usage:      Color plane write enable register
  1946                              <1> ;            d7,d6 Reserved
  1947                              <1> ;            d3    Plane 3 Write enable
  1948                              <1> ;            d2    Plane 2 Write enable
  1949                              <1> ;            d1    Plane 1 Write enable
  1950                              <1> ;            d0    Plane 0 Write enable
  1951                              <1> ;Description:
  1952                              <1> ;------------------------------------------------------------
  1953                              <1> ;Port-Index: 03h              Port: 03c4h
  1954                              <1> ;usage:      Character generator select register
  1955                              <1> ;            d7,d6 Reserved
  1956                              <1> ;            d5    Character generator table select A (MSB)
  1957                              <1> ;            d4    Character generator table select B (MSB)
  1958                              <1> ;            d3,d2 Character generator table select A
  1959                              <1> ;            d1,d0 Character generator table select B
  1960                              <1> ;Description: This register is only of interest if your software
  1961                              <1> ;             will be using multiple character sets. Either one
  1962                              <1> ;             or two character sets can be active. Table A selects
  1963                              <1> ;             the charcater with attribute d3 set to zero and
  1964                              <1> ;             Table B is the one with d3 set to one.
  1965                              <1> ;------------------------------------------------------------
  1966                              <1> ;Port-Index: 04h              Port: 03c4h
  1967                              <1> ;usage:      Memory mode register
  1968                              <1> ;            d4-d7 Reserved
  1969                              <1> ;            d3    Chain 4 (address bits 0&1 to select plan, mode 13h)
  1970                              <1> ;            d2    Odd/even (address bit 0 to select plane 0&2 or
  1971                              <1> ;                  1&3 text modes)
  1972                              <1> ;            d1    Extended memory (disable 64k modes)
  1973                              <1> ;            d0    Reserved
  1974                              <1> ;Description:
  1975                              <1> ;------------------------------------------------------------
  1976                              <1> ;Port-Index: 00h              Port: 03ceh
  1977                              <1> ;usage:      Set / Reset register
  1978                              <1> ;            d7-d4 Reserved (0)
  1979                              <1> ;            d3    Fill data for plane 3
  1980                              <1> ;            d2    Fill data for plane 2
  1981                              <1> ;            d1    Fill data for plane 1
  1982                              <1> ;            d0    Fill data for plane 0
  1983                              <1> ;------------------------------------------------------------
  1984                              <1> ;Port-Index: 01h              Port: 03ceh
  1985                              <1> ;usage:      Set / Reset enable register
  1986                              <1> ;            d7-d4 Reserved (0)
  1987                              <1> ;            d3    enable set/reset for plane 3 (1 = enable)
  1988                              <1> ;            d2    enable set/reset for plane 2 (1 = enable)
  1989                              <1> ;            d1    enable set/reset for plane 1 (1 = enable)
  1990                              <1> ;            d0    enable set/reset for plane 0 (1 = enable)
  1991                              <1> ;Description: Set/Reset enable defines which memory planes will
  1992                              <1> ;            receive fill data from set/reset register. Any plane
  1993                              <1> ;             that is disable for set/reset will be written with
  1994                              <1> ;             normal processor output data
  1995                              <1> ;------------------------------------------------------------
  1996                              <1> ;Port-Index: 02h              Port: 03ceh
  1997                              <1> ;usage:      Color compare register
  1998                              <1> ;            d7-d4 Reserved
  1999                              <1> ;            d3    Color compare value for plane 3
  2000                              <1> ;            d2    Color compare value for plane 2
  2001                              <1> ;            d1    Color compare value for plane 1
  2002                              <1> ;            d0    Color compare value for plane 0
  2003                              <1> ;Description: one indicate that color is the same
  2004                              <1> ;------------------------------------------------------------
  2005                              <1> ;Port-Index: 03h              Port: 03ceh
  2006                              <1> ;usage:      Data rotate / Function select register
  2007                              <1> ;            d7-d5 Resrved (0)
  2008                              <1> ;            d4,d3 Function select
  2009                              <1> ;            d2-d0 Rotate count
  2010                              <1> ;
  2011                              <1> ;            d4 d3  Function
  2012                              <1> ;            0  0   Write data unmodified
  2013                              <1> ;            0  1   Write data ANDed with processor latches
  2014                              <1> ;            1  0   Write data ORed with processor latches
  2015                              <1> ;            1  1   Write data XORed with processor latches
  2016                              <1> ;Description: Rotation is made before writing data
  2017                              <1> ;------------------------------------------------------------
  2018                              <1> ;Port-Index: 04h              Port: 03ceh
  2019                              <1> ;usage:      Read plane select register
  2020                              <1> ;            d7-d2 Reserved (0)
  2021                              <1> ;            d1,d0 Defines color plane for reading (0-3)
  2022                              <1> ;Description: Doesnt matter in color compare mode
  2023                              <1> ;------------------------------------------------------------
  2024                              <1> ;Port-Index: 05h              Port: 03ceh
  2025                              <1> ;usage:      Mode register
  2026                              <1> ;            d7    Reserved (0)
  2027                              <1> ;            d6    256-colour mode
  2028                              <1> ;            d5    Shift register mode
  2029                              <1> ;            d4    Odd / Even mode
  2030                              <1> ;            d3    Color compare mode enable (1 = enable)
  2031                              <1> ;            d2    Reserved (0)
  2032                              <1> ;            d1,d0 Write mode
  2033                              <1> ;
  2034                              <1> ;            d1 d0 Write mode
  2035                              <1> ;            0  0  Direct write (data rotate, set/reset may apply)
  2036                              <1> ;            0  1  Use processor latches as write data
  2037                              <1> ;            1  0  Color plane n (0-3) is filled with the value of
  2038                              <1> ;                  bit n in the write data
  2039                              <1> ;            1  1  Use (rotated) write data ANDed with Bit mask as
  2040                              <1> ;                  bit mask. Use set/reset as if set/reset was
  2041                              <1> ;                  enable for all planes
  2042                              <1> ;Description:
  2043                              <1> ;------------------------------------------------------------
  2044                              <1> ;Port-Index: 06h              Port: 03ceh
  2045                              <1> ;usage:      Miscellaneous register
  2046                              <1> ;            d7-d4 Reserved
  2047                              <1> ;            d3-d2 Memory map
  2048                              <1> ;                  00 = A000h for 128k
  2049                              <1> ;                  01 = A000h for 64k
  2050                              <1> ;                  10 = B000h for 32k
  2051                              <1> ;                  11 = B800h for 32k
  2052                              <1> ;            d1    Odd/even enable (used in text modes)
  2053                              <1> ;            d0    Graphics mode enable
  2054                              <1> ;Description: Memory map defines the location and size of the
  2055                              <1> ;             host window
  2056                              <1> ;------------------------------------------------------------
  2057                              <1> ;Port-Index: 07h              Port: 03ceh
  2058                              <1> ;usage:      Color don't care register
  2059                              <1> ;            d7-d4 Reserved (0)
  2060                              <1> ;            d3    Plane 3 don't care
  2061                              <1> ;            d2    Plane 2 don't care
  2062                              <1> ;            d1    Plane 1 don't care
  2063                              <1> ;            d0    Plane 0 don't care
  2064                              <1> ;Description: Color don't care is used in conjunction with color
  2065                              <1> ;             compare mode. This register masks particular planes
  2066                              <1> ;             from being tested during color compare cycles.
  2067                              <1> ;------------------------------------------------------------
  2068                              <1> ;Port-Index: 08h              Port: 03ceh
  2069                              <1> ;usage:      Bitmask register
  2070                              <1> ;Description: The bitmask register is used to mask certain bit
  2071                              <1> ;             positons from being modified.
  2072                              <1> ;------------------------------------------------------------
  2073                              <1> ;Port-Index: -                 Port: 03c0h both index and data
  2074                              <1> ;usage:      d7,d6 Reserved
  2075                              <1> ;            d5    Palette address source
  2076                              <1> ;                  0 = palette can be modified, screen is blanked
  2077                              <1> ;                  1 = screen is enable, palette cannot be modified
  2078                              <1> ;            d4-d0 Palette register address
  2079                              <1> ;Description: Palette register address selects which register of
  2080                              <1> ;             the attributes controller will be addres,sed by the
  2081                              <1> ;             next I/O write cycle
  2082                              <1> ;------------------------------------------------------------
  2083                              <1> ;Port-Index: 00h-0fh          Port: 03c0h
  2084                              <1> ;usage:      Color palette register
  2085                              <1> ;            d6,d7 Reserved
  2086                              <1> ;            d5-d0 Color value
  2087                              <1> ;Description: not used in 256 color modes
  2088                              <1> ;------------------------------------------------------------
  2089                              <1> ;Port-Index: 10h              Port: 03c0h
  2090                              <1> ;usage:      Mode control register
  2091                              <1> ;            d7  p4,p5 source select
  2092                              <1> ;            d6  pixel width
  2093                              <1> ;            d5  Horizontal panning compatibility
  2094                              <1> ;            d4  Reserved
  2095                              <1> ;            d3  Background intensify / enable blinking
  2096                              <1> ;            d2  Line graphics enable (text modes only)
  2097                              <1> ;            d1  display type
  2098                              <1> ;            d0  graphics / text mode
  2099                              <1> ;Description: p4,p5 source select: selects the source for video
  2100                              <1> ;              outputs p4 and p5 to the DACs. If set to zero, p4
  2101                              <1> ;              and p5 are driven from the palette registers (normal
  2102                              <1> ;              operation). If set to one, p4 and p5 video outputs
  2103                              <1> ;              come from bits 0 and 1 of the color select register.
  2104                              <1> ;             pixel width: is set to one in mode 13h (256-color mode)
  2105                              <1> ;             horizontal panning compatibility: enhances the
  2106                              <1> ;              operation of the line compare register of the CRT
  2107                              <1> ;              controller, which allows one section of the screen
  2108                              <1> ;              to be scrolled while another section remains stationary.
  2109                              <1> ;              When this bit is set to one, the stationary
  2110                              <1> ;              section of the screen will also be immune to horizontal
  2111                              <1> ;              panning.
  2112                              <1> ;------------------------------------------------------------
  2113                              <1> ;Port-Index: 11h              Port: 03c0h
  2114                              <1> ;usage:      Screen border color
  2115                              <1> ;Description: In text modes, the screen border color register
  2116                              <1> ;             selects the color of the border that sorrounds the
  2117                              <1> ;             text display area on the screen. This is also referred
  2118                              <1> ;             to by IBM as overscan. Unfortunately, this feature
  2119                              <1> ;             does not work properly on EGA displays in 350-line
  2120                              <1> ;             modes.
  2121                              <1> ;------------------------------------------------------------
  2122                              <1> ;Port-Index: 12h              Port: 03c0h
  2123                              <1> ;usage:      Color plane enable register
  2124                              <1> ;            d7,d6 Reserved
  2125                              <1> ;            d5,d4 Video status mux
  2126                              <1> ;            d3    Enable color plane 3
  2127                              <1> ;            d2    Enable color plane 2
  2128                              <1> ;            d1    Enable color plane 1
  2129                              <1> ;            d0    Enable color plane 0
  2130                              <1> ;Description:  The video status mux bits can be used in conjunction
  2131                              <1> ;             with the diagnostic bits of input status register 1
  2132                              <1> ;             to read palette registers. For the EGA, this is the
  2133                              <1> ;             only means available for reading the palette registers.
  2134                              <1> ;              Enable color planes can be used to enable or disable
  2135                              <1> ;             color planes at the input to the color lockup table.
  2136                              <1> ;             A zero in any of these bit positions will mask the
  2137                              <1> ;             data from that color plane. The effect on the display
  2138                              <1> ;             will be the same as if that color plane were cleared
  2139                              <1> ;             to all zeros.
  2140                              <1> ;------------------------------------------------------------
  2141                              <1> ;Port-Index: 13h              Port: 03c0h
  2142                              <1> ;usage:      Horizontal panning register
  2143                              <1> ;            d7-d4 reserved
  2144                              <1> ;            d3-d0 Horizontal pan
  2145                              <1> ;Description: Horizontal pan allows the display to be shifted
  2146                              <1> ;             horizontally one pixel at a time.
  2147                              <1> ;
  2148                              <1> ;             d3-d0      Number of pixels shifted to the left
  2149                              <1> ;                        0+,1+,2+     13h     Other modes
  2150                              <1> ;                        3+,7,7+
  2151                              <1> ;             0          1            0       0
  2152                              <1> ;             1          2            1       -
  2153                              <1> ;             2          3            2       1
  2154                              <1> ;             3          4            3       -
  2155                              <1> ;             4          5            4       2
  2156                              <1> ;             5          6            5       -
  2157                              <1> ;             6          7            6       3
  2158                              <1> ;             7          8            7       -
  2159                              <1> ;             8          9            -       -
  2160                              <1> ;------------------------------------------------------------
  2161                              <1> ;Port-Index: 14h              Port: 03c0h
  2162                              <1> ;usage:      Color select register
  2163                              <1> ;            d7-d4 Reserved
  2164                              <1> ;            d3    color 7
  2165                              <1> ;            d2    color 6
  2166                              <1> ;            d1    color 5
  2167                              <1> ;            d0    color 4
  2168                              <1> ;Description:  Color 7 and color 6: are normally used as the high
  2169                              <1> ;             order bits of the eight-bit video color data from the
  2170                              <1> ;             attribute controller to the DACs. The only exceptions
  2171                              <1> ;             are 256-color modes
  2172                              <1> ;              Color 5 and color 4: can be used in place of the p5
  2173                              <1> ;             and p6 outputs from the palette registers (see mode
  2174                              <1> ;             control register - index 10h). In 16-color modes, the
  2175                              <1> ;             color select register can be used to rapidly cycle
  2176                              <1> ;             between sets of colors in the video DAC.
  2177                              <1> ;------------------------------------------------------------
  2178                              <1> ;Port-Index: -                Port: 03c6h
  2179                              <1> ;usage:      Pixel mask register
  2180                              <1> ;Description: ???
  2181                              <1> ;------------------------------------------------------------
  2182                              <1> ;Port-Index: -                Port: 03c7h
  2183                              <1> ;usage:      DAC state register (read-only)
  2184                              <1> ;Description: if d0 and d1 is set to zero it indicates that
  2185                              <1> ;             the lookup table is in a write mode
  2186                              <1> ;------------------------------------------------------------
  2187                              <1> ;Port-Index: -                Port: 03c7h
  2188                              <1> ;usage:      Lookup table read index register (Write only)
  2189                              <1> ;Description: Used when you want to read the palette (set color
  2190                              <1> ;             number)
  2191                              <1> ;------------------------------------------------------------
  2192                              <1> ;Port-Index: -                Port: 03c8h
  2193                              <1> ;usage:      Lookup table write index register
  2194                              <1> ;Description: Used when you want to change palette (set color
  2195                              <1> ;             number)
  2196                              <1> ;------------------------------------------------------------
  2197                              <1> ;Port-Index: -                Port: 03c9h
  2198                              <1> ;usage:      Lookup table data register
  2199                              <1> ;Description: Read color value (Red-Green-Blue) or write same data.
  2200                              <1> ;------------------------------------------------------------
  2201                              <1> 
  2202                              <1> 
  2203                              <1> ;%include "timer.inc"
  2204                              <1> 
  2205                              <1> VIDEO_TEXTMODE_clear_screen:
  2206 000006E8 B9A08F0B00          <1> mov ecx, VIDEO_TEXTMODE_ADDRESS+4000
  2207 000006ED BF00800B00          <1> mov edi, VIDEO_TEXTMODE_ADDRESS
  2208                              <1> next_char:
  2209 000006F2 26C70700000000      <1> mov dword [es:edi], 0
  2210 000006F9 81C704000000        <1> add edi, 4
  2211 000006FF 39CF                <1> cmp edi, ecx
  2212 00000701 75EF                <1> jne next_char
  2213                              <1> ;mov [VIDEO_TEXTMODE_ROW_POSITION], 0x01
  2214 00000703 CB                  <1> retf
  2215                              <1> 
  2216                              <1> %macro VIDEO_TEXTMODE_typewriter	3
  2217                              <1> inc byte [VIDEO_TEXTMODE_LINE]
  2218                              <1> cmp byte [VIDEO_TEXTMODE_LINE], 24
  2219                              <1> jl %%skip_window_up
  2220                              <1> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  2221                              <1> call dword 0x0008:VIDEO_TEXTMODE_window_up
  2222                              <1> dec byte [VIDEO_TEXTMODE_LINE]
  2223                              <1> %%skip_window_up:
  2224                              <1> 
  2225                              <1> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  2226                              <1> mov eax, 160
  2227                              <1> xor ebx, ebx
  2228                              <1> mov bl, [VIDEO_TEXTMODE_LINE]
  2229                              <1> mul ebx
  2230                              <1> add edi, eax
  2231                              <1> 
  2232                              <1> mov esi, %3
  2233                              <1> mov ah, %2
  2234                              <1> %%next_char1:
  2235                              <1> ;;; 
  2236                              <1> ;;; ---  typewriter effect  ---
  2237                              <1> ;;; TIMER_rtc_msdelay       50
  2238                              <1> ;;; SPEAKER_sound
  2239                              <1> ;;; 
  2240                              <1> mov al, byte [es:esi]
  2241                              <1> mov word [es:edi], ax
  2242                              <1> times 2 inc edi
  2243                              <1> inc esi
  2244                              <1> cmp byte [es:esi], 0x00
  2245                              <1> jne %%next_char1
  2246                              <1> %endmacro
  2247                              <1> 
  2248                              <1> %macro VIDEO_TEXTMODE_write_mensage	4
  2249                              <1> ; LOOP (Loop While ECX Not Zero)
  2250                              <1> ; CLD = clear direction flag (increment)
  2251                              <1> ; LODSB = (mov al, byte [ds:esi] & inc esi)
  2252                              <1> ; LEA EAX,[EBX+ECX*4+100] = real fast & complex arithmetic calculations
  2253                              <1> ; MOVSB = (mov byte `[ES:EDI]' to byte `[DS:ESI]' & inc esi & inc edi)
  2254                              <1> ; LES al, esi = (mov al, byte [es:esi])
  2255                              <1> ; LES ax, edi = (mov ax, word [es:edi])
  2256                              <1> ; LDS al, esi = (mov al, byte [ds:esi])
  2257                              <1> ;
  2258                              <1> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  2259                              <1> 
  2260                              <1> mov eax, 160
  2261                              <1> mov ebx, %1
  2262                              <1> mul ebx
  2263                              <1> add edi, eax
  2264                              <1> 
  2265                              <1> mov esi, %4
  2266                              <1> mov ah, %3
  2267                              <1> %%next_char:
  2268                              <1> mov al, byte [es:esi]
  2269                              <1> mov word [es:edi], ax
  2270                              <1> times 2 inc edi
  2271                              <1> inc esi
  2272                              <1> cmp byte [es:esi], 0x00
  2273                              <1> jne %%next_char
  2274                              <1> %endmacro
  2275                              <1> 
  2276                              <1> VIDEO_TEXTMODE_window_up:
  2277 00000704 BE00800B00          <1> mov esi, VIDEO_TEXTMODE_ADDRESS
  2278 00000709 BF00800B00          <1> mov edi, VIDEO_TEXTMODE_ADDRESS
  2279                              <1> 
  2280 0000070E B8A0000000          <1> mov eax, 160
  2281 00000713 31DB                <1> xor ebx, ebx
  2282 00000715 8A1D[A90C0000]      <1> mov bl, [VIDEO_TEXTMODE_WINDOW_LINE_START]
  2283 0000071B F7E3                <1> mul ebx
  2284 0000071D 01C7                <1> add edi, eax
  2285 0000071F 05A0000000          <1> add eax, 160
  2286 00000724 01C6                <1> add esi, eax
  2287 00000726 BBA08F0B00          <1> mov ebx, VIDEO_TEXTMODE_ADDRESS+4000
  2288                              <1> 
  2289                              <1> next_copy:
  2290 0000072B 268B06              <1> mov eax, dword [es:esi]
  2291 0000072E 268907              <1> mov dword [es:edi], eax
  2292 00000731 81C604000000        <1> add esi, 4
  2293 00000737 81C704000000        <1> add edi, 4
  2294 0000073D 39DE                <1> cmp esi, ebx
  2295 0000073F 75EA                <1> jne next_copy
  2296                              <1> next_clean:
  2297 00000741 26C70700000000      <1> mov dword [es:edi], 0x00000000
  2298 00000748 81C704000000        <1> add edi, 4
  2299 0000074E 39DF                <1> cmp edi, ebx
  2300 00000750 75EF                <1> jne next_clean 
  2301 00000752 CB                  <1> retf
  2302                              <1> 
  2303                              <1> %macro VIDEO_TEXTMODE_set_line	1
  2304                              <1> mov al, %1
  2305                              <1> mov [VIDEO_TEXTMODE_LINE], al
  2306                              <1> %endmacro
  2307                              <1> 
  2308                              <1> %macro VIDEO_TEXTMODE_print_line	3
  2309                              <1> 
  2310                              <1> inc byte [VIDEO_TEXTMODE_LINE]
  2311                              <1> cmp byte [VIDEO_TEXTMODE_LINE], 24
  2312                              <1> jl %%skip_window_up
  2313                              <1> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04 
  2314                              <1> call dword 0x0008:VIDEO_TEXTMODE_window_up
  2315                              <1> dec byte [VIDEO_TEXTMODE_LINE]
  2316                              <1> %%skip_window_up:
  2317                              <1> 
  2318                              <1> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  2319                              <1> mov eax, 160
  2320                              <1> xor ebx, ebx
  2321                              <1> mov bl, [VIDEO_TEXTMODE_LINE]
  2322                              <1> mul ebx
  2323                              <1> add edi, eax
  2324                              <1> 
  2325                              <1> mov esi, %3
  2326                              <1> mov ah, %2
  2327                              <1> %%next_char1:
  2328                              <1> mov al, byte [es:esi]
  2329                              <1> mov word [es:edi], ax
  2330                              <1> times 2 inc edi
  2331                              <1> inc esi
  2332                              <1> cmp byte [es:esi], 0x00
  2333                              <1> jne %%next_char1
  2334                              <1> %endmacro
  2335                              <1> 
  2336                              <1> ; COLOR, R, G, B
  2337                              <1> %macro VIDEO_VGA_get_pal	4
  2338                              <1> cli
  2339                              <1> pushf
  2340                              <1> mov dx, VIDEO_VGA_READ_INDEX_PORT
  2341                              <1> mov al, [%1]
  2342                              <1> out dx, al
  2343                              <1> mov dx, VIDEO_VGA_DATA_PORT
  2344                              <1> in al, dx
  2345                              <1> mov byte [%2], al
  2346                              <1> in al, dx
  2347                              <1> mov byte [%3], al
  2348                              <1> in al, dx
  2349                              <1> mov byte [%4], al
  2350                              <1> popf
  2351                              <1> sti
  2352                              <1> %endmacro 
  2353                              <1> 
  2354                              <1> ; COLOR, R, G, B
  2355                              <1> %macro VIDEO_VGA_set_pal	4
  2356                              <1> cli
  2357                              <1> pushf
  2358                              <1> mov dx, VIDEO_VGA_WRITE_INDEX_PORT
  2359                              <1> mov al, %1
  2360                              <1> out dx, al
  2361                              <1> mov dx, VIDEO_VGA_DATA_PORT
  2362                              <1> mov al, %2
  2363                              <1> out dx, al 
  2364                              <1> mov al, %3
  2365                              <1> out dx, al
  2366                              <1> mov al, %4
  2367                              <1> out dx, al
  2368                              <1> popf
  2369                              <1> sti
  2370                              <1> %endmacro
  2371                              <1> 
  2372                              <1> %macro VIDEO_VGA_wait_retrace	0
  2373                              <1> cli
  2374                              <1> pushf
  2375                              <1> mov dx, 0x03DA
  2376                              <1> %%loop1:
  2377                              <1> in al, dx
  2378                              <1> and al, 0x08
  2379                              <1> jnz near %%loop1
  2380                              <1> %%loop2:
  2381                              <1> in al, dx
  2382                              <1> and al, 0x08
  2383                              <1> jz near %%loop2
  2384                              <1> popf
  2385                              <1> sti
  2386                              <1> %endmacro
  2387                              <1> 
  2388                              <1> %macro VIDEO_VGA_save_pal	0
  2389                              <1> mov edi, VIDEO_VGA_PAL_BUFFER
  2390                              <1> mov byte [VIDEO_VGA_COLOR], 0
  2391                              <1> %%get_next_color:
  2392                              <1> VIDEO_VGA_get_pal      VIDEO_VGA_COLOR ,VIDEO_VGA_RED,VIDEO_VGA_GREEN,VIDEO_VGA_BLUE
  2393                              <1> mov al, [VIDEO_VGA_RED]
  2394                              <1> mov byte [es:edi], al
  2395                              <1> mov al, [VIDEO_VGA_GREEN]
  2396                              <1> mov byte [es:edi+1], al
  2397                              <1> mov al, [VIDEO_VGA_BLUE]
  2398                              <1> mov byte [es:edi+2], al
  2399                              <1> add edi, 3
  2400                              <1> inc byte [VIDEO_VGA_COLOR]
  2401                              <1> cmp byte [VIDEO_VGA_COLOR], 16
  2402                              <1> jne %%get_next_color
  2403                              <1> %endmacro
  2404                              <1> 
  2405                              <1> VIDEO_VGA_fadeout:
  2406                              <1> VIDEO_VGA_save_pal
  2407 00000753 BF[A3090000]        <2> mov edi, VIDEO_VGA_PAL_BUFFER
  2408 00000758 C605[A60C0000]00    <2> mov byte [VIDEO_VGA_COLOR], 0
  2409                              <2> %%get_next_color:
  2410                              <2> VIDEO_VGA_get_pal VIDEO_VGA_COLOR ,VIDEO_VGA_RED,VIDEO_VGA_GREEN,VIDEO_VGA_BLUE
  2411 0000075F FA                  <3> cli
  2412 00000760 9C                  <3> pushf
  2413 00000761 66BAC703            <3> mov dx, VIDEO_VGA_READ_INDEX_PORT
  2414 00000765 A0[A60C0000]        <3> mov al, [%1]
  2415 0000076A EE                  <3> out dx, al
  2416 0000076B 66BAC903            <3> mov dx, VIDEO_VGA_DATA_PORT
  2417 0000076F EC                  <3> in al, dx
  2418 00000770 A2[A30C0000]        <3> mov byte [%2], al
  2419 00000775 EC                  <3> in al, dx
  2420 00000776 A2[A40C0000]        <3> mov byte [%3], al
  2421 0000077B EC                  <3> in al, dx
  2422 0000077C A2[A50C0000]        <3> mov byte [%4], al
  2423 00000781 9D                  <3> popf
  2424 00000782 FB                  <3> sti
  2425 00000783 A0[A30C0000]        <2> mov al, [VIDEO_VGA_RED]
  2426 00000788 268807              <2> mov byte [es:edi], al
  2427 0000078B A0[A40C0000]        <2> mov al, [VIDEO_VGA_GREEN]
  2428 00000790 26884701            <2> mov byte [es:edi+1], al
  2429 00000794 A0[A50C0000]        <2> mov al, [VIDEO_VGA_BLUE]
  2430 00000799 26884702            <2> mov byte [es:edi+2], al
  2431 0000079D 81C703000000        <2> add edi, 3
  2432 000007A3 FE05[A60C0000]      <2> inc byte [VIDEO_VGA_COLOR]
  2433 000007A9 803D[A60C0000]10    <2> cmp byte [VIDEO_VGA_COLOR], 16
  2434 000007B0 75AD                <2> jne %%get_next_color
  2435                              <1> set_next_dec:
  2436 000007B2 C605[A60C0000]00    <1> mov byte [VIDEO_VGA_COLOR], 0
  2437 000007B9 C605[A70C0000]00    <1> mov byte [VIDEO_VGA_RGB], 0
  2438                              <1> VIDEO_VGA_wait_retrace
  2439 000007C0 FA                  <2> cli
  2440 000007C1 9C                  <2> pushf
  2441 000007C2 66BADA03            <2> mov dx, 0x03DA
  2442                              <2> %%loop1:
  2443 000007C6 EC                  <2> in al, dx
  2444 000007C7 2408                <2> and al, 0x08
  2445 000007C9 0F85F7FFFFFF        <2> jnz near %%loop1
  2446                              <2> %%loop2:
  2447 000007CF EC                  <2> in al, dx
  2448 000007D0 2408                <2> and al, 0x08
  2449 000007D2 0F84F7FFFFFF        <2> jz near %%loop2
  2450 000007D8 9D                  <2> popf
  2451 000007D9 FB                  <2> sti
  2452                              <1> set_next_color:
  2453                              <1> VIDEO_VGA_get_pal        VIDEO_VGA_COLOR ,VIDEO_VGA_RED,VIDEO_VGA_GREEN,VIDEO_VGA_BLUE
  2454 000007DA FA                  <2> cli
  2455 000007DB 9C                  <2> pushf
  2456 000007DC 66BAC703            <2> mov dx, VIDEO_VGA_READ_INDEX_PORT
  2457 000007E0 A0[A60C0000]        <2> mov al, [%1]
  2458 000007E5 EE                  <2> out dx, al
  2459 000007E6 66BAC903            <2> mov dx, VIDEO_VGA_DATA_PORT
  2460 000007EA EC                  <2> in al, dx
  2461 000007EB A2[A30C0000]        <2> mov byte [%2], al
  2462 000007F0 EC                  <2> in al, dx
  2463 000007F1 A2[A40C0000]        <2> mov byte [%3], al
  2464 000007F6 EC                  <2> in al, dx
  2465 000007F7 A2[A50C0000]        <2> mov byte [%4], al
  2466 000007FC 9D                  <2> popf
  2467 000007FD FB                  <2> sti
  2468 000007FE 803D[A30C0000]00    <1> cmp byte [VIDEO_VGA_RED], 0
  2469 00000805 740C                <1> je skip_red
  2470 00000807 FE05[A70C0000]      <1> inc byte [VIDEO_VGA_RGB]
  2471 0000080D FE0D[A30C0000]      <1> dec byte [VIDEO_VGA_RED]
  2472                              <1> skip_red:
  2473 00000813 803D[A40C0000]00    <1> cmp byte [VIDEO_VGA_GREEN], 0
  2474 0000081A 740C                <1> je skip_green
  2475 0000081C FE05[A70C0000]      <1> inc byte [VIDEO_VGA_RGB]
  2476 00000822 FE0D[A40C0000]      <1> dec byte [VIDEO_VGA_GREEN]
  2477                              <1> skip_green:
  2478 00000828 803D[A50C0000]00    <1> cmp byte [VIDEO_VGA_BLUE], 0
  2479 0000082F 740C                <1> je skip_blue
  2480 00000831 FE05[A70C0000]      <1> inc byte [VIDEO_VGA_RGB]
  2481 00000837 FE0D[A50C0000]      <1> dec byte [VIDEO_VGA_BLUE]
  2482                              <1> skip_blue:
  2483                              <1> VIDEO_VGA_set_pal	[VIDEO_VGA_COLOR],[VIDEO_VGA_RED],[VIDEO_VGA_GREEN],[VIDEO_VGA_BLUE]
  2484 0000083D FA                  <2> cli
  2485 0000083E 9C                  <2> pushf
  2486 0000083F 66BAC803            <2> mov dx, VIDEO_VGA_WRITE_INDEX_PORT
  2487 00000843 A0[A60C0000]        <2> mov al, %1
  2488 00000848 EE                  <2> out dx, al
  2489 00000849 66BAC903            <2> mov dx, VIDEO_VGA_DATA_PORT
  2490 0000084D A0[A30C0000]        <2> mov al, %2
  2491 00000852 EE                  <2> out dx, al
  2492 00000853 A0[A40C0000]        <2> mov al, %3
  2493 00000858 EE                  <2> out dx, al
  2494 00000859 A0[A50C0000]        <2> mov al, %4
  2495 0000085E EE                  <2> out dx, al
  2496 0000085F 9D                  <2> popf
  2497 00000860 FB                  <2> sti
  2498 00000861 FE05[A60C0000]      <1> inc byte [VIDEO_VGA_COLOR]
  2499 00000867 803D[A60C0000]10    <1> cmp byte [VIDEO_VGA_COLOR], 16 
  2500 0000086E 7407                <1> je end_dec
  2501 00000870 EA[DA070000]0800    <1> jmp dword 0x0008:set_next_color
  2502                              <1> end_dec:
  2503                              <1> TIMER_rtc_msdelay       50 
  2504 00000877 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  2505 0000087C 31DB                <2> xor ebx, ebx
  2506 0000087E BB32000000          <2> mov ebx, %1
  2507 00000883 01D8                <2> add eax, ebx
  2508 00000885 93                  <2> xchg eax, ebx
  2509                              <2> 
  2510                              <2> 
  2511                              <2> 
  2512                              <2> %%check_rtc:
  2513 00000886 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  2514 0000088B 39D8                <2> cmp eax, ebx
  2515 0000088D 7CF7                <2> jl %%check_rtc
  2516                              <2> 
  2517 0000088F 803D[A70C0000]00    <1> cmp byte [VIDEO_VGA_RGB], 0
  2518 00000896 7407                <1> je end_fadeout
  2519 00000898 EA[B2070000]0800    <1> jmp dword 0x0008:set_next_dec
  2520                              <1> end_fadeout:
  2521 0000089F CB                  <1> retf
  2522                              <1> 
  2523                              <1> VIDEO_VGA_fadein:
  2524                              <1> set_next_inc:
  2525 000008A0 BE[A3090000]        <1> mov esi, VIDEO_VGA_PAL_BUFFER
  2526 000008A5 C605[A60C0000]00    <1> mov byte [VIDEO_VGA_COLOR], 0
  2527 000008AC C605[A70C0000]00    <1> mov byte [VIDEO_VGA_RGB], 0
  2528                              <1> VIDEO_VGA_wait_retrace
  2529 000008B3 FA                  <2> cli
  2530 000008B4 9C                  <2> pushf
  2531 000008B5 66BADA03            <2> mov dx, 0x03DA
  2532                              <2> %%loop1:
  2533 000008B9 EC                  <2> in al, dx
  2534 000008BA 2408                <2> and al, 0x08
  2535 000008BC 0F85F7FFFFFF        <2> jnz near %%loop1
  2536                              <2> %%loop2:
  2537 000008C2 EC                  <2> in al, dx
  2538 000008C3 2408                <2> and al, 0x08
  2539 000008C5 0F84F7FFFFFF        <2> jz near %%loop2
  2540 000008CB 9D                  <2> popf
  2541 000008CC FB                  <2> sti
  2542                              <1> set_next_color1:
  2543                              <1> VIDEO_VGA_get_pal        VIDEO_VGA_COLOR ,VIDEO_VGA_RED,VIDEO_VGA_GREEN,VIDEO_VGA_BLUE
  2544 000008CD FA                  <2> cli
  2545 000008CE 9C                  <2> pushf
  2546 000008CF 66BAC703            <2> mov dx, VIDEO_VGA_READ_INDEX_PORT
  2547 000008D3 A0[A60C0000]        <2> mov al, [%1]
  2548 000008D8 EE                  <2> out dx, al
  2549 000008D9 66BAC903            <2> mov dx, VIDEO_VGA_DATA_PORT
  2550 000008DD EC                  <2> in al, dx
  2551 000008DE A2[A30C0000]        <2> mov byte [%2], al
  2552 000008E3 EC                  <2> in al, dx
  2553 000008E4 A2[A40C0000]        <2> mov byte [%3], al
  2554 000008E9 EC                  <2> in al, dx
  2555 000008EA A2[A50C0000]        <2> mov byte [%4], al
  2556 000008EF 9D                  <2> popf
  2557 000008F0 FB                  <2> sti
  2558 000008F1 268A06              <1> mov al, byte [es:esi]
  2559 000008F4 3805[A30C0000]      <1> cmp byte [VIDEO_VGA_RED], al 
  2560 000008FA 740C                <1> je skip_red1
  2561 000008FC FE05[A70C0000]      <1> inc byte [VIDEO_VGA_RGB]
  2562 00000902 FE05[A30C0000]      <1> inc byte [VIDEO_VGA_RED]
  2563                              <1> skip_red1:
  2564 00000908 268A4601            <1> mov al, byte [es:esi+1]
  2565 0000090C 3805[A40C0000]      <1> cmp byte [VIDEO_VGA_GREEN], al 
  2566 00000912 740C                <1> je skip_green1
  2567 00000914 FE05[A70C0000]      <1> inc byte [VIDEO_VGA_RGB]
  2568 0000091A FE05[A40C0000]      <1> inc byte [VIDEO_VGA_GREEN]
  2569                              <1> skip_green1:
  2570 00000920 268A4602            <1> mov al, byte [es:esi+2]
  2571 00000924 3805[A50C0000]      <1> cmp byte [VIDEO_VGA_BLUE], al 
  2572 0000092A 740C                <1> je skip_blue1
  2573 0000092C FE05[A70C0000]      <1> inc byte [VIDEO_VGA_RGB]
  2574 00000932 FE05[A50C0000]      <1> inc byte [VIDEO_VGA_BLUE]
  2575                              <1> skip_blue1:
  2576                              <1> VIDEO_VGA_set_pal	[VIDEO_VGA_COLOR],[VIDEO_VGA_RED],[VIDEO_VGA_GREEN],[VIDEO_VGA_BLUE]
  2577 00000938 FA                  <2> cli
  2578 00000939 9C                  <2> pushf
  2579 0000093A 66BAC803            <2> mov dx, VIDEO_VGA_WRITE_INDEX_PORT
  2580 0000093E A0[A60C0000]        <2> mov al, %1
  2581 00000943 EE                  <2> out dx, al
  2582 00000944 66BAC903            <2> mov dx, VIDEO_VGA_DATA_PORT
  2583 00000948 A0[A30C0000]        <2> mov al, %2
  2584 0000094D EE                  <2> out dx, al
  2585 0000094E A0[A40C0000]        <2> mov al, %3
  2586 00000953 EE                  <2> out dx, al
  2587 00000954 A0[A50C0000]        <2> mov al, %4
  2588 00000959 EE                  <2> out dx, al
  2589 0000095A 9D                  <2> popf
  2590 0000095B FB                  <2> sti
  2591 0000095C 81C603000000        <1> add esi,3
  2592 00000962 FE05[A60C0000]      <1> inc byte [VIDEO_VGA_COLOR]
  2593 00000968 803D[A60C0000]10    <1> cmp byte [VIDEO_VGA_COLOR], 16 
  2594 0000096F 7407                <1> je end_inc
  2595 00000971 EA[CD080000]0800    <1> jmp dword 0x0008:set_next_color1
  2596                              <1> end_inc:
  2597                              <1> TIMER_rtc_msdelay       50 
  2598 00000978 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  2599 0000097D 31DB                <2> xor ebx, ebx
  2600 0000097F BB32000000          <2> mov ebx, %1
  2601 00000984 01D8                <2> add eax, ebx
  2602 00000986 93                  <2> xchg eax, ebx
  2603                              <2> 
  2604                              <2> 
  2605                              <2> 
  2606                              <2> %%check_rtc:
  2607 00000987 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  2608 0000098C 39D8                <2> cmp eax, ebx
  2609 0000098E 7CF7                <2> jl %%check_rtc
  2610                              <2> 
  2611 00000990 803D[A70C0000]00    <1> cmp byte [VIDEO_VGA_RGB], 0
  2612 00000997 7407                <1> je end_fadein
  2613 00000999 EA[A0080000]0800    <1> jmp dword 0x0008:set_next_inc
  2614                              <1> end_fadein:
  2615 000009A0 CB                  <1> retf
  2616                              <1> 
  2617                              <1> ;============================================================================
  2618                              <1> VIDEO_TEXTMODE_ADDRESS		equ     0x000B8000
  2619                              <1> VIDEO_GRAPHMODE_ADDRESS		equ	0x000A0000
  2620 000009A1 01                  <1> VIDEO_TEXTMODE_ROW_POSITION	DB	0x01
  2621 000009A2 01                  <1> VIDEO_TEXTMODE_COL_POSITION	DB	0x01
  2622                              <1> VIDEO_VGA_READ_INDEX_PORT	equ	0x03C7
  2623                              <1> VIDEO_VGA_WRITE_INDEX_PORT	equ	0x03C8
  2624                              <1> VIDEO_VGA_DATA_PORT		equ	0x03C9
  2625                              <1> VIDEO_VGA_PALETTE_SIZE		equ	256 * 3
  2626 000009A3 00<rept>            <1> VIDEO_VGA_PAL_BUFFER		times VIDEO_VGA_PALETTE_SIZE DB 0
  2627 00000CA3 00                  <1> VIDEO_VGA_RED			DB	0
  2628 00000CA4 00                  <1> VIDEO_VGA_GREEN			DB	0
  2629 00000CA5 00                  <1> VIDEO_VGA_BLUE			DB	0
  2630 00000CA6 00                  <1> VIDEO_VGA_COLOR			DB	0
  2631 00000CA7 00                  <1> VIDEO_VGA_RGB			DB	0
  2632 00000CA8 00                  <1> VIDEO_TEXTMODE_LINE		DB	0
  2633 00000CA9 00                  <1> VIDEO_TEXTMODE_WINDOW_LINE_START	DB	0	
  2634                              <1> 
  2635                              <1> ;offset = (row * ROW_RES ) + column
  2636                              <1> ;320x200 - 64K memory
  2637                              <1> 
  2638                              <1> ; !!! console lib !!!
  2639                              <1> ; before writing a line to the bottom screen, screen must scroll one line up
  2640                              <1> ; if is something on it
  2641                              <1> 
  2642                                  %include "keyboard.inc"
  2643                              <1> ;
  2644                              <1> ;^8042 - Keyboard Controller  (AT,PS/2)
  2645                              <1> ;                    
  2646                              <1> ;%       8042 Status Register (port 64h read)
  2647                              <1> ;                    
  2648                              <1> ;        |7|6|5|4|3|2|1|0|  8042 Status Register
  2649                              <1> ;         | | | | | | | ----- output register (60h) has data for system
  2650                              <1> ;         | | | | | | ------ input register (60h/64h) has data for 8042
  2651                              <1> ;         | | | | | ------- system flag (set to 0 after power on reset)
  2652                              <1> ;         | | | | -------- data in input register is command (1) or data (0)
  2653                              <1> ;         | | | --------- 1=keyboard enabled, 0=keyboard disabled (via switch)
  2654                              <1> ;         | | ---------- 1=transmit timeout (data transmit not complete)
  2655                              <1> ;         | ----------- 1=receive timeout (data transmit not complete)
  2656                              <1> ;         ------------ 1=even parity rec'd, 0=odd parity rec'd (should be odd)
  2657                              <1> ;        
  2658                              <1> ;%       Port Mode                 Description
  2659                              <1> ;              
  2660                              <1> ;        64h  read   8042 status register. Can be read at any time.  See
  2661                              <1> ;                    table above for more information.
  2662                              <1> ;        64h  write  8042 command register.  Writing this port sets Bit 3
  2663                              <1> ;                    of the status register to 1 and the byte is treated
  2664                              <1> ;                    as a controller command.  Devices attached to the
  2665                              <1> ;                    8042 should be disabled before issuing commands that
  2666                              <1> ;                    return data since data in the output register will
  2667                              <1> ;                    be overwritten.
  2668                              <1> ;        60h  read   8042 output register (should only be read if Bit 0 of
  2669                              <1> ;                    status port is set to 1)
  2670                              <1> ;        60h  write  8042 data register.  Data should only be written if
  2671                              <1> ;                    Bit 1 of the status register is zero (register is empty).
  2672                              <1> ;                    When this port is written Bit 3 of the status register
  2673                              <1> ;                    is set to zero and the byte is treated as a data.  The
  2674                              <1> ;                    8042 uses this byte if it's expecting data for a previous
  2675                              <1> ;                    command, otherwise the data is written directly to the
  2676                              <1> ;                    keyboard.   See ~KEYBOARD COMMANDS~ for information on
  2677                              <1> ;                    programming the actual keyboard hardware.
  2678                              <1> ;         
  2679                              <1> ;         
  2680                              <1> ;^8042 Commands Related to PC Systems  (Port 64h)
  2681                              <1> ;         
  2682                              <1> ;%       Command                    Description
  2683                              <1> ;        
  2684                              <1> ;         20   Read 8042 Command Byte: current 8042 command byte is placed
  2685                              <1> ;              in port 60h.
  2686                              <1> ;         60   Write 8042 Command Byte: next data byte written to port 60h is
  2687                              <1> ;              placed in 8042 command register.  Format:
  2688                              <1> ;        
  2689                              <1> ;             |7|6|5|4|3|2|1|0|  8042 Command Byte
  2690                              <1> ;              | | | | | | | ----- 1=enable output register full interrupt
  2691                              <1> ;              | | | | | | ------ should be 0 
  2692                              <1> ;              | | | | | ------- 1=set status register system, 0=clear
  2693                              <1> ;              | | | | -------- 1=override keyboard inhibit, 0=allow inhibit
  2694                              <1> ;              | | | --------- disable keyboard I/O by driving clock line low
  2695                              <1> ;              | | ---------- disable auxiliary device, drives clock line low
  2696                              <1> ;              | ----------- IBM scancode translation 0=AT, 1=PC/XT
  2697                              <1> ;              ------------ reserved, should be 0
  2698                              <1> ;                    
  2699                              <1> ;         A4   Password Installed Test: returned data can be read
  2700                              <1> ;              from port 60h;  FA=password installed, F1=no password
  2701                              <1> ;         A5   Load Security: bytes written to port 60h will be read
  2702                              <1> ;              until a null (0) is found.
  2703                              <1> ;         A6   Enable Security: works only if a password is already loaded
  2704                              <1> ;         A7   Disable Auxiliary Interface: sets Bit 5 of command register
  2705                              <1> ;              stopping auxiliary I/O by driving the clock line low
  2706                              <1> ;         A8   Enable Auxiliary Interface: clears Bit 5 of command register
  2707                              <1> ;         A9   Auxiliary Interface Test: clock and data lines are tested;
  2708                              <1> ;              results placed at port 60h are listed below:
  2709                              <1> ;        
  2710                              <1> ;                00  no error
  2711                              <1> ;                01  keyboard clock line is stuck low
  2712                              <1> ;                02  keyboard clock line is stuck high
  2713                              <1> ;                03  keyboard data line is stuck low
  2714                              <1> ;                04  keyboard data line is stuck high
  2715                              <1> ;             
  2716                              <1> ;         AA   Self Test: diagnostic result placed at port 60h, 55h=OK
  2717                              <1> ;         AB   Keyboard Interface Test:  clock and data lines are tested;
  2718                              <1> ;              results placed at port 60h are listed above with command A9
  2719                              <1> ;         AC   Diagnostic Dump: sends 16 bytes of 8042's RAM, current input
  2720                              <1> ;              port state, current output port state and 8042 program status
  2721                              <1> ;              word to port 60h in scan-code format.
  2722                              <1> ;         AD   Disable Keyboard Interface: sets Bit 4 of command register
  2723                              <1> ;              stopping keyboard I/O by driving the clock line low
  2724                              <1> ;         AE   Enable Keyboard Interface: clears Bit 4 of command register
  2725                              <1> ;              enabling keyboard interface.
  2726                              <1> ;         C0   Read Input Port: data is read from its input port (which is
  2727                              <1> ;              inaccessible to the data bus) and written to output register
  2728                              <1> ;              at port 60h;  output register should be empty before call.
  2729                              <1> ;         
  2730                              <1> ;               |7|6|5|4|3-0|  8042 Input Port
  2731                              <1> ;                | | | | ----- undefined
  2732                              <1> ;                | | | ------ 1=enable 2nd 256K of motherboard RAM, 0=disable
  2733                              <1> ;                | | ------- 1=manufacturing jumper not installed, 0=installed
  2734                              <1> ;                | -------- 1=primary display is MDA, 0=primary display is CGA
  2735                              <1> ;                --------- 1=keyboard not inhibited, 0=keyboard inhibited
  2736                              <1> ;                
  2737                              <1> ;         C1   Poll Input Port Low Bits: Bits 0-3 of port 1 placed in
  2738                              <1> ;              status Bits 4-7
  2739                              <1> ;         C2   Poll Input Port High Bits: Bits 4-7 of port 1 placed in
  2740                              <1> ;              status Bits 4-7
  2741                              <1> ;         D0   Read Output Port: data is read from 8042 output port (which is
  2742                              <1> ;              inaccessible to the data bus) and placed in output register;
  2743                              <1> ;              the output register should be empty.  (see command D1 below)
  2744                              <1> ;         D1   Write Output Port: next byte written to port 60h is placed in
  2745                              <1> ;              the 8042 output port (which is inaccessible to the data bus)
  2746                              <1> ;              
  2747                              <1> ;                |7|6|5|4|3|2|1|0|  8042 Output Port
  2748                              <1> ;                 | | | | | | | ----- system reset line
  2749                              <1> ;                 | | | | | | ------ gate A20
  2750                              <1> ;                 | | | | --------- undefined
  2751                              <1> ;                 | | | ---------- output buffer full
  2752                              <1> ;                 | | ----------- input buffer empty
  2753                              <1> ;                 | ------------ keyboard clock (output)
  2754                              <1> ;                 ------------- keyboard data (output)
  2755                              <1> ;         
  2756                              <1> ;         D2   Write Keyboard Output Register: on PS/2 systems the next data
  2757                              <1> ;              byte written to port 60h input register is written to port 60h
  2758                              <1> ;              output register as if initiated by a device; invokes interrupt
  2759                              <1> ;              if enabled
  2760                              <1> ;         D3   Write Auxiliary Output Register: on PS/2 systems the next data
  2761                              <1> ;              byte written to port 60h input register is written to port 60h
  2762                              <1> ;              output register as if initiated by a device; invokes interrupt
  2763                              <1> ;              if enabled
  2764                              <1> ;         D4   Write Auxiliary Device: on PS/2 systems the next data byte
  2765                              <1> ;              written to input register a port at 60h is sent to the
  2766                              <1> ;              auxiliary device
  2767                              <1> ;         E0   Read Test Inputs: 8042 reads its T0 and T1 inputs; data is
  2768                              <1> ;              placed in output register;  Bit 0 is T0, Bit 1 is T1:
  2769                              <1> ;                |1|0|  Test Input Port Bits
  2770                              <1> ;                 | ----- keyboard clock
  2771                              <1> ;                 ------ keyboard data
  2772                              <1> ;                
  2773                              <1> ;         Fx   Pulse Output Port: Bits 0-3 of the 8042 output port can be
  2774                              <1> ;              pulsed low for 6 ms;  Bits 0-3 of command indicate which
  2775                              <1> ;              Bits should be pulsed; 0=pulse, 1=don't pulse; pulsing
  2776                              <1> ;              Bit 0 results in CPU reset since it is connected to system
  2777                              <1> ;              reset line.
  2778                              <1> ;                 
  2779                              <1> ;        - PC systems previous to the AT use the 8255 PPI as a keyboard
  2780                              <1> ;          controller and use the keyboard's internal 8048.
  2781                              <1> ;        - the keyboard's internal controller buffers up to 16 bytes of
  2782                              <1> ;          make/break code information.  This is common among all PC systems
  2783                              <1> ;          and shouldn't be confused with the (32 byte) keyboard buffer
  2784                              <1> ;          maintained by the BIOS.
  2785                              <1> ;        - see  ~KEYBOARD COMMANDS~ for information on programming the
  2786                              <1> ;          keyboards internal microprocessor
  2787                              <1> ;
  2788                              <1> ; KEYBOARD COMMANDS
  2789                              <1> ;
  2790                              <1> ;EDh nn          write LEDs, as above
  2791                              <1> ;EEh             echo, keyboard responds with EEh
  2792                              <1> ;EFh             no-operation (reserved)
  2793                              <1> ;F0h nn          selects scancode set nn=1-3 or 0 to return current set
  2794                              <1> ;F2h             read ID. Keyboard responds with ACK (FAh) and two optional
  2795                              <1> ;                ID bytes:
  2796                              <1> ;                    (none)      AT keyboard
  2797                              <1> ;                    83h ABh     (?)
  2798                              <1> ;                    ABh 41h     MF2, translation mode
  2799                              <1> ;                    ABh 83h     MF2, pass-through mode
  2800                              <1> ;F3h nn          set typematic (auto-repeat) rate/delay. nn=
  2801                              <1> ;                    b7      unused
  2802                              <1> ;                    b6..5   Repeat delay (00=250 msec ... 11=1000msec)
  2803                              <1> ;                    b4..0   Repeat rate (00000=30 Hz ... 11111=2 Hz).
  2804                              <1> ;F4h             clears output buffer, enables keyboard
  2805                              <1> ;F5h             disables keyboard, resets to defaults
  2806                              <1> ;F6h             sets keyboard defaults
  2807                              <1> ;
  2808                              <1> ;F7h             make all keys typematic (auto-repeat)   [*]
  2809                              <1> ;F8h             make all keys make-break                [*]
  2810                              <1> ;F9h             make all keys make-only                 [*]
  2811                              <1> ;FAh             make all keys typematic and make-break  [*]
  2812                              <1> ;FBh nn          make one key typematic                  [*]
  2813                              <1> ;FCh nn          make one key make-break                 [*]
  2814                              <1> ;FDh nn          make one key make-only                  [*]
  2815                              <1> ;                        [*] these commands may work only for
  2816                              <1> ;                            scancode set 3; I'm not sure.
  2817                              <1> ;FEh             resend previous scan code
  2818                              <1> ;FFh             reset keyboard CPU, do power-on self-test, return
  2819                              <1> ;                self-test result byte
  2820                              <1> ;
  2821                              <1> 
  2822                              <1> 
  2823                              <1> %macro KEYBOARD_write	2
  2824                              <1> %%get_status_write:
  2825                              <1> in al, KEYBOARD_COMMAND_PORT
  2826                              <1> mov ah, 0x02
  2827                              <1> and ah, al
  2828                              <1> cmp ah, 0x02
  2829                              <1> je %%get_status_write	; loop until 8042 input buffer empty
  2830                              <1> xor dx, dx
  2831                              <1> mov dl, %1
  2832                              <1> mov al, %2
  2833                              <1> out dx, al
  2834                              <1> %endmacro
  2835                              <1> 
  2836                              <1> %macro KEYBOARD_read	1
  2837                              <1> %%get_status_read:
  2838                              <1> in al, KEYBOARD_COMMAND_PORT
  2839                              <1> mov ah, 0x01
  2840                              <1> and ah, al
  2841                              <1> cmp ah, 0x01
  2842                              <1> jne %%get_status_read	; loop until 8042 output buffer full
  2843                              <1> in al, KEYBOARD_DATA_PORT
  2844                              <1> mov ah, 0xC0
  2845                              <1> and ah, al
  2846                              <1> cmp ah, 0
  2847                              <1> jne %%get_status_read	; loop if parity error
  2848                              <1> mov byte [%1], al
  2849                              <1> %endmacro
  2850                              <1> 
  2851                              <1> %macro KEYBOARD_init	0
  2852                              <1> KEYBOARD_write		0x60, 0xF5	; Disable Keyboard
  2853                              <1> ; Expect 0xFA 
  2854                              <1> KEYBOARD_write		0x64, 0x60
  2855                              <1> KEYBOARD_write		0x60, 01100101b	; Enable Interrupt and Disable PS/2 Mouse
  2856                              <1> KEYBOARD_write		0x60, 0xF6	; Keyboard Defaults
  2857                              <1> ;;;KEYBOARD_write		0x60, 0xF0	; Setting Scancode
  2858                              <1> ; Expect 0xFA
  2859                              <1> ;;;KEYBOARD_write		0x60, 0x01	; Scancode Set
  2860                              <1> ; Expect 0xFA
  2861                              <1> KEYBOARD_write		0x60, 0xF7	; Make all Keys Typematic (auto-repeat)
  2862                              <1> ; Expect 0xFA
  2863                              <1> KEYBOARD_write		0x60, 0xF3	; Setting Typematic Delay
  2864                              <1> ; Expect 0xFA
  2865                              <1> KEYBOARD_write		0x60, 0		; RATE=30 chars/s,DELAY=250 msec
  2866                              <1> ; Expect 0xFA
  2867                              <1> KEYBOARD_write		0x60, 0xF4	; Enable Keyboard
  2868                              <1> ; Expect 0xFA
  2869                              <1> %endmacro
  2870                              <1> 
  2871                              <1> %macro KEYBOARD_get_key		1	
  2872                              <1> %%get_again:
  2873                              <1> xor	ax, ax
  2874                              <1> mov	al, [KEYBOARD_KEY]
  2875                              <1> cmp	ax, KEYBOARD_RELEASE_KEY	; !!! This MUST be a 16-bit register !!!
  2876                              <1> jge %%get_again
  2877                              <1> mov	byte [%1], al
  2878                              <1> mov	al, KEYBOARD_RELEASE_KEY
  2879                              <1> mov 	[KEYBOARD_KEY], al
  2880                              <1> %endmacro
  2881                              <1> 
  2882                              <1> %macro  KEYBOARD_check_key  	1
  2883                              <1> mov	bl, %1
  2884                              <1> %%repeat_check:
  2885                              <1> ;;;in      al, KEYBOARD_IO_PORT    ; 0x60 IO PORT
  2886                              <1> mov	al, [KEYBOARD_KEY]
  2887                              <1> cmp     al, bl                  ; Key to check if is pressed
  2888                              <1> jne     %%repeat_check          ; JUMP if not equal
  2889                              <1> xor	al, al
  2890                              <1> mov 	[KEYBOARD_KEY], al
  2891                              <1> %endmacro
  2892                              <1> 
  2893                              <1> %macro KEYBOARD_direct_check_key	1
  2894                              <1> mov     bl, %1
  2895                              <1> %%repeat_check:
  2896                              <1> in      al, 0x60                ; GET KEY FROM KEYBOARD
  2897                              <1> cmp     al, bl                  ; CHECK KEY
  2898                              <1> jne     %%repeat_check          ; JUMP if not equal
  2899                              <1> %endmacro
  2900                              <1> 
  2901                              <1> %macro KEYBOARD_reset	0
  2902                              <1> mov     al, 0xFF
  2903                              <1> out     KEYBOARD_DATA_PORT, al            ; 0x60 IO PORT
  2904                              <1> %endmacro
  2905                              <1> 
  2906                              <1> %macro  KEYBOARD_status 	1
  2907                              <1> in      al, KEYBOARD_COMMAND_PORT       ; 0x64 CONTROL PORT
  2908                              <1> mov 	byte [%1], al
  2909                              <1> %endmacro
  2910                              <1> 
  2911                              <1> %macro KEYBOARD_clear_buffer 0
  2912                              <1> mov esi, 16 * 0x0040 + 0x001C
  2913                              <1> mov edi, 16 * 0x0040 + 0x001A
  2914                              <1> mov al, byte [es:esi]
  2915                              <1> mov byte [es:edi], al
  2916                              <1> %endmacro
  2917                              <1> 
  2918                              <1> %macro KEYBOARD_selftest	0
  2919                              <1> mov     al, 0xAA
  2920                              <1> out     KEYBOARD_COMMAND_PORT, al       ; 0x64 CONTROL PORT
  2921                              <1> %endmacro
  2922                              <1> 
  2923                              <1> %macro KEYBOARD_interface_self_test	0
  2924                              <1> mov     al, 0xAB
  2925                              <1> out     KEYBOARD_COMMAND_PORT, al       ; 0x64 CONTROL PORT
  2926                              <1> %endmacro
  2927                              <1> 
  2928                              <1> %macro KEYBOARD_enable	0
  2929                              <1> mov     al, 0xAE
  2930                              <1> out     KEYBOARD_COMMAND_PORT, al       ; 0x64 CONTROL PORT
  2931                              <1> %endmacro
  2932                              <1> 
  2933                              <1> %macro KEYBOARD_disable	0
  2934                              <1> mov     al, 0xAD
  2935                              <1> out     KEYBOARD_COMMAND_PORT, al       ; 0x64 CONTROL PORT
  2936                              <1> %endmacro
  2937                              <1> 
  2938                              <1> KEYBOARD_system_reset:
  2939 00000CAA B0FE                <1> mov al, 0xFE
  2940 00000CAC E664                <1> out KEYBOARD_COMMAND_PORT, al
  2941                              <1> 
  2942                              <1> %macro KEYBOARD_map	1
  2943                              <1> mov esi, pt_keys
  2944                              <1> mov bl, [%1]
  2945                              <1> %%try_key:
  2946                              <1> inc esi
  2947                              <1> mov al, byte [ds:esi]
  2948                              <1> add esi, 2
  2949                              <1> cmp al, bl
  2950                              <1> je %%skip_keys
  2951                              <1> cmp esi, end_pt_keys 
  2952                              <1> jne %%try_key
  2953                              <1> %%skip_keys:
  2954                              <1> sub esi, 1
  2955                              <1> mov al, byte [ds:esi]
  2956                              <1> mov byte [%1], al
  2957                              <1> %endmacro
  2958                              <1> 
  2959                              <1> ;==============================================================================
  2960                              <1> KEYBOARD_DATA_PORT        	equ     0x60
  2961                              <1> KEYBOARD_COMMAND_PORT    	equ     0x64
  2962                              <1> KEYBOARD_ESC_KEY		equ	0x01
  2963                              <1> KEYBOARD_ENTER_KEY		equ	0x1C
  2964                              <1> KEYBOARD_BACKSPACE_KEY		equ	14
  2965                              <1> KEYBOARD_RELEASE_KEY		equ	128	
  2966 00000CAE 00                  <1> KEYBOARD_KEY			DB	0x00	
  2967                              <1> ;------------------------------------------------------------------------------
  2968                              <1> ;                        KEYBOARD LAYOUT SCANCODES
  2969                              <1> ;------------------------------------------------------------------------------
  2970                              <1> ;
  2971                              <1> ; Portuguese
  2972                              <1> ; 		     press,   key,   ascii
  2973 00000CAF 000100              <1> pt_keys:	DB	0, 	1, 	0		; ESC
  2974 00000CB2 000231              <1> 		DB	0, 	2, 	49		; 1
  2975 00000CB5 2A0221              <1> 		DB	42, 	2, 	33		; Shift-1 = !	
  2976 00000CB8 000332              <1> 		DB	0, 	3, 	50		; 2 
  2977 00000CBB 2A0322              <1> 		DB	42, 	3, 	34		; Shift-2 = "
  2978 00000CBE 000433              <1> 		DB	0, 	4, 	51		; 3
  2979 00000CC1 2A0423              <1> 		DB	42, 	4, 	35		; Shift-3 = #
  2980 00000CC4 000534              <1> 		DB	0, 	5, 	52		; 4
  2981 00000CC7 2A0524              <1> 		DB	42, 	5, 	36		; Shift-4 = $
  2982 00000CCA 000635              <1> 		DB	0, 	6, 	53		; 5
  2983 00000CCD 2A0625              <1> 		DB	42, 	6, 	37		; Shift-5 = %
  2984 00000CD0 000736              <1> 		DB	0, 	7, 	54		; 6
  2985 00000CD3 2A0726              <1> 		DB	42, 	7, 	38		; Shift-6 = &
  2986 00000CD6 000837              <1> 		DB	0, 	8, 	55		; 7
  2987 00000CD9 2A082F              <1> 		DB	42, 	8, 	47		; Shift-7 = /
  2988 00000CDC 000938              <1> 		DB	0, 	9, 	56		; 8
  2989 00000CDF 2A0928              <1> 		DB	42, 	9, 	40		; Shift-8 = (
  2990 00000CE2 000A39              <1> 		DB 	0, 	10, 	57		; 9	
  2991 00000CE5 2A0A29              <1> 		DB 	42,	10, 	41		; Shift-9 = )
  2992 00000CE8 000B30              <1> 		DB 	0, 	11, 	48		; 0
  2993 00000CEB 2A0B3D              <1> 		DB 	42, 	11, 	61		; Shift-0 = =
  2994 00000CEE 000E00              <1> 		DB 	0, 	14, 	0		; BACKSPACE
  2995 00000CF1 001071              <1> 		DB 	0, 	16, 	113		; q
  2996 00000CF4 2A1051              <1> 		DB 	42, 	16, 	81		; Q
  2997 00000CF7 001177              <1> 		DB 	0, 	17, 	119		; w
  2998 00000CFA 2A1157              <1> 		DB 	42, 	17, 	87		; W
  2999 00000CFD 001265              <1> 		DB 	0, 	18, 	101		; e
  3000 00000D00 2A1245              <1> 		DB 	42, 	18, 	69		; E
  3001 00000D03 001372              <1> 		DB 	0, 	19, 	114		; r
  3002 00000D06 2A1352              <1> 		DB 	42, 	19, 	82		; R
  3003 00000D09 001474              <1> 		DB 	0, 	20, 	116		; t
  3004 00000D0C 2A1454              <1> 		DB 	42, 	20, 	84		; T
  3005 00000D0F 001579              <1> 		DB 	0, 	21, 	121		; y
  3006 00000D12 2A1559              <1> 		DB 	42, 	21, 	89		; Y
  3007 00000D15 001675              <1> 		DB 	0, 	22, 	117		; u
  3008 00000D18 2A1655              <1> 		DB 	42, 	22, 	85		; U
  3009 00000D1B 001769              <1> 		DB 	0, 	23, 	105		; i
  3010 00000D1E 2A1749              <1> 		DB 	42, 	23, 	73		; I
  3011 00000D21 00186F              <1> 		DB 	0, 	24, 	111		; o
  3012 00000D24 2A184F              <1> 		DB 	42, 	24, 	79		; O
  3013 00000D27 001970              <1> 		DB 	0, 	25, 	112		; p
  3014 00000D2A 2A1950              <1> 		DB 	42, 	25, 	80		; P 
  3015 00000D2D 001C00              <1> 		DB 	0, 	28, 	0		; ENTER
  3016 00000D30 001D00              <1> 		DB 	0, 	29, 	0		; CTRL
  3017 00000D33 001E61              <1> 		DB 	0, 	30, 	97		; a 
  3018 00000D36 2A1E41              <1> 		DB 	42, 	30, 	65		; A
  3019 00000D39 001F73              <1> 		DB 	0, 	31, 	115		; s
  3020 00000D3C 2A1F53              <1> 		DB 	42, 	31, 	83		; S
  3021 00000D3F 002064              <1> 		DB 	0, 	32, 	100		; d
  3022 00000D42 2A2044              <1> 		DB 	42, 	32, 	68		; D
  3023 00000D45 002166              <1> 		DB 	0, 	33, 	102		; f
  3024 00000D48 2A2146              <1> 		DB 	42, 	33, 	70		; F
  3025 00000D4B 002267              <1> 		DB 	0, 	34, 	103		; g
  3026 00000D4E 2A2247              <1> 		DB 	42, 	34, 	71		; G
  3027 00000D51 002368              <1> 		DB 	0, 	35, 	104		; h
  3028 00000D54 2A2348              <1> 		DB 	42, 	35, 	72		; H
  3029 00000D57 00246A              <1> 		DB 	0, 	36, 	106		; j
  3030 00000D5A 2A244A              <1> 		DB 	42, 	36, 	74		; J
  3031 00000D5D 00256B              <1> 		DB 	0, 	37, 	107		; k
  3032 00000D60 2A254B              <1> 		DB 	42, 	37, 	75		; K
  3033 00000D63 00266C              <1> 		DB 	0, 	38, 	108		; l
  3034 00000D66 2A264C              <1> 		DB 	42, 	38, 	76		; L
  3035 00000D69 002A00              <1> 		DB 	0, 	42, 	0		; LEFT SHIFT
  3036 00000D6C 002B00              <1> 		DB 	0, 	43, 	0		; 		DB 	42, 	43, 	0		; Shift-\ = |
  3037 00000D6F 002C7A              <1> 		DB 	0, 	44, 	122		; z
  3038 00000D72 2A2C5A              <1> 		DB 	42, 	44, 	90		; Z
  3039 00000D75 002D78              <1> 		DB 	0, 	45, 	120		; x
  3040 00000D78 2A2D58              <1> 		DB 	42, 	45, 	88		; X
  3041 00000D7B 002E63              <1> 		DB 	0, 	46, 	99		; c
  3042 00000D7E 2A2E43              <1> 		DB 	42, 	46, 	67		; C
  3043 00000D81 002F76              <1> 		DB 	0, 	47, 	118		; v
  3044 00000D84 2A2F56              <1> 		DB 	42, 	47, 	86		; V
  3045 00000D87 003062              <1> 		DB 	0, 	48, 	98		; b
  3046 00000D8A 2A3042              <1> 		DB 	42, 	48, 	66		; B
  3047 00000D8D 00316E              <1> 		DB 	0, 	49, 	110		; n 
  3048 00000D90 2A314E              <1> 		DB 	42, 	49, 	78		; N
  3049 00000D93 00326D              <1> 		DB 	0, 	50, 	109		; m
  3050 00000D96 2A324D              <1> 		DB 	42, 	50, 	77		; M
  3051 00000D99 003800              <1> 		DB 	0, 	56, 	0		; ALT
  3052 00000D9C 003900              <1> 		DB 	0, 	57, 	0		; SPACEBAR
  3053 00000D9F 003B00              <1> 		DB 	0, 	59, 	0		; F1
  3054 00000DA2 003C00              <1> 		DB 	0, 	60, 	0		; F2
  3055 00000DA5 003D00              <1> 		DB 	0, 	61, 	0		; F3
  3056 00000DA8 003E00              <1> 		DB 	0, 	62, 	0		; F4
  3057 00000DAB 003F00              <1> 		DB 	0, 	63, 	0		; F5
  3058 00000DAE 004000              <1> 		DB 	0, 	64, 	0		; F6
  3059 00000DB1 004100              <1> 		DB 	0, 	65, 	0		; F7
  3060 00000DB4 004200              <1> 		DB 	0, 	66, 	0		; F8
  3061 00000DB7 004300              <1> 		DB 	0, 	67, 	0		; F9
  3062 00000DBA 004400              <1> 		DB 	0, 	68, 	0		; F10
  3063 00000DBD 008500              <1> 		DB 	0, 	133, 	0		; F11
  3064 00000DC0 008600              <1> 		DB 	0, 	134, 	0		; F12
  3065                              <1> 		
  3066                              <1> end_pt_keys:
  3067                              <1> 
  3068                              <1> 
  3069                                  
  3070                                  %include "gdt.inc"
  3071                              <1> 
  3072                              <1> ; Segment Selector Struc
  3073                              <1> ;
  3074                              <1> ;15-bit                                 2-bit   0-bit
  3075                              <1> ;=================================================
  3076                              <1> ;             index	               | TI | RPL|
  3077                              <1> ;=================================================
  3078                              <1> ; index : index into GDT or LDT
  3079                              <1> ; TI	: Table indicator	0=GDT	1=LDT
  3080                              <1> ; RPL   : Requested Privilege Level	00=0	01=1	10=2	11=3
  3081                              <1> ;  
  3082                              <1> 
  3083                              <1> ; Segment Descriptor Format
  3084                              <1> ;
  3085                              <1> ;31-bit          23-bit		          15-bit                            0
  3086                              <1> ;============================================================================
  3087                              <1> ;  Base 31..24  |G|DB|res|av|Limit 19..16|P| DPL |DT| Type | Base 23..16  
  3088                              <1> ;----------------------------------------------------------------------------
  3089                              <1> ;              Base 15..0	         |	    Limit 15..0          
  3090                              <1> ;============================================================================
  3091                              <1> ; Base 31..24, Base 23..16, Base 15..0 : Segment Base
  3092                              <1> ; Limit 19..16, Limit 15..0 : Segment Limit
  3093                              <1> ;    G : Granularity	0=Byte Granularity		1=Page Granularity
  3094                              <1> ;   DB : Segment Size 	0=16-bit addresses(default)	1=32-bit addresses(Big)
  3095                              <1> ;  res : Reserved 
  3096                              <1> ;   av : Available for Operating System
  3097                              <1> ;    P : Segment Present	0=Segment Not in Memory	1=Segment in Memory
  3098                              <1> ;  DPL : Descriptor Privilege Level	00=0	01=1	10=2	11=3
  3099                              <1> ;   DT : Descriptor Type	0=System Segment	1=Application Segment
  3100                              <1> ; Type : Type of System or Application Segment
  3101                              <1> ;
  3102                              <1> 
  3103                              <1> ; For DT=1
  3104                              <1> ;===================================================== 
  3105                              <1> ;  Type
  3106                              <1> ;=====================================================
  3107                              <1> ;  0000		read only
  3108                              <1> ;  0001		read only, accessed
  3109                              <1> ;  0010		read/write
  3110                              <1> ;  0011		read/write, accessed
  3111                              <1> ;  0100		read only, expand down
  3112                              <1> ;  0101		read only, expand down, accessed
  3113                              <1> ;  0110		read/write, expand down
  3114                              <1> ;  0111		read/write, expand down, accessed
  3115                              <1> ;  1000		execute only
  3116                              <1> ;  1001		execute only, accessed
  3117                              <1> ;  1010		execute/read
  3118                              <1> ;  1011		execute/read, accessed
  3119                              <1> ;  1100		execute only, conforming
  3120                              <1> ;  1101		execute only, conforming, accessed
  3121                              <1> ;  1110		execute/read, conforming
  3122                              <1> ;  1111		execute/read, conforming, accessed
  3123                              <1> ;
  3124                              <1> ; For DT=0
  3125                              <1> ;======================================================
  3126                              <1> ;  Type
  3127                              <1> ;======================================================
  3128                              <1> ;  0000		reserved
  3129                              <1> ;  0001		available 80286 TSS
  3130                              <1> ;  0010		LDT
  3131                              <1> ;  0011		active 80286 TSS
  3132                              <1> ;  0100		80286 Call Gate
  3133                              <1> ;  0101		Task Gate (80286+i386)
  3134                              <1> ;  0110		80286 Interrupt Gate
  3135                              <1> ;  0111		80286 Trap Gate
  3136                              <1> ;  1000		reserved
  3137                              <1> ;  1001		available i386 TSS
  3138                              <1> ;  1010		reserved
  3139                              <1> ;  1011		active i386 TSS
  3140                              <1> ;  1100		i386 Call Gate
  3141                              <1> ;  1101		reserved
  3142                              <1> ;  1110		i386 Interrupt Gate
  3143                              <1> ;  1111		i386 Trap Gate 
  3144                              <1> ;	 
  3145                              <1> ;=======================================================================
  3146                              <1> gdt_ptr:
  3147 00000DC3 5700                <1> 	  dw	gdt_size-1	; Length of GDT
  3148 00000DC5 [C90D0000]          <1> 	  dd	gdt		; GDT address
  3149                              <1> 
  3150                              <1> gdt:
  3151 00000DC9 00<rept>            <1> null_des  times	8 DB 0		; NULL descriptor
  3152                              <1> ; selector 0x0008
  3153                              <1> ; execute/read, accessed
  3154                              <1> code32:   
  3155 00000DD1 FFFF                <1> 	  dw	0xFFFF		; Limit 0..15 (4096*0FFFFFh=4GB)
  3156 00000DD3 0000                <1> 	  dw	0		; Base 0..15
  3157 00000DD5 00                  <1>  	  db	0		; Base 16..23
  3158 00000DD6 9B                  <1> 	  db	10011011b	; P=1 DPL=00 DT=1 TYPE=1011
  3159 00000DD7 CF                  <1> 	  db	11001111b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3160 00000DD8 00                  <1> 	  db	0		; Base [24..31]
  3161                              <1> ; selector 0x0010
  3162                              <1> ; read/write, accessed
  3163                              <1> data32:   
  3164 00000DD9 FFFF                <1> 	  dw	0xFFFF		; Limit 0..15 (4096*0FFFFFh=4GB)
  3165 00000DDB 0000                <1> 	  dw	0		; Base 0..15
  3166 00000DDD 00                  <1>  	  db	0		; Base 16..23
  3167 00000DDE 93                  <1> 	  db	10010011b	; P=1 DPL=00 DT=1 TYPE=0011
  3168 00000DDF CF                  <1> 	  db	11001111b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3169 00000DE0 00                  <1> 	  db	0		; Base [24..31]
  3170                              <1> ; selector 0x0018
  3171                              <1> int_gate: 
  3172 00000DE1 FFFF                <1> 	  dw	0xFFFF		; Limit 0..15 (4096*0FFFFFh=4GB)
  3173 00000DE3 0000                <1> 	  dw	0		; Base 0..15
  3174 00000DE5 00                  <1>  	  db	0		; Base 16..23
  3175 00000DE6 8E                  <1> 	  db	10001110b	; P=1 DPL=00 DT=0 TYPE=1110
  3176 00000DE7 CF                  <1> 	  db	11001111b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3177 00000DE8 00                  <1> 	  db	0		; Base [24..31]
  3178                              <1> ; selector 0x0020
  3179                              <1> call_gate: 
  3180 00000DE9 FFFF                <1> 	  dw	0xFFFF		; Limit 0..15 (4096*0FFFFFh=4GB)
  3181 00000DEB 0000                <1> 	  dw	0		; Base 0..15
  3182 00000DED 00                  <1>  	  db	0		; Base 16..23
  3183 00000DEE 8C                  <1> 	  db	10001100b	; P=1 DPL=00 DT=0 TYPE=1100
  3184 00000DEF CF                  <1> 	  db	11001111b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3185 00000DF0 00                  <1> 	  db	0		; Base [24..31]
  3186                              <1> ; selector 0x0028
  3187                              <1> active_tss: 
  3188 00000DF1 FFFF                <1> 	  dw	0xFFFF		; Limit 0..15 (4096*0FFFFFh=4GB)
  3189 00000DF3 0000                <1> 	  dw	0		; Base 0..15
  3190 00000DF5 00                  <1>  	  db	0		; Base 16..23
  3191 00000DF6 8B                  <1> 	  db	10001011b	; P=1 DPL=00 DT=0 TYPE=1011
  3192 00000DF7 CF                  <1> 	  db	11001111b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3193 00000DF8 00                  <1> 	  db	0		; Base [24..31]
  3194                              <1> ; selector 0x0030
  3195                              <1> avail_tss: 
  3196 00000DF9 FFFF                <1> 	  dw	0xFFFF		; Limit 0..15 (4096*0FFFFFh=4GB)
  3197 00000DFB 0000                <1> 	  dw	0		; Base 0..15
  3198 00000DFD 00                  <1>  	  db	0		; Base 16..23
  3199 00000DFE 89                  <1> 	  db	10001001b	; P=1 DPL=00 DT=0 TYPE=1001
  3200 00000DFF CF                  <1> 	  db	11001111b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3201 00000E00 00                  <1> 	  db	0		; Base [24..31]
  3202                              <1> ; selector 0x0038
  3203                              <1> ldt: 
  3204 00000E01 FFFF                <1> 	  dw	0xFFFF		; Limit 0..15 (4096*0FFFFFh=4GB)
  3205 00000E03 0000                <1> 	  dw	0		; Base 0..15
  3206 00000E05 00                  <1>  	  db	0		; Base 16..23
  3207 00000E06 82                  <1> 	  db	10000010b	; P=1 DPL=00 DT=0 TYPE=0010
  3208 00000E07 CF                  <1> 	  db	11001111b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3209 00000E08 00                  <1> 	  db	0		; Base [24..31]
  3210                              <1> ; selector 0x0040
  3211                              <1> sys_tss: 
  3212 00000E09 6700                <1> 	  dw	103		; Limit 0..15 (4096*0FFFFFh=4GB)
  3213 00000E0B 0000                <1> 	  dw	0		; Base 0..15
  3214 00000E0D 00                  <1>  	  db	0		; Base 16..23
  3215 00000E0E 89                  <1> 	  db	10001001b	; P=1 DPL=00 DT=0 TYPE=1001
  3216 00000E0F C0                  <1> 	  db	11000000b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3217 00000E10 00                  <1> 	  db	0		; Base [24..31]
  3218                              <1> ; selector 0x0048
  3219                              <1> user_tss1: 
  3220 00000E11 6700                <1> 	  dw	103		; Limit 0..15 (4096*0FFFFFh=4GB)
  3221 00000E13 0000                <1> 	  dw	0		; Base 0..15
  3222 00000E15 00                  <1>  	  db	0		; Base 16..23
  3223 00000E16 89                  <1> 	  db	10001001b	; P=1 DPL=00 DT=0 TYPE=1001
  3224 00000E17 C0                  <1> 	  db	11000000b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3225 00000E18 00                  <1> 	  db	0		; Base [24..31]
  3226                              <1> ; selector 0x0050
  3227                              <1> user_tss2: 
  3228 00000E19 6700                <1> 	  dw	103		; Limit 0..15 (4096*0FFFFFh=4GB)
  3229 00000E1B 0000                <1> 	  dw	0		; Base 0..15
  3230 00000E1D 00                  <1>  	  db	0		; Base 16..23
  3231 00000E1E 89                  <1> 	  db	10001001b	; P=1 DPL=00 DT=0 TYPE=1001
  3232 00000E1F C0                  <1> 	  db	11000000b	; G=1 DB=1 res=0 av=0 Limit 16..19
  3233 00000E20 00                  <1> 	  db	0		; Base [24..31]
  3234                              <1> 
  3235                              <1> ;SYSTEM_CODE_SELECTOR
  3236                              <1> ;SYSTEM_TSS_SELECTOR
  3237                              <1> ;USER_TSS_SELECTOR
  3238                              <1> ; blah..blah
  3239                              <1> ;ldt_selector:
  3240                              <1> ;idt_selector: !!! this is really needed for DT=0 !!!
  3241                              <1> ;tss_selector:
  3242                              <1> 
  3243                              <1> gdt_size  equ	$-gdt	
  3244                              <1> ;=======================================================================
  3245                              <1> 
  3246                                  %include "idt.inc";
  3247                              <1> ;Figure 9-3.  80306 IDT Gate Descriptors
  3248                              <1> ;
  3249                              <1> ;                                80386 TASK GATE
  3250                              <1> ;   31                23                15                7                0
  3251                              <1> ;  
  3252                              <1> ;  (NOT USED) P DPL0 0 1 0 1(NOT USED)4
  3253                              <1> ;  
  3254                              <1> ;               SELECTOR              (NOT USED)0
  3255                              <1> ;  
  3256                              <1> 
  3257                              <1> ;                                80386 INTERRUPT GATE
  3258                              <1> ;   31                23                15                7                0
  3259                              <1> ;  
  3260                              <1> ;             OFFSET 31..16            P DPL0 1 1 1 00 0 0(NOT USED) 4
  3261                              <1> ;  
  3262                              <1> ;               SELECTOR                         OFFSET 15..0            0
  3263                              <1> ;  
  3264                              <1> 
  3265                              <1> ;                                80386 TRAP GATE
  3266                              <1> ;   31                23                15                7                0
  3267                              <1> ;  
  3268                              <1> ;            OFFSET 31..16             P DPL0 1 1 1 10 0 0(NOT USED) 4
  3269                              <1> ;  
  3270                              <1> ;               SELECTOR                         OFFSET 15..0            0
  3271                              <1> ;  
  3272                              <1> ;
  3273                              <1> ;==============================================================================
  3274                              <1> 
  3275                              <1> ;%include "pic.inc"
  3276                              <1> ;%include "floppy.inc"
  3277                              <1> 
  3278                              <1> fill_idt:
  3279 00000E21 BF[5A0E0000]        <1> mov edi, idt
  3280 00000E26 BE[A20F0000]        <1> mov esi, int_address
  3281                              <1> next_int:
  3282 00000E2B 268B06              <1> mov eax, dword [es:esi]
  3283 00000E2E 26668907            <1> mov word [es:edi], ax
  3284 00000E32 81C706000000        <1> add edi, 6
  3285 00000E38 C1E810              <1> shr eax, 16
  3286 00000E3B 26668907            <1> mov word [es:edi], ax
  3287 00000E3F 81C702000000        <1> add edi, 2  
  3288 00000E45 81C604000000        <1> add esi, 4 
  3289 00000E4B 81FE[46100000]      <1> cmp esi, int_address_size
  3290 00000E51 75D8                <1> jne next_int
  3291 00000E53 CB                  <1> retf
  3292                              <1> 
  3293                              <1> 	
  3294                              <1> idt_ptr:
  3295 00000E54 4701                <1> 	 	dw	idt_size-1		; IDT Size
  3296 00000E56 [5A0E0000]          <1> 		dd	idt			; IDT Address	
  3297                              <1> idt:
  3298                              <1> ;==============================================================================
  3299                              <1> ; => HARDWARE EXCEPTIONS
  3300                              <1> ;==============================================================================
  3301                              <1> ;------------------------------------------------------------------------------
  3302                              <1> ; [0x00 * 0x08] EXCEPTION 0 - Divide error
  3303                              <1> ;------------------------------------------------------------------------------
  3304 00000E5A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3305 00000E5C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3306 00000E5E 00                  <1> 		db	0			; (NOT USED)
  3307 00000E5F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3308 00000E60 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3309                              <1> ;------------------------------------------------------------------------------
  3310                              <1> ; [0x01 * 0x08] EXCEPTION 1 - Debug exceptions
  3311                              <1> ;------------------------------------------------------------------------------
  3312 00000E62 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3313 00000E64 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3314 00000E66 00                  <1> 		db	0			; (NOT USED)
  3315 00000E67 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3316 00000E68 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3317                              <1> ;------------------------------------------------------------------------------
  3318                              <1> ; [0x02 * 0x08] EXCEPTION 2 - Nonmaskable interrupt 
  3319                              <1> ;------------------------------------------------------------------------------
  3320 00000E6A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3321 00000E6C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3322 00000E6E 00                  <1> 		db	0			; (NOT USED)
  3323 00000E6F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3324 00000E70 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3325                              <1> ;------------------------------------------------------------------------------
  3326                              <1> ; [0x03 * 0x08] EXCEPTION 3 - Breakpoint (one-byte INT 3 instruction) 
  3327                              <1> ;------------------------------------------------------------------------------
  3328 00000E72 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3329 00000E74 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3330 00000E76 00                  <1> 		db	0			; (NOT USED)
  3331 00000E77 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3332 00000E78 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3333                              <1> ;------------------------------------------------------------------------------
  3334                              <1> ; [0x04 * 0x08] EXCEPTION 4 - Overflow (INTO instruction) 
  3335                              <1> ;------------------------------------------------------------------------------
  3336 00000E7A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3337 00000E7C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3338 00000E7E 00                  <1> 		db	0			; (NOT USED)
  3339 00000E7F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3340 00000E80 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3341                              <1> ;------------------------------------------------------------------------------
  3342                              <1> ; [0x05 * 0x08] EXCEPTION 5 - Bounds check (BOUND instruction)
  3343                              <1> ;------------------------------------------------------------------------------
  3344 00000E82 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3345 00000E84 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3346 00000E86 00                  <1> 		db	0			; (NOT USED)
  3347 00000E87 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3348 00000E88 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3349                              <1> ;------------------------------------------------------------------------------
  3350                              <1> ; [0x06 * 0x08] EXCEPTION 6 - Invalid opcode
  3351                              <1> ;------------------------------------------------------------------------------
  3352 00000E8A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3353 00000E8C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3354 00000E8E 00                  <1> 		db	0			; (NOT USED)
  3355 00000E8F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3356 00000E90 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3357                              <1> ;------------------------------------------------------------------------------
  3358                              <1> ; [0x07 * 0x08] EXCEPTION 7 - Coprocessor not available
  3359                              <1> ;------------------------------------------------------------------------------
  3360 00000E92 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3361 00000E94 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3362 00000E96 00                  <1> 		db	0			; (NOT USED)
  3363 00000E97 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3364 00000E98 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3365                              <1> ;------------------------------------------------------------------------------
  3366                              <1> ; [0x08 * 0x08] EXCEPTION 8 - Double fault
  3367                              <1> ;------------------------------------------------------------------------------
  3368 00000E9A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3369 00000E9C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3370 00000E9E 00                  <1> 		db	0			; (NOT USED)
  3371 00000E9F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3372 00000EA0 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3373                              <1> ;------------------------------------------------------------------------------
  3374                              <1> ; [0x09 * 0x08] EXCEPTION 9 - (reserved)
  3375                              <1> ;------------------------------------------------------------------------------
  3376 00000EA2 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3377 00000EA4 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3378 00000EA6 00                  <1> 		db	0			; (NOT USED)
  3379 00000EA7 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3380 00000EA8 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3381                              <1> ;------------------------------------------------------------------------------
  3382                              <1> ; [0x0A * 0x08] EXCEPTION 10 - Invalid TSS
  3383                              <1> ;------------------------------------------------------------------------------
  3384 00000EAA 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3385 00000EAC 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3386 00000EAE 00                  <1> 		db	0			; (NOT USED)
  3387 00000EAF 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3388 00000EB0 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3389                              <1> ;------------------------------------------------------------------------------
  3390                              <1> ; [0x0B * 0x08] EXCEPTION 11 - Segment not present
  3391                              <1> ;------------------------------------------------------------------------------
  3392 00000EB2 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3393 00000EB4 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3394 00000EB6 00                  <1> 		db	0			; (NOT USED)
  3395 00000EB7 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3396 00000EB8 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3397                              <1> ;------------------------------------------------------------------------------
  3398                              <1> ; [0x0C * 0x08] EXCEPTION 12 - Stack exception
  3399                              <1> ;------------------------------------------------------------------------------
  3400 00000EBA 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3401 00000EBC 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3402 00000EBE 00                  <1> 		db	0			; (NOT USED)
  3403 00000EBF 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3404 00000EC0 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3405                              <1> ;------------------------------------------------------------------------------
  3406                              <1> ; [0x0D * 0x08] EXCEPTION 13 - General protection
  3407                              <1> ;------------------------------------------------------------------------------
  3408 00000EC2 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3409 00000EC4 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3410 00000EC6 00                  <1> 		db	0			; (NOT USED)
  3411 00000EC7 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3412 00000EC8 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3413                              <1> ;------------------------------------------------------------------------------
  3414                              <1> ; [0x0E * 0x08] EXCEPTION 14 - Page fault
  3415                              <1> ;------------------------------------------------------------------------------
  3416 00000ECA 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3417 00000ECC 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3418 00000ECE 00                  <1> 		db	0			; (NOT USED)
  3419 00000ECF 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3420 00000ED0 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3421                              <1> ;------------------------------------------------------------------------------
  3422                              <1> ; [0x0F * 0x08] EXCEPTION 15 - (reserved)
  3423                              <1> ;------------------------------------------------------------------------------
  3424 00000ED2 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3425 00000ED4 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3426 00000ED6 00                  <1> 		db	0			; (NOT USED)
  3427 00000ED7 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3428 00000ED8 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3429                              <1> ;------------------------------------------------------------------------------
  3430                              <1> ; [0x10 * 0x08] EXCEPTION 16 - Coprocessor error
  3431                              <1> ;------------------------------------------------------------------------------
  3432 00000EDA 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3433 00000EDC 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3434 00000EDE 00                  <1> 		db	0			; (NOT USED)
  3435 00000EDF 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3436 00000EE0 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3437                              <1> ;------------------------------------------------------------------------------
  3438                              <1> ; [0x11 * 0x08] EXCEPTION 17
  3439                              <1> ;------------------------------------------------------------------------------
  3440                              <1> ;17-31         (reserved)
  3441                              <1> 
  3442 00000EE2 00<rept>            <1> times (15 * 0x08)	DB 0
  3443                              <1> ;==============================================================================
  3444                              <1> ; => HARDWARE INTERRUPTS
  3445                              <1> ;==============================================================================
  3446                              <1> ;------------------------------------------------------------------------------
  3447                              <1> ; [0x20 * 0x08] IRQ0 System Timer - INT 08h
  3448                              <1> ;------------------------------------------------------------------------------ 
  3449 00000F5A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3450 00000F5C 4000                <1> 		dw	sys_tss-gdt		; SELECTOR of GDT	
  3451 00000F5E 00                  <1> 		db	0			; (NOT USED)
  3452 00000F5F 85                  <1> 		db	10000101b		; P=1 DPL=00 01110
  3453 00000F60 0000                <1> 		dw	0			; OFFSET Address [16..31]	
  3454                              <1> ;------------------------------------------------------------------------------
  3455                              <1> ; [0x21 * 0x08] IRQ1 Keyboard - INT 09h
  3456                              <1> ;------------------------------------------------------------------------------ 		
  3457 00000F62 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3458 00000F64 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3459 00000F66 00                  <1> 		db	0			; (NOT USED)
  3460 00000F67 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3461 00000F68 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3462                              <1> ;------------------------------------------------------------------------------
  3463                              <1> ; [0x22 * 0x08] IRQ2 Slave PIC - INT 0Ah
  3464                              <1> ;------------------------------------------------------------------------------ 		
  3465 00000F6A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3466 00000F6C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3467 00000F6E 00                  <1> 		db	0			; (NOT USED)
  3468 00000F6F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3469 00000F70 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3470                              <1> ;------------------------------------------------------------------------------
  3471                              <1> ; [0x23 * 0x08] IRQ3 Second Serial Interface - INT 0Bh
  3472                              <1> ;------------------------------------------------------------------------------ 		
  3473 00000F72 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3474 00000F74 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3475 00000F76 00                  <1> 		db	0			; (NOT USED)
  3476 00000F77 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3477 00000F78 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3478                              <1> ;------------------------------------------------------------------------------
  3479                              <1> ; [0x24 * 0x08] IRQ4 First Serial Interface - INT 0Ch
  3480                              <1> ;------------------------------------------------------------------------------ 		
  3481 00000F7A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3482 00000F7C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3483 00000F7E 00                  <1> 		db	0			; (NOT USED)
  3484 00000F7F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3485 00000F80 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3486                              <1> ;------------------------------------------------------------------------------
  3487                              <1> ; [0x25 * 0x08] IRQ5 Second Parallel Interface - INT 0Dh
  3488                              <1> ;------------------------------------------------------------------------------ 		
  3489 00000F82 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3490 00000F84 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3491 00000F86 00                  <1> 		db	0			; (NOT USED)
  3492 00000F87 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3493 00000F88 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3494                              <1> ;------------------------------------------------------------------------------
  3495                              <1> ; [0x26 * 0x08] IRQ6 Floppy Drive Controller - INT 0Eh
  3496                              <1> ;------------------------------------------------------------------------------ 		
  3497 00000F8A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3498 00000F8C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3499 00000F8E 00                  <1> 		db	0			; (NOT USED)
  3500 00000F8F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3501 00000F90 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3502                              <1> ;------------------------------------------------------------------------------
  3503                              <1> ; [0x27 * 0x08] IRQ7 First Parallel Interface - INT 0Fh
  3504                              <1> ;------------------------------------------------------------------------------ 		
  3505 00000F92 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3506 00000F94 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3507 00000F96 00                  <1> 		db	0			; (NOT USED)
  3508 00000F97 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3509 00000F98 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3510                              <1> ;------------------------------------------------------------------------------
  3511                              <1> ; [0x28 * 0x08] IRQ8 Real Time Clock - INT 10h
  3512                              <1> ;------------------------------------------------------------------------------ 		
  3513 00000F9A 0000                <1> 		dw	0			; OFFSET Address [0..15] 
  3514 00000F9C 0800                <1> 		dw	0x0008			; SELECTOR of GDT	
  3515 00000F9E 00                  <1> 		db	0			; (NOT USED)
  3516 00000F9F 8E                  <1> 		db	10001110b		; P=1 DPL=00 01110
  3517 00000FA0 0000                <1> 		dw	0			; OFFSET Address [16..31]
  3518                              <1> ;==============================================================================	
  3519                              <1> ; => SOFTWARE INTERRUPTS
  3520                              <1> ;==============================================================================
  3521                              <1> ;------------------------------------------------------------------------------
  3522                              <1> ;
  3523                              <1> ;------------------------------------------------------------------------------
  3524                              <1> ; MAX. INT'S = 256
  3525                              <1> idt_size	equ	$-idt
  3526                              <1> int_address:	
  3527 00000FA2 [46100000]          <1> 		dd	exception_0		; EXCEPTION 0
  3528 00000FA6 [BB100000]          <1> 		dd	exception_1		; EXCEPTION 1
  3529 00000FAA [30110000]          <1> 		dd	exception_2		; EXCEPTION 2
  3530 00000FAE [A5110000]          <1> 		dd	exception_3		; EXCEPTION 3
  3531 00000FB2 [1A120000]          <1> 		dd	exception_4		; EXCEPTION 4
  3532 00000FB6 [8F120000]          <1> 		dd	exception_5		; EXCEPTION 5
  3533 00000FBA [04130000]          <1> 		dd	exception_6		; EXCEPTION 6
  3534 00000FBE [79130000]          <1> 		dd	exception_7		; EXCEPTION 7
  3535 00000FC2 [EE130000]          <1> 		dd	exception_8		; EXCEPTION 8
  3536 00000FC6 [63140000]          <1> 		dd	exception_9		; EXCEPTION 9
  3537 00000FCA [D8140000]          <1> 		dd	exception_10		; EXCEPTION 10
  3538 00000FCE [4D150000]          <1> 		dd	exception_11		; EXCEPTION 11
  3539 00000FD2 [C2150000]          <1> 		dd	exception_12		; EXCEPTION 12
  3540 00000FD6 [37160000]          <1> 		dd	exception_13		; EXCEPTION 13
  3541 00000FDA [0B1C0000]          <1> 		dd	exception_14		; EXCEPTION 14
  3542 00000FDE [801C0000]          <1> 		dd	exception_15		; EXCEPTION 15
  3543 00000FE2 [F51C0000]          <1> 		dd	exception_16		; EXCEPTION 16
  3544 00000FE6 00000000<rept>      <1> times 15 	dd	0			; EXCEPTION 17-31
  3545 00001022 00000000            <1> 		dd	0			; IRQ0 timer_int as task gate!
  3546 00001026 [7F1D0000]          <1> 		dd	keyboard_int		; IRQ1
  3547 0000102A 00000000            <1> 		dd	0			; IRQ2
  3548 0000102E 00000000            <1> 		dd	0			; IRQ3
  3549 00001032 00000000            <1> 		dd	0			; IRQ4
  3550 00001036 00000000            <1> 		dd	0			; IRQ5
  3551 0000103A [B71D0000]          <1> 		dd	floppy_int		; IRQ6
  3552 0000103E 00000000            <1> 		dd	0			; IRQ7
  3553 00001042 [C91D0000]          <1> 		dd	rtc_int			; IRQ8
  3554                              <1> int_address_size:
  3555                              <1> ;==============================================================================
  3556                              <1> ; INT ROUTINES
  3557                              <1> ;==============================================================================
  3558                              <1> ;   0   IRQ0 System Timer | for MULTI-TASKING (PIT at 50 ticks/s)
  3559                              <1> ;   1   IRQ1 Keyboard
  3560                              <1> ;   2   IRQ0 Real time clock | for ms DELAYs ( IRQ8 )
  3561                              <1> ;   3   IRQ1 Free
  3562                              <1> ;   4   IRQ2 Free
  3563                              <1> ;   5   IRQ3 Free
  3564                              <1> ;   6   IRQ4 Free
  3565                              <1> ;   7   IRQ5 Math coprocessor
  3566                              <1> ;   8   IRQ6 Hard disk controller
  3567                              <1> ;   9   IRQ7 Free
  3568                              <1> ;   10  IRQ2 Slave PIC
  3569                              <1> ;   11  IRQ3 Second serial interface
  3570                              <1> ;   12  IRQ4 First serial interface
  3571                              <1> ;   13  IRQ5 Second parallel interface
  3572                              <1> ;   14  IRQ6 Floppy drive controller
  3573                              <1> ;   15  IRQ7 First parallel interface
  3574                              <1> ;
  3575                              <1> ; IRQ Routing Procedure:
  3576                              <1> ; Ex: Driver de SOM (placa de som), depois de o IRQ estar colocado para a placa de SOM,
  3577                              <1> ; vai colocar no IRQ da IDT o address da ROTINA(INT) de som.
  3578                              <1> ; Software Task(CALL) Gates for kernel modules(libraries) accessing
  3579                              <1> ; A CALL GATE on GDT can have level 0 access
  3580                              <1> ; INTERFACE for drivers and application resource access
  3581                              <1> 
  3582                              <1> 
  3583                              <1> %macro save_regs	0
  3584                              <1> mov [REGISTER_EAX], eax
  3585                              <1> mov [REGISTER_EBX], ebx
  3586                              <1> mov [REGISTER_ECX], ecx
  3587                              <1> mov [REGISTER_EDX], edx
  3588                              <1> mov [REGISTER_EDI], edi
  3589                              <1> mov [REGISTER_ESI], esi
  3590                              <1> mov [REGISTER_ESP], esp
  3591                              <1> mov [REGISTER_EBP], ebp
  3592                              <1> mov dword [REGISTER_EIP], $ 
  3593                              <1> ;mov [REGISTER_EFLAGS], eflags
  3594                              <1> mov [REGISTER_ES], es
  3595                              <1> mov [REGISTER_DS], ds
  3596                              <1> mov [REGISTER_SS], ss
  3597                              <1> mov [REGISTER_FS], fs
  3598                              <1> mov [REGISTER_GS], gs
  3599                              <1> %endmacro
  3600                              <1> 
  3601                              <1> %macro show_regs	0
  3602                              <1> number_to_text [REGISTER_EAX], 16, mensage_eax+13
  3603                              <1> number_to_text [REGISTER_EBX], 16, mensage_ebx+13
  3604                              <1> number_to_text [REGISTER_ECX], 16, mensage_ecx+13
  3605                              <1> number_to_text [REGISTER_EDX], 16, mensage_edx+13
  3606                              <1> number_to_text [REGISTER_EDI], 16, mensage_edi+13
  3607                              <1> number_to_text [REGISTER_ESI], 16, mensage_esi+13
  3608                              <1> number_to_text [REGISTER_ESP], 16, mensage_esp+13
  3609                              <1> number_to_text [REGISTER_EBP], 16, mensage_ebp+13
  3610                              <1> number_to_text [REGISTER_EIP], 16, mensage_eip+13
  3611                              <1> number_to_text [REGISTER_ES], 16, mensage_es+8
  3612                              <1> number_to_text [REGISTER_DS], 16, mensage_ds+8
  3613                              <1> number_to_text [REGISTER_SS], 16, mensage_ss+8
  3614                              <1> number_to_text [REGISTER_FS], 16, mensage_fs+8
  3615                              <1> number_to_text [REGISTER_GS], 16, mensage_gs+8
  3616                              <1> VIDEO_TEXTMODE_write_mensage            0x03, 0x01, 0x0F, mensage_eax
  3617                              <1> VIDEO_TEXTMODE_write_mensage            0x04, 0x01, 0x0F, mensage_ebx
  3618                              <1> VIDEO_TEXTMODE_write_mensage            0x05, 0x01, 0x0F, mensage_ecx
  3619                              <1> VIDEO_TEXTMODE_write_mensage            0x06, 0x01, 0x0F, mensage_edx
  3620                              <1> VIDEO_TEXTMODE_write_mensage            0x07, 0x01, 0x0F, mensage_edi
  3621                              <1> VIDEO_TEXTMODE_write_mensage            0x08, 0x01, 0x0F, mensage_esi
  3622                              <1> VIDEO_TEXTMODE_write_mensage            0x09, 0x01, 0x0F, mensage_esp
  3623                              <1> VIDEO_TEXTMODE_write_mensage            0x0A, 0x01, 0x0F, mensage_ebp
  3624                              <1> VIDEO_TEXTMODE_write_mensage            0x0B, 0x01, 0x0F, mensage_eip
  3625                              <1> VIDEO_TEXTMODE_write_mensage            0x0C, 0x01, 0x0F, mensage_es
  3626                              <1> VIDEO_TEXTMODE_write_mensage            0x0D, 0x01, 0x0F, mensage_ds
  3627                              <1> VIDEO_TEXTMODE_write_mensage            0x0E, 0x01, 0x0F, mensage_ss
  3628                              <1> VIDEO_TEXTMODE_write_mensage            0x0F, 0x01, 0x0F, mensage_fs
  3629                              <1> VIDEO_TEXTMODE_write_mensage            0x10, 0x01, 0x0F, mensage_gs
  3630                              <1> %endmacro
  3631                              <1> 
  3632                              <1> exception_0:
  3633 00001046 FA                  <1> cli
  3634 00001047 60                  <1> pusha
  3635 00001048 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  3636                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_0
  3637                              <2> 
  3638                              <2> 
  3639                              <2> 
  3640                              <2> 
  3641                              <2> 
  3642                              <2> 
  3643                              <2> 
  3644                              <2> 
  3645                              <2> 
  3646 0000104F BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3647                              <2> 
  3648 00001054 B8A0000000          <2> mov eax, 160
  3649 00001059 BB01000000          <2> mov ebx, %1
  3650 0000105E F7E3                <2> mul ebx
  3651 00001060 01C7                <2> add edi, eax
  3652                              <2> 
  3653 00001062 BE[031E0000]        <2> mov esi, %4
  3654 00001067 B40F                <2> mov ah, %3
  3655                              <2> %%next_char:
  3656 00001069 268A06              <2> mov al, byte [es:esi]
  3657 0000106C 26668907            <2> mov word [es:edi], ax
  3658 00001070 47<rept>            <2> times 2 inc edi
  3659 00001072 46                  <2> inc esi
  3660 00001073 26803E00            <2> cmp byte [es:esi], 0x00
  3661 00001077 75F0                <2> jne %%next_char
  3662                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  3663                              <2> 
  3664                              <2> 
  3665                              <2> 
  3666                              <2> 
  3667                              <2> 
  3668                              <2> 
  3669                              <2> 
  3670                              <2> 
  3671                              <2> 
  3672 00001079 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3673                              <2> 
  3674 0000107E B8A0000000          <2> mov eax, 160
  3675 00001083 BB16000000          <2> mov ebx, %1
  3676 00001088 F7E3                <2> mul ebx
  3677 0000108A 01C7                <2> add edi, eax
  3678                              <2> 
  3679 0000108C BE[3D200000]        <2> mov esi, %4
  3680 00001091 B403                <2> mov ah, %3
  3681                              <2> %%next_char:
  3682 00001093 268A06              <2> mov al, byte [es:esi]
  3683 00001096 26668907            <2> mov word [es:edi], ax
  3684 0000109A 47<rept>            <2> times 2 inc edi
  3685 0000109C 46                  <2> inc esi
  3686 0000109D 26803E00            <2> cmp byte [es:esi], 0x00
  3687 000010A1 75F0                <2> jne %%next_char
  3688                              <1> 
  3689                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  3690 000010A3 B31C                <2> mov bl, %1
  3691                              <2> %%repeat_check:
  3692 000010A5 E460                <2> in al, 0x60
  3693 000010A7 38D8                <2> cmp al, bl
  3694 000010A9 75FA                <2> jne %%repeat_check
  3695 000010AB EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  3696                              <1> ; recover from error
  3697                              <1> PIC_eoi_cmd
  3698 000010B2 B020                <2> mov al, 0x20
  3699 000010B4 E6A0                <2> out PIC_SLAVE_PORT0,al
  3700 000010B6 E620                <2> out PIC_MASTER_PORT0,al
  3701                              <2> 
  3702                              <2> 
  3703 000010B8 61                  <1> popa
  3704 000010B9 FB                  <1> sti
  3705 000010BA CF                  <1> iretd
  3706                              <1> 
  3707                              <1> exception_1:
  3708 000010BB FA                  <1> cli
  3709 000010BC 60                  <1> pusha
  3710 000010BD 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  3711                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_1
  3712                              <2> 
  3713                              <2> 
  3714                              <2> 
  3715                              <2> 
  3716                              <2> 
  3717                              <2> 
  3718                              <2> 
  3719                              <2> 
  3720                              <2> 
  3721 000010C4 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3722                              <2> 
  3723 000010C9 B8A0000000          <2> mov eax, 160
  3724 000010CE BB01000000          <2> mov ebx, %1
  3725 000010D3 F7E3                <2> mul ebx
  3726 000010D5 01C7                <2> add edi, eax
  3727                              <2> 
  3728 000010D7 BE[1E1E0000]        <2> mov esi, %4
  3729 000010DC B40F                <2> mov ah, %3
  3730                              <2> %%next_char:
  3731 000010DE 268A06              <2> mov al, byte [es:esi]
  3732 000010E1 26668907            <2> mov word [es:edi], ax
  3733 000010E5 47<rept>            <2> times 2 inc edi
  3734 000010E7 46                  <2> inc esi
  3735 000010E8 26803E00            <2> cmp byte [es:esi], 0x00
  3736 000010EC 75F0                <2> jne %%next_char
  3737                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  3738                              <2> 
  3739                              <2> 
  3740                              <2> 
  3741                              <2> 
  3742                              <2> 
  3743                              <2> 
  3744                              <2> 
  3745                              <2> 
  3746                              <2> 
  3747 000010EE BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3748                              <2> 
  3749 000010F3 B8A0000000          <2> mov eax, 160
  3750 000010F8 BB16000000          <2> mov ebx, %1
  3751 000010FD F7E3                <2> mul ebx
  3752 000010FF 01C7                <2> add edi, eax
  3753                              <2> 
  3754 00001101 BE[3D200000]        <2> mov esi, %4
  3755 00001106 B403                <2> mov ah, %3
  3756                              <2> %%next_char:
  3757 00001108 268A06              <2> mov al, byte [es:esi]
  3758 0000110B 26668907            <2> mov word [es:edi], ax
  3759 0000110F 47<rept>            <2> times 2 inc edi
  3760 00001111 46                  <2> inc esi
  3761 00001112 26803E00            <2> cmp byte [es:esi], 0x00
  3762 00001116 75F0                <2> jne %%next_char
  3763                              <1> 
  3764                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  3765 00001118 B31C                <2> mov bl, %1
  3766                              <2> %%repeat_check:
  3767 0000111A E460                <2> in al, 0x60
  3768 0000111C 38D8                <2> cmp al, bl
  3769 0000111E 75FA                <2> jne %%repeat_check
  3770 00001120 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  3771                              <1> ; recover from error
  3772                              <1> PIC_eoi_cmd
  3773 00001127 B020                <2> mov al, 0x20
  3774 00001129 E6A0                <2> out PIC_SLAVE_PORT0,al
  3775 0000112B E620                <2> out PIC_MASTER_PORT0,al
  3776                              <2> 
  3777                              <2> 
  3778 0000112D 61                  <1> popa
  3779 0000112E FB                  <1> sti
  3780 0000112F CF                  <1> iretd
  3781                              <1> 
  3782                              <1> exception_2:
  3783 00001130 FA                  <1> cli
  3784 00001131 60                  <1> pusha
  3785 00001132 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  3786                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_2
  3787                              <2> 
  3788                              <2> 
  3789                              <2> 
  3790                              <2> 
  3791                              <2> 
  3792                              <2> 
  3793                              <2> 
  3794                              <2> 
  3795                              <2> 
  3796 00001139 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3797                              <2> 
  3798 0000113E B8A0000000          <2> mov eax, 160
  3799 00001143 BB01000000          <2> mov ebx, %1
  3800 00001148 F7E3                <2> mul ebx
  3801 0000114A 01C7                <2> add edi, eax
  3802                              <2> 
  3803 0000114C BE[3D1E0000]        <2> mov esi, %4
  3804 00001151 B40F                <2> mov ah, %3
  3805                              <2> %%next_char:
  3806 00001153 268A06              <2> mov al, byte [es:esi]
  3807 00001156 26668907            <2> mov word [es:edi], ax
  3808 0000115A 47<rept>            <2> times 2 inc edi
  3809 0000115C 46                  <2> inc esi
  3810 0000115D 26803E00            <2> cmp byte [es:esi], 0x00
  3811 00001161 75F0                <2> jne %%next_char
  3812                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  3813                              <2> 
  3814                              <2> 
  3815                              <2> 
  3816                              <2> 
  3817                              <2> 
  3818                              <2> 
  3819                              <2> 
  3820                              <2> 
  3821                              <2> 
  3822 00001163 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3823                              <2> 
  3824 00001168 B8A0000000          <2> mov eax, 160
  3825 0000116D BB16000000          <2> mov ebx, %1
  3826 00001172 F7E3                <2> mul ebx
  3827 00001174 01C7                <2> add edi, eax
  3828                              <2> 
  3829 00001176 BE[3D200000]        <2> mov esi, %4
  3830 0000117B B403                <2> mov ah, %3
  3831                              <2> %%next_char:
  3832 0000117D 268A06              <2> mov al, byte [es:esi]
  3833 00001180 26668907            <2> mov word [es:edi], ax
  3834 00001184 47<rept>            <2> times 2 inc edi
  3835 00001186 46                  <2> inc esi
  3836 00001187 26803E00            <2> cmp byte [es:esi], 0x00
  3837 0000118B 75F0                <2> jne %%next_char
  3838                              <1> 
  3839                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  3840 0000118D B31C                <2> mov bl, %1
  3841                              <2> %%repeat_check:
  3842 0000118F E460                <2> in al, 0x60
  3843 00001191 38D8                <2> cmp al, bl
  3844 00001193 75FA                <2> jne %%repeat_check
  3845 00001195 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  3846                              <1> ; recover from error
  3847                              <1> PIC_eoi_cmd
  3848 0000119C B020                <2> mov al, 0x20
  3849 0000119E E6A0                <2> out PIC_SLAVE_PORT0,al
  3850 000011A0 E620                <2> out PIC_MASTER_PORT0,al
  3851                              <2> 
  3852                              <2> 
  3853 000011A2 61                  <1> popa
  3854 000011A3 FB                  <1> sti
  3855 000011A4 CF                  <1> iretd
  3856                              <1> 
  3857                              <1> exception_3:
  3858 000011A5 FA                  <1> cli
  3859 000011A6 60                  <1> pusha
  3860 000011A7 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  3861                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_3
  3862                              <2> 
  3863                              <2> 
  3864                              <2> 
  3865                              <2> 
  3866                              <2> 
  3867                              <2> 
  3868                              <2> 
  3869                              <2> 
  3870                              <2> 
  3871 000011AE BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3872                              <2> 
  3873 000011B3 B8A0000000          <2> mov eax, 160
  3874 000011B8 BB01000000          <2> mov ebx, %1
  3875 000011BD F7E3                <2> mul ebx
  3876 000011BF 01C7                <2> add edi, eax
  3877                              <2> 
  3878 000011C1 BE[611E0000]        <2> mov esi, %4
  3879 000011C6 B40F                <2> mov ah, %3
  3880                              <2> %%next_char:
  3881 000011C8 268A06              <2> mov al, byte [es:esi]
  3882 000011CB 26668907            <2> mov word [es:edi], ax
  3883 000011CF 47<rept>            <2> times 2 inc edi
  3884 000011D1 46                  <2> inc esi
  3885 000011D2 26803E00            <2> cmp byte [es:esi], 0x00
  3886 000011D6 75F0                <2> jne %%next_char
  3887                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  3888                              <2> 
  3889                              <2> 
  3890                              <2> 
  3891                              <2> 
  3892                              <2> 
  3893                              <2> 
  3894                              <2> 
  3895                              <2> 
  3896                              <2> 
  3897 000011D8 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3898                              <2> 
  3899 000011DD B8A0000000          <2> mov eax, 160
  3900 000011E2 BB16000000          <2> mov ebx, %1
  3901 000011E7 F7E3                <2> mul ebx
  3902 000011E9 01C7                <2> add edi, eax
  3903                              <2> 
  3904 000011EB BE[3D200000]        <2> mov esi, %4
  3905 000011F0 B403                <2> mov ah, %3
  3906                              <2> %%next_char:
  3907 000011F2 268A06              <2> mov al, byte [es:esi]
  3908 000011F5 26668907            <2> mov word [es:edi], ax
  3909 000011F9 47<rept>            <2> times 2 inc edi
  3910 000011FB 46                  <2> inc esi
  3911 000011FC 26803E00            <2> cmp byte [es:esi], 0x00
  3912 00001200 75F0                <2> jne %%next_char
  3913                              <1> 
  3914                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  3915 00001202 B31C                <2> mov bl, %1
  3916                              <2> %%repeat_check:
  3917 00001204 E460                <2> in al, 0x60
  3918 00001206 38D8                <2> cmp al, bl
  3919 00001208 75FA                <2> jne %%repeat_check
  3920 0000120A EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  3921                              <1> ; recover from error
  3922                              <1> PIC_eoi_cmd
  3923 00001211 B020                <2> mov al, 0x20
  3924 00001213 E6A0                <2> out PIC_SLAVE_PORT0,al
  3925 00001215 E620                <2> out PIC_MASTER_PORT0,al
  3926                              <2> 
  3927                              <2> 
  3928 00001217 61                  <1> popa
  3929 00001218 FB                  <1> sti
  3930 00001219 CF                  <1> iretd
  3931                              <1> 
  3932                              <1> exception_4:
  3933 0000121A FA                  <1> cli
  3934 0000121B 60                  <1> pusha
  3935 0000121C 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  3936                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_4
  3937                              <2> 
  3938                              <2> 
  3939                              <2> 
  3940                              <2> 
  3941                              <2> 
  3942                              <2> 
  3943                              <2> 
  3944                              <2> 
  3945                              <2> 
  3946 00001223 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3947                              <2> 
  3948 00001228 B8A0000000          <2> mov eax, 160
  3949 0000122D BB01000000          <2> mov ebx, %1
  3950 00001232 F7E3                <2> mul ebx
  3951 00001234 01C7                <2> add edi, eax
  3952                              <2> 
  3953 00001236 BE[971E0000]        <2> mov esi, %4
  3954 0000123B B40F                <2> mov ah, %3
  3955                              <2> %%next_char:
  3956 0000123D 268A06              <2> mov al, byte [es:esi]
  3957 00001240 26668907            <2> mov word [es:edi], ax
  3958 00001244 47<rept>            <2> times 2 inc edi
  3959 00001246 46                  <2> inc esi
  3960 00001247 26803E00            <2> cmp byte [es:esi], 0x00
  3961 0000124B 75F0                <2> jne %%next_char
  3962                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  3963                              <2> 
  3964                              <2> 
  3965                              <2> 
  3966                              <2> 
  3967                              <2> 
  3968                              <2> 
  3969                              <2> 
  3970                              <2> 
  3971                              <2> 
  3972 0000124D BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  3973                              <2> 
  3974 00001252 B8A0000000          <2> mov eax, 160
  3975 00001257 BB16000000          <2> mov ebx, %1
  3976 0000125C F7E3                <2> mul ebx
  3977 0000125E 01C7                <2> add edi, eax
  3978                              <2> 
  3979 00001260 BE[3D200000]        <2> mov esi, %4
  3980 00001265 B403                <2> mov ah, %3
  3981                              <2> %%next_char:
  3982 00001267 268A06              <2> mov al, byte [es:esi]
  3983 0000126A 26668907            <2> mov word [es:edi], ax
  3984 0000126E 47<rept>            <2> times 2 inc edi
  3985 00001270 46                  <2> inc esi
  3986 00001271 26803E00            <2> cmp byte [es:esi], 0x00
  3987 00001275 75F0                <2> jne %%next_char
  3988                              <1> 
  3989                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  3990 00001277 B31C                <2> mov bl, %1
  3991                              <2> %%repeat_check:
  3992 00001279 E460                <2> in al, 0x60
  3993 0000127B 38D8                <2> cmp al, bl
  3994 0000127D 75FA                <2> jne %%repeat_check
  3995 0000127F EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  3996                              <1> ; recover from error
  3997                              <1> PIC_eoi_cmd
  3998 00001286 B020                <2> mov al, 0x20
  3999 00001288 E6A0                <2> out PIC_SLAVE_PORT0,al
  4000 0000128A E620                <2> out PIC_MASTER_PORT0,al
  4001                              <2> 
  4002                              <2> 
  4003 0000128C 61                  <1> popa
  4004 0000128D FB                  <1> sti
  4005 0000128E CF                  <1> iretd
  4006                              <1> 
  4007                              <1> exception_5:
  4008 0000128F FA                  <1> cli
  4009 00001290 60                  <1> pusha
  4010 00001291 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4011                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_5
  4012                              <2> 
  4013                              <2> 
  4014                              <2> 
  4015                              <2> 
  4016                              <2> 
  4017                              <2> 
  4018                              <2> 
  4019                              <2> 
  4020                              <2> 
  4021 00001298 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4022                              <2> 
  4023 0000129D B8A0000000          <2> mov eax, 160
  4024 000012A2 BB01000000          <2> mov ebx, %1
  4025 000012A7 F7E3                <2> mul ebx
  4026 000012A9 01C7                <2> add edi, eax
  4027                              <2> 
  4028 000012AB BE[C11E0000]        <2> mov esi, %4
  4029 000012B0 B40F                <2> mov ah, %3
  4030                              <2> %%next_char:
  4031 000012B2 268A06              <2> mov al, byte [es:esi]
  4032 000012B5 26668907            <2> mov word [es:edi], ax
  4033 000012B9 47<rept>            <2> times 2 inc edi
  4034 000012BB 46                  <2> inc esi
  4035 000012BC 26803E00            <2> cmp byte [es:esi], 0x00
  4036 000012C0 75F0                <2> jne %%next_char
  4037                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4038                              <2> 
  4039                              <2> 
  4040                              <2> 
  4041                              <2> 
  4042                              <2> 
  4043                              <2> 
  4044                              <2> 
  4045                              <2> 
  4046                              <2> 
  4047 000012C2 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4048                              <2> 
  4049 000012C7 B8A0000000          <2> mov eax, 160
  4050 000012CC BB16000000          <2> mov ebx, %1
  4051 000012D1 F7E3                <2> mul ebx
  4052 000012D3 01C7                <2> add edi, eax
  4053                              <2> 
  4054 000012D5 BE[3D200000]        <2> mov esi, %4
  4055 000012DA B403                <2> mov ah, %3
  4056                              <2> %%next_char:
  4057 000012DC 268A06              <2> mov al, byte [es:esi]
  4058 000012DF 26668907            <2> mov word [es:edi], ax
  4059 000012E3 47<rept>            <2> times 2 inc edi
  4060 000012E5 46                  <2> inc esi
  4061 000012E6 26803E00            <2> cmp byte [es:esi], 0x00
  4062 000012EA 75F0                <2> jne %%next_char
  4063                              <1> 
  4064                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4065 000012EC B31C                <2> mov bl, %1
  4066                              <2> %%repeat_check:
  4067 000012EE E460                <2> in al, 0x60
  4068 000012F0 38D8                <2> cmp al, bl
  4069 000012F2 75FA                <2> jne %%repeat_check
  4070 000012F4 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4071                              <1> ; recover from error
  4072                              <1> PIC_eoi_cmd
  4073 000012FB B020                <2> mov al, 0x20
  4074 000012FD E6A0                <2> out PIC_SLAVE_PORT0,al
  4075 000012FF E620                <2> out PIC_MASTER_PORT0,al
  4076                              <2> 
  4077                              <2> 
  4078 00001301 61                  <1> popa
  4079 00001302 FB                  <1> sti
  4080 00001303 CF                  <1> iretd
  4081                              <1> 
  4082                              <1> exception_6:
  4083 00001304 FA                  <1> cli
  4084 00001305 60                  <1> pusha
  4085 00001306 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4086                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_6
  4087                              <2> 
  4088                              <2> 
  4089                              <2> 
  4090                              <2> 
  4091                              <2> 
  4092                              <2> 
  4093                              <2> 
  4094                              <2> 
  4095                              <2> 
  4096 0000130D BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4097                              <2> 
  4098 00001312 B8A0000000          <2> mov eax, 160
  4099 00001317 BB01000000          <2> mov ebx, %1
  4100 0000131C F7E3                <2> mul ebx
  4101 0000131E 01C7                <2> add edi, eax
  4102                              <2> 
  4103 00001320 BE[F01E0000]        <2> mov esi, %4
  4104 00001325 B40F                <2> mov ah, %3
  4105                              <2> %%next_char:
  4106 00001327 268A06              <2> mov al, byte [es:esi]
  4107 0000132A 26668907            <2> mov word [es:edi], ax
  4108 0000132E 47<rept>            <2> times 2 inc edi
  4109 00001330 46                  <2> inc esi
  4110 00001331 26803E00            <2> cmp byte [es:esi], 0x00
  4111 00001335 75F0                <2> jne %%next_char
  4112                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4113                              <2> 
  4114                              <2> 
  4115                              <2> 
  4116                              <2> 
  4117                              <2> 
  4118                              <2> 
  4119                              <2> 
  4120                              <2> 
  4121                              <2> 
  4122 00001337 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4123                              <2> 
  4124 0000133C B8A0000000          <2> mov eax, 160
  4125 00001341 BB16000000          <2> mov ebx, %1
  4126 00001346 F7E3                <2> mul ebx
  4127 00001348 01C7                <2> add edi, eax
  4128                              <2> 
  4129 0000134A BE[3D200000]        <2> mov esi, %4
  4130 0000134F B403                <2> mov ah, %3
  4131                              <2> %%next_char:
  4132 00001351 268A06              <2> mov al, byte [es:esi]
  4133 00001354 26668907            <2> mov word [es:edi], ax
  4134 00001358 47<rept>            <2> times 2 inc edi
  4135 0000135A 46                  <2> inc esi
  4136 0000135B 26803E00            <2> cmp byte [es:esi], 0x00
  4137 0000135F 75F0                <2> jne %%next_char
  4138                              <1> 
  4139                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4140 00001361 B31C                <2> mov bl, %1
  4141                              <2> %%repeat_check:
  4142 00001363 E460                <2> in al, 0x60
  4143 00001365 38D8                <2> cmp al, bl
  4144 00001367 75FA                <2> jne %%repeat_check
  4145 00001369 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4146                              <1> ; recover from error
  4147                              <1> PIC_eoi_cmd
  4148 00001370 B020                <2> mov al, 0x20
  4149 00001372 E6A0                <2> out PIC_SLAVE_PORT0,al
  4150 00001374 E620                <2> out PIC_MASTER_PORT0,al
  4151                              <2> 
  4152                              <2> 
  4153 00001376 61                  <1> popa
  4154 00001377 FB                  <1> sti
  4155 00001378 CF                  <1> iretd
  4156                              <1> 
  4157                              <1> exception_7:
  4158 00001379 FA                  <1> cli
  4159 0000137A 60                  <1> pusha
  4160 0000137B 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4161                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_7
  4162                              <2> 
  4163                              <2> 
  4164                              <2> 
  4165                              <2> 
  4166                              <2> 
  4167                              <2> 
  4168                              <2> 
  4169                              <2> 
  4170                              <2> 
  4171 00001382 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4172                              <2> 
  4173 00001387 B8A0000000          <2> mov eax, 160
  4174 0000138C BB01000000          <2> mov ebx, %1
  4175 00001391 F7E3                <2> mul ebx
  4176 00001393 01C7                <2> add edi, eax
  4177                              <2> 
  4178 00001395 BE[0D1F0000]        <2> mov esi, %4
  4179 0000139A B40F                <2> mov ah, %3
  4180                              <2> %%next_char:
  4181 0000139C 268A06              <2> mov al, byte [es:esi]
  4182 0000139F 26668907            <2> mov word [es:edi], ax
  4183 000013A3 47<rept>            <2> times 2 inc edi
  4184 000013A5 46                  <2> inc esi
  4185 000013A6 26803E00            <2> cmp byte [es:esi], 0x00
  4186 000013AA 75F0                <2> jne %%next_char
  4187                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4188                              <2> 
  4189                              <2> 
  4190                              <2> 
  4191                              <2> 
  4192                              <2> 
  4193                              <2> 
  4194                              <2> 
  4195                              <2> 
  4196                              <2> 
  4197 000013AC BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4198                              <2> 
  4199 000013B1 B8A0000000          <2> mov eax, 160
  4200 000013B6 BB16000000          <2> mov ebx, %1
  4201 000013BB F7E3                <2> mul ebx
  4202 000013BD 01C7                <2> add edi, eax
  4203                              <2> 
  4204 000013BF BE[3D200000]        <2> mov esi, %4
  4205 000013C4 B403                <2> mov ah, %3
  4206                              <2> %%next_char:
  4207 000013C6 268A06              <2> mov al, byte [es:esi]
  4208 000013C9 26668907            <2> mov word [es:edi], ax
  4209 000013CD 47<rept>            <2> times 2 inc edi
  4210 000013CF 46                  <2> inc esi
  4211 000013D0 26803E00            <2> cmp byte [es:esi], 0x00
  4212 000013D4 75F0                <2> jne %%next_char
  4213                              <1> 
  4214                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4215 000013D6 B31C                <2> mov bl, %1
  4216                              <2> %%repeat_check:
  4217 000013D8 E460                <2> in al, 0x60
  4218 000013DA 38D8                <2> cmp al, bl
  4219 000013DC 75FA                <2> jne %%repeat_check
  4220 000013DE EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4221                              <1> ; recover from error
  4222                              <1> PIC_eoi_cmd
  4223 000013E5 B020                <2> mov al, 0x20
  4224 000013E7 E6A0                <2> out PIC_SLAVE_PORT0,al
  4225 000013E9 E620                <2> out PIC_MASTER_PORT0,al
  4226                              <2> 
  4227                              <2> 
  4228 000013EB 61                  <1> popa
  4229 000013EC FB                  <1> sti
  4230 000013ED CF                  <1> iretd
  4231                              <1> 
  4232                              <1> exception_8:
  4233 000013EE FA                  <1> cli
  4234 000013EF 60                  <1> pusha
  4235 000013F0 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4236                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_8
  4237                              <2> 
  4238                              <2> 
  4239                              <2> 
  4240                              <2> 
  4241                              <2> 
  4242                              <2> 
  4243                              <2> 
  4244                              <2> 
  4245                              <2> 
  4246 000013F7 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4247                              <2> 
  4248 000013FC B8A0000000          <2> mov eax, 160
  4249 00001401 BB01000000          <2> mov ebx, %1
  4250 00001406 F7E3                <2> mul ebx
  4251 00001408 01C7                <2> add edi, eax
  4252                              <2> 
  4253 0000140A BE[351F0000]        <2> mov esi, %4
  4254 0000140F B40F                <2> mov ah, %3
  4255                              <2> %%next_char:
  4256 00001411 268A06              <2> mov al, byte [es:esi]
  4257 00001414 26668907            <2> mov word [es:edi], ax
  4258 00001418 47<rept>            <2> times 2 inc edi
  4259 0000141A 46                  <2> inc esi
  4260 0000141B 26803E00            <2> cmp byte [es:esi], 0x00
  4261 0000141F 75F0                <2> jne %%next_char
  4262                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4263                              <2> 
  4264                              <2> 
  4265                              <2> 
  4266                              <2> 
  4267                              <2> 
  4268                              <2> 
  4269                              <2> 
  4270                              <2> 
  4271                              <2> 
  4272 00001421 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4273                              <2> 
  4274 00001426 B8A0000000          <2> mov eax, 160
  4275 0000142B BB16000000          <2> mov ebx, %1
  4276 00001430 F7E3                <2> mul ebx
  4277 00001432 01C7                <2> add edi, eax
  4278                              <2> 
  4279 00001434 BE[3D200000]        <2> mov esi, %4
  4280 00001439 B403                <2> mov ah, %3
  4281                              <2> %%next_char:
  4282 0000143B 268A06              <2> mov al, byte [es:esi]
  4283 0000143E 26668907            <2> mov word [es:edi], ax
  4284 00001442 47<rept>            <2> times 2 inc edi
  4285 00001444 46                  <2> inc esi
  4286 00001445 26803E00            <2> cmp byte [es:esi], 0x00
  4287 00001449 75F0                <2> jne %%next_char
  4288                              <1> 
  4289                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4290 0000144B B31C                <2> mov bl, %1
  4291                              <2> %%repeat_check:
  4292 0000144D E460                <2> in al, 0x60
  4293 0000144F 38D8                <2> cmp al, bl
  4294 00001451 75FA                <2> jne %%repeat_check
  4295 00001453 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4296                              <1> ; recover from error
  4297                              <1> PIC_eoi_cmd
  4298 0000145A B020                <2> mov al, 0x20
  4299 0000145C E6A0                <2> out PIC_SLAVE_PORT0,al
  4300 0000145E E620                <2> out PIC_MASTER_PORT0,al
  4301                              <2> 
  4302                              <2> 
  4303 00001460 61                  <1> popa
  4304 00001461 FB                  <1> sti
  4305 00001462 CF                  <1> iretd
  4306                              <1> 
  4307                              <1> exception_9:
  4308 00001463 FA                  <1> cli
  4309 00001464 60                  <1> pusha
  4310 00001465 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4311                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_9
  4312                              <2> 
  4313                              <2> 
  4314                              <2> 
  4315                              <2> 
  4316                              <2> 
  4317                              <2> 
  4318                              <2> 
  4319                              <2> 
  4320                              <2> 
  4321 0000146C BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4322                              <2> 
  4323 00001471 B8A0000000          <2> mov eax, 160
  4324 00001476 BB01000000          <2> mov ebx, %1
  4325 0000147B F7E3                <2> mul ebx
  4326 0000147D 01C7                <2> add edi, eax
  4327                              <2> 
  4328 0000147F BE[501F0000]        <2> mov esi, %4
  4329 00001484 B40F                <2> mov ah, %3
  4330                              <2> %%next_char:
  4331 00001486 268A06              <2> mov al, byte [es:esi]
  4332 00001489 26668907            <2> mov word [es:edi], ax
  4333 0000148D 47<rept>            <2> times 2 inc edi
  4334 0000148F 46                  <2> inc esi
  4335 00001490 26803E00            <2> cmp byte [es:esi], 0x00
  4336 00001494 75F0                <2> jne %%next_char
  4337                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4338                              <2> 
  4339                              <2> 
  4340                              <2> 
  4341                              <2> 
  4342                              <2> 
  4343                              <2> 
  4344                              <2> 
  4345                              <2> 
  4346                              <2> 
  4347 00001496 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4348                              <2> 
  4349 0000149B B8A0000000          <2> mov eax, 160
  4350 000014A0 BB16000000          <2> mov ebx, %1
  4351 000014A5 F7E3                <2> mul ebx
  4352 000014A7 01C7                <2> add edi, eax
  4353                              <2> 
  4354 000014A9 BE[3D200000]        <2> mov esi, %4
  4355 000014AE B403                <2> mov ah, %3
  4356                              <2> %%next_char:
  4357 000014B0 268A06              <2> mov al, byte [es:esi]
  4358 000014B3 26668907            <2> mov word [es:edi], ax
  4359 000014B7 47<rept>            <2> times 2 inc edi
  4360 000014B9 46                  <2> inc esi
  4361 000014BA 26803E00            <2> cmp byte [es:esi], 0x00
  4362 000014BE 75F0                <2> jne %%next_char
  4363                              <1> 
  4364                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4365 000014C0 B31C                <2> mov bl, %1
  4366                              <2> %%repeat_check:
  4367 000014C2 E460                <2> in al, 0x60
  4368 000014C4 38D8                <2> cmp al, bl
  4369 000014C6 75FA                <2> jne %%repeat_check
  4370 000014C8 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4371                              <1> ; recover from error
  4372                              <1> PIC_eoi_cmd
  4373 000014CF B020                <2> mov al, 0x20
  4374 000014D1 E6A0                <2> out PIC_SLAVE_PORT0,al
  4375 000014D3 E620                <2> out PIC_MASTER_PORT0,al
  4376                              <2> 
  4377                              <2> 
  4378 000014D5 61                  <1> popa
  4379 000014D6 FB                  <1> sti
  4380 000014D7 CF                  <1> iretd
  4381                              <1> 
  4382                              <1> exception_10:
  4383 000014D8 FA                  <1> cli
  4384 000014D9 60                  <1> pusha
  4385 000014DA 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4386                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_10
  4387                              <2> 
  4388                              <2> 
  4389                              <2> 
  4390                              <2> 
  4391                              <2> 
  4392                              <2> 
  4393                              <2> 
  4394                              <2> 
  4395                              <2> 
  4396 000014E1 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4397                              <2> 
  4398 000014E6 B8A0000000          <2> mov eax, 160
  4399 000014EB BB01000000          <2> mov ebx, %1
  4400 000014F0 F7E3                <2> mul ebx
  4401 000014F2 01C7                <2> add edi, eax
  4402                              <2> 
  4403 000014F4 BE[691F0000]        <2> mov esi, %4
  4404 000014F9 B40F                <2> mov ah, %3
  4405                              <2> %%next_char:
  4406 000014FB 268A06              <2> mov al, byte [es:esi]
  4407 000014FE 26668907            <2> mov word [es:edi], ax
  4408 00001502 47<rept>            <2> times 2 inc edi
  4409 00001504 46                  <2> inc esi
  4410 00001505 26803E00            <2> cmp byte [es:esi], 0x00
  4411 00001509 75F0                <2> jne %%next_char
  4412                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4413                              <2> 
  4414                              <2> 
  4415                              <2> 
  4416                              <2> 
  4417                              <2> 
  4418                              <2> 
  4419                              <2> 
  4420                              <2> 
  4421                              <2> 
  4422 0000150B BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4423                              <2> 
  4424 00001510 B8A0000000          <2> mov eax, 160
  4425 00001515 BB16000000          <2> mov ebx, %1
  4426 0000151A F7E3                <2> mul ebx
  4427 0000151C 01C7                <2> add edi, eax
  4428                              <2> 
  4429 0000151E BE[3D200000]        <2> mov esi, %4
  4430 00001523 B403                <2> mov ah, %3
  4431                              <2> %%next_char:
  4432 00001525 268A06              <2> mov al, byte [es:esi]
  4433 00001528 26668907            <2> mov word [es:edi], ax
  4434 0000152C 47<rept>            <2> times 2 inc edi
  4435 0000152E 46                  <2> inc esi
  4436 0000152F 26803E00            <2> cmp byte [es:esi], 0x00
  4437 00001533 75F0                <2> jne %%next_char
  4438                              <1> 
  4439                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4440 00001535 B31C                <2> mov bl, %1
  4441                              <2> %%repeat_check:
  4442 00001537 E460                <2> in al, 0x60
  4443 00001539 38D8                <2> cmp al, bl
  4444 0000153B 75FA                <2> jne %%repeat_check
  4445 0000153D EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4446                              <1> ; recover from error
  4447                              <1> PIC_eoi_cmd
  4448 00001544 B020                <2> mov al, 0x20
  4449 00001546 E6A0                <2> out PIC_SLAVE_PORT0,al
  4450 00001548 E620                <2> out PIC_MASTER_PORT0,al
  4451                              <2> 
  4452                              <2> 
  4453 0000154A 61                  <1> popa
  4454 0000154B FB                  <1> sti
  4455 0000154C CF                  <1> iretd
  4456                              <1> 
  4457                              <1> exception_11:
  4458 0000154D FA                  <1> cli
  4459 0000154E 60                  <1> pusha
  4460 0000154F 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4461                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_11
  4462                              <2> 
  4463                              <2> 
  4464                              <2> 
  4465                              <2> 
  4466                              <2> 
  4467                              <2> 
  4468                              <2> 
  4469                              <2> 
  4470                              <2> 
  4471 00001556 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4472                              <2> 
  4473 0000155B B8A0000000          <2> mov eax, 160
  4474 00001560 BB01000000          <2> mov ebx, %1
  4475 00001565 F7E3                <2> mul ebx
  4476 00001567 01C7                <2> add edi, eax
  4477                              <2> 
  4478 00001569 BE[841F0000]        <2> mov esi, %4
  4479 0000156E B40F                <2> mov ah, %3
  4480                              <2> %%next_char:
  4481 00001570 268A06              <2> mov al, byte [es:esi]
  4482 00001573 26668907            <2> mov word [es:edi], ax
  4483 00001577 47<rept>            <2> times 2 inc edi
  4484 00001579 46                  <2> inc esi
  4485 0000157A 26803E00            <2> cmp byte [es:esi], 0x00
  4486 0000157E 75F0                <2> jne %%next_char
  4487                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4488                              <2> 
  4489                              <2> 
  4490                              <2> 
  4491                              <2> 
  4492                              <2> 
  4493                              <2> 
  4494                              <2> 
  4495                              <2> 
  4496                              <2> 
  4497 00001580 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4498                              <2> 
  4499 00001585 B8A0000000          <2> mov eax, 160
  4500 0000158A BB16000000          <2> mov ebx, %1
  4501 0000158F F7E3                <2> mul ebx
  4502 00001591 01C7                <2> add edi, eax
  4503                              <2> 
  4504 00001593 BE[3D200000]        <2> mov esi, %4
  4505 00001598 B403                <2> mov ah, %3
  4506                              <2> %%next_char:
  4507 0000159A 268A06              <2> mov al, byte [es:esi]
  4508 0000159D 26668907            <2> mov word [es:edi], ax
  4509 000015A1 47<rept>            <2> times 2 inc edi
  4510 000015A3 46                  <2> inc esi
  4511 000015A4 26803E00            <2> cmp byte [es:esi], 0x00
  4512 000015A8 75F0                <2> jne %%next_char
  4513                              <1> 
  4514                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4515 000015AA B31C                <2> mov bl, %1
  4516                              <2> %%repeat_check:
  4517 000015AC E460                <2> in al, 0x60
  4518 000015AE 38D8                <2> cmp al, bl
  4519 000015B0 75FA                <2> jne %%repeat_check
  4520 000015B2 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4521                              <1> ; recover from error
  4522                              <1> PIC_eoi_cmd
  4523 000015B9 B020                <2> mov al, 0x20
  4524 000015BB E6A0                <2> out PIC_SLAVE_PORT0,al
  4525 000015BD E620                <2> out PIC_MASTER_PORT0,al
  4526                              <2> 
  4527                              <2> 
  4528 000015BF 61                  <1> popa
  4529 000015C0 FB                  <1> sti
  4530 000015C1 CF                  <1> iretd
  4531                              <1> 
  4532                              <1> exception_12:
  4533 000015C2 FA                  <1> cli
  4534 000015C3 60                  <1> pusha
  4535 000015C4 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4536                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_12
  4537                              <2> 
  4538                              <2> 
  4539                              <2> 
  4540                              <2> 
  4541                              <2> 
  4542                              <2> 
  4543                              <2> 
  4544                              <2> 
  4545                              <2> 
  4546 000015CB BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4547                              <2> 
  4548 000015D0 B8A0000000          <2> mov eax, 160
  4549 000015D5 BB01000000          <2> mov ebx, %1
  4550 000015DA F7E3                <2> mul ebx
  4551 000015DC 01C7                <2> add edi, eax
  4552                              <2> 
  4553 000015DE BE[A71F0000]        <2> mov esi, %4
  4554 000015E3 B40F                <2> mov ah, %3
  4555                              <2> %%next_char:
  4556 000015E5 268A06              <2> mov al, byte [es:esi]
  4557 000015E8 26668907            <2> mov word [es:edi], ax
  4558 000015EC 47<rept>            <2> times 2 inc edi
  4559 000015EE 46                  <2> inc esi
  4560 000015EF 26803E00            <2> cmp byte [es:esi], 0x00
  4561 000015F3 75F0                <2> jne %%next_char
  4562                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  4563                              <2> 
  4564                              <2> 
  4565                              <2> 
  4566                              <2> 
  4567                              <2> 
  4568                              <2> 
  4569                              <2> 
  4570                              <2> 
  4571                              <2> 
  4572 000015F5 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4573                              <2> 
  4574 000015FA B8A0000000          <2> mov eax, 160
  4575 000015FF BB16000000          <2> mov ebx, %1
  4576 00001604 F7E3                <2> mul ebx
  4577 00001606 01C7                <2> add edi, eax
  4578                              <2> 
  4579 00001608 BE[3D200000]        <2> mov esi, %4
  4580 0000160D B403                <2> mov ah, %3
  4581                              <2> %%next_char:
  4582 0000160F 268A06              <2> mov al, byte [es:esi]
  4583 00001612 26668907            <2> mov word [es:edi], ax
  4584 00001616 47<rept>            <2> times 2 inc edi
  4585 00001618 46                  <2> inc esi
  4586 00001619 26803E00            <2> cmp byte [es:esi], 0x00
  4587 0000161D 75F0                <2> jne %%next_char
  4588                              <1> 
  4589                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  4590 0000161F B31C                <2> mov bl, %1
  4591                              <2> %%repeat_check:
  4592 00001621 E460                <2> in al, 0x60
  4593 00001623 38D8                <2> cmp al, bl
  4594 00001625 75FA                <2> jne %%repeat_check
  4595 00001627 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  4596                              <1> ; recover from error
  4597                              <1> PIC_eoi_cmd
  4598 0000162E B020                <2> mov al, 0x20
  4599 00001630 E6A0                <2> out PIC_SLAVE_PORT0,al
  4600 00001632 E620                <2> out PIC_MASTER_PORT0,al
  4601                              <2> 
  4602                              <2> 
  4603 00001634 61                  <1> popa
  4604 00001635 FB                  <1> sti
  4605 00001636 CF                  <1> iretd
  4606                              <1> 
  4607                              <1> exception_13:
  4608                              <1> save_regs
  4609 00001637 A3[59200000]        <2> mov [REGISTER_EAX], eax
  4610 0000163C 891D[5D200000]      <2> mov [REGISTER_EBX], ebx
  4611 00001642 890D[61200000]      <2> mov [REGISTER_ECX], ecx
  4612 00001648 8915[65200000]      <2> mov [REGISTER_EDX], edx
  4613 0000164E 893D[69200000]      <2> mov [REGISTER_EDI], edi
  4614 00001654 8935[6D200000]      <2> mov [REGISTER_ESI], esi
  4615 0000165A 8925[71200000]      <2> mov [REGISTER_ESP], esp
  4616 00001660 892D[75200000]      <2> mov [REGISTER_EBP], ebp
  4617 00001666 C705[79200000]-     <2> mov dword [REGISTER_EIP], $
  4618 0000166C [66160000]          <2>
  4619                              <2> 
  4620 00001670 8C05[7D200000]      <2> mov [REGISTER_ES], es
  4621 00001676 8C1D[7F200000]      <2> mov [REGISTER_DS], ds
  4622 0000167C 8C15[81200000]      <2> mov [REGISTER_SS], ss
  4623 00001682 8C25[83200000]      <2> mov [REGISTER_FS], fs
  4624 00001688 8C2D[85200000]      <2> mov [REGISTER_GS], gs
  4625 0000168E FA                  <1> cli
  4626 0000168F 60                  <1> pusha
  4627 00001690 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  4628                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_13
  4629                              <2> 
  4630                              <2> 
  4631                              <2> 
  4632                              <2> 
  4633                              <2> 
  4634                              <2> 
  4635                              <2> 
  4636                              <2> 
  4637                              <2> 
  4638 00001697 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4639                              <2> 
  4640 0000169C B8A0000000          <2> mov eax, 160
  4641 000016A1 BB01000000          <2> mov ebx, %1
  4642 000016A6 F7E3                <2> mul ebx
  4643 000016A8 01C7                <2> add edi, eax
  4644                              <2> 
  4645 000016AA BE[C61F0000]        <2> mov esi, %4
  4646 000016AF B40F                <2> mov ah, %3
  4647                              <2> %%next_char:
  4648 000016B1 268A06              <2> mov al, byte [es:esi]
  4649 000016B4 26668907            <2> mov word [es:edi], ax
  4650 000016B8 47<rept>            <2> times 2 inc edi
  4651 000016BA 46                  <2> inc esi
  4652 000016BB 26803E00            <2> cmp byte [es:esi], 0x00
  4653 000016BF 75F0                <2> jne %%next_char
  4654                              <1> show_regs
  4655                              <2> number_to_text [REGISTER_EAX], 16, mensage_eax+13
  4656                              <3> 
  4657                              <3> 
  4658                              <3> 
  4659 000016C1 BF[94200000]        <3> mov edi, %3
  4660 000016C6 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4661 000016CB A1[59200000]        <3> mov eax, %1
  4662 000016D0 BB10000000          <3> mov ebx, %2
  4663                              <3> %%divide:
  4664 000016D5 31D2                <3> xor edx, edx
  4665 000016D7 F7F3                <3> div ebx
  4666 000016D9 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4667 000016DD 3E880F              <3> mov byte [ds:edi], cl
  4668 000016E0 4F                  <3> dec edi
  4669 000016E1 39D8                <3> cmp eax, ebx
  4670 000016E3 7DF0                <3> jge %%divide
  4671 000016E5 3D00000000          <3> cmp eax, 0
  4672 000016EA 7407                <3> je %%end
  4673 000016EC 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4674 000016F0 26880F              <3> mov byte [es:edi], cl
  4675                              <3> %%end:
  4676                              <2> number_to_text [REGISTER_EBX], 16, mensage_ebx+13
  4677                              <3> 
  4678                              <3> 
  4679                              <3> 
  4680 000016F3 BF[A4200000]        <3> mov edi, %3
  4681 000016F8 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4682 000016FD A1[5D200000]        <3> mov eax, %1
  4683 00001702 BB10000000          <3> mov ebx, %2
  4684                              <3> %%divide:
  4685 00001707 31D2                <3> xor edx, edx
  4686 00001709 F7F3                <3> div ebx
  4687 0000170B 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4688 0000170F 3E880F              <3> mov byte [ds:edi], cl
  4689 00001712 4F                  <3> dec edi
  4690 00001713 39D8                <3> cmp eax, ebx
  4691 00001715 7DF0                <3> jge %%divide
  4692 00001717 3D00000000          <3> cmp eax, 0
  4693 0000171C 7407                <3> je %%end
  4694 0000171E 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4695 00001722 26880F              <3> mov byte [es:edi], cl
  4696                              <3> %%end:
  4697                              <2> number_to_text [REGISTER_ECX], 16, mensage_ecx+13
  4698                              <3> 
  4699                              <3> 
  4700                              <3> 
  4701 00001725 BF[B4200000]        <3> mov edi, %3
  4702 0000172A BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4703 0000172F A1[61200000]        <3> mov eax, %1
  4704 00001734 BB10000000          <3> mov ebx, %2
  4705                              <3> %%divide:
  4706 00001739 31D2                <3> xor edx, edx
  4707 0000173B F7F3                <3> div ebx
  4708 0000173D 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4709 00001741 3E880F              <3> mov byte [ds:edi], cl
  4710 00001744 4F                  <3> dec edi
  4711 00001745 39D8                <3> cmp eax, ebx
  4712 00001747 7DF0                <3> jge %%divide
  4713 00001749 3D00000000          <3> cmp eax, 0
  4714 0000174E 7407                <3> je %%end
  4715 00001750 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4716 00001754 26880F              <3> mov byte [es:edi], cl
  4717                              <3> %%end:
  4718                              <2> number_to_text [REGISTER_EDX], 16, mensage_edx+13
  4719                              <3> 
  4720                              <3> 
  4721                              <3> 
  4722 00001757 BF[C4200000]        <3> mov edi, %3
  4723 0000175C BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4724 00001761 A1[65200000]        <3> mov eax, %1
  4725 00001766 BB10000000          <3> mov ebx, %2
  4726                              <3> %%divide:
  4727 0000176B 31D2                <3> xor edx, edx
  4728 0000176D F7F3                <3> div ebx
  4729 0000176F 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4730 00001773 3E880F              <3> mov byte [ds:edi], cl
  4731 00001776 4F                  <3> dec edi
  4732 00001777 39D8                <3> cmp eax, ebx
  4733 00001779 7DF0                <3> jge %%divide
  4734 0000177B 3D00000000          <3> cmp eax, 0
  4735 00001780 7407                <3> je %%end
  4736 00001782 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4737 00001786 26880F              <3> mov byte [es:edi], cl
  4738                              <3> %%end:
  4739                              <2> number_to_text [REGISTER_EDI], 16, mensage_edi+13
  4740                              <3> 
  4741                              <3> 
  4742                              <3> 
  4743 00001789 BF[D4200000]        <3> mov edi, %3
  4744 0000178E BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4745 00001793 A1[69200000]        <3> mov eax, %1
  4746 00001798 BB10000000          <3> mov ebx, %2
  4747                              <3> %%divide:
  4748 0000179D 31D2                <3> xor edx, edx
  4749 0000179F F7F3                <3> div ebx
  4750 000017A1 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4751 000017A5 3E880F              <3> mov byte [ds:edi], cl
  4752 000017A8 4F                  <3> dec edi
  4753 000017A9 39D8                <3> cmp eax, ebx
  4754 000017AB 7DF0                <3> jge %%divide
  4755 000017AD 3D00000000          <3> cmp eax, 0
  4756 000017B2 7407                <3> je %%end
  4757 000017B4 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4758 000017B8 26880F              <3> mov byte [es:edi], cl
  4759                              <3> %%end:
  4760                              <2> number_to_text [REGISTER_ESI], 16, mensage_esi+13
  4761                              <3> 
  4762                              <3> 
  4763                              <3> 
  4764 000017BB BF[E4200000]        <3> mov edi, %3
  4765 000017C0 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4766 000017C5 A1[6D200000]        <3> mov eax, %1
  4767 000017CA BB10000000          <3> mov ebx, %2
  4768                              <3> %%divide:
  4769 000017CF 31D2                <3> xor edx, edx
  4770 000017D1 F7F3                <3> div ebx
  4771 000017D3 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4772 000017D7 3E880F              <3> mov byte [ds:edi], cl
  4773 000017DA 4F                  <3> dec edi
  4774 000017DB 39D8                <3> cmp eax, ebx
  4775 000017DD 7DF0                <3> jge %%divide
  4776 000017DF 3D00000000          <3> cmp eax, 0
  4777 000017E4 7407                <3> je %%end
  4778 000017E6 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4779 000017EA 26880F              <3> mov byte [es:edi], cl
  4780                              <3> %%end:
  4781                              <2> number_to_text [REGISTER_ESP], 16, mensage_esp+13
  4782                              <3> 
  4783                              <3> 
  4784                              <3> 
  4785 000017ED BF[F4200000]        <3> mov edi, %3
  4786 000017F2 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4787 000017F7 A1[71200000]        <3> mov eax, %1
  4788 000017FC BB10000000          <3> mov ebx, %2
  4789                              <3> %%divide:
  4790 00001801 31D2                <3> xor edx, edx
  4791 00001803 F7F3                <3> div ebx
  4792 00001805 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4793 00001809 3E880F              <3> mov byte [ds:edi], cl
  4794 0000180C 4F                  <3> dec edi
  4795 0000180D 39D8                <3> cmp eax, ebx
  4796 0000180F 7DF0                <3> jge %%divide
  4797 00001811 3D00000000          <3> cmp eax, 0
  4798 00001816 7407                <3> je %%end
  4799 00001818 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4800 0000181C 26880F              <3> mov byte [es:edi], cl
  4801                              <3> %%end:
  4802                              <2> number_to_text [REGISTER_EBP], 16, mensage_ebp+13
  4803                              <3> 
  4804                              <3> 
  4805                              <3> 
  4806 0000181F BF[04210000]        <3> mov edi, %3
  4807 00001824 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4808 00001829 A1[75200000]        <3> mov eax, %1
  4809 0000182E BB10000000          <3> mov ebx, %2
  4810                              <3> %%divide:
  4811 00001833 31D2                <3> xor edx, edx
  4812 00001835 F7F3                <3> div ebx
  4813 00001837 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4814 0000183B 3E880F              <3> mov byte [ds:edi], cl
  4815 0000183E 4F                  <3> dec edi
  4816 0000183F 39D8                <3> cmp eax, ebx
  4817 00001841 7DF0                <3> jge %%divide
  4818 00001843 3D00000000          <3> cmp eax, 0
  4819 00001848 7407                <3> je %%end
  4820 0000184A 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4821 0000184E 26880F              <3> mov byte [es:edi], cl
  4822                              <3> %%end:
  4823                              <2> number_to_text [REGISTER_EIP], 16, mensage_eip+13
  4824                              <3> 
  4825                              <3> 
  4826                              <3> 
  4827 00001851 BF[14210000]        <3> mov edi, %3
  4828 00001856 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4829 0000185B A1[79200000]        <3> mov eax, %1
  4830 00001860 BB10000000          <3> mov ebx, %2
  4831                              <3> %%divide:
  4832 00001865 31D2                <3> xor edx, edx
  4833 00001867 F7F3                <3> div ebx
  4834 00001869 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4835 0000186D 3E880F              <3> mov byte [ds:edi], cl
  4836 00001870 4F                  <3> dec edi
  4837 00001871 39D8                <3> cmp eax, ebx
  4838 00001873 7DF0                <3> jge %%divide
  4839 00001875 3D00000000          <3> cmp eax, 0
  4840 0000187A 7407                <3> je %%end
  4841 0000187C 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4842 00001880 26880F              <3> mov byte [es:edi], cl
  4843                              <3> %%end:
  4844                              <2> number_to_text [REGISTER_ES], 16, mensage_es+8
  4845                              <3> 
  4846                              <3> 
  4847                              <3> 
  4848 00001883 BF[1F210000]        <3> mov edi, %3
  4849 00001888 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4850 0000188D A1[7D200000]        <3> mov eax, %1
  4851 00001892 BB10000000          <3> mov ebx, %2
  4852                              <3> %%divide:
  4853 00001897 31D2                <3> xor edx, edx
  4854 00001899 F7F3                <3> div ebx
  4855 0000189B 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4856 0000189F 3E880F              <3> mov byte [ds:edi], cl
  4857 000018A2 4F                  <3> dec edi
  4858 000018A3 39D8                <3> cmp eax, ebx
  4859 000018A5 7DF0                <3> jge %%divide
  4860 000018A7 3D00000000          <3> cmp eax, 0
  4861 000018AC 7407                <3> je %%end
  4862 000018AE 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4863 000018B2 26880F              <3> mov byte [es:edi], cl
  4864                              <3> %%end:
  4865                              <2> number_to_text [REGISTER_DS], 16, mensage_ds+8
  4866                              <3> 
  4867                              <3> 
  4868                              <3> 
  4869 000018B5 BF[2A210000]        <3> mov edi, %3
  4870 000018BA BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4871 000018BF A1[7F200000]        <3> mov eax, %1
  4872 000018C4 BB10000000          <3> mov ebx, %2
  4873                              <3> %%divide:
  4874 000018C9 31D2                <3> xor edx, edx
  4875 000018CB F7F3                <3> div ebx
  4876 000018CD 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4877 000018D1 3E880F              <3> mov byte [ds:edi], cl
  4878 000018D4 4F                  <3> dec edi
  4879 000018D5 39D8                <3> cmp eax, ebx
  4880 000018D7 7DF0                <3> jge %%divide
  4881 000018D9 3D00000000          <3> cmp eax, 0
  4882 000018DE 7407                <3> je %%end
  4883 000018E0 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4884 000018E4 26880F              <3> mov byte [es:edi], cl
  4885                              <3> %%end:
  4886                              <2> number_to_text [REGISTER_SS], 16, mensage_ss+8
  4887                              <3> 
  4888                              <3> 
  4889                              <3> 
  4890 000018E7 BF[35210000]        <3> mov edi, %3
  4891 000018EC BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4892 000018F1 A1[81200000]        <3> mov eax, %1
  4893 000018F6 BB10000000          <3> mov ebx, %2
  4894                              <3> %%divide:
  4895 000018FB 31D2                <3> xor edx, edx
  4896 000018FD F7F3                <3> div ebx
  4897 000018FF 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4898 00001903 3E880F              <3> mov byte [ds:edi], cl
  4899 00001906 4F                  <3> dec edi
  4900 00001907 39D8                <3> cmp eax, ebx
  4901 00001909 7DF0                <3> jge %%divide
  4902 0000190B 3D00000000          <3> cmp eax, 0
  4903 00001910 7407                <3> je %%end
  4904 00001912 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4905 00001916 26880F              <3> mov byte [es:edi], cl
  4906                              <3> %%end:
  4907                              <2> number_to_text [REGISTER_FS], 16, mensage_fs+8
  4908                              <3> 
  4909                              <3> 
  4910                              <3> 
  4911 00001919 BF[40210000]        <3> mov edi, %3
  4912 0000191E BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4913 00001923 A1[83200000]        <3> mov eax, %1
  4914 00001928 BB10000000          <3> mov ebx, %2
  4915                              <3> %%divide:
  4916 0000192D 31D2                <3> xor edx, edx
  4917 0000192F F7F3                <3> div ebx
  4918 00001931 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4919 00001935 3E880F              <3> mov byte [ds:edi], cl
  4920 00001938 4F                  <3> dec edi
  4921 00001939 39D8                <3> cmp eax, ebx
  4922 0000193B 7DF0                <3> jge %%divide
  4923 0000193D 3D00000000          <3> cmp eax, 0
  4924 00001942 7407                <3> je %%end
  4925 00001944 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4926 00001948 26880F              <3> mov byte [es:edi], cl
  4927                              <3> %%end:
  4928                              <2> number_to_text [REGISTER_GS], 16, mensage_gs+8
  4929                              <3> 
  4930                              <3> 
  4931                              <3> 
  4932 0000194B BF[4B210000]        <3> mov edi, %3
  4933 00001950 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  4934 00001955 A1[85200000]        <3> mov eax, %1
  4935 0000195A BB10000000          <3> mov ebx, %2
  4936                              <3> %%divide:
  4937 0000195F 31D2                <3> xor edx, edx
  4938 00001961 F7F3                <3> div ebx
  4939 00001963 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  4940 00001967 3E880F              <3> mov byte [ds:edi], cl
  4941 0000196A 4F                  <3> dec edi
  4942 0000196B 39D8                <3> cmp eax, ebx
  4943 0000196D 7DF0                <3> jge %%divide
  4944 0000196F 3D00000000          <3> cmp eax, 0
  4945 00001974 7407                <3> je %%end
  4946 00001976 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  4947 0000197A 26880F              <3> mov byte [es:edi], cl
  4948                              <3> %%end:
  4949                              <2> VIDEO_TEXTMODE_write_mensage 0x03, 0x01, 0x0F, mensage_eax
  4950                              <3> 
  4951                              <3> 
  4952                              <3> 
  4953                              <3> 
  4954                              <3> 
  4955                              <3> 
  4956                              <3> 
  4957                              <3> 
  4958                              <3> 
  4959 0000197D BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4960                              <3> 
  4961 00001982 B8A0000000          <3> mov eax, 160
  4962 00001987 BB03000000          <3> mov ebx, %1
  4963 0000198C F7E3                <3> mul ebx
  4964 0000198E 01C7                <3> add edi, eax
  4965                              <3> 
  4966 00001990 BE[87200000]        <3> mov esi, %4
  4967 00001995 B40F                <3> mov ah, %3
  4968                              <3> %%next_char:
  4969 00001997 268A06              <3> mov al, byte [es:esi]
  4970 0000199A 26668907            <3> mov word [es:edi], ax
  4971 0000199E 47<rept>            <3> times 2 inc edi
  4972 000019A0 46                  <3> inc esi
  4973 000019A1 26803E00            <3> cmp byte [es:esi], 0x00
  4974 000019A5 75F0                <3> jne %%next_char
  4975                              <2> VIDEO_TEXTMODE_write_mensage 0x04, 0x01, 0x0F, mensage_ebx
  4976                              <3> 
  4977                              <3> 
  4978                              <3> 
  4979                              <3> 
  4980                              <3> 
  4981                              <3> 
  4982                              <3> 
  4983                              <3> 
  4984                              <3> 
  4985 000019A7 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  4986                              <3> 
  4987 000019AC B8A0000000          <3> mov eax, 160
  4988 000019B1 BB04000000          <3> mov ebx, %1
  4989 000019B6 F7E3                <3> mul ebx
  4990 000019B8 01C7                <3> add edi, eax
  4991                              <3> 
  4992 000019BA BE[97200000]        <3> mov esi, %4
  4993 000019BF B40F                <3> mov ah, %3
  4994                              <3> %%next_char:
  4995 000019C1 268A06              <3> mov al, byte [es:esi]
  4996 000019C4 26668907            <3> mov word [es:edi], ax
  4997 000019C8 47<rept>            <3> times 2 inc edi
  4998 000019CA 46                  <3> inc esi
  4999 000019CB 26803E00            <3> cmp byte [es:esi], 0x00
  5000 000019CF 75F0                <3> jne %%next_char
  5001                              <2> VIDEO_TEXTMODE_write_mensage 0x05, 0x01, 0x0F, mensage_ecx
  5002                              <3> 
  5003                              <3> 
  5004                              <3> 
  5005                              <3> 
  5006                              <3> 
  5007                              <3> 
  5008                              <3> 
  5009                              <3> 
  5010                              <3> 
  5011 000019D1 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5012                              <3> 
  5013 000019D6 B8A0000000          <3> mov eax, 160
  5014 000019DB BB05000000          <3> mov ebx, %1
  5015 000019E0 F7E3                <3> mul ebx
  5016 000019E2 01C7                <3> add edi, eax
  5017                              <3> 
  5018 000019E4 BE[A7200000]        <3> mov esi, %4
  5019 000019E9 B40F                <3> mov ah, %3
  5020                              <3> %%next_char:
  5021 000019EB 268A06              <3> mov al, byte [es:esi]
  5022 000019EE 26668907            <3> mov word [es:edi], ax
  5023 000019F2 47<rept>            <3> times 2 inc edi
  5024 000019F4 46                  <3> inc esi
  5025 000019F5 26803E00            <3> cmp byte [es:esi], 0x00
  5026 000019F9 75F0                <3> jne %%next_char
  5027                              <2> VIDEO_TEXTMODE_write_mensage 0x06, 0x01, 0x0F, mensage_edx
  5028                              <3> 
  5029                              <3> 
  5030                              <3> 
  5031                              <3> 
  5032                              <3> 
  5033                              <3> 
  5034                              <3> 
  5035                              <3> 
  5036                              <3> 
  5037 000019FB BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5038                              <3> 
  5039 00001A00 B8A0000000          <3> mov eax, 160
  5040 00001A05 BB06000000          <3> mov ebx, %1
  5041 00001A0A F7E3                <3> mul ebx
  5042 00001A0C 01C7                <3> add edi, eax
  5043                              <3> 
  5044 00001A0E BE[B7200000]        <3> mov esi, %4
  5045 00001A13 B40F                <3> mov ah, %3
  5046                              <3> %%next_char:
  5047 00001A15 268A06              <3> mov al, byte [es:esi]
  5048 00001A18 26668907            <3> mov word [es:edi], ax
  5049 00001A1C 47<rept>            <3> times 2 inc edi
  5050 00001A1E 46                  <3> inc esi
  5051 00001A1F 26803E00            <3> cmp byte [es:esi], 0x00
  5052 00001A23 75F0                <3> jne %%next_char
  5053                              <2> VIDEO_TEXTMODE_write_mensage 0x07, 0x01, 0x0F, mensage_edi
  5054                              <3> 
  5055                              <3> 
  5056                              <3> 
  5057                              <3> 
  5058                              <3> 
  5059                              <3> 
  5060                              <3> 
  5061                              <3> 
  5062                              <3> 
  5063 00001A25 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5064                              <3> 
  5065 00001A2A B8A0000000          <3> mov eax, 160
  5066 00001A2F BB07000000          <3> mov ebx, %1
  5067 00001A34 F7E3                <3> mul ebx
  5068 00001A36 01C7                <3> add edi, eax
  5069                              <3> 
  5070 00001A38 BE[C7200000]        <3> mov esi, %4
  5071 00001A3D B40F                <3> mov ah, %3
  5072                              <3> %%next_char:
  5073 00001A3F 268A06              <3> mov al, byte [es:esi]
  5074 00001A42 26668907            <3> mov word [es:edi], ax
  5075 00001A46 47<rept>            <3> times 2 inc edi
  5076 00001A48 46                  <3> inc esi
  5077 00001A49 26803E00            <3> cmp byte [es:esi], 0x00
  5078 00001A4D 75F0                <3> jne %%next_char
  5079                              <2> VIDEO_TEXTMODE_write_mensage 0x08, 0x01, 0x0F, mensage_esi
  5080                              <3> 
  5081                              <3> 
  5082                              <3> 
  5083                              <3> 
  5084                              <3> 
  5085                              <3> 
  5086                              <3> 
  5087                              <3> 
  5088                              <3> 
  5089 00001A4F BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5090                              <3> 
  5091 00001A54 B8A0000000          <3> mov eax, 160
  5092 00001A59 BB08000000          <3> mov ebx, %1
  5093 00001A5E F7E3                <3> mul ebx
  5094 00001A60 01C7                <3> add edi, eax
  5095                              <3> 
  5096 00001A62 BE[D7200000]        <3> mov esi, %4
  5097 00001A67 B40F                <3> mov ah, %3
  5098                              <3> %%next_char:
  5099 00001A69 268A06              <3> mov al, byte [es:esi]
  5100 00001A6C 26668907            <3> mov word [es:edi], ax
  5101 00001A70 47<rept>            <3> times 2 inc edi
  5102 00001A72 46                  <3> inc esi
  5103 00001A73 26803E00            <3> cmp byte [es:esi], 0x00
  5104 00001A77 75F0                <3> jne %%next_char
  5105                              <2> VIDEO_TEXTMODE_write_mensage 0x09, 0x01, 0x0F, mensage_esp
  5106                              <3> 
  5107                              <3> 
  5108                              <3> 
  5109                              <3> 
  5110                              <3> 
  5111                              <3> 
  5112                              <3> 
  5113                              <3> 
  5114                              <3> 
  5115 00001A79 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5116                              <3> 
  5117 00001A7E B8A0000000          <3> mov eax, 160
  5118 00001A83 BB09000000          <3> mov ebx, %1
  5119 00001A88 F7E3                <3> mul ebx
  5120 00001A8A 01C7                <3> add edi, eax
  5121                              <3> 
  5122 00001A8C BE[E7200000]        <3> mov esi, %4
  5123 00001A91 B40F                <3> mov ah, %3
  5124                              <3> %%next_char:
  5125 00001A93 268A06              <3> mov al, byte [es:esi]
  5126 00001A96 26668907            <3> mov word [es:edi], ax
  5127 00001A9A 47<rept>            <3> times 2 inc edi
  5128 00001A9C 46                  <3> inc esi
  5129 00001A9D 26803E00            <3> cmp byte [es:esi], 0x00
  5130 00001AA1 75F0                <3> jne %%next_char
  5131                              <2> VIDEO_TEXTMODE_write_mensage 0x0A, 0x01, 0x0F, mensage_ebp
  5132                              <3> 
  5133                              <3> 
  5134                              <3> 
  5135                              <3> 
  5136                              <3> 
  5137                              <3> 
  5138                              <3> 
  5139                              <3> 
  5140                              <3> 
  5141 00001AA3 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5142                              <3> 
  5143 00001AA8 B8A0000000          <3> mov eax, 160
  5144 00001AAD BB0A000000          <3> mov ebx, %1
  5145 00001AB2 F7E3                <3> mul ebx
  5146 00001AB4 01C7                <3> add edi, eax
  5147                              <3> 
  5148 00001AB6 BE[F7200000]        <3> mov esi, %4
  5149 00001ABB B40F                <3> mov ah, %3
  5150                              <3> %%next_char:
  5151 00001ABD 268A06              <3> mov al, byte [es:esi]
  5152 00001AC0 26668907            <3> mov word [es:edi], ax
  5153 00001AC4 47<rept>            <3> times 2 inc edi
  5154 00001AC6 46                  <3> inc esi
  5155 00001AC7 26803E00            <3> cmp byte [es:esi], 0x00
  5156 00001ACB 75F0                <3> jne %%next_char
  5157                              <2> VIDEO_TEXTMODE_write_mensage 0x0B, 0x01, 0x0F, mensage_eip
  5158                              <3> 
  5159                              <3> 
  5160                              <3> 
  5161                              <3> 
  5162                              <3> 
  5163                              <3> 
  5164                              <3> 
  5165                              <3> 
  5166                              <3> 
  5167 00001ACD BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5168                              <3> 
  5169 00001AD2 B8A0000000          <3> mov eax, 160
  5170 00001AD7 BB0B000000          <3> mov ebx, %1
  5171 00001ADC F7E3                <3> mul ebx
  5172 00001ADE 01C7                <3> add edi, eax
  5173                              <3> 
  5174 00001AE0 BE[07210000]        <3> mov esi, %4
  5175 00001AE5 B40F                <3> mov ah, %3
  5176                              <3> %%next_char:
  5177 00001AE7 268A06              <3> mov al, byte [es:esi]
  5178 00001AEA 26668907            <3> mov word [es:edi], ax
  5179 00001AEE 47<rept>            <3> times 2 inc edi
  5180 00001AF0 46                  <3> inc esi
  5181 00001AF1 26803E00            <3> cmp byte [es:esi], 0x00
  5182 00001AF5 75F0                <3> jne %%next_char
  5183                              <2> VIDEO_TEXTMODE_write_mensage 0x0C, 0x01, 0x0F, mensage_es
  5184                              <3> 
  5185                              <3> 
  5186                              <3> 
  5187                              <3> 
  5188                              <3> 
  5189                              <3> 
  5190                              <3> 
  5191                              <3> 
  5192                              <3> 
  5193 00001AF7 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5194                              <3> 
  5195 00001AFC B8A0000000          <3> mov eax, 160
  5196 00001B01 BB0C000000          <3> mov ebx, %1
  5197 00001B06 F7E3                <3> mul ebx
  5198 00001B08 01C7                <3> add edi, eax
  5199                              <3> 
  5200 00001B0A BE[17210000]        <3> mov esi, %4
  5201 00001B0F B40F                <3> mov ah, %3
  5202                              <3> %%next_char:
  5203 00001B11 268A06              <3> mov al, byte [es:esi]
  5204 00001B14 26668907            <3> mov word [es:edi], ax
  5205 00001B18 47<rept>            <3> times 2 inc edi
  5206 00001B1A 46                  <3> inc esi
  5207 00001B1B 26803E00            <3> cmp byte [es:esi], 0x00
  5208 00001B1F 75F0                <3> jne %%next_char
  5209                              <2> VIDEO_TEXTMODE_write_mensage 0x0D, 0x01, 0x0F, mensage_ds
  5210                              <3> 
  5211                              <3> 
  5212                              <3> 
  5213                              <3> 
  5214                              <3> 
  5215                              <3> 
  5216                              <3> 
  5217                              <3> 
  5218                              <3> 
  5219 00001B21 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5220                              <3> 
  5221 00001B26 B8A0000000          <3> mov eax, 160
  5222 00001B2B BB0D000000          <3> mov ebx, %1
  5223 00001B30 F7E3                <3> mul ebx
  5224 00001B32 01C7                <3> add edi, eax
  5225                              <3> 
  5226 00001B34 BE[22210000]        <3> mov esi, %4
  5227 00001B39 B40F                <3> mov ah, %3
  5228                              <3> %%next_char:
  5229 00001B3B 268A06              <3> mov al, byte [es:esi]
  5230 00001B3E 26668907            <3> mov word [es:edi], ax
  5231 00001B42 47<rept>            <3> times 2 inc edi
  5232 00001B44 46                  <3> inc esi
  5233 00001B45 26803E00            <3> cmp byte [es:esi], 0x00
  5234 00001B49 75F0                <3> jne %%next_char
  5235                              <2> VIDEO_TEXTMODE_write_mensage 0x0E, 0x01, 0x0F, mensage_ss
  5236                              <3> 
  5237                              <3> 
  5238                              <3> 
  5239                              <3> 
  5240                              <3> 
  5241                              <3> 
  5242                              <3> 
  5243                              <3> 
  5244                              <3> 
  5245 00001B4B BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5246                              <3> 
  5247 00001B50 B8A0000000          <3> mov eax, 160
  5248 00001B55 BB0E000000          <3> mov ebx, %1
  5249 00001B5A F7E3                <3> mul ebx
  5250 00001B5C 01C7                <3> add edi, eax
  5251                              <3> 
  5252 00001B5E BE[2D210000]        <3> mov esi, %4
  5253 00001B63 B40F                <3> mov ah, %3
  5254                              <3> %%next_char:
  5255 00001B65 268A06              <3> mov al, byte [es:esi]
  5256 00001B68 26668907            <3> mov word [es:edi], ax
  5257 00001B6C 47<rept>            <3> times 2 inc edi
  5258 00001B6E 46                  <3> inc esi
  5259 00001B6F 26803E00            <3> cmp byte [es:esi], 0x00
  5260 00001B73 75F0                <3> jne %%next_char
  5261                              <2> VIDEO_TEXTMODE_write_mensage 0x0F, 0x01, 0x0F, mensage_fs
  5262                              <3> 
  5263                              <3> 
  5264                              <3> 
  5265                              <3> 
  5266                              <3> 
  5267                              <3> 
  5268                              <3> 
  5269                              <3> 
  5270                              <3> 
  5271 00001B75 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5272                              <3> 
  5273 00001B7A B8A0000000          <3> mov eax, 160
  5274 00001B7F BB0F000000          <3> mov ebx, %1
  5275 00001B84 F7E3                <3> mul ebx
  5276 00001B86 01C7                <3> add edi, eax
  5277                              <3> 
  5278 00001B88 BE[38210000]        <3> mov esi, %4
  5279 00001B8D B40F                <3> mov ah, %3
  5280                              <3> %%next_char:
  5281 00001B8F 268A06              <3> mov al, byte [es:esi]
  5282 00001B92 26668907            <3> mov word [es:edi], ax
  5283 00001B96 47<rept>            <3> times 2 inc edi
  5284 00001B98 46                  <3> inc esi
  5285 00001B99 26803E00            <3> cmp byte [es:esi], 0x00
  5286 00001B9D 75F0                <3> jne %%next_char
  5287                              <2> VIDEO_TEXTMODE_write_mensage 0x10, 0x01, 0x0F, mensage_gs
  5288                              <3> 
  5289                              <3> 
  5290                              <3> 
  5291                              <3> 
  5292                              <3> 
  5293                              <3> 
  5294                              <3> 
  5295                              <3> 
  5296                              <3> 
  5297 00001B9F BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5298                              <3> 
  5299 00001BA4 B8A0000000          <3> mov eax, 160
  5300 00001BA9 BB10000000          <3> mov ebx, %1
  5301 00001BAE F7E3                <3> mul ebx
  5302 00001BB0 01C7                <3> add edi, eax
  5303                              <3> 
  5304 00001BB2 BE[43210000]        <3> mov esi, %4
  5305 00001BB7 B40F                <3> mov ah, %3
  5306                              <3> %%next_char:
  5307 00001BB9 268A06              <3> mov al, byte [es:esi]
  5308 00001BBC 26668907            <3> mov word [es:edi], ax
  5309 00001BC0 47<rept>            <3> times 2 inc edi
  5310 00001BC2 46                  <3> inc esi
  5311 00001BC3 26803E00            <3> cmp byte [es:esi], 0x00
  5312 00001BC7 75F0                <3> jne %%next_char
  5313                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  5314                              <2> 
  5315                              <2> 
  5316                              <2> 
  5317                              <2> 
  5318                              <2> 
  5319                              <2> 
  5320                              <2> 
  5321                              <2> 
  5322                              <2> 
  5323 00001BC9 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5324                              <2> 
  5325 00001BCE B8A0000000          <2> mov eax, 160
  5326 00001BD3 BB16000000          <2> mov ebx, %1
  5327 00001BD8 F7E3                <2> mul ebx
  5328 00001BDA 01C7                <2> add edi, eax
  5329                              <2> 
  5330 00001BDC BE[3D200000]        <2> mov esi, %4
  5331 00001BE1 B403                <2> mov ah, %3
  5332                              <2> %%next_char:
  5333 00001BE3 268A06              <2> mov al, byte [es:esi]
  5334 00001BE6 26668907            <2> mov word [es:edi], ax
  5335 00001BEA 47<rept>            <2> times 2 inc edi
  5336 00001BEC 46                  <2> inc esi
  5337 00001BED 26803E00            <2> cmp byte [es:esi], 0x00
  5338 00001BF1 75F0                <2> jne %%next_char
  5339                              <1> 
  5340                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  5341 00001BF3 B31C                <2> mov bl, %1
  5342                              <2> %%repeat_check:
  5343 00001BF5 E460                <2> in al, 0x60
  5344 00001BF7 38D8                <2> cmp al, bl
  5345 00001BF9 75FA                <2> jne %%repeat_check
  5346 00001BFB EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  5347                              <1> ; recover from error
  5348                              <1> PIC_eoi_cmd
  5349 00001C02 B020                <2> mov al, 0x20
  5350 00001C04 E6A0                <2> out PIC_SLAVE_PORT0,al
  5351 00001C06 E620                <2> out PIC_MASTER_PORT0,al
  5352                              <2> 
  5353                              <2> 
  5354 00001C08 61                  <1> popa
  5355 00001C09 FB                  <1> sti
  5356 00001C0A CF                  <1> iretd
  5357                              <1> 
  5358                              <1> exception_14:
  5359 00001C0B FA                  <1> cli
  5360 00001C0C 60                  <1> pusha
  5361 00001C0D 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  5362                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_14
  5363                              <2> 
  5364                              <2> 
  5365                              <2> 
  5366                              <2> 
  5367                              <2> 
  5368                              <2> 
  5369                              <2> 
  5370                              <2> 
  5371                              <2> 
  5372 00001C14 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5373                              <2> 
  5374 00001C19 B8A0000000          <2> mov eax, 160
  5375 00001C1E BB01000000          <2> mov ebx, %1
  5376 00001C23 F7E3                <2> mul ebx
  5377 00001C25 01C7                <2> add edi, eax
  5378                              <2> 
  5379 00001C27 BE[E81F0000]        <2> mov esi, %4
  5380 00001C2C B40F                <2> mov ah, %3
  5381                              <2> %%next_char:
  5382 00001C2E 268A06              <2> mov al, byte [es:esi]
  5383 00001C31 26668907            <2> mov word [es:edi], ax
  5384 00001C35 47<rept>            <2> times 2 inc edi
  5385 00001C37 46                  <2> inc esi
  5386 00001C38 26803E00            <2> cmp byte [es:esi], 0x00
  5387 00001C3C 75F0                <2> jne %%next_char
  5388                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  5389                              <2> 
  5390                              <2> 
  5391                              <2> 
  5392                              <2> 
  5393                              <2> 
  5394                              <2> 
  5395                              <2> 
  5396                              <2> 
  5397                              <2> 
  5398 00001C3E BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5399                              <2> 
  5400 00001C43 B8A0000000          <2> mov eax, 160
  5401 00001C48 BB16000000          <2> mov ebx, %1
  5402 00001C4D F7E3                <2> mul ebx
  5403 00001C4F 01C7                <2> add edi, eax
  5404                              <2> 
  5405 00001C51 BE[3D200000]        <2> mov esi, %4
  5406 00001C56 B403                <2> mov ah, %3
  5407                              <2> %%next_char:
  5408 00001C58 268A06              <2> mov al, byte [es:esi]
  5409 00001C5B 26668907            <2> mov word [es:edi], ax
  5410 00001C5F 47<rept>            <2> times 2 inc edi
  5411 00001C61 46                  <2> inc esi
  5412 00001C62 26803E00            <2> cmp byte [es:esi], 0x00
  5413 00001C66 75F0                <2> jne %%next_char
  5414                              <1> 
  5415                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  5416 00001C68 B31C                <2> mov bl, %1
  5417                              <2> %%repeat_check:
  5418 00001C6A E460                <2> in al, 0x60
  5419 00001C6C 38D8                <2> cmp al, bl
  5420 00001C6E 75FA                <2> jne %%repeat_check
  5421 00001C70 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  5422                              <1> ; recover from error
  5423                              <1> PIC_eoi_cmd
  5424 00001C77 B020                <2> mov al, 0x20
  5425 00001C79 E6A0                <2> out PIC_SLAVE_PORT0,al
  5426 00001C7B E620                <2> out PIC_MASTER_PORT0,al
  5427                              <2> 
  5428                              <2> 
  5429 00001C7D 61                  <1> popa
  5430 00001C7E FB                  <1> sti
  5431 00001C7F CF                  <1> iretd
  5432                              <1> 
  5433                              <1> exception_15:
  5434 00001C80 FA                  <1> cli
  5435 00001C81 60                  <1> pusha
  5436 00001C82 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  5437                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_15
  5438                              <2> 
  5439                              <2> 
  5440                              <2> 
  5441                              <2> 
  5442                              <2> 
  5443                              <2> 
  5444                              <2> 
  5445                              <2> 
  5446                              <2> 
  5447 00001C89 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5448                              <2> 
  5449 00001C8E B8A0000000          <2> mov eax, 160
  5450 00001C93 BB01000000          <2> mov ebx, %1
  5451 00001C98 F7E3                <2> mul ebx
  5452 00001C9A 01C7                <2> add edi, eax
  5453                              <2> 
  5454 00001C9C BE[02200000]        <2> mov esi, %4
  5455 00001CA1 B40F                <2> mov ah, %3
  5456                              <2> %%next_char:
  5457 00001CA3 268A06              <2> mov al, byte [es:esi]
  5458 00001CA6 26668907            <2> mov word [es:edi], ax
  5459 00001CAA 47<rept>            <2> times 2 inc edi
  5460 00001CAC 46                  <2> inc esi
  5461 00001CAD 26803E00            <2> cmp byte [es:esi], 0x00
  5462 00001CB1 75F0                <2> jne %%next_char
  5463                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  5464                              <2> 
  5465                              <2> 
  5466                              <2> 
  5467                              <2> 
  5468                              <2> 
  5469                              <2> 
  5470                              <2> 
  5471                              <2> 
  5472                              <2> 
  5473 00001CB3 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5474                              <2> 
  5475 00001CB8 B8A0000000          <2> mov eax, 160
  5476 00001CBD BB16000000          <2> mov ebx, %1
  5477 00001CC2 F7E3                <2> mul ebx
  5478 00001CC4 01C7                <2> add edi, eax
  5479                              <2> 
  5480 00001CC6 BE[3D200000]        <2> mov esi, %4
  5481 00001CCB B403                <2> mov ah, %3
  5482                              <2> %%next_char:
  5483 00001CCD 268A06              <2> mov al, byte [es:esi]
  5484 00001CD0 26668907            <2> mov word [es:edi], ax
  5485 00001CD4 47<rept>            <2> times 2 inc edi
  5486 00001CD6 46                  <2> inc esi
  5487 00001CD7 26803E00            <2> cmp byte [es:esi], 0x00
  5488 00001CDB 75F0                <2> jne %%next_char
  5489                              <1> 
  5490                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  5491 00001CDD B31C                <2> mov bl, %1
  5492                              <2> %%repeat_check:
  5493 00001CDF E460                <2> in al, 0x60
  5494 00001CE1 38D8                <2> cmp al, bl
  5495 00001CE3 75FA                <2> jne %%repeat_check
  5496 00001CE5 EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  5497                              <1> ; recover from error
  5498                              <1> PIC_eoi_cmd
  5499 00001CEC B020                <2> mov al, 0x20
  5500 00001CEE E6A0                <2> out PIC_SLAVE_PORT0,al
  5501 00001CF0 E620                <2> out PIC_MASTER_PORT0,al
  5502                              <2> 
  5503                              <2> 
  5504 00001CF2 61                  <1> popa
  5505 00001CF3 FB                  <1> sti
  5506 00001CF4 CF                  <1> iretd
  5507                              <1> 
  5508                              <1> exception_16:
  5509 00001CF5 FA                  <1> cli
  5510 00001CF6 60                  <1> pusha
  5511 00001CF7 9A[E8060000]0800    <1> call dword 0x0008:VIDEO_TEXTMODE_clear_screen
  5512                              <1> VIDEO_TEXTMODE_write_mensage            0x01, 0x01, 0x0F, exception_msg_16
  5513                              <2> 
  5514                              <2> 
  5515                              <2> 
  5516                              <2> 
  5517                              <2> 
  5518                              <2> 
  5519                              <2> 
  5520                              <2> 
  5521                              <2> 
  5522 00001CFE BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5523                              <2> 
  5524 00001D03 B8A0000000          <2> mov eax, 160
  5525 00001D08 BB01000000          <2> mov ebx, %1
  5526 00001D0D F7E3                <2> mul ebx
  5527 00001D0F 01C7                <2> add edi, eax
  5528                              <2> 
  5529 00001D11 BE[1C200000]        <2> mov esi, %4
  5530 00001D16 B40F                <2> mov ah, %3
  5531                              <2> %%next_char:
  5532 00001D18 268A06              <2> mov al, byte [es:esi]
  5533 00001D1B 26668907            <2> mov word [es:edi], ax
  5534 00001D1F 47<rept>            <2> times 2 inc edi
  5535 00001D21 46                  <2> inc esi
  5536 00001D22 26803E00            <2> cmp byte [es:esi], 0x00
  5537 00001D26 75F0                <2> jne %%next_char
  5538                              <1> VIDEO_TEXTMODE_write_mensage            0x16, 0x01, 0x03, exception_reboot_msg 
  5539                              <2> 
  5540                              <2> 
  5541                              <2> 
  5542                              <2> 
  5543                              <2> 
  5544                              <2> 
  5545                              <2> 
  5546                              <2> 
  5547                              <2> 
  5548 00001D28 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  5549                              <2> 
  5550 00001D2D B8A0000000          <2> mov eax, 160
  5551 00001D32 BB16000000          <2> mov ebx, %1
  5552 00001D37 F7E3                <2> mul ebx
  5553 00001D39 01C7                <2> add edi, eax
  5554                              <2> 
  5555 00001D3B BE[3D200000]        <2> mov esi, %4
  5556 00001D40 B403                <2> mov ah, %3
  5557                              <2> %%next_char:
  5558 00001D42 268A06              <2> mov al, byte [es:esi]
  5559 00001D45 26668907            <2> mov word [es:edi], ax
  5560 00001D49 47<rept>            <2> times 2 inc edi
  5561 00001D4B 46                  <2> inc esi
  5562 00001D4C 26803E00            <2> cmp byte [es:esi], 0x00
  5563 00001D50 75F0                <2> jne %%next_char
  5564                              <1> 
  5565                              <1> KEYBOARD_direct_check_key	KEYBOARD_ENTER_KEY
  5566 00001D52 B31C                <2> mov bl, %1
  5567                              <2> %%repeat_check:
  5568 00001D54 E460                <2> in al, 0x60
  5569 00001D56 38D8                <2> cmp al, bl
  5570 00001D58 75FA                <2> jne %%repeat_check
  5571 00001D5A EA[AA0C0000]0800    <1> jmp dword 0x0008:KEYBOARD_system_reset
  5572                              <1> ; recover from error
  5573                              <1> PIC_eoi_cmd
  5574 00001D61 B020                <2> mov al, 0x20
  5575 00001D63 E6A0                <2> out PIC_SLAVE_PORT0,al
  5576 00001D65 E620                <2> out PIC_MASTER_PORT0,al
  5577                              <2> 
  5578                              <2> 
  5579 00001D67 61                  <1> popa
  5580 00001D68 FB                  <1> sti
  5581 00001D69 CF                  <1> iretd
  5582                              <1> 
  5583                              <1> timer_int:
  5584 00001D6A FA                  <1> cli
  5585 00001D6B 60                  <1> pusha
  5586 00001D6C 8105[E0060000]0000- <1> add dword [TIMER_PIT_TICKS], 65536 
  5587 00001D74 0100                <1>
  5588                              <1> PIC_eoi_cmd
  5589 00001D76 B020                <2> mov al, 0x20
  5590 00001D78 E6A0                <2> out PIC_SLAVE_PORT0,al
  5591 00001D7A E620                <2> out PIC_MASTER_PORT0,al
  5592                              <2> 
  5593                              <2> 
  5594 00001D7C 61                  <1> popa
  5595                              <1> ; GET FROM STACK 
  5596                              <1> ; EIP on the 4-byte				; updated
  5597                              <1> ; CS on the 4-byte, the top 2 are discarded 	; the same
  5598                              <1> ; EFLAGS on the 4-byte			    	; the same
  5599 00001D7D FB                  <1> sti
  5600 00001D7E CF                  <1> iretd
  5601                              <1> 
  5602                              <1> keyboard_int:
  5603 00001D7F FA                  <1> cli
  5604 00001D80 60                  <1> pusha
  5605                              <1> KEYBOARD_write	KEYBOARD_COMMAND_PORT, 0xAD
  5606                              <2> %%get_status_write:
  5607 00001D81 E464                <2> in al, KEYBOARD_COMMAND_PORT
  5608 00001D83 B402                <2> mov ah, 0x02
  5609 00001D85 20C4                <2> and ah, al
  5610 00001D87 80FC02              <2> cmp ah, 0x02
  5611 00001D8A 74F5                <2> je %%get_status_write
  5612 00001D8C 6631D2              <2> xor dx, dx
  5613 00001D8F B264                <2> mov dl, %1
  5614 00001D91 B0AD                <2> mov al, %2
  5615 00001D93 EE                  <2> out dx, al
  5616 00001D94 E460                <1> in al, KEYBOARD_DATA_PORT	; Keyboard Scan Code
  5617 00001D96 A2[AE0C0000]        <1> mov [KEYBOARD_KEY], al
  5618                              <1> KEYBOARD_write	KEYBOARD_COMMAND_PORT, 0xAE
  5619                              <2> %%get_status_write:
  5620 00001D9B E464                <2> in al, KEYBOARD_COMMAND_PORT
  5621 00001D9D B402                <2> mov ah, 0x02
  5622 00001D9F 20C4                <2> and ah, al
  5623 00001DA1 80FC02              <2> cmp ah, 0x02
  5624 00001DA4 74F5                <2> je %%get_status_write
  5625 00001DA6 6631D2              <2> xor dx, dx
  5626 00001DA9 B264                <2> mov dl, %1
  5627 00001DAB B0AE                <2> mov al, %2
  5628 00001DAD EE                  <2> out dx, al
  5629                              <1> PIC_eoi_cmd
  5630 00001DAE B020                <2> mov al, 0x20
  5631 00001DB0 E6A0                <2> out PIC_SLAVE_PORT0,al
  5632 00001DB2 E620                <2> out PIC_MASTER_PORT0,al
  5633                              <2> 
  5634                              <2> 
  5635 00001DB4 61                  <1> popa
  5636 00001DB5 FB                  <1> sti
  5637 00001DB6 CF                  <1> iretd
  5638                              <1> 
  5639                              <1> floppy_int:
  5640 00001DB7 FA                  <1> cli
  5641 00001DB8 60                  <1> pusha
  5642                              <1> ; End of Floppy Operation
  5643 00001DB9 C605[64060000]01    <1> mov byte [FLOPPY_INTERRUPT], 1
  5644                              <1> PIC_eoi_cmd
  5645 00001DC0 B020                <2> mov al, 0x20
  5646 00001DC2 E6A0                <2> out PIC_SLAVE_PORT0,al
  5647 00001DC4 E620                <2> out PIC_MASTER_PORT0,al
  5648                              <2> 
  5649                              <2> 
  5650 00001DC6 61                  <1> popa
  5651 00001DC7 FB                  <1> sti
  5652 00001DC8 CF                  <1> iretd
  5653                              <1> 
  5654                              <1> rtc_int:
  5655 00001DC9 FA                  <1> cli
  5656 00001DCA 60                  <1> pusha
  5657 00001DCB FF05[E4060000]      <1> inc dword [TIMER_RTC_TICKS]
  5658 00001DD1 813D[E4060000]FFFF- <1> cmp dword [TIMER_RTC_TICKS],0xFFFFFFFF
  5659 00001DD9 FFFF                <1>
  5660 00001DDB 750A                <1> jne skip_reset
  5661 00001DDD C705[E4060000]0000- <1> mov dword [TIMER_RTC_TICKS], 0
  5662 00001DE5 0000                <1>
  5663                              <1> skip_reset:
  5664                              <1> ;;; CHECK for RTC Interrupt (periodic int,alarm time reached,time changed)
  5665                              <1> RTC_read_register       0x0C, RTC_VALUE
  5666 00001DE7 66BA7000            <2> mov dx, 0x70
  5667 00001DEB B00C                <2> mov al, %1
  5668 00001DED EE                  <2> out dx, al
  5669 00001DEE EB00                <2> jmp short $+2
  5670 00001DF0 66BA7100            <2> mov dx, 0x71
  5671 00001DF4 EC                  <2> in al, dx
  5672 00001DF5 A2[DD060000]        <2> mov byte [%2], al
  5673                              <1> PIC_eoi_cmd
  5674 00001DFA B020                <2> mov al, 0x20
  5675 00001DFC E6A0                <2> out PIC_SLAVE_PORT0,al
  5676 00001DFE E620                <2> out PIC_MASTER_PORT0,al
  5677                              <2> 
  5678                              <2> 
  5679 00001E00 61                  <1> popa
  5680 00001E01 FB                  <1> sti
  5681 00001E02 CF                  <1> iretd
  5682                              <1> 
  5683                              <1> ;========================================================================;
  5684 00001E03 457863657074696F6E- <1> exception_msg_0		DB 'Exception 0 : Divide error',0
  5685 00001E0C 2030203A2044697669- <1>
  5686 00001E15 6465206572726F7200  <1>
  5687 00001E1E 457863657074696F6E- <1> exception_msg_1		DB 'Exception 1 : Debug exceptions',0
  5688 00001E27 2031203A2044656275- <1>
  5689 00001E30 672065786365707469- <1>
  5690 00001E39 6F6E7300            <1>
  5691 00001E3D 457863657074696F6E- <1> exception_msg_2		DB 'Exception 2 : Nonmaskable interrupt',0
  5692 00001E46 2032203A204E6F6E6D- <1>
  5693 00001E4F 61736B61626C652069- <1>
  5694 00001E58 6E7465727275707400  <1>
  5695 00001E61 457863657074696F6E- <1> exception_msg_3		DB 'Exception 3 : Breakpoint (one-byte INT 3 instruction)',0
  5696 00001E6A 2033203A2042726561- <1>
  5697 00001E73 6B706F696E7420286F- <1>
  5698 00001E7C 6E652D627974652049- <1>
  5699 00001E85 4E54203320696E7374- <1>
  5700 00001E8E 72756374696F6E2900  <1>
  5701 00001E97 457863657074696F6E- <1> exception_msg_4		DB 'Exception 4 : Overflow (INTO instruction)',0
  5702 00001EA0 2034203A204F766572- <1>
  5703 00001EA9 666C6F772028494E54- <1>
  5704 00001EB2 4F20696E7374727563- <1>
  5705 00001EBB 74696F6E2900        <1>
  5706 00001EC1 457863657074696F6E- <1> exception_msg_5		DB 'Exception 5 : Bounds check (BOUND instruction)',0
  5707 00001ECA 2035203A20426F756E- <1>
  5708 00001ED3 647320636865636B20- <1>
  5709 00001EDC 28424F554E4420696E- <1>
  5710 00001EE5 737472756374696F6E- <1>
  5711 00001EEE 2900                <1>
  5712 00001EF0 457863657074696F6E- <1> exception_msg_6		DB 'Exception 6 : Invalid opcode',0
  5713 00001EF9 2036203A20496E7661- <1>
  5714 00001F02 6C6964206F70636F64- <1>
  5715 00001F0B 6500                <1>
  5716 00001F0D 457863657074696F6E- <1> exception_msg_7		DB 'Exception 7 : Coprocessor not available',0
  5717 00001F16 2037203A20436F7072- <1>
  5718 00001F1F 6F636573736F72206E- <1>
  5719 00001F28 6F7420617661696C61- <1>
  5720 00001F31 626C6500            <1>
  5721 00001F35 457863657074696F6E- <1> exception_msg_8		DB 'Exception 8 : Double fault',0
  5722 00001F3E 2038203A20446F7562- <1>
  5723 00001F47 6C65206661756C7400  <1>
  5724 00001F50 457863657074696F6E- <1> exception_msg_9		DB 'Exception 9 : (reserved)',0
  5725 00001F59 2039203A2028726573- <1>
  5726 00001F62 65727665642900      <1>
  5727 00001F69 457863657074696F6E- <1> exception_msg_10	DB 'Exception 10 : Invalid TSS',0
  5728 00001F72 203130203A20496E76- <1>
  5729 00001F7B 616C69642054535300  <1>
  5730 00001F84 457863657074696F6E- <1> exception_msg_11	DB 'Exception 11 : Segment not present',0
  5731 00001F8D 203131203A20536567- <1>
  5732 00001F96 6D656E74206E6F7420- <1>
  5733 00001F9F 70726573656E7400    <1>
  5734 00001FA7 457863657074696F6E- <1> exception_msg_12	DB 'Exception 12 : Stack exception',0
  5735 00001FB0 203132203A20537461- <1>
  5736 00001FB9 636B20657863657074- <1>
  5737 00001FC2 696F6E00            <1>
  5738 00001FC6 457863657074696F6E- <1> exception_msg_13	DB 'Exception 13 : General protection',0
  5739 00001FCF 203133203A2047656E- <1>
  5740 00001FD8 6572616C2070726F74- <1>
  5741 00001FE1 656374696F6E00      <1>
  5742 00001FE8 457863657074696F6E- <1> exception_msg_14	DB 'Exception 14 : Page fault',0
  5743 00001FF1 203134203A20506167- <1>
  5744 00001FFA 65206661756C7400    <1>
  5745 00002002 457863657074696F6E- <1> exception_msg_15	DB 'Exception 15 : (reserved)',0
  5746 0000200B 203135203A20287265- <1>
  5747 00002014 7365727665642900    <1>
  5748 0000201C 457863657074696F6E- <1> exception_msg_16	DB 'Exception 16 : Coprocessor error',0
  5749 00002025 203136203A20436F70- <1>
  5750 0000202E 726F636573736F7220- <1>
  5751 00002037 6572726F7200        <1>
  5752 0000203D 5052455353205B454E- <1> exception_reboot_msg	DB 'PRESS [ENTER] FOR REBOOT...',0
  5753 00002046 5445525D20464F5220- <1>
  5754 0000204F 5245424F4F542E2E2E- <1>
  5755 00002058 00                  <1>
  5756 00002059 00000000            <1> REGISTER_EAX		DD 0
  5757 0000205D 00000000            <1> REGISTER_EBX		DD 0
  5758 00002061 00000000            <1> REGISTER_ECX		DD 0
  5759 00002065 00000000            <1> REGISTER_EDX		DD 0
  5760 00002069 00000000            <1> REGISTER_EDI		DD 0
  5761 0000206D 00000000            <1> REGISTER_ESI		DD 0
  5762 00002071 00000000            <1> REGISTER_ESP		DD 0
  5763 00002075 00000000            <1> REGISTER_EBP		DD 0
  5764 00002079 00000000            <1> REGISTER_EIP		DD 0
  5765                              <1> ;REGISTER_EFLAGS		DD 0
  5766 0000207D 0000                <1> REGISTER_ES		DW 0
  5767 0000207F 0000                <1> REGISTER_DS		DW 0
  5768 00002081 0000                <1> REGISTER_SS		DW 0
  5769 00002083 0000                <1> REGISTER_FS		DW 0				
  5770 00002085 0000                <1> REGISTER_GS		DW 0
  5771 00002087 454158203D20202020- <1> mensage_eax		DB 'EAX =         h',0
  5772 00002090 20202020206800      <1>
  5773 00002097 454258203D20202020- <1> mensage_ebx		DB 'EBX =         h',0
  5774 000020A0 20202020206800      <1>
  5775 000020A7 454358203D20202020- <1> mensage_ecx		DB 'ECX =         h',0
  5776 000020B0 20202020206800      <1>
  5777 000020B7 454458203D20202020- <1> mensage_edx		DB 'EDX =         h',0
  5778 000020C0 20202020206800      <1>
  5779 000020C7 454449203D20202020- <1> mensage_edi		DB 'EDI =         h',0
  5780 000020D0 20202020206800      <1>
  5781 000020D7 455349203D20202020- <1> mensage_esi		DB 'ESI =         h',0
  5782 000020E0 20202020206800      <1>
  5783 000020E7 455350203D20202020- <1> mensage_esp		DB 'ESP =         h',0
  5784 000020F0 20202020206800      <1>
  5785 000020F7 454250203D20202020- <1> mensage_ebp		DB 'EBP =         h',0
  5786 00002100 20202020206800      <1>
  5787 00002107 454950203D20202020- <1> mensage_eip		DB 'EIP =         h',0
  5788 00002110 20202020206800      <1>
  5789                              <1> ;mensage_eflags		DB 'EFLAGS =         h',0
  5790 00002117 4553203D2020202020- <1> mensage_es		DB 'ES =     h',0
  5791 00002120 6800                <1>
  5792 00002122 4453203D2020202020- <1> mensage_ds		DB 'DS =     h',0
  5793 0000212B 6800                <1>
  5794 0000212D 5353203D2020202020- <1> mensage_ss		DB 'SS =     h',0
  5795 00002136 6800                <1>
  5796 00002138 4653203D2020202020- <1> mensage_fs		DB 'FS =     h',0
  5797 00002141 6800                <1>
  5798 00002143 4753203D2020202020- <1> mensage_gs		DB 'GS =     h',0
  5799 0000214C 6800                <1>
  5800                              <1> 
  5801                                  
  5802                                  %include "memory.inc"
  5803                              <1> 
  5804                              <1> %macro MEMORY_get_ram		1
  5805                              <1> mov ebx, 0x00100000 ; address 1 048 576
  5806                              <1> %%next_byte:
  5807                              <1> mov al, 0xFF
  5808                              <1> mov byte [es:ebx], 0x00
  5809                              <1> mov al, byte [es:ebx]
  5810                              <1> inc ebx
  5811                              <1> cmp al, 0x00
  5812                              <1> je %%next_byte
  5813                              <1> dec ebx
  5814                              <1> xor edx, edx
  5815                              <1> mov eax, ebx
  5816                              <1> mov ebx, 0x00100000
  5817                              <1> div ebx
  5818                              <1> mov %1, eax
  5819                              <1> %endmacro
  5820                              <1> 
  5821                              <1> ; cada programa pede ao kernel a memoria(bytes) q precisa que seja alocada
  5822                              <1> ; e o kernel devolve-lhe um ponteiro para esse bloco de memoria
  5823                              <1> 
  5824                                  %include "bios.inc"
  5825                              <1> 
  5826                              <1> ; BIOS Cold Reboot
  5827                              <1> BIOS_cold_boot:
  5828 0000214E BF72040000          <1> mov edi, 16 * BIOS_DATA_SEGMENT + BIOS_POST_RESET_FLAG_OFFSET
  5829 00002153 2666C7870000000000- <1> mov word [es:edi], BIOS_COLD_REBOOT_FLAG
  5830 0000215C 00                  <1>
  5831 0000215D EAF0FF0F000800      <1> jmp dword 0x0008: 16 * 0xFFFF + 0x0000
  5832                              <1> 
  5833                              <1> ; BIOS Warm Reboot
  5834                              <1> BIOS_warm_boot:
  5835 00002164 BF72040000          <1> mov edi, 16 * BIOS_DATA_SEGMENT + BIOS_POST_RESET_FLAG_OFFSET
  5836 00002169 2666C7870000000034- <1> mov word [es:edi], BIOS_WARM_REBOOT_FLAG
  5837 00002172 12                  <1>
  5838 00002173 EAF0FF0F000800      <1> jmp dword 0x0008: 16 * 0xFFFF + 0x0000
  5839                              <1> 
  5840                              <1> ; get BIOS Timer Ticks since midnight [0040:006C]
  5841                              <1> ; updated every 55 mseconds(execute INT 0x08 - timer)
  5842                              <1> ; PM Address(REAL) = 16 * RM Segment + RM Offset
  5843                              <1> %macro BIOS_read_clock_ticks		1 
  5844                              <1> mov esi, 16 * BIOS_DATA_SEGMENT + BIOS_CLOCK_TICKS_OFFSET
  5845                              <1> mov eax, dword [es:esi]
  5846                              <1> mov %1, eax
  5847                              <1> %endmacro
  5848                              <1> 
  5849                              <1> %macro BIOS_write_clock_ticks		1
  5850                              <1> mov edi, 16 * BIOS_DATA_SEGMENT + BIOS_CLOCK_TICKS_OFFSET
  5851                              <1> mov eax, %1
  5852                              <1> mov dword [es:edi], eax
  5853                              <1> %endmacro
  5854                              <1> 
  5855                              <1> %macro BIOS_inc_clock_ticks	0
  5856                              <1> mov edi, 16 * BIOS_DATA_SEGMENT + BIOS_CLOCK_TICKS_OFFSET
  5857                              <1> inc dword [es:edi]
  5858                              <1> %endmacro
  5859                              <1> 
  5860                              <1> %macro BIOS_dec_clock_ticks		0
  5861                              <1> mov edi, 16 * BIOS_DATA_SEGMENT + BIOS_CLOCK_TICKS_OFFSET
  5862                              <1> dec dword [es:edi]
  5863                              <1> %endmacro
  5864                              <1> 
  5865                              <1> ;check PNP_BIOS Structure String (0x000F0000-0x000FFFFF)
  5866                              <1> %macro BIOS_pnp_signature	1
  5867                              <1> mov edi, 0x000F0000
  5868                              <1> mov esi, 0x000FFFFF
  5869                              <1> %%check_pnp:
  5870                              <1> mov eax, dword [es:edi]
  5871                              <1> inc edi
  5872                              <1> cmp eax, [BIOS_PNP_STRING]
  5873                              <1> je %%end_check
  5874                              <1> cmp edi, [esi-3]
  5875                              <1> jne %%check_pnp
  5876                              <1> mov edi, 1
  5877                              <1> %%end_check:
  5878                              <1> dec edi
  5879                              <1> mov %1, eax 
  5880                              <1> %endmacro
  5881                              <1> 
  5882                              <1> ;=========================================================================;
  5883                              <1> ; BIOS                                                                    ;
  5884                              <1> ;=========================================================================;
  5885 0000217A 24506E50            <1> BIOS_PNP_STRING         	DD '$PnP'
  5886                              <1> BIOS_DATA_SEGMENT		equ 0x0040
  5887                              <1> BIOS_CLOCK_TICKS_OFFSET		equ 0x006C
  5888                              <1> BIOS_POST_RESET_FLAG_OFFSET	equ 0x0072
  5889                              <1> BIOS_COLD_REBOOT_FLAG		equ 0x0000
  5890                              <1> BIOS_WARM_REBOOT_FLAG		equ 0x1234
  5891                              <1> 
  5892                              <1> ;
  5893                              <1> ;Offset    Length    Value    Description
  5894                              <1> ;0h        4 BYTES    $PnP    Signature    Generic
  5895                              <1> ;               (ASCII)
  5896                              <1> ;04h    BYTE    Varies    Structure Revision    01h
  5897                              <1> ;05h    BYTE    Varies     Length (in 16 byte increments)    Generic
  5898                              <1> ;06h    WORD    Varies    Offset of next Header (0000h if none)    Generic
  5899                              <1> ;08h    BYTE    00h       Reserved    Generic
  5900                              <1> ;09h    BYTE    Varies    Checksum    Generic
  5901                              <1> ;0Ah    DWORD    Varies    Device Identifier    PnP Specific
  5902                              <1> ;0Eh    WORD    Varies    Pointer to Manufacturer String (Optional)    PnP Specific
  5903                              <1> ;10h    WORD    Varies    Pointer to Product Name String (Optional)    PnP Specific
  5904                              <1> ;12h    3 BYTE    Varies    Device Type Code    PnP Specific
  5905                              <1> ;15h    BYTE    Varies    Device Indicators    PnP Specific
  5906                              <1> ;16h    WORD    Varies    Boot Connection Vector - Real/Protected mode    PnP Specific
  5907                              <1> ;                         (0000h if none)
  5908                              <1> ;18h    WORD    Varies    Disconnect Vector - Real/Protected mode (0000h if    PnP Specific
  5909                              <1> ;                         none)
  5910                              <1> ;1Ah    WORD    Varies    Bootstrap Entry Point - Real/Protected mode  (0000h    PnP Specific
  5911                              <1> ;                         if none)
  5912                              <1> ;1Ch    WORD    0000h    Reserved    PnP Specific
  5913                              <1> ;1Eh    WORD    Varies    Static Resource Information Vector- Real/Protected    PnP Specific
  5914                              <1> ;                         mode (0000h if none)
  5915                              <1> 
  5916                              <1> 
  5917                                  %include "vesa.inc"
  5918                              <1> 
  5919                              <1> ; Check VESA PM Info Block signature
  5920                              <1> %macro VESA_signature		1
  5921                              <1> mov edi, 0
  5922                              <1> mov esi, 32000
  5923                              <1> %%check_vesa:
  5924                              <1> mov eax, dword [es:edi]
  5925                              <1> inc edi
  5926                              <1> cmp eax, dword [VESA_STRING]
  5927                              <1> je %%end_check_vesa
  5928                              <1> cmp edi, [esi-3]
  5929                              <1> jne %%check_vesa
  5930                              <1> mov edi, 1
  5931                              <1> %%end_check_vesa:
  5932                              <1> dec edi
  5933                              <1> mov %1, edi
  5934                              <1> ;;; TODO: checksum => (sum of all bytes / checksum) = 0 ?
  5935                              <1> %endmacro
  5936                              <1> 
  5937                              <1> ;============================================================================
  5938 0000217E 504D4944            <1> VESA_STRING		DD 'PMID'
  5939                              <1> VESA_PM_INFOBLOCK:
  5940 00002182 504D4944            <1> 			DD 'PMID'	; PM Info Block Signature
  5941 00002186 0000                <1> 			DW 0		; Offset of PM entry point within BIOS
  5942 00002188 0000                <1> 			DW 0		; Offset of PM initialization entry point
  5943 0000218A 0000                <1> 			DW 0		; Selector to BIOS data area emulation block
  5944 0000218C 00A0                <1> 			DW 0xA000	; Selector to access 0xA0000 physical mem
  5945 0000218E 00B0                <1> 			DW 0xB000	; Selector to access 0xB0000 physical mem
  5946 00002190 00B8                <1> 			DW 0xB800	; Selector to access 0xB8000 physical mem
  5947 00002192 00C0                <1> 			DW 0xC000	; Selector to access code segment as data
  5948 00002194 00                  <1> 			DB 0		; Set to 1 when in protected mode
  5949 00002195 00                  <1> 			DB 0		; Checksum byte for structure
  5950                              <1> ;==============================================================================
  5951                              <1> 
  5952                              <1> ; VESA (VBE SPECIFICATION) FUNCTIONS
  5953                              <1> ;
  5954                              <1> ; 'PMID' vesa signature
  5955                              <1> ; scan the first 32KB of BIOS image
  5956                              <1> ; make a FAR CALL to the ENTRY POINT
  5957                              <1> 
  5958                                  %include "pci.inc"
  5959                              <1> 
  5960                              <1> 
  5961                              <1> %macro PCI_get_type	1
  5962                              <1> mov ebx, 2
  5963                              <1> mov ax, 0x0000
  5964                              <1> mov dx, PCI_ADDRESS_PORT
  5965                              <1> out dx, ax
  5966                              <1> in ax, dx 
  5967                              <1> cmp ax, 0x0000
  5968                              <1> jne %%type_1 
  5969                              <1> add dx, 2
  5970                              <1> out dx, ax
  5971                              <1> in ax, dx
  5972                              <1> sub dx, 2
  5973                              <1> cmp ax, 0x0000
  5974                              <1> je %%exit_type
  5975                              <1> %%type_1:
  5976                              <1> mov ebx, 1
  5977                              <1> mov eax, 0x80000000
  5978                              <1> out dx, eax
  5979                              <1> in eax, dx
  5980                              <1> cmp eax, 0x80000000
  5981                              <1> je %%exit_type
  5982                              <1> mov ebx, 0
  5983                              <1> %%exit_type:
  5984                              <1> mov %1, ebx
  5985                              <1> %endmacro
  5986                              <1> 
  5987                              <1> %macro PCI_get_device_info 	3
  5988                              <1> mov ebx, %1
  5989                              <1> cmp ebx, 1
  5990                              <1> jne %%type_2
  5991                              <1> xor ebx,ebx
  5992                              <1> mov bx, %2
  5993                              <1> shl ebx, 11
  5994                              <1> or ebx, 0x80000000
  5995                              <1> mov cx, 64
  5996                              <1> mov edi, %3
  5997                              <1> %%next_info1:
  5998                              <1> mov eax, ebx
  5999                              <1> mov dx, PCI_ADDRESS_PORT
  6000                              <1> out dx, eax
  6001                              <1> mov dx, PCI_DATA_PORT
  6002                              <1> in eax, dx
  6003                              <1> mov dword [es:edi], eax
  6004                              <1> add edi, 4
  6005                              <1> add ebx, 4
  6006                              <1> dec cx
  6007                              <1> jnz %%next_info1
  6008                              <1> jmp short %%exit_info
  6009                              <1> %%type_2: 
  6010                              <1> mov ebx, %1
  6011                              <1> cmp ebx, 2
  6012                              <1> jne %%exit_info
  6013                              <1> mov dx, PCI_ADDRESS_PORT
  6014                              <1> mov al, 0x80
  6015                              <1> out dx, al
  6016                              <1> xor al, al
  6017                              <1> add dx, 2
  6018                              <1> out dx, al
  6019                              <1> sub dx, 2
  6020                              <1> mov dx, %2
  6021                              <1> shl dx, 8
  6022                              <1> or dx, 0xC000
  6023                              <1> mov cx, 64
  6024                              <1> mov edi, %3
  6025                              <1> %%next_info2:
  6026                              <1> in eax, dx
  6027                              <1> mov dword [es:edi], eax
  6028                              <1> add edi, 4
  6029                              <1> add dx, 4
  6030                              <1> dec cx
  6031                              <1> jnz %%next_info2
  6032                              <1> mov dx, PCI_ADDRESS_PORT
  6033                              <1> xor al, al
  6034                              <1> out dx, al
  6035                              <1> %%exit_info:
  6036                              <1> %endmacro
  6037                              <1> 
  6038                              <1> %macro PCI_detect_device	4	
  6039                              <1> mov ebx, %1
  6040                              <1> mov esi, PCI_DEVICES
  6041                              <1> %%next_device:
  6042                              <1> mov eax, dword [es:esi]
  6043                              <1> add esi, 35 
  6044                              <1> cmp eax, ebx
  6045                              <1> je %%exit_devices
  6046                              <1> cmp esi, END_PCI_DEVICES
  6047                              <1> jne %%next_device
  6048                              <1> %%exit_devices:
  6049                              <1> sub esi, 31
  6050                              <1> mov %3, esi
  6051                              <1> mov bl, %2 
  6052                              <1> mov esi, PCI_CLASSES
  6053                              <1> %%next_class:
  6054                              <1> mov al, byte [es:esi]
  6055                              <1> add esi, 22
  6056                              <1> cmp al, bl
  6057                              <1> je %%exit_classes
  6058                              <1> cmp esi, END_PCI_CLASSES
  6059                              <1> jne %%next_class
  6060                              <1> %%exit_classes:
  6061                              <1> sub esi, 21
  6062                              <1> mov %4, esi
  6063                              <1> %endmacro
  6064                              <1> 
  6065                              <1> ;=============================================================================;
  6066                              <1> PCI_ADDRESS_PORT	equ     0xCF8
  6067                              <1> PCI_DATA_PORT		equ     0xCFC
  6068 00002196 00000000            <1> pci_type		DD	0
  6069 0000219A 00000000            <1> pci_device_string	DD	0x00000000 ; COOL Pointer!!! :)
  6070 0000219E 00000000            <1> pci_class_string	DD	0x00000000 ; COOL Pointer!!! :)
  6071                              <1> ;------------------------------------------------------------------------------
  6072                              <1> ;				PCI DEVICE STRUCTURE 
  6073                              <1> ;------------------------------------------------------------------------------
  6074 000021A2 0000                <1> pci_device		DW	0x0000		; 00h Vendor ID
  6075 000021A4 0000                <1> 			DW	0x0000		; 02h Device ID
  6076 000021A6 0000                <1> 			DW	0x0000		; 04h Bus Command
  6077 000021A8 0000                <1> 			DW	0x0000		; 06h Bus Status
  6078 000021AA 00                  <1> 			DB	0x00		; 08h Revision Code
  6079 000021AB 00                  <1> 			DB	0x00		; 09h Prog Interface
  6080 000021AC 0000                <1> 			DW	0x0000		; 0Ah Class Code
  6081 000021AE 00                  <1> 			DB	0x00		; 0Ch Cache Line Size
  6082 000021AF 00                  <1> 			DB	0x00		; 0Dh Latency Timer
  6083 000021B0 00                  <1> 			DB	0x00		; 0Eh Header Type
  6084 000021B1 00                  <1> 			DB	0x00		; 0Fh ist
  6085 000021B2 00000000            <1> 			DD	0x00000000	; 10h Base Address 0
  6086 000021B6 00000000            <1> 			DD	0x00000000	; 14h Base Address 1
  6087 000021BA 00000000            <1> 			DD	0x00000000	; 18h Base Address 2
  6088 000021BE 00000000            <1> 			DD	0x00000000	; 1Ch Base Address 3
  6089 000021C2 00000000            <1> 			DD	0x00000000	; 20h Base Address 4
  6090 000021C6 00000000            <1> 			DD	0x00000000	; 24h Base Address 5
  6091 000021CA 00000000            <1> 			DD	0x00000000	; 28h Reserved1
  6092 000021CE 00000000            <1> 			DD	0x00000000	; 2Ch Reserved2
  6093 000021D2 00000000            <1> 			DD	0x00000000	; 30h ROM Base Address
  6094 000021D6 00000000            <1> 			DD	0x00000000	; 34h Reserved3
  6095 000021DA 00000000            <1> 			DD	0x00000000	; 38h Reserved4
  6096 000021DE 00                  <1> 			DB	0x00		; 3Ch Interrupt Line 
  6097 000021DF 00                  <1> 			DB	0x00		; 3Dh Interrupt Pin
  6098 000021E0 00                  <1> 			DB 	0x00		; 3Eh Min Grant
  6099 000021E1 00                  <1> 			DB	0x00		; 3Fh Max Latency
  6100 000021E2 00<rept>            <1> times 	192		DB 	0x00		; 40h Reserved5 (for PCI Unit)
  6101                              <1> PCI_CLASSES		
  6102                              <1> ;------------------------------------------------------------------------------
  6103                              <1> ;				PCI CLASS 
  6104                              <1> ;------------------------------------------------------------------------------
  6105 000022A2 00556E6B6E6F776E20- <1> 			DB	0x00,'Unknown Class       ',0
  6106 000022AB 436C61737320202020- <1>
  6107 000022B4 20202000            <1>
  6108 000022B8 014D6173732053746F- <1> 			DB	0x01,'Mass Storage Device ',0
  6109 000022C1 726167652044657669- <1>
  6110 000022CA 63652000            <1>
  6111 000022CE 024E6574776F726B20- <1> 			DB	0x02,'Network Device      ',0
  6112 000022D7 446576696365202020- <1>
  6113 000022E0 20202000            <1>
  6114 000022E4 03566964656F204465- <1> 			DB	0x03,'Video Device        ',0
  6115 000022ED 766963652020202020- <1>
  6116 000022F6 20202000            <1>
  6117 000022FA 044D756C74696D6564- <1> 			DB	0x04,'Multimedia Device   ',0
  6118 00002303 696120446576696365- <1>
  6119 0000230C 20202000            <1>
  6120 00002310 054D656D6F72792044- <1> 			DB	0x05,'Memory Device       ',0
  6121 00002319 657669636520202020- <1>
  6122 00002322 20202000            <1>
  6123 00002326 064272696467652044- <1> 			DB	0x06,'Bridge Device       ',0
  6124 0000232F 657669636520202020- <1>
  6125 00002338 20202000            <1>
  6126 0000233C FF4E6F20436C617373- <1> 			DB	0xFF,'No Class for Device ',0
  6127 00002345 20666F722044657669- <1>
  6128 0000234E 63652000            <1>
  6129                              <1> END_PCI_CLASSES:
  6130                              <1> PCI_DEVICES            
  6131                              <1> ;------------------------------------------------------------------------------
  6132                              <1> ;				VIDEO CARDS
  6133                              <1> ;------------------------------------------------------------------------------
  6134 00002352 33538100            <1>     			DW 0x5333,0x0081
  6135 00002356 533320496E632C2039- <1> 			DB 'S3 Inc, 911                   ',0
  6136 0000235F 313120202020202020- <1>
  6137 00002368 202020202020202020- <1>
  6138 00002371 20202000            <1>
  6139 00002375 33538200            <1> 			DW 0x5333,0x0082
  6140 00002379 533320496E632C2039- <1> 			DB 'S3 Inc, 911A/924              ',0
  6141 00002382 3131412F3932342020- <1>
  6142 0000238B 202020202020202020- <1>
  6143 00002394 20202000            <1>
  6144 00002398 33539000            <1> 			DW 0x5333,0x0090
  6145 0000239C 533320496E632C2039- <1> 			DB 'S3 Inc, 928                   ',0
  6146 000023A5 323820202020202020- <1>
  6147 000023AE 202020202020202020- <1>
  6148 000023B7 20202000            <1>
  6149 000023BB 33539100            <1> 			DW 0x5333,0x0091
  6150 000023BF 533320496E632C2039- <1> 			DB 'S3 Inc, 928                   ',0
  6151 000023C8 323820202020202020- <1>
  6152 000023D1 202020202020202020- <1>
  6153 000023DA 20202000            <1>
  6154 000023DE 33539200            <1> 			DW 0x5333,0x0092
  6155 000023E2 533320496E632C2039- <1> 			DB 'S3 Inc, 928                   ',0
  6156 000023EB 323820202020202020- <1>
  6157 000023F4 202020202020202020- <1>
  6158 000023FD 20202000            <1>
  6159 00002401 33539300            <1> 			DW 0x5333,0x0093
  6160 00002405 533320496E632C2039- <1> 			DB 'S3 Inc, 928                   ',0
  6161 0000240E 323820202020202020- <1>
  6162 00002417 202020202020202020- <1>
  6163 00002420 20202000            <1>
  6164 00002424 33539400            <1> 			DW 0x5333,0x0094
  6165 00002428 533320496E632C2039- <1> 			DB 'S3 Inc, 928                   ',0
  6166 00002431 323820202020202020- <1>
  6167 0000243A 202020202020202020- <1>
  6168 00002443 20202000            <1>
  6169 00002447 33539500            <1> 			DW 0x5333,0x0095
  6170 0000244B 533320496E632C2039- <1> 			DB 'S3 Inc, 928                   ',0
  6171 00002454 323820202020202020- <1>
  6172 0000245D 202020202020202020- <1>
  6173 00002466 20202000            <1>
  6174 0000246A 3353A000            <1> 			DW 0x5333,0x00A0
  6175 0000246E 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6176 00002477 30312F383035202020- <1>
  6177 00002480 202020202020202020- <1>
  6178 00002489 20202000            <1>
  6179 0000248D 3353A100            <1> 			DW 0x5333,0x00A1
  6180 00002491 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6181 0000249A 30312F383035202020- <1>
  6182 000024A3 202020202020202020- <1>
  6183 000024AC 20202000            <1>
  6184 000024B0 3353A200            <1> 			DW 0x5333,0x00A2
  6185 000024B4 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6186 000024BD 30312F383035202020- <1>
  6187 000024C6 202020202020202020- <1>
  6188 000024CF 20202000            <1>
  6189 000024D3 3353A300            <1> 			DW 0x5333,0x00A3
  6190 000024D7 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6191 000024E0 30312F383035202020- <1>
  6192 000024E9 202020202020202020- <1>
  6193 000024F2 20202000            <1>
  6194 000024F6 3353A400            <1> 			DW 0x5333,0x00A4
  6195 000024FA 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6196 00002503 30312F383035202020- <1>
  6197 0000250C 202020202020202020- <1>
  6198 00002515 20202000            <1>
  6199 00002519 3353A500            <1> 			DW 0x5333,0x00A5
  6200 0000251D 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6201 00002526 30312F383035202020- <1>
  6202 0000252F 202020202020202020- <1>
  6203 00002538 20202000            <1>
  6204 0000253C 3353A600            <1> 			DW 0x5333,0x00A6
  6205 00002540 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6206 00002549 30312F383035202020- <1>
  6207 00002552 202020202020202020- <1>
  6208 0000255B 20202000            <1>
  6209 0000255F 3353A700            <1> 			DW 0x5333,0x00A7
  6210 00002563 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6211 0000256C 30312F383035202020- <1>
  6212 00002575 202020202020202020- <1>
  6213 0000257E 20202000            <1>
  6214 00002582 3353A800            <1> 			DW 0x5333,0x00A8
  6215 00002586 533320496E632C2038- <1> 			DB 'S3 Inc, 801/805               ',0
  6216 0000258F 30312F383035202020- <1>
  6217 00002598 202020202020202020- <1>
  6218 000025A1 20202000            <1>
  6219 000025A5 3353B000            <1> 			DW 0x5333,0x00B0
  6220 000025A9 533320496E632C2039- <1> 			DB 'S3 Inc, 928PCI                ',0
  6221 000025B2 323850434920202020- <1>
  6222 000025BB 202020202020202020- <1>
  6223 000025C4 20202000            <1>
  6224 000025C8 3353C000            <1> 			DW 0x5333,0x00C0
  6225 000025CC 533320496E632C2056- <1> 			DB 'S3 Inc, Vision 864            ',0
  6226 000025D5 6973696F6E20383634- <1>
  6227 000025DE 202020202020202020- <1>
  6228 000025E7 20202000            <1>
  6229 000025EB 3353C100            <1> 			DW 0x5333,0x00C1
  6230 000025EF 533320496E632C2056- <1> 			DB 'S3 Inc, Vision 864            ',0
  6231 000025F8 6973696F6E20383634- <1>
  6232 00002601 202020202020202020- <1>
  6233 0000260A 20202000            <1>
  6234 0000260E 3353D000            <1> 			DW 0x5333,0x00D0
  6235 00002612 533320496E632C2056- <1> 			DB 'S3 Inc, Vision 964            ',0
  6236 0000261B 6973696F6E20393634- <1>
  6237 00002624 202020202020202020- <1>
  6238 0000262D 20202000            <1>
  6239 00002631 3353D100            <1> 			DW 0x5333,0x00D1
  6240 00002635 533320496E63205669- <1> 			DB 'S3 Inc Vision 964             ',0
  6241 0000263E 73696F6E2039363420- <1>
  6242 00002647 202020202020202020- <1>
  6243 00002650 20202000            <1>
  6244 00002654 33535105            <1> 			DW 0x5333,0x0551
  6245 00002658 533320496E632C2050- <1> 			DB 'S3 Inc, PLATO/PX              ',0
  6246 00002661 4C41544F2F50582020- <1>
  6247 0000266A 202020202020202020- <1>
  6248 00002673 20202000            <1>
  6249 00002677 33533156            <1> 			DW 0x5333,0x5631
  6250 0000267B 533320496E632C2038- <1> 			DB 'S3 Inc, 86c325 (ViRGE)        ',0
  6251 00002684 366333323520285669- <1>
  6252 0000268D 524745292020202020- <1>
  6253 00002696 20202000            <1>
  6254 0000269A 33530088            <1> 			DW 0x5333,0x8800
  6255 0000269E 533320496E632C2056- <1> 			DB 'S3 Inc, Vision 866            ',0
  6256 000026A7 6973696F6E20383636- <1>
  6257 000026B0 202020202020202020- <1>
  6258 000026B9 20202000            <1>
  6259 000026BD 33530288            <1> 			DW 0x5333,0x8802
  6260 000026C1 533320496E632C2056- <1> 			DB 'S3 Inc, Vision 968            ',0
  6261 000026CA 6973696F6E20393638- <1>
  6262 000026D3 202020202020202020- <1>
  6263 000026DC 20202000            <1>
  6264 000026E0 33531088            <1> 			DW 0x5333,0x8810
  6265 000026E4 533320496E632C2038- <1> 			DB 'S3 Inc, 86C732 (Trio32) Rev 00',0
  6266 000026ED 364337333220285472- <1>
  6267 000026F6 696F33322920526576- <1>
  6268 000026FF 20303000            <1>
  6269 00002703 33531188            <1> 			DW 0x5333,0x8811
  6270 00002707 533320496E632C2038- <1> 			DB 'S3 Inc, 86c764 (Trio64)       ',0
  6271 00002710 366337363420285472- <1>
  6272 00002719 696F36342920202020- <1>
  6273 00002722 20202000            <1>
  6274 00002726 33531288            <1> 			DW 0x5333,0x8812
  6275 0000272A 533320496E632C2038- <1> 			DB 'S3 Inc, 86cm65 (Aurora64V+)   ',0
  6276 00002733 36636D363520284175- <1>
  6277 0000273C 726F72613634562B29- <1>
  6278 00002745 20202000            <1>
  6279 00002749 33531488            <1> 			DW 0x5333,0x8814
  6280 0000274D 533320496E632C2038- <1> 			DB 'S3 Inc, 86c767 (Trio64UV+)    ',0
  6281 00002756 366337363720285472- <1>
  6282 0000275F 696F363455562B2920- <1>
  6283 00002768 20202000            <1>
  6284 0000276C 33531588            <1> 			DW 0x5333,0x8815
  6285 00002770 533320496E632C2038- <1> 			DB 'S3 Inc, 86cm65 (Aurora128)    ',0
  6286 00002779 36636D363520284175- <1>
  6287 00002782 726F72613132382920- <1>
  6288 0000278B 20202000            <1>
  6289 0000278F 33533D88            <1> 			DW 0x5333,0x883D
  6290 00002793 533320496E632C2038- <1> 			DB 'S3 Inc, 86c988 (Virge/VX)     ',0
  6291 0000279C 366339383820285669- <1>
  6292 000027A5 7267652F5658292020- <1>
  6293 000027AE 20202000            <1>
  6294 000027B2 33538088            <1> 			DW 0x5333,0x8880
  6295 000027B6 533320496E632C2038- <1> 			DB 'S3 Inc, 86c866 (Vision)       ',0
  6296 000027BF 366338363620285669- <1>
  6297 000027C8 73696F6E2920202020- <1>
  6298 000027D1 20202000            <1>
  6299 000027D5 33539088            <1> 			DW 0x5333,0x8890
  6300 000027D9 533320496E632C2038- <1> 			DB 'S3 Inc, 86c868 (Vision)       ',0
  6301 000027E2 366338363820285669- <1>
  6302 000027EB 73696F6E2920202020- <1>
  6303 000027F4 20202000            <1>
  6304 000027F8 3353B088            <1> 			DW 0x5333,0x88B0
  6305 000027FC 533320496E632C2038- <1> 			DB 'S3 Inc, 86c928P (Vision)      ',0
  6306 00002805 366339323850202856- <1>
  6307 0000280E 6973696F6E29202020- <1>
  6308 00002817 20202000            <1>
  6309 0000281B 3353C088            <1> 			DW 0x5333,0x88C0
  6310 0000281F 533320496E632C2038- <1> 			DB 'S3 Inc, 86c864 (Vision)       ',0
  6311 00002828 366338363420285669- <1>
  6312 00002831 73696F6E2920202020- <1>
  6313 0000283A 20202000            <1>
  6314 0000283E 3353C188            <1> 			DW 0x5333,0x88C1
  6315 00002842 533320496E632C2038- <1> 			DB 'S3 Inc, 86c864P (Vision)      ',0
  6316 0000284B 366338363450202856- <1>
  6317 00002854 6973696F6E29202020- <1>
  6318 0000285D 20202000            <1>
  6319 00002861 3353D088            <1> 			DW 0x5333,0x88D0
  6320 00002865 533320496E632C2038- <1> 			DB 'S3 Inc, 86c964 (Vision)       ',0
  6321 0000286E 366339363420285669- <1>
  6322 00002877 73696F6E2920202020- <1>
  6323 00002880 20202000            <1>
  6324 00002884 3353D188            <1> 			DW 0x5333,0x88D1
  6325 00002888 533320496E632C2038- <1> 			DB 'S3 Inc, 86c964P (Vision)      ',0
  6326 00002891 366339363450202856- <1>
  6327 0000289A 6973696F6E29202020- <1>
  6328 000028A3 20202000            <1>
  6329 000028A7 3353F088            <1> 			DW 0x5333,0x88F0
  6330 000028AB 533320496E632C2038- <1> 			DB 'S3 Inc, 86c968 (Vision)       ',0
  6331 000028B4 366339363820285669- <1>
  6332 000028BD 73696F6E2920202020- <1>
  6333 000028C6 20202000            <1>
  6334 000028CA 33530089            <1> 			DW 0x5333,0x8900
  6335 000028CE 533320496E632C2038- <1> 			DB 'S3 Inc, 86C775 (Trio64V2/DX)  ',0
  6336 000028D7 364337373520285472- <1>
  6337 000028E0 696F363456322F4458- <1>
  6338 000028E9 29202000            <1>
  6339 000028ED 33530189            <1> 			DW 0x5333,0x8901
  6340 000028F1 533320496E632C2054- <1> 			DB 'S3 Inc, Trio64V2 DX/GX        ',0
  6341 000028FA 72696F363456322044- <1>
  6342 00002903 582F47582020202020- <1>
  6343 0000290C 20202000            <1>
  6344 00002910 33530289            <1> 			DW 0x5333,0x8902
  6345 00002914 533320496E632C2050- <1> 			DB 'S3 Inc, Plato PX              ',0
  6346 0000291D 6C61746F2050582020- <1>
  6347 00002926 202020202020202020- <1>
  6348 0000292F 20202000            <1>
  6349 00002933 33530489            <1> 			DW 0x5333,0x8904
  6350 00002937 533320496E632C2054- <1> 			DB 'S3 Inc, Trio 3D               ',0
  6351 00002940 72696F203344202020- <1>
  6352 00002949 202020202020202020- <1>
  6353 00002952 20202000            <1>
  6354 00002956 3353018A            <1> 			DW 0x5333,0x8A01
  6355 0000295A 533320496E632C2056- <1> 			DB 'S3 Inc, Virge DX/GX           ',0
  6356 00002963 697267652044582F47- <1>
  6357 0000296C 582020202020202020- <1>
  6358 00002975 20202000            <1>
  6359 00002979 3353108A            <1> 			DW 0x5333,0x8A10
  6360 0000297D 533320496E632C2056- <1> 			DB 'S3 Inc, ViRGE/GX2             ',0
  6361 00002986 695247452F47583220- <1>
  6362 0000298F 202020202020202020- <1>
  6363 00002998 20202000            <1>
  6364 0000299C 3353138A            <1> 			DW 0x5333,0x8A13
  6365 000029A0 533320496E632C2054- <1> 			DB 'S3 Inc, Trio3D/2x/2x+         ',0
  6366 000029A9 72696F33442F32782F- <1>
  6367 000029B2 32782B202020202020- <1>
  6368 000029BB 20202000            <1>
  6369 000029BF 3353208A            <1> 			DW 0x5333,0x8A20
  6370 000029C3 533320496E632C2038- <1> 			DB 'S3 Inc, 86c391 (Savage3D)     ',0
  6371 000029CC 366333393120285361- <1>
  6372 000029D5 766167653344292020- <1>
  6373 000029DE 20202000            <1>
  6374 000029E2 3353218A            <1> 			DW 0x5333,0x8A21
  6375 000029E6 533320496E632C2038- <1> 			DB 'S3 Inc, 86c390 (Savage3D/MV)  ',0
  6376 000029EF 366333393020285361- <1>
  6377 000029F8 7661676533442F4D56- <1>
  6378 00002A01 29202000            <1>
  6379 00002A05 3353228A            <1> 			DW 0x5333,0x8A22
  6380 00002A09 533320496E632C2038- <1> 			DB 'S3 Inc, 86C394-397 (Savage4)  ',0
  6381 00002A12 36433339342D333937- <1>
  6382 00002A1B 202853617661676534- <1>
  6383 00002A24 29202000            <1>
  6384 00002A28 3353008C            <1> 			DW 0x5333,0x8C00
  6385 00002A2C 533320496E632C2038- <1> 			DB 'S3 Inc, 86C260 M3 (ViRGE/MX)  ',0
  6386 00002A35 3643323630204D3320- <1>
  6387 00002A3E 2856695247452F4D58- <1>
  6388 00002A47 29202000            <1>
  6389 00002A4B 3353018C            <1> 			DW 0x5333,0x8C01
  6390 00002A4F 533320496E632C2056- <1> 			DB 'S3 Inc, ViRGE/MX              ',0
  6391 00002A58 695247452F4D582020- <1>
  6392 00002A61 202020202020202020- <1>
  6393 00002A6A 20202000            <1>
  6394 00002A6E 3353028C            <1> 			DW 0x5333,0x8C02
  6395 00002A72 533320496E632C2038- <1> 			DB 'S3 Inc, 86C240 (ViRGE/MXC)    ',0
  6396 00002A7B 364332343020285669- <1>
  6397 00002A84 5247452F4D58432920- <1>
  6398 00002A8D 20202000            <1>
  6399 00002A91 3353038C            <1> 			DW 0x5333,0x8C03
  6400 00002A95 533320496E632C2056- <1> 			DB 'S3 Inc, ViRGE/MX+             ',0
  6401 00002A9E 695247452F4D582B20- <1>
  6402 00002AA7 202020202020202020- <1>
  6403 00002AB0 20202000            <1>
  6404 00002AB4 3353108C            <1> 			DW 0x5333,0x8C10
  6405 00002AB8 533320496E632C5361- <1> 			DB 'S3 Inc,SavageMX/IX/MX+MV/IX+MV',0
  6406 00002AC1 766167654D582F4958- <1>
  6407 00002ACA 2F4D582B4D562F4958- <1>
  6408 00002AD3 2B4D5600            <1>
  6409 00002AD7 3353128C            <1> 			DW 0x5333,0x8C12
  6410 00002ADB 533320496E632C5361- <1> 			DB 'S3 Inc,SavageMX/IX/MX+MV/IX+MV',0
  6411 00002AE4 766167654D582F4958- <1>
  6412 00002AED 2F4D582B4D562F4958- <1>
  6413 00002AF6 2B4D5600            <1>
  6414 00002AFA 33530291            <1> 			DW 0x5333,0x9102
  6415 00002AFE 533320496E632C2038- <1> 			DB 'S3 Inc, 86c410 (Savage2000)   ',0
  6416 00002B07 366334313020285361- <1>
  6417 00002B10 766167653230303029- <1>
  6418 00002B19 20202000            <1>
  6419 00002B1D 335300CA            <1> 			DW 0x5333,0xCA00
  6420 00002B21 533320496E632C2038- <1> 			DB 'S3 Inc, 86c617 (SonicVibes)   ',0
  6421 00002B2A 36633631372028536F- <1>
  6422 00002B33 6E6963566962657329- <1>
  6423 00002B3C 20202000            <1>
  6424 00002B40 DE102D00            <1> 			DW 0x10DE,0x002D
  6425 00002B44 4E5669646961205249- <1> 			DB 'NVidia RIVA TNT2 Model 64     ',0
  6426 00002B4D 564120544E5432204D- <1>
  6427 00002B56 6F64656C2036342020- <1>
  6428 00002B5F 20202000            <1>
  6429 00002B63 1A120100            <1> 			DW 0x121A,0x0001
  6430 00002B67 3344667820496E632C- <1> 			DB '3Dfx Inc, Voodoo Chipset      ',0
  6431 00002B70 20566F6F646F6F2043- <1>
  6432 00002B79 686970736574202020- <1>
  6433 00002B82 20202000            <1>
  6434 00002B86 1A120200            <1> 			DW 0x121A,0x0002
  6435 00002B8A 3344667820496E632C- <1> 			DB '3Dfx Inc, Voodoo2 Chipset     ',0
  6436 00002B93 20566F6F646F6F3220- <1>
  6437 00002B9C 436869707365742020- <1>
  6438 00002BA5 20202000            <1>
  6439                              <1> 			
  6440                              <1> ; 10DEh - - NVidia Corporation
  6441                              <1> ; 002Dh RIVA TNT2 Model 64
  6442                              <1> ; 121Ah - - 3Dfx Interactive, Inc
  6443                              <1> ; 0001h 3Dfx Voodoo Chipset
  6444                              <1> ; 0002h 3Dfx Voodoo2 Chipset
  6445                              <1> ;------------------------------------------------------------------------------
  6446                              <1> ;				BRIDGE
  6447                              <1> ;------------------------------------------------------------------------------
  6448 00002BA9 FFFFFFFF            <1> 			DW 0xFFFF,0xFFFF
  6449 00002BAD 556E6B6E6F776E2044- <1> 			DB 'Unknown Device                ',0			
  6450 00002BB6 657669636520202020- <1>
  6451 00002BBF 202020202020202020- <1>
  6452 00002BC8 20202000            <1>
  6453                              <1> END_PCI_DEVICES:
  6454                              <1> 
  6455                              <1> ;
  6456                              <1> ; in the future this device ID information will be in a file
  6457                              <1> ;
  6458                              <1> 
  6459                                  %include "isapnp.inc"
  6460                              <1> ;==============================================================================
  6461                              <1> ; FUNCTION     WRITE ADDRESS                 WRITE DATA
  6462                              <1> ;==============================================================================
  6463                              <1> ; 0x00         Set Read Port                 Port Address(PORT>>2)
  6464                              <1> ; 0x01         SERIAL ISOLATION
  6465                              <1> ; 0x02         CONFIG CONTROL                1 RESET
  6466                              <1> ;                                            2 WAIT_FOR_KEY(normal state after power on)
  6467                              <1> ;                                            4 RESET_CSN(all)
  6468                              <1> ;                                            7 RESET_DRV(combination of above)
  6469                              <1> ; 0x03         WAKEUP                        > logical card number(0 = reset all cards)
  6470                              <1> ; 0x04         RESOURCE DATA                 < read (Read Port Address)
  6471                              <1> ; 0x05         STATUS                        < read (Read Port Address)
  6472                              <1> ; 0x06         SET CARD NUMBER               > logical card number
  6473                              <1> ; 0x07         SET DEVICE NUMBER             > logical device number
  6474                              <1> ; 0x30         ACTIVE ADDRESS                0x01 on reads
  6475                              <1> ; 0x31         IO RANGECHECK
  6476                              <1> ; 0x60         PORT
  6477                              <1> ; 0x70         IRQ
  6478                              <1> ; 0x74         DMA
  6479                              <1> ;=============================================================================
  6480                              <1> ; READ ADDRESS = 0x200<->0x3FF
  6481                              <1> ; 0203 020b 0213 021b 0223 022b 0233 023b 0243 024b 0253 025b 0263 026b 0273
  6482                              <1> ; 027b 0283 028b 0293 029b 02a3 02ab 02b3 02bb 02c3 02cb 02d3 02db 02e3 02eb
  6483                              <1> ; 02f3 02fb 0303 030b 0313 031b 0323 032b 0333 033b 0343 034b 0353 035b 0363
  6484                              <1> ; 036b 0373 037b 0383 038b 0393 039b 03a3 03ab 03b3 03bb 03c3 03cb 03d3 03db
  6485                              <1> ; 03e3 03eb 03f3 03fb
  6486                              <1> ;
  6487                              <1> ; CSN = CARD SELECT NUMBER
  6488                              <1> ; SERIAL NUMBER(72-bit) = 4-Byte Encoded ID + 4-Byte Serial Number + 1-Byte Checksum
  6489                              <1> ; Encoded ID = 2-Byte Encoded Model Name + 2-Byte Product Number
  6490                              <1> ; =>Encoded Model Name  - Bit 15 is not used
  6491                              <1> ; 01234 56789 01234
  6492                              <1> ; xxxxx:xxxxx:xxxxx
  6493                              <1> ; 1:1:1 = AAA
  6494                              <1> ; 26:26:26 = ZZZ
  6495                              <1> ; =>Product Number
  6496                              <1> ; 0x1234 = Product 0x123 Rev 0x4
  6497                              <1> ; Bit 1 = the card sends 0x55 and 0xAA on the READ ADDRESS
  6498                              <1> ; Bit 0 = the card sends nothing, but listens instead
  6499                              <1> ; ### CARD ###
  6500                              <1> ; 9 BYTE SERIAL NUMBER
  6501                              <1> ; pnp version
  6502                              <1> ; card name
  6503                              <1> ; vendor id
  6504                              <1> ;   device id 0
  6505                              <1> ;     device name
  6506                              <1> ;     resource config 0
  6507                              <1> ;     resource config n
  6508                              <1> ;     resource end
  6509                              <1> ;   device id n
  6510                              <1> ;     device name
  6511                              <1> ;     resource configs 0 to n
  6512                              <1> ;     resource end
  6513                              <1> ; end
  6514                              <1> ; Each Record has <TAG><OPTIONAL LENGTH><DATA>
  6515                              <1> ; SHORT FORMAT: 0TTTTLLL data
  6516                              <1> ; TTTT: 4-bit field, 16 possible types
  6517                              <1> ; -----------------------------------------------
  6518                              <1> ; 0x1 = Plug and Play version number
  6519                              <1> ; 0x2 = Logical Device ID
  6520                              <1> ; 0x3 = Compatible Device ID
  6521                              <1> ; 0x4 = IRQ Format
  6522                              <1> ; 0x5 = DMA Format
  6523                              <1> ; 0x6 = Start Dependent Function
  6524                              <1> ; 0x7 = End Dependent Function
  6525                              <1> ; 0x8 = I/O Port Descriptor
  6526                              <1> ; 0x9 = Fixed Location I/O Port Descriptor
  6527                              <1> ; 0xA-0xD = RESERVED
  6528                              <1> ; 0xE = Vendor Defined
  6529                              <1> ; 0xF = End Tag
  6530                              <1> ; -----------------------------------------------
  6531                              <1> ; LLL: 3-bit field, length of data
  6532                              <1> ;  LONG FORMAT: 1TTTTTTT LL data
  6533                              <1> ; TTTTTTT: 7-bit field, 128 possible types
  6534                              <1> ; -----------------------------------------------
  6535                              <1> ; 0x1 = Memory Range Descriptor
  6536                              <1> ; 0x2 = Identifier String(ANSI)
  6537                              <1> ; 0x3 = Identifier String(Unicode)
  6538                              <1> ; 0x4 = Vendor Defined
  6539                              <1> ; 0x5 = 32-Bit Memory Range Descriptor
  6540                              <1> ; 0x6 = 32-Bit Fixed Location Memory Range Descriptor
  6541                              <1> ; 0x7-0x7F = RESERVED
  6542                              <1> ; -----------------------------------------------
  6543                              <1> ; LL: 2-byte length of data
  6544                              <1> ;============================================================================;
  6545                              <1> 
  6546                              <1> ;%include "idt.inc"
  6547                              <1> 
  6548                              <1> %macro ISAPNP_write_address	1
  6549                              <1> mov al, %1
  6550                              <1> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6551                              <1> out dx, al 
  6552                              <1> jmp short $+2		; Delay at least 10useconds
  6553                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6554                              <1> %endmacro
  6555                              <1> 
  6556                              <1> %macro ISAPNP_write_data	1
  6557                              <1> mov al, %1
  6558                              <1> mov dx, ISAPNP_WRITE_DATA_PORT
  6559                              <1> out dx, al
  6560                              <1> %endmacro
  6561                              <1> 
  6562                              <1> %macro ISAPNP_read_data		1
  6563                              <1> mov dx, [ISAPNP_DEVICE_PORT]
  6564                              <1> in al, dx
  6565                              <1> mov %1, al
  6566                              <1> %endmacro
  6567                              <1> 
  6568                              <1> %macro ISAPNP_write_byte	2
  6569                              <1> ISAPNP_write_address	%1
  6570                              <1> ISAPNP_write_data	%2
  6571                              <1> %endmacro
  6572                              <1> 
  6573                              <1> %macro ISAPNP_reset		0
  6574                              <1> ISAPNP_write_byte	0x02,0x01
  6575                              <1> %endmacro
  6576                              <1> 
  6577                              <1> %macro ISAPNP_reset_csn		0
  6578                              <1> ISAPNP_write_byte	0x02,0x04
  6579                              <1> %endmacro
  6580                              <1> 
  6581                              <1> %macro ISAPNP_reset_drv		0
  6582                              <1> ISAPNP_write_byte	0x02,0x07
  6583                              <1> ;jmp short $+2		; Delay at least 2mseconds
  6584                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 2 
  6585                              <1> TIMER_rtc_msdelay	2
  6586                              <1> %endmacro
  6587                              <1> 
  6588                              <1> %macro ISAPNP_wait_state	0
  6589                              <1> ISAPNP_write_byte	0x02,0x02
  6590                              <1> ;jmp short $+2		; Delay at least 1msecond
  6591                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6592                              <1> TIMER_rtc_msdelay	1
  6593                              <1> %endmacro
  6594                              <1> 
  6595                              <1> %macro ISAPNP_wakeup_csn	1
  6596                              <1> ISAPNP_write_byte	0x03, %1
  6597                              <1> %endmacro
  6598                              <1> 
  6599                              <1> %macro ISAPNP_set_card		1
  6600                              <1> ISAPNP_write_byte	0x06, %1
  6601                              <1> %endmacro
  6602                              <1> 
  6603                              <1> %macro ISAPNP_set_device	1
  6604                              <1> ISAPNP_write_byte	0x07, %1
  6605                              <1> %endmacro
  6606                              <1> 
  6607                              <1> %macro ISAPNP_device_activate		1
  6608                              <1> ISAPNP_set_device	%1
  6609                              <1> ISAPNP_write_byte	0x02,0x01
  6610                              <1> jmp short $+2		; Delay at least 250useconds
  6611                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6612                              <1> %endmacro
  6613                              <1> 
  6614                              <1> %macro ISAPNP_device_deactivate	1
  6615                              <1> ISAPNP_set_device	%1
  6616                              <1> ISAPNP_write_byte	0x02,0x00
  6617                              <1> jmp short $+2		; Delay at least 250useconds
  6618                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6619                              <1> %endmacro
  6620                              <1> 
  6621                              <1> %macro ISAPNP_serial_isolation	0
  6622                              <1> ISAPNP_write_address	0x01
  6623                              <1> %endmacro
  6624                              <1> 
  6625                              <1> %macro ISAPNP_set_device_port	0
  6626                              <1> mov bx, [ISAPNP_DEVICE_PORT]
  6627                              <1> shr bx, 2
  6628                              <1> ISAPNP_write_byte	0x00, bl
  6629                              <1> ;jmp short $+2		; Delay at least 1000useconds
  6630                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1 
  6631                              <1> TIMER_rtc_msdelay	1
  6632                              <1> %endmacro
  6633                              <1> 
  6634                              <1> %macro ISAPNP_get_resource_data	1
  6635                              <1> ISAPNP_write_address	0x04
  6636                              <1> ISAPNP_read_data	%1
  6637                              <1> %endmacro
  6638                              <1> 
  6639                              <1> %macro ISAPNP_get_status	1
  6640                              <1> ISAPNP_write_address	0x05
  6641                              <1> ISAPNP_read_data	%1
  6642                              <1> %endmacro
  6643                              <1> 
  6644                              <1> %macro ISAPNP_activate_address	0
  6645                              <1> ISAPNP_write_address	0x30
  6646                              <1> %endmacro
  6647                              <1> 
  6648                              <1> %macro ISAPNP_check_range	0
  6649                              <1> ISAPNP_write_address	0x31
  6650                              <1> %endmacro
  6651                              <1> 
  6652                              <1> ISAPNP_initkey:
  6653                              <1> ; Delay at least 1msecond 
  6654                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6655                              <1> TIMER_rtc_msdelay	1
  6656 00002BCC A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6657 00002BD1 31DB                <2> xor ebx, ebx
  6658 00002BD3 BB01000000          <2> mov ebx, %1
  6659 00002BD8 01D8                <2> add eax, ebx
  6660 00002BDA 93                  <2> xchg eax, ebx
  6661                              <2> 
  6662                              <2> 
  6663                              <2> 
  6664                              <2> %%check_rtc:
  6665 00002BDB A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6666 00002BE0 39D8                <2> cmp eax, ebx
  6667 00002BE2 7CF7                <2> jl %%check_rtc
  6668                              <2> 
  6669                              <1> ISAPNP_write_address	0
  6670 00002BE4 B000                <2> mov al, %1
  6671 00002BE6 66BA7902            <2> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6672 00002BEA EE                  <2> out dx, al
  6673 00002BEB EB00                <2> jmp short $+2
  6674                              <2> 
  6675                              <1> ISAPNP_write_address	0
  6676 00002BED B000                <2> mov al, %1
  6677 00002BEF 66BA7902            <2> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6678 00002BF3 EE                  <2> out dx, al
  6679 00002BF4 EB00                <2> jmp short $+2
  6680                              <2> 
  6681 00002BF6 BE[9A300000]        <1> mov esi, ISAPNP_INITKEY
  6682                              <1> next_key:
  6683 00002BFB 3E8A06              <1> mov al, byte [ds:esi]
  6684 00002BFE A2[88300000]        <1> mov byte [ISAPNP_TEMP_DATA], al
  6685                              <1> ISAPNP_write_address	[ISAPNP_TEMP_DATA]	
  6686 00002C03 A0[88300000]        <2> mov al, %1
  6687 00002C08 66BA7902            <2> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6688 00002C0C EE                  <2> out dx, al
  6689 00002C0D EB00                <2> jmp short $+2
  6690                              <2> 
  6691 00002C0F 46                  <1> inc esi
  6692 00002C10 81FE[BA300000]      <1> cmp esi, ISAPNP_INITKEY+32 
  6693 00002C16 75E3                <1> jne next_key
  6694                              <1> ;jmp dword 0x0008:next_key
  6695                              <1> ;end_initkey:
  6696 00002C18 CB                  <1> retf
  6697                              <1> 
  6698                              <1> ISAPNP_init_isolation:
  6699                              <1> ISAPNP_wait_state
  6700                              <2> ISAPNP_write_byte 0x02,0x02
  6701                              <3> ISAPNP_write_address %1
  6702 00002C19 B002                <4> mov al, %1
  6703 00002C1B 66BA7902            <4> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6704 00002C1F EE                  <4> out dx, al
  6705 00002C20 EB00                <4> jmp short $+2
  6706                              <4> 
  6707                              <3> ISAPNP_write_data %2
  6708 00002C22 B002                <4> mov al, %1
  6709 00002C24 66BA790A            <4> mov dx, ISAPNP_WRITE_DATA_PORT
  6710 00002C28 EE                  <4> out dx, al
  6711                              <2> 
  6712                              <2> 
  6713                              <2> TIMER_rtc_msdelay 1
  6714 00002C29 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6715 00002C2E 31DB                <3> xor ebx, ebx
  6716 00002C30 BB01000000          <3> mov ebx, %1
  6717 00002C35 01D8                <3> add eax, ebx
  6718 00002C37 93                  <3> xchg eax, ebx
  6719                              <3> 
  6720                              <3> 
  6721                              <3> 
  6722                              <3> %%check_rtc:
  6723 00002C38 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6724 00002C3D 39D8                <3> cmp eax, ebx
  6725 00002C3F 7CF7                <3> jl %%check_rtc
  6726                              <3> 
  6727 00002C41 9A[CC2B0000]0800    <1> call dword 0x0008:ISAPNP_initkey
  6728                              <1> ISAPNP_reset_drv
  6729                              <2> ISAPNP_write_byte 0x02,0x07
  6730                              <3> ISAPNP_write_address %1
  6731 00002C48 B002                <4> mov al, %1
  6732 00002C4A 66BA7902            <4> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6733 00002C4E EE                  <4> out dx, al
  6734 00002C4F EB00                <4> jmp short $+2
  6735                              <4> 
  6736                              <3> ISAPNP_write_data %2
  6737 00002C51 B007                <4> mov al, %1
  6738 00002C53 66BA790A            <4> mov dx, ISAPNP_WRITE_DATA_PORT
  6739 00002C57 EE                  <4> out dx, al
  6740                              <2> 
  6741                              <2> 
  6742                              <2> TIMER_rtc_msdelay 2
  6743 00002C58 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6744 00002C5D 31DB                <3> xor ebx, ebx
  6745 00002C5F BB02000000          <3> mov ebx, %1
  6746 00002C64 01D8                <3> add eax, ebx
  6747 00002C66 93                  <3> xchg eax, ebx
  6748                              <3> 
  6749                              <3> 
  6750                              <3> 
  6751                              <3> %%check_rtc:
  6752 00002C67 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6753 00002C6C 39D8                <3> cmp eax, ebx
  6754 00002C6E 7CF7                <3> jl %%check_rtc
  6755                              <3> 
  6756                              <1> ISAPNP_wait_state
  6757                              <2> ISAPNP_write_byte 0x02,0x02
  6758                              <3> ISAPNP_write_address %1
  6759 00002C70 B002                <4> mov al, %1
  6760 00002C72 66BA7902            <4> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6761 00002C76 EE                  <4> out dx, al
  6762 00002C77 EB00                <4> jmp short $+2
  6763                              <4> 
  6764                              <3> ISAPNP_write_data %2
  6765 00002C79 B002                <4> mov al, %1
  6766 00002C7B 66BA790A            <4> mov dx, ISAPNP_WRITE_DATA_PORT
  6767 00002C7F EE                  <4> out dx, al
  6768                              <2> 
  6769                              <2> 
  6770                              <2> TIMER_rtc_msdelay 1
  6771 00002C80 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6772 00002C85 31DB                <3> xor ebx, ebx
  6773 00002C87 BB01000000          <3> mov ebx, %1
  6774 00002C8C 01D8                <3> add eax, ebx
  6775 00002C8E 93                  <3> xchg eax, ebx
  6776                              <3> 
  6777                              <3> 
  6778                              <3> 
  6779                              <3> %%check_rtc:
  6780 00002C8F A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6781 00002C94 39D8                <3> cmp eax, ebx
  6782 00002C96 7CF7                <3> jl %%check_rtc
  6783                              <3> 
  6784 00002C98 9A[CC2B0000]0800    <1> call dword 0x0008:ISAPNP_initkey
  6785                              <1> ISAPNP_wakeup_csn 0x00
  6786                              <2> ISAPNP_write_byte 0x03, %1
  6787                              <3> ISAPNP_write_address %1
  6788 00002C9F B003                <4> mov al, %1
  6789 00002CA1 66BA7902            <4> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6790 00002CA5 EE                  <4> out dx, al
  6791 00002CA6 EB00                <4> jmp short $+2
  6792                              <4> 
  6793                              <3> ISAPNP_write_data %2
  6794 00002CA8 B000                <4> mov al, %1
  6795 00002CAA 66BA790A            <4> mov dx, ISAPNP_WRITE_DATA_PORT
  6796 00002CAE EE                  <4> out dx, al
  6797                              <1> ISAPNP_set_device_port
  6798 00002CAF 668B1D[98300000]    <2> mov bx, [ISAPNP_DEVICE_PORT]
  6799 00002CB6 66C1EB02            <2> shr bx, 2
  6800                              <2> ISAPNP_write_byte 0x00, bl
  6801                              <3> ISAPNP_write_address %1
  6802 00002CBA B000                <4> mov al, %1
  6803 00002CBC 66BA7902            <4> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6804 00002CC0 EE                  <4> out dx, al
  6805 00002CC1 EB00                <4> jmp short $+2
  6806                              <4> 
  6807                              <3> ISAPNP_write_data %2
  6808 00002CC3 88D8                <4> mov al, %1
  6809 00002CC5 66BA790A            <4> mov dx, ISAPNP_WRITE_DATA_PORT
  6810 00002CC9 EE                  <4> out dx, al
  6811                              <2> 
  6812                              <2> 
  6813                              <2> TIMER_rtc_msdelay 1
  6814 00002CCA A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6815 00002CCF 31DB                <3> xor ebx, ebx
  6816 00002CD1 BB01000000          <3> mov ebx, %1
  6817 00002CD6 01D8                <3> add eax, ebx
  6818 00002CD8 93                  <3> xchg eax, ebx
  6819                              <3> 
  6820                              <3> 
  6821                              <3> 
  6822                              <3> %%check_rtc:
  6823 00002CD9 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  6824 00002CDE 39D8                <3> cmp eax, ebx
  6825 00002CE0 7CF7                <3> jl %%check_rtc
  6826                              <3> 
  6827                              <1> ISAPNP_serial_isolation
  6828                              <2> ISAPNP_write_address 0x01
  6829 00002CE2 B001                <3> mov al, %1
  6830 00002CE4 66BA7902            <3> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  6831 00002CE8 EE                  <3> out dx, al
  6832 00002CE9 EB00                <3> jmp short $+2
  6833                              <3> 
  6834                              <1> ; Delay at least 1msecond
  6835                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6836                              <1> TIMER_rtc_msdelay	1
  6837 00002CEB A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6838 00002CF0 31DB                <2> xor ebx, ebx
  6839 00002CF2 BB01000000          <2> mov ebx, %1
  6840 00002CF7 01D8                <2> add eax, ebx
  6841 00002CF9 93                  <2> xchg eax, ebx
  6842                              <2> 
  6843                              <2> 
  6844                              <2> 
  6845                              <2> %%check_rtc:
  6846 00002CFA A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6847 00002CFF 39D8                <2> cmp eax, ebx
  6848 00002D01 7CF7                <2> jl %%check_rtc
  6849                              <2> 
  6850 00002D03 CB                  <1> retf
  6851                              <1> 
  6852                              <1> ISAPNP_isolation:		
  6853 00002D04 BF[E8300000]        <1> mov edi, ISAPNP_ENCODED_SIGNATURE
  6854 00002D09 B846464646          <1> mov dword eax, 'FFFF'
  6855 00002D0E BB46464646          <1> mov dword ebx, 'FFFF'
  6856 00002D13 3E8907              <1> mov dword [ds:edi], eax
  6857 00002D16 3E895F04            <1> mov dword [ds:edi+4], ebx
  6858 00002D1A BF[D5300000]        <1> mov edi, ISAPNP_SERIAL_NUMBER
  6859 00002D1F 66A1[98300000]      <1> mov ax, [ISAPNP_DEVICE_PORT]
  6860 00002D25 3E668907            <1> mov word [ds:edi], ax
  6861 00002D29 81C702000000        <1> add edi, 2
  6862 00002D2F 893D[90300000]      <1> mov dword [ISAPNP_TEMP_ADDRESS], edi
  6863 00002D35 C705[8C300000]0000- <1> mov dword [ISAPNP_TEMP_VALUE], 0
  6864 00002D3D 0000                <1>
  6865 00002D3F C705[94300000]0100- <1> mov dword [ISAPNP_TEMP_BITMASK], 1
  6866 00002D47 0000                <1>
  6867 00002D49 C605[89300000]6A    <1> mov byte [ISAPNP_TEMP_CHECKSUM], 0x6A
  6868                              <1> 
  6869                              <1> next_encoded_bit:	
  6870                              <1> ISAPNP_read_data 	byte [ISAPNP_TEMP_DATA]	
  6871 00002D50 668B15[98300000]    <2> mov dx, [ISAPNP_DEVICE_PORT]
  6872 00002D57 EC                  <2> in al, dx
  6873 00002D58 A2[88300000]        <2> mov %1, al
  6874 00002D5D A0[88300000]        <1> mov al, [ISAPNP_TEMP_DATA]
  6875 00002D62 66C1E008            <1> shl ax, 8
  6876 00002D66 66A3[8A300000]      <1> mov [ISAPNP_TEMP_SIGNAL], ax
  6877 00002D6C EB00                <1> jmp short $+2		; Delay at least 250useconds 
  6878                              <1> ISAPNP_read_data 	byte [ISAPNP_TEMP_DATA]
  6879 00002D6E 668B15[98300000]    <2> mov dx, [ISAPNP_DEVICE_PORT]
  6880 00002D75 EC                  <2> in al, dx
  6881 00002D76 A2[88300000]        <2> mov %1, al
  6882 00002D7B 6631C0              <1> xor ax, ax
  6883 00002D7E A0[88300000]        <1> mov al, [ISAPNP_TEMP_DATA]
  6884 00002D83 660105[8A300000]    <1> add [ISAPNP_TEMP_SIGNAL], ax
  6885 00002D8A EB00                <1> jmp short $+2		; Delay at least 250useconds 
  6886 00002D8C C605[88300000]00    <1> mov byte [ISAPNP_TEMP_DATA], 0
  6887 00002D93 66813D[8A300000]AA- <1> cmp word [ISAPNP_TEMP_SIGNAL], 0x55AA
  6888 00002D9B 55                  <1>
  6889 00002D9C 7519                <1> jne skip_bit
  6890 00002D9E C605[88300000]01    <1> mov byte [ISAPNP_TEMP_DATA], 1
  6891 00002DA5 A1[8C300000]        <1> mov eax, dword [ISAPNP_TEMP_VALUE]
  6892 00002DAA 8B1D[94300000]      <1> mov ebx, dword [ISAPNP_TEMP_BITMASK]
  6893 00002DB0 09D8                <1> or eax, ebx
  6894 00002DB2 A3[8C300000]        <1> mov dword [ISAPNP_TEMP_VALUE], eax
  6895                              <1> skip_bit:
  6896                              <1> 
  6897                              <1> ;;; checksum = ((((checksum ^ (checksum >> 1)) & 0x01) ^ bit) << 7) | (checksum >> 1);
  6898 00002DB7 A0[89300000]        <1> mov al, [ISAPNP_TEMP_CHECKSUM]
  6899 00002DBC 88C3                <1> mov bl, al
  6900 00002DBE D0EB                <1> shr bl, 1
  6901 00002DC0 30D8                <1> xor al,bl 
  6902 00002DC2 2401                <1> and al, 1
  6903 00002DC4 3205[88300000]      <1> xor al, byte [ISAPNP_TEMP_DATA] 
  6904 00002DCA C0E007              <1> shl al, 7
  6905 00002DCD 08D8                <1> or al, bl
  6906 00002DCF A2[89300000]        <1> mov [ISAPNP_TEMP_CHECKSUM], al
  6907                              <1> 
  6908                              <1> ; Delay at least 1msecond
  6909                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6910                              <1> TIMER_rtc_msdelay	1
  6911 00002DD4 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6912 00002DD9 31DB                <2> xor ebx, ebx
  6913 00002DDB BB01000000          <2> mov ebx, %1
  6914 00002DE0 01D8                <2> add eax, ebx
  6915 00002DE2 93                  <2> xchg eax, ebx
  6916                              <2> 
  6917                              <2> 
  6918                              <2> 
  6919                              <2> %%check_rtc:
  6920 00002DE3 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6921 00002DE8 39D8                <2> cmp eax, ebx
  6922 00002DEA 7CF7                <2> jl %%check_rtc
  6923                              <2> 
  6924 00002DEC 813D[94300000]0000- <1> cmp dword [ISAPNP_TEMP_BITMASK], 10000000000000000000000000000000b 
  6925 00002DF4 0080                <1>
  6926 00002DF6 740D                <1> je next_32bit
  6927 00002DF8 D125[94300000]      <1> shl dword [ISAPNP_TEMP_BITMASK], 1
  6928 00002DFE EA[502D0000]0800    <1> jmp dword 0x0008:next_encoded_bit
  6929                              <1> next_32bit:
  6930 00002E05 A1[8C300000]        <1> mov eax, dword [ISAPNP_TEMP_VALUE]
  6931 00002E0A 8B3D[90300000]      <1> mov edi, dword [ISAPNP_TEMP_ADDRESS]
  6932 00002E10 3E8907              <1> mov dword [ds:edi], eax
  6933 00002E13 C705[8C300000]0000- <1> mov dword [ISAPNP_TEMP_VALUE], 0
  6934 00002E1B 0000                <1>
  6935 00002E1D 8105[90300000]0400- <1> add dword [ISAPNP_TEMP_ADDRESS], 4
  6936 00002E25 0000                <1>
  6937 00002E27 C705[94300000]0100- <1> mov dword [ISAPNP_TEMP_BITMASK], 1
  6938 00002E2F 0000                <1>
  6939 00002E31 813D[90300000]-     <1> cmp dword [ISAPNP_TEMP_ADDRESS], ISAPNP_SERIAL_NUMBER+10
  6940 00002E37 [DF300000]          <1>
  6941 00002E3B 7407                <1> je checksum_bit
  6942 00002E3D EA[502D0000]0800    <1> jmp dword 0x0008:next_encoded_bit
  6943                              <1> 
  6944                              <1> checksum_bit:
  6945                              <1> ISAPNP_read_data 	byte [ISAPNP_TEMP_DATA]	
  6946 00002E44 668B15[98300000]    <2> mov dx, [ISAPNP_DEVICE_PORT]
  6947 00002E4B EC                  <2> in al, dx
  6948 00002E4C A2[88300000]        <2> mov %1, al
  6949 00002E51 A0[88300000]        <1> mov al, [ISAPNP_TEMP_DATA]
  6950 00002E56 66C1E008            <1> shl ax, 8
  6951 00002E5A 66A3[8A300000]      <1> mov [ISAPNP_TEMP_SIGNAL], ax
  6952 00002E60 EB00                <1> jmp short $+2		; Delay at least 250useconds 
  6953                              <1> ISAPNP_read_data 	byte [ISAPNP_TEMP_DATA]
  6954 00002E62 668B15[98300000]    <2> mov dx, [ISAPNP_DEVICE_PORT]
  6955 00002E69 EC                  <2> in al, dx
  6956 00002E6A A2[88300000]        <2> mov %1, al
  6957 00002E6F 6631C0              <1> xor ax, ax
  6958 00002E72 A0[88300000]        <1> mov al, [ISAPNP_TEMP_DATA]
  6959 00002E77 660105[8A300000]    <1> add [ISAPNP_TEMP_SIGNAL], ax
  6960 00002E7E EB00                <1> jmp short $+2		; Delay at least 250useconds 
  6961 00002E80 66813D[8A300000]AA- <1> cmp word [ISAPNP_TEMP_SIGNAL], 0x55AA
  6962 00002E88 55                  <1>
  6963 00002E89 7512                <1> jne skip_bit1
  6964 00002E8B A1[8C300000]        <1> mov eax, dword [ISAPNP_TEMP_VALUE]
  6965 00002E90 8B1D[94300000]      <1> mov ebx, dword [ISAPNP_TEMP_BITMASK]
  6966 00002E96 09D8                <1> or eax, ebx
  6967 00002E98 A3[8C300000]        <1> mov dword [ISAPNP_TEMP_VALUE], eax
  6968                              <1> skip_bit1:
  6969                              <1> ; Delay at least 1msecond
  6970                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  6971                              <1> TIMER_rtc_msdelay	1
  6972 00002E9D A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6973 00002EA2 31DB                <2> xor ebx, ebx
  6974 00002EA4 BB01000000          <2> mov ebx, %1
  6975 00002EA9 01D8                <2> add eax, ebx
  6976 00002EAB 93                  <2> xchg eax, ebx
  6977                              <2> 
  6978                              <2> 
  6979                              <2> 
  6980                              <2> %%check_rtc:
  6981 00002EAC A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  6982 00002EB1 39D8                <2> cmp eax, ebx
  6983 00002EB3 7CF7                <2> jl %%check_rtc
  6984                              <2> 
  6985 00002EB5 813D[94300000]8000- <1> cmp dword [ISAPNP_TEMP_BITMASK], 00000000000000000000000010000000b 
  6986 00002EBD 0000                <1>
  6987 00002EBF 740D                <1> je check_checksum
  6988 00002EC1 D125[94300000]      <1> shl dword [ISAPNP_TEMP_BITMASK], 1
  6989 00002EC7 EA[442E0000]0800    <1> jmp dword 0x0008:checksum_bit
  6990                              <1> 
  6991                              <1> check_checksum:
  6992 00002ECE 8B1D[8C300000]      <1> mov ebx, dword [ISAPNP_TEMP_VALUE]
  6993 00002ED4 8B3D[90300000]      <1> mov edi, dword [ISAPNP_TEMP_ADDRESS]
  6994 00002EDA 3E881F              <1> mov byte [ds:edi], bl
  6995 00002EDD A0[89300000]        <1> mov al, [ISAPNP_TEMP_CHECKSUM]
  6996 00002EE2 38D8                <1> cmp al, bl
  6997 00002EE4 754A                <1> jne end_isolation
  6998                              <1> ;jmp dword 0x0008:end_isolation
  6999                              <1> ;isolate:
  7000 00002EE6 FE05[D4300000]      <1> inc byte [ISAPNP_CSN]
  7001                              <1> ISAPNP_set_card	 [ISAPNP_CSN]
  7002                              <2> ISAPNP_write_byte 0x06, %1
  7003                              <3> ISAPNP_write_address %1
  7004 00002EEC B006                <4> mov al, %1
  7005 00002EEE 66BA7902            <4> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  7006 00002EF2 EE                  <4> out dx, al
  7007 00002EF3 EB00                <4> jmp short $+2
  7008                              <4> 
  7009                              <3> ISAPNP_write_data %2
  7010 00002EF5 A0[D4300000]        <4> mov al, %1
  7011 00002EFA 66BA790A            <4> mov dx, ISAPNP_WRITE_DATA_PORT
  7012 00002EFE EE                  <4> out dx, al
  7013 00002EFF EB00                <1> jmp short $+2		; Delay at least 250useconds 
  7014                              <1> ;TIMER_delay	MSEC_PIT_FREQUENCY, 1
  7015                              <1> ISAPNP_wakeup_csn	0x00
  7016                              <2> ISAPNP_write_byte 0x03, %1
  7017                              <3> ISAPNP_write_address %1
  7018 00002F01 B003                <4> mov al, %1
  7019 00002F03 66BA7902            <4> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  7020 00002F07 EE                  <4> out dx, al
  7021 00002F08 EB00                <4> jmp short $+2
  7022                              <4> 
  7023                              <3> ISAPNP_write_data %2
  7024 00002F0A B000                <4> mov al, %1
  7025 00002F0C 66BA790A            <4> mov dx, ISAPNP_WRITE_DATA_PORT
  7026 00002F10 EE                  <4> out dx, al
  7027                              <1> ISAPNP_serial_isolation
  7028                              <2> ISAPNP_write_address 0x01
  7029 00002F11 B001                <3> mov al, %1
  7030 00002F13 66BA7902            <3> mov dx, ISAPNP_WRITE_ADDRESS_PORT
  7031 00002F17 EE                  <3> out dx, al
  7032 00002F18 EB00                <3> jmp short $+2
  7033                              <3> 
  7034 00002F1A BF[E8300000]        <1> mov edi, ISAPNP_ENCODED_SIGNATURE
  7035 00002F1F B830303030          <1> mov dword eax, '0000'
  7036 00002F24 BB30303030          <1> mov dword ebx, '0000'
  7037 00002F29 3E8907              <1> mov dword [ds:edi], eax
  7038 00002F2C 3E895F04            <1> mov dword [ds:edi+4], ebx
  7039                              <1> end_isolation:
  7040                              <1> 
  7041 00002F30 CB                  <1> retf
  7042                              <1> 
  7043                              <1> ;
  7044                              <1> ;   Bit value   |         Results of
  7045                              <1> ;   E1  |   E2  | E1 & E2 | E1 ^ E2 | E1 | E2
  7046                              <1> ;----------------------------------------------
  7047                              <1> ;   0   |   0   |    0    |    0    |    0
  7048                              <1> ;   1   |   0   |    0    |    1    |    1
  7049                              <1> ;   0   |   1   |    0    |    1    |    1
  7050                              <1> ;   1   |   1   |    1    |    0    |    1
  7051                              <1> 
  7052                              <1> %macro ISAPNP_get_encoded_char            0
  7053                              <1> ; al = encoded number           
  7054                              <1> mov esi, ISAPNP_ENCODED_CHAR
  7055                              <1> mov bl, al
  7056                              <1> mov eax, 0
  7057                              <1> mov al, bl
  7058                              <1> add esi, eax
  7059                              <1> dec esi
  7060                              <1> mov al, byte [ds:esi]
  7061                              <1> ; al = ASCII 
  7062                              <1> %endmacro
  7063                              <1> 
  7064                              <1> ISAPNP_detect:
  7065                              <1> ; BIT 7 = 0
  7066 00002F31 BF[E8300000]        <1> mov edi, ISAPNP_ENCODED_SIGNATURE
  7067 00002F36 BE[D7300000]        <1> mov esi, ISAPNP_SERIAL_NUMBER+2
  7068 00002F3B 3E668B06            <1> mov ax, word [ds:esi]
  7069 00002F3F 66BA7C00            <1> mov dx, 0000000001111100b
  7070 00002F43 6650                <1> push ax
  7071 00002F45 6621D0              <1> and ax, dx
  7072 00002F48 66C1E802            <1> shr ax, 2	; Shift to RIGHT
  7073                              <1> ISAPNP_get_encoded_char
  7074                              <2> 
  7075 00002F4C BE[BA300000]        <2> mov esi, ISAPNP_ENCODED_CHAR
  7076 00002F51 88C3                <2> mov bl, al
  7077 00002F53 B800000000          <2> mov eax, 0
  7078 00002F58 88D8                <2> mov al, bl
  7079 00002F5A 01C6                <2> add esi, eax
  7080 00002F5C 4E                  <2> dec esi
  7081 00002F5D 3E8A06              <2> mov al, byte [ds:esi]
  7082                              <2> 
  7083 00002F60 3E8807              <1> mov byte [ds:edi], al
  7084 00002F63 47                  <1> inc edi
  7085 00002F64 6658                <1> pop ax
  7086 00002F66 6650                <1> push ax
  7087 00002F68 66BA03E0            <1> mov dx, 1110000000000011b
  7088 00002F6C 6621D0              <1> and ax, dx
  7089 00002F6F 66C1C003            <1> rol ax, 3	; Rotate RIGHT-to-LEFT
  7090                              <1> ISAPNP_get_encoded_char
  7091                              <2> 
  7092 00002F73 BE[BA300000]        <2> mov esi, ISAPNP_ENCODED_CHAR
  7093 00002F78 88C3                <2> mov bl, al
  7094 00002F7A B800000000          <2> mov eax, 0
  7095 00002F7F 88D8                <2> mov al, bl
  7096 00002F81 01C6                <2> add esi, eax
  7097 00002F83 4E                  <2> dec esi
  7098 00002F84 3E8A06              <2> mov al, byte [ds:esi]
  7099                              <2> 
  7100 00002F87 3E8807              <1> mov byte [ds:edi], al
  7101 00002F8A 47                  <1> inc edi
  7102 00002F8B 6658                <1> pop ax
  7103 00002F8D 66BA001F            <1> mov dx, 0001111100000000b
  7104 00002F91 6621D0              <1> and ax, dx
  7105 00002F94 66C1E808            <1> shr ax, 8 	; Shift to RIGHT
  7106                              <1> ISAPNP_get_encoded_char
  7107                              <2> 
  7108 00002F98 BE[BA300000]        <2> mov esi, ISAPNP_ENCODED_CHAR
  7109 00002F9D 88C3                <2> mov bl, al
  7110 00002F9F B800000000          <2> mov eax, 0
  7111 00002FA4 88D8                <2> mov al, bl
  7112 00002FA6 01C6                <2> add esi, eax
  7113 00002FA8 4E                  <2> dec esi
  7114 00002FA9 3E8A06              <2> mov al, byte [ds:esi]
  7115                              <2> 
  7116 00002FAC 3E8807              <1> mov byte [ds:edi], al
  7117 00002FAF BE[D9300000]        <1> mov esi, ISAPNP_SERIAL_NUMBER+4
  7118 00002FB4 31C0                <1> xor eax, eax
  7119 00002FB6 3E668B06            <1> mov ax, word [ds:esi]
  7120 00002FBA 86C4                <1> xchg al, ah
  7121 00002FBC A3[8C300000]        <1> mov [ISAPNP_TEMP_VALUE], eax
  7122                              <1> number_to_text  dword [ISAPNP_TEMP_VALUE], 16, ISAPNP_ENCODED_SIGNATURE+6
  7123                              <2> 
  7124                              <2> 
  7125                              <2> 
  7126 00002FC1 BF[EE300000]        <2> mov edi, %3
  7127 00002FC6 BE[03060000]        <2> mov esi, UTIL_HEX_DIGITS
  7128 00002FCB A1[8C300000]        <2> mov eax, %1
  7129 00002FD0 BB10000000          <2> mov ebx, %2
  7130                              <2> %%divide:
  7131 00002FD5 31D2                <2> xor edx, edx
  7132 00002FD7 F7F3                <2> div ebx
  7133 00002FD9 3E8A0C16            <2> mov cl, byte [ds:esi+edx]
  7134 00002FDD 3E880F              <2> mov byte [ds:edi], cl
  7135 00002FE0 4F                  <2> dec edi
  7136 00002FE1 39D8                <2> cmp eax, ebx
  7137 00002FE3 7DF0                <2> jge %%divide
  7138 00002FE5 3D00000000          <2> cmp eax, 0
  7139 00002FEA 7407                <2> je %%end
  7140 00002FEC 3E8A0C06            <2> mov cl, byte [ds:esi+eax]
  7141 00002FF0 26880F              <2> mov byte [es:edi], cl
  7142                              <2> %%end:
  7143 00002FF3 BF[EF300000]        <1> mov edi, ISAPNP_ENCODED_SIGNATURE+7
  7144 00002FF8 3EC60700            <1> mov byte [ds:edi], 0 
  7145                              <1> 
  7146 00002FFC BF[F1300000]        <1> mov edi, ISAPNP_DEVICES
  7147 00003001 BE[E8300000]        <1> mov esi, ISAPNP_ENCODED_SIGNATURE
  7148 00003006 BA00000000          <1> mov edx, 0
  7149                              <1> next_device:
  7150 0000300B 3E8A0416            <1> mov al, byte [ds:esi+edx]
  7151 0000300F 3E8A1C17            <1> mov bl, byte [ds:edi+edx]
  7152 00003013 38D8                <1> cmp al, bl
  7153 00003015 741B                <1> je next_char2
  7154 00003017 BA00000000          <1> mov edx, 0
  7155 0000301C 81C726000000        <1> add edi, 38
  7156 00003022 81FF[41390000]      <1> cmp edi, END_ISAPNP_DEVICES
  7157 00003028 75E1                <1> jne next_device
  7158 0000302A 81EF26000000        <1> sub edi, 38
  7159 00003030 EB09                <1> jmp short end_detect
  7160                              <1> next_char2:
  7161 00003032 42                  <1> inc edx
  7162 00003033 81FA07000000        <1> cmp edx, 7
  7163 00003039 75D0                <1> jne next_device
  7164                              <1> end_detect:
  7165 0000303B 81C707000000        <1> add edi, 7 
  7166 00003041 893D[E0300000]      <1> mov dword [ISAPNP_CARD_STRING], edi 
  7167                              <1> 
  7168 00003047 CB                  <1> retf
  7169                              <1> 
  7170                              <1> 
  7171                              <1> ;============================================================================;
  7172 00003048 030B131B232B        <1> ISAPNP_CHECK_PORTS		DB      0x203, 0x20B, 0x213, 0x21B, 0x223, 0x22B 
  7173 0000304E 333B434B535B        <1> 				DB	0x233, 0x23B, 0x243, 0x24B, 0x253, 0x25B
  7174 00003054 636B737B838B        <1> 				DB	0x263, 0x26B, 0x273, 0x27B, 0x283, 0x28B
  7175 0000305A 939BA3ABB3BB        <1> 				DB	0x293, 0x29B, 0x2A3, 0x2AB, 0x2B3, 0x2BB
  7176 00003060 C3CBD3DBE3EB        <1> 				DB	0x2C3, 0x2CB, 0x2D3, 0x2DB, 0x2E3, 0x2EB
  7177 00003066 F3FB030B131B        <1> 				DB	0x2F3, 0x2FB, 0x303, 0x30B, 0x313, 0x31B 
  7178 0000306C 232B333B434B        <1> 				DB	0x323, 0x32B, 0x333, 0x33B, 0x343, 0x34B
  7179 00003072 535B636B737B        <1> 				DB	0x353, 0x35B, 0x363, 0x36B, 0x373, 0x37B
  7180 00003078 838B939BA3AB        <1> 				DB	0x383, 0x38B, 0x393, 0x39B, 0x3A3, 0x3AB
  7181 0000307E B3BBC3CBD3DB        <1> 				DB	0x3B3, 0x3BB, 0x3C3, 0x3CB, 0x3D3, 0x3DB
  7182 00003084 E3EBF3FB            <1> 				DB	0x3E3, 0x3EB, 0x3F3, 0x3FB
  7183                              <1> 
  7184 00003088 00                  <1> ISAPNP_TEMP_DATA		DB	0
  7185 00003089 00                  <1> ISAPNP_TEMP_CHECKSUM		DB	0
  7186 0000308A 0000                <1> ISAPNP_TEMP_SIGNAL		DW	0
  7187 0000308C 00000000            <1> ISAPNP_TEMP_VALUE		DD	0
  7188 00003090 00000000            <1> ISAPNP_TEMP_ADDRESS		DD	0
  7189 00003094 00000000            <1> ISAPNP_TEMP_BITMASK		DD	0
  7190                              <1> ISAPNP_WRITE_ADDRESS_PORT	equ 	0x279
  7191                              <1> ISAPNP_WRITE_DATA_PORT		equ	0xA79
  7192 00003098 0000                <1> ISAPNP_DEVICE_PORT		DW	0
  7193                              <1> ISAPNP_DEVICE_PORT_INC		equ	32
  7194                              <1> ISAPNP_DEVICE_PORT_START	equ	0x200
  7195                              <1> ISAPNP_DEVICE_PORT_END		equ	0x3FF
  7196 0000309A 6AB5DAEDF6FB        <1> ISAPNP_INITKEY	 		DB	0x6A, 0xB5, 0xDA, 0xED, 0xF6, 0xFB
  7197 000030A0 7DBEDF6F371B        <1> 				DB	0x7D, 0xBE, 0xDF, 0x6F, 0x37, 0x1B
  7198 000030A6 0D86C361B058        <1> 				DB	0x0D, 0x86, 0xC3, 0x61, 0xB0, 0x58 
  7199 000030AC 2C168B45A2D1        <1> 				DB	0x2C, 0x16, 0x8B, 0x45, 0xA2, 0xD1
  7200 000030B2 E8743A9DCEE7        <1> 				DB	0xE8, 0x74, 0x3A, 0x9D, 0xCE, 0xE7
  7201 000030B8 7339                <1> 				DB	0x73, 0x39
  7202 000030BA 414243444546474849- <1> ISAPNP_ENCODED_CHAR             DB 	'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
  7203 000030C3 4A4B4C4D4E4F505152- <1>
  7204 000030CC 535455565758595A    <1>
  7205 000030D4 00                  <1> ISAPNP_CSN			DB	0
  7206 000030D5 0000                <1> ISAPNP_SERIAL_NUMBER		DW	0		; port address
  7207 000030D7 0421                <1> 				DW	0010000100000100b	; encoded model name
  7208                              <1> 				; initialize with AAA for debugging
  7209 000030D9 0000                <1> 				DW	0		; product number
  7210 000030DB 00000000            <1> 				DD	0		; serial number
  7211 000030DF 00                  <1> 				DB	0		; checksum
  7212                              <1> 
  7213 000030E0 00000000            <1> ISAPNP_CARD_STRING		DD	0x00000000	; COOL Pointer !!! :)
  7214 000030E4 00000000            <1> ISAPNP_DEVICE_STRING		DD	0x00000000	; COOL Pointer !!! :)
  7215 000030E8 202020202020202000  <1> ISAPNP_ENCODED_SIGNATURE	DB 	'        ',0
  7216                              <1> ISAPNP_DEVICES:			
  7217                              <1> ;-----------------------------------------------------------------------;
  7218                              <1> ;				PNP CARDS				;
  7219                              <1> ;-----------------------------------------------------------------------;	
  7220 000030F1 43544C30303031      <1> 				DB	'CTL0001'	; Encoded Signature
  7221 000030F8 437265617469766520- <1> 				DB	'Creative Labs SB16            ',0
  7222 00003101 4C6162732053423136- <1>
  7223 0000310A 202020202020202020- <1>
  7224 00003113 20202000            <1>
  7225 00003117 43544C30303231      <1> 				DB	'CTL0021'
  7226 0000311E 437265617469766520- <1> 				DB	'Creative Labs AWE/AWE32       ',0
  7227 00003127 4C616273204157452F- <1>
  7228 00003130 415745333220202020- <1>
  7229 00003139 20202000            <1>
  7230 0000313D 43544C30303232      <1> 				DB	'CTL0022'
  7231 00003144 437265617469766520- <1> 				DB	'Creative Labs AWE64 16-Bit    ',0
  7232 0000314D 4C6162732041574536- <1>
  7233 00003156 342031362D42697420- <1>
  7234 0000315F 20202000            <1>
  7235 00003163 43544C30303233      <1> 				DB	'CTL0023'
  7236 0000316A 437265617469766520- <1> 				DB	'Creative Labs AWE64 Gold      ',0
  7237 00003173 4C6162732041574536- <1>
  7238 0000317C 3420476F6C64202020- <1>
  7239 00003185 20202000            <1>
  7240 00003189 43544C30303234      <1> 				DB	'CTL0024'
  7241 00003190 437265617469766520- <1> 				DB	'Creative Labs AWE64           ',0
  7242 00003199 4C6162732041574536- <1>
  7243 000031A2 342020202020202020- <1>
  7244 000031AB 20202000            <1>
  7245 000031AF 43544C30303242      <1> 				DB	'CTL002B'
  7246 000031B6 437265617469766520- <1> 				DB	'Creative Labs SB16 PnP        ',0
  7247 000031BF 4C6162732053423136- <1>
  7248 000031C8 20506E502020202020- <1>
  7249 000031D1 20202000            <1>
  7250 000031D5 43544C30303331      <1> 				DB	'CTL0031'
  7251 000031DC 437265617469766520- <1> 				DB	'Creative Labs SB16            ',0
  7252 000031E5 4C6162732053423136- <1>
  7253 000031EE 202020202020202020- <1>
  7254 000031F7 20202000            <1>
  7255 000031FB 43544C30303431      <1> 				DB	'CTL0041'
  7256 00003202 437265617469766520- <1> 				DB	'Creative Labs V16CL/V32D/V32G ',0
  7257 0000320B 4C6162732056313643- <1>
  7258 00003214 4C2F563332442F5633- <1>
  7259 0000321D 32472000            <1>
  7260 00003221 43544C30303432      <1> 				DB	'CTL0042'
  7261 00003228 437265617469766520- <1> 				DB	'Creative Labs AWE64 WaveTable ',0
  7262 00003231 4C6162732041574536- <1>
  7263 0000323A 342057617665546162- <1>
  7264 00003243 6C652000            <1>
  7265 00003247 43544C30303433      <1> 				DB	'CTL0043'
  7266 0000324E 437265617469766520- <1> 				DB	'Creative Labs SB16            ',0
  7267 00003257 4C6162732053423136- <1>
  7268 00003260 202020202020202020- <1>
  7269 00003269 20202000            <1>
  7270 0000326D 43544C30303434      <1> 				DB	'CTL0044'
  7271 00003274 437265617469766520- <1> 				DB	'Creative Labs AWE64 Gold      ',0
  7272 0000327D 4C6162732041574536- <1>
  7273 00003286 3420476F6C64202020- <1>
  7274 0000328F 20202000            <1>
  7275 00003293 43544C30303435      <1> 				DB	'CTL0045'
  7276 0000329A 437265617469766520- <1> 				DB	'Creative Labs AWE64 16-Bit    ',0
  7277 000032A3 4C6162732041574536- <1>
  7278 000032AC 342031362D42697420- <1>
  7279 000032B5 20202000            <1>
  7280 000032B9 43544C30303436      <1> 				DB	'CTL0046'
  7281 000032C0 437265617469766520- <1> 				DB	'Creative Labs AWE64 16-Bit    ',0
  7282 000032C9 4C6162732041574536- <1>
  7283 000032D2 342031362D42697420- <1>
  7284 000032DB 20202000            <1>
  7285 000032DF 43544C30303437      <1> 				DB	'CTL0047'
  7286 000032E6 437265617469766520- <1> 				DB	'Creative Labs SB16            ',0
  7287 000032EF 4C6162732053423136- <1>
  7288 000032F8 202020202020202020- <1>
  7289 00003301 20202000            <1>
  7290 00003305 43544C30303531      <1> 				DB	'CTL0051'
  7291 0000330C 437265617469766520- <1> 				DB	'Creative Labs 3D Stereo       ',0
  7292 00003315 4C6162732033442053- <1>
  7293 0000331E 746572656F20202020- <1>
  7294 00003327 20202000            <1>
  7295 0000332B 43544C30303730      <1> 				DB	'CTL0070'
  7296 00003332 437265617469766520- <1> 				DB	'Creative Labs ViBRA16C        ',0
  7297 0000333B 4C6162732056694252- <1>
  7298 00003344 413136432020202020- <1>
  7299 0000334D 20202000            <1>
  7300 00003351 43544C30303944      <1> 				DB	'CTL009D'
  7301 00003358 437265617469766520- <1> 				DB	'Creative Labs SB AWE64        ',0
  7302 00003361 4C6162732053422041- <1>
  7303 0000336A 574536342020202020- <1>
  7304 00003373 20202000            <1>
  7305 00003377 43544C30303945      <1> 				DB	'CTL009E'
  7306 0000337E 437265617469766520- <1> 				DB	'Creative Labs SB AWE64 Gold   ',0
  7307 00003387 4C6162732053422041- <1>
  7308 00003390 5745363420476F6C64- <1>
  7309 00003399 20202000            <1>
  7310 0000339D 43544C30304333      <1> 				DB	'CTL00C3'
  7311 000033A4 437265617469766520- <1> 				DB	'Creative Labs SB AWE64        ',0
  7312 000033AD 4C6162732053422041- <1>
  7313 000033B6 574536342020202020- <1>
  7314 000033BF 20202000            <1>
  7315 000033C3 43544C30304534      <1> 				DB	'CTL00E4'
  7316 000033CA 437265617469766520- <1> 				DB	'Creative Labs SB AWE64        ',0
  7317 000033D3 4C6162732053422041- <1>
  7318 000033DC 574536342020202020- <1>
  7319 000033E5 20202000            <1>
  7320 000033E9 43544C30304630      <1> 				DB	'CTL00F0'
  7321 000033F0 437265617469766520- <1> 				DB	'Creative Labs Vibra16X        ',0
  7322 000033F9 4C6162732056696272- <1>
  7323 00003402 613136582020202020- <1>
  7324 0000340B 20202000            <1>
  7325 0000340F 43544C31303030      <1> 				DB	'CTL1000'
  7326 00003416 437265617469766520- <1> 				DB	'Creative Labs 3D Blaster      ',0
  7327 0000341F 4C6162732033442042- <1>
  7328 00003428 6C6173746572202020- <1>
  7329 00003431 20202000            <1>
  7330 00003435 43544C31303033      <1> 				DB	'CTL1003'
  7331 0000343C 437265617469766520- <1> 				DB	'Creative Labs 3D Blaster      ',0
  7332 00003445 4C6162732033442042- <1>
  7333 0000344E 6C6173746572202020- <1>
  7334 00003457 20202000            <1>
  7335 0000345B 43544C31303034      <1> 				DB	'CTL1004'
  7336 00003462 437265617469766520- <1> 				DB	'Creative Labs 3D Blaster      ',0
  7337 0000346B 4C6162732033442042- <1>
  7338 00003474 6C6173746572202020- <1>
  7339 0000347D 20202000            <1>
  7340 00003481 43544C31303035      <1> 				DB	'CTL1005'
  7341 00003488 437265617469766520- <1> 				DB	'Creative Labs 3D Blaster      ',0
  7342 00003491 4C6162732033442042- <1>
  7343 0000349A 6C6173746572202020- <1>
  7344 000034A3 20202000            <1>
  7345 000034A7 43544C31303036      <1> 				DB	'CTL1006'
  7346 000034AE 437265617469766520- <1> 				DB	'Creative Labs 3D Blaster      ',0
  7347 000034B7 4C6162732033442042- <1>
  7348 000034C0 6C6173746572202020- <1>
  7349 000034C9 20202000            <1>
  7350 000034CD 43544C32303031      <1> 				DB	'CTL2001'
  7351 000034D4 437265617469766520- <1> 				DB	'Creative Labs IDE Interface   ',0
  7352 000034DD 4C6162732049444520- <1>
  7353 000034E6 496E74657266616365- <1>
  7354 000034EF 20202000            <1>
  7355 000034F3 43544C32303032      <1> 				DB	'CTL2002'
  7356 000034FA 437265617469766520- <1> 				DB	'Creative Labs IDE CD-ROM Drive',0
  7357 00003503 4C6162732049444520- <1>
  7358 0000350C 43442D524F4D204472- <1>
  7359 00003515 69766500            <1>
  7360 00003519 43544C32303131      <1> 				DB	'CTL2011'
  7361 00003520 437265617469766520- <1> 				DB	'Creative Labs IDE CD-ROM Drive',0
  7362 00003529 4C6162732049444520- <1>
  7363 00003532 43442D524F4D204472- <1>
  7364 0000353B 69766500            <1>
  7365 0000353F 43544C37303031      <1> 				DB	'CTL7001'
  7366 00003546 437265617469766520- <1> 				DB	'Creative Labs Joystick Control',0
  7367 0000354F 4C616273204A6F7973- <1>
  7368 00003558 7469636B20436F6E74- <1>
  7369 00003561 726F6C00            <1>
  7370 00003565 43544C37303031      <1> 				DB	'CTL7001'
  7371 0000356C 437265617469766520- <1> 				DB	'Creative Labs Game Port       ',0
  7372 00003575 4C6162732047616D65- <1>
  7373 0000357E 20506F727420202020- <1>
  7374 00003587 20202000            <1>
  7375 0000358B 43544C37303032      <1> 				DB	'CTL7002'
  7376 00003592 437265617469766520- <1> 				DB	'Creative Labs Prog. Game Port ',0
  7377 0000359B 4C6162732050726F67- <1>
  7378 000035A4 2E2047616D6520506F- <1>
  7379 000035AD 72742000            <1>
  7380 000035B1 43544C37303035      <1> 				DB	'CTL7005'
  7381 000035B8 437265617469766520- <1> 				DB	'Creative Labs Prog. Game Port ',0
  7382 000035C1 4C6162732050726F67- <1>
  7383 000035CA 2E2047616D6520506F- <1>
  7384 000035D3 72742000            <1>
  7385 000035D7 43544C38303031      <1> 				DB	'CTL8001'
  7386 000035DE 437265617469766520- <1> 				DB	'Creative Labs Legacy SB       ',0
  7387 000035E7 4C616273204C656761- <1>
  7388 000035F0 637920534220202020- <1>
  7389 000035F9 20202000            <1>
  7390 000035FD 43544C39303131      <1> 				DB	'CTL9011'
  7391 00003604 437265617469766520- <1> 				DB	'Creative Labs RT300 VB        ',0
  7392 0000360D 4C6162732052543330- <1>
  7393 00003616 302056422020202020- <1>
  7394 0000361F 20202000            <1>
  7395                              <1> 
  7396 00003623 504E5042303030      <1> 				DB	'PNPB000'
  7397 0000362A 536F756E6420426C61- <1> 				DB	'Sound Blaster 1.5             ',0
  7398 00003633 7374657220312E3520- <1>
  7399 0000363C 202020202020202020- <1>
  7400 00003645 20202000            <1>
  7401 00003649 504E5042303031      <1> 				DB	'PNPB001'
  7402 00003650 536F756E6420426C61- <1> 				DB	'Sound Blaster 2.0             ',0
  7403 00003659 7374657220322E3020- <1>
  7404 00003662 202020202020202020- <1>
  7405 0000366B 20202000            <1>
  7406 0000366F 504E5042303032      <1> 				DB	'PNPB002'
  7407 00003676 536F756E6420426C61- <1> 				DB	'Sound Blaster Pro             ',0
  7408 0000367F 737465722050726F20- <1>
  7409 00003688 202020202020202020- <1>
  7410 00003691 20202000            <1>
  7411 00003695 504E5042303033      <1> 				DB	'PNPB003'
  7412 0000369C 536F756E6420426C61- <1> 				DB	'Sound Blaster 16              ',0
  7413 000036A5 737465722031362020- <1>
  7414 000036AE 202020202020202020- <1>
  7415 000036B7 20202000            <1>
  7416                              <1> 
  7417 000036BB 49435530313830      <1> 				DB	'ICU0180'
  7418 000036C2 536F756E6420426C61- <1> 				DB	'Sound Blaster                 ',0
  7419 000036CB 737465722020202020- <1>
  7420 000036D4 202020202020202020- <1>
  7421 000036DD 20202000            <1>
  7422 000036E1 49435530313930      <1> 				DB	'ICU0190'
  7423 000036E8 536F756E6420426C61- <1> 				DB	'Sound Blaster Pro             ',0
  7424 000036F1 737465722050726F20- <1>
  7425 000036FA 202020202020202020- <1>
  7426 00003703 20202000            <1>
  7427 00003707 49435530314130      <1> 				DB	'ICU01A0'
  7428 0000370E 536F756E6420426C61- <1> 				DB	'Sound Blaster 16ASP           ',0
  7429 00003717 737465722031364153- <1>
  7430 00003720 502020202020202020- <1>
  7431 00003729 20202000            <1>
  7432 0000372D 49435530314131      <1> 				DB	'ICU01A1'
  7433 00003734 536F756E6420426C61- <1> 				DB	'Sound Blaster 16              ',0
  7434 0000373D 737465722031362020- <1>
  7435 00003746 202020202020202020- <1>
  7436 0000374F 20202000            <1>
  7437 00003753 49435530314132      <1> 				DB	'ICU01A2'
  7438 0000375A 536F756E6420426C61- <1> 				DB	'Sound Blaster 16 SCSI-2       ',0
  7439 00003763 737465722031362053- <1>
  7440 0000376C 4353492D3220202020- <1>
  7441 00003775 20202000            <1>
  7442 00003779 49435530314133      <1> 				DB	'ICU01A3'
  7443 00003780 536F756E6420426C61- <1> 				DB	'Sound Blaster 16ASP/CD-ROM    ',0
  7444 00003789 737465722031364153- <1>
  7445 00003792 502F43442D524F4D20- <1>
  7446 0000379B 20202000            <1>
  7447                              <1> 
  7448 0000379F 4F505430303030      <1> 				DB	'OPT0000'
  7449 000037A6 4F50546920536F756E- <1> 				DB	'OPTi SoundExpression System   ',0
  7450 000037AF 644578707265737369- <1>
  7451 000037B8 6F6E2053797374656D- <1>
  7452 000037C1 20202000            <1>
  7453 000037C5 4F505430303031      <1> 				DB	'OPT0001'
  7454 000037CC 4F50546920536F756E- <1> 				DB	'OPTi SoundExpression Game Port',0
  7455 000037D5 644578707265737369- <1>
  7456 000037DE 6F6E2047616D652050- <1>
  7457 000037E7 6F727400            <1>
  7458 000037EB 4F505430303032      <1> 				DB	'OPT0002'
  7459 000037F2 4F50546920536F756E- <1> 				DB	'OPTi SoundExpression MPU-401  ',0
  7460 000037FB 644578707265737369- <1>
  7461 00003804 6F6E204D50552D3430- <1>
  7462 0000380D 31202000            <1>
  7463 00003811 4F505430303035      <1> 				DB	'OPT0005'
  7464 00003818 4F50546920536F756E- <1> 				DB	'OPTi SoundExpression Control  ',0
  7465 00003821 644578707265737369- <1>
  7466 0000382A 6F6E20436F6E74726F- <1>
  7467 00003833 6C202000            <1>
  7468 00003837 4F505430303036      <1> 				DB	'OPT0006'
  7469 0000383E 4F50546920504E5020- <1> 				DB	'OPTi PNP COM Port             ',0
  7470 00003847 434F4D20506F727420- <1>
  7471 00003850 202020202020202020- <1>
  7472 00003859 20202000            <1>
  7473 0000385D 4F505430303037      <1> 				DB	'OPT0007'
  7474 00003864 4F50546920504E5020- <1> 				DB	'OPTi PNP IDE Controller       ',0
  7475 0000386D 49444520436F6E7472- <1>
  7476 00003876 6F6C6C657220202020- <1>
  7477 0000387F 20202000            <1>
  7478 00003883 4F505430393331      <1> 				DB	'OPT0931'
  7479 0000388A 4F5054692038364339- <1> 				DB	'OPTi 86C931 Audio Card        ',0
  7480 00003893 333120417564696F20- <1>
  7481 0000389C 436172642020202020- <1>
  7482 000038A5 20202000            <1>
  7483 000038A9 4F505439333030      <1> 				DB	'OPT9300'
  7484 000038B0 4F5054692039333020- <1> 				DB	'OPTi 930 Sound/OPL3 Device    ',0
  7485 000038B9 536F756E642F4F504C- <1>
  7486 000038C2 332044657669636520- <1>
  7487 000038CB 20202000            <1>
  7488 000038CF 4F505439333031      <1> 				DB	'OPT9301'
  7489 000038D6 4F5054692039333020- <1> 				DB	'OPTi 930 MPU-401 Device       ',0
  7490 000038DF 4D50552D3430312044- <1>
  7491 000038E8 657669636520202020- <1>
  7492 000038F1 20202000            <1>
  7493 000038F5 4F505439333130      <1> 				DB	'OPT9310'
  7494 000038FC 4F50546920504E5020- <1> 				DB	'OPTi PNP Sound System         ',0
  7495 00003905 536F756E6420537973- <1>
  7496 0000390E 74656D202020202020- <1>
  7497 00003917 20202000            <1>
  7498 0000391B 58585858585858      <1> 				DB	'XXXXXXX'
  7499 00003922 556E6B6E6F776E2044- <1> 				DB	'Unknown Device                ',0
  7500 0000392B 657669636520202020- <1>
  7501 00003934 202020202020202020- <1>
  7502 0000393D 20202000            <1>
  7503                              <1> 
  7504                              <1> END_ISAPNP_DEVICES:
  7505                              <1> 
  7506                              <1> ;
  7507                              <1> ; in the future this device ID information will be in a file
  7508                              <1> ;
  7509                              <1> ; TODO: Standard ISA/EISA Specification (Non-PNP Mode)
  7510                              <1> ;
  7511                                  ;%include "shellcmds.inc"
  7512                                  %include "tss.inc"
  7513                              <1> ;Figure 7-1.  80386 32-Bit Task State Segment
  7514                              <1> ;
  7515                              <1> ;      31              23              15              7             0
  7516                              <1> ;     
  7517                              <1> ;               I/O MAP BASE          0 0 0 0 0 0 0   0 0 0 0 0 0 T64
  7518                              <1> ;     
  7519                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              LDT              60
  7520                              <1> ;     
  7521                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              GS               5C
  7522                              <1> ;     
  7523                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              FS               58
  7524                              <1> ;     
  7525                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              DS               54
  7526                              <1> ;     
  7527                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              SS               50
  7528                              <1> ;     
  7529                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              CS               4C
  7530                              <1> ;     
  7531                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              ES               48
  7532                              <1> ;     
  7533                              <1> ;                                   EDI                              44
  7534                              <1> ;     
  7535                              <1> ;                                   ESI                              40
  7536                              <1> ;     
  7537                              <1> ;                                   EBP                              3C
  7538                              <1> ;     
  7539                              <1> ;                                   ESP                              38
  7540                              <1> ;     
  7541                              <1> ;                                   EBX                              34
  7542                              <1> ;     
  7543                              <1> ;                                   EDX                              30
  7544                              <1> ;     
  7545                              <1> ;                                   ECX                              2C
  7546                              <1> ;     
  7547                              <1> ;                                   EAX                              28
  7548                              <1> ;     
  7549                              <1> ;                                 EFLAGS                             24
  7550                              <1> ;     
  7551                              <1> ;                         INSTRUCTION POINTER (EIP)                  20
  7552                              <1> ;     
  7553                              <1> ;                               CR3  (PDPR)                          1C
  7554                              <1> ;     
  7555                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              SS2              18
  7556                              <1> ;     
  7557                              <1> ;                                  ESP2                              14
  7558                              <1> ;     
  7559                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              SS1              10
  7560                              <1> ;     
  7561                              <1> ;                                  ESP1                              0C
  7562                              <1> ;     
  7563                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0              SS0              8
  7564                              <1> ;     
  7565                              <1> ;                                  ESP0                              4
  7566                              <1> ;     
  7567                              <1> ;     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0   BACK LINK TO PREVIOUS TSS   0
  7568                              <1> ;     
  7569                              <1> 
  7570                              <1> 
  7571                              <1> ;Figure 7-2.  TSS Descriptor for 32-bit TSS
  7572                              <1> ;
  7573                              <1> ;  31                23                15                7               0
  7574                              <1> ; 
  7575                              <1> ;                     A LIMIT           TYPE                    
  7576                              <1> ;    BASE 31..24   G00V         P DPL             BASE 23..16    4
  7577                              <1> ;                     L  19..16       010B1                 
  7578                              <1> ; 
  7579                              <1> ;                                                                       
  7580                              <1> ;              BASE 15..0                         LIMIT 15..0            0
  7581                              <1> ;                                                                       
  7582                              <1> ; 
  7583                              <1> 
  7584                              <1> 
  7585                              <1> ;Figure 7-3.  Task Register
  7586                              <1> ;
  7587                              <1> ;                          
  7588                              <1> ;                                                   
  7589                              <1> ;                                                   
  7590                              <1> ;                                 TASK STATE        
  7591                              <1> ;                                  SEGMENT          ^Q
  7592                              <1> ;                                                             
  7593                              <1> ;                                                             
  7594                              <1> ;                                    
  7595                              <1> ;           16-BIT VISIBLE             ^^                        
  7596                              <1> ;              REGISTER                   HIDDEN REGISTER      
  7597                              <1> ;       
  7598                              <1> ;    TR       SELECTOR            (BASE)               (LIMT)       
  7599                              <1> ;       
  7600                              <1> ;                                     ^^                     ^^
  7601                              <1> ;                                        
  7602                              <1> ;                           GLOBAL DESCRIPTOR TABLE        
  7603                              <1> ;                               
  7604                              <1> ;                         |     TSS DESCRIPTOR      |      
  7605                              <1> ;                               
  7606                              <1> ;                                                  
  7607                              <1> ;                                
  7608                              <1> ;                 ^P                        
  7609                              <1> ;                          
  7610                              <1> ;                          |                         |
  7611                              <1> ;                          
  7612                              <1> 
  7613                              <1> 
  7614                              <1> ;Figure 7-4.  Task Gate Descriptor
  7615                              <1> ;
  7616                              <1> ;   31                23               15                7             0
  7617                              <1> ;  
  7618                              <1> ;                 
  7619                              <1> ;  (NOT USED)P DPL 0 0 1 0 1(NOT USED) 4
  7620                              <1> ;                 
  7621                              <1> ;  
  7622                              <1> ;                                    
  7623                              <1> ;                SELECTOR            (NOT USED) 0
  7624                              <1> ;                                    
  7625                              <1> ;  
  7626                              <1> 
  7627                              <1> ;Figure 7-5.  Task Gate Indirectly Identifies Task
  7628                              <1> ;
  7629                              <1> ;         LOCAL DESCRIPTOR TABLE              INTERRUPT DESCRIPTOR TABLE
  7630                              <1> ;                  
  7631                              <1> ;       |                         |           |                         |
  7632                              <1> ;       |        TASK GATE        |           |        TASK GATE        |
  7633                              <1> ;                  
  7634                              <1> ;                                                              
  7635                              <1> ;                  
  7636                              <1> ;                                                            
  7637                              <1> ;                
  7638                              <1> ;      |                         |          |                         |
  7639                              <1> ;      |                         |          |                         |
  7640                              <1> ;                
  7641                              <1> ;      
  7642                              <1> ;                           GLOBAL DESCRIPTOR TABLE
  7643                              <1> ;                         
  7644                              <1> ;                         |                         |
  7645                              <1> ;                         |     TASK DESCRIPTOR     |
  7646                              <1> ;                         
  7647                              <1> ;                                               
  7648                              <1> ;                       ^P
  7649                              <1> ;                     ^P                        
  7650                              <1> ;                             
  7651                              <1> ;                           |                         |  
  7652                              <1> ;                           |                         |  
  7653                              <1> ;                             
  7654                              <1> ;                                                        
  7655                              <1> ;                             
  7656                              <1> ;                                                      
  7657                              <1> ;                                                      
  7658                              <1> ;                                                      
  7659                              <1> ;                                  TASK STATE          
  7660                              <1> ;                                    SEGMENT           
  7661                              <1> ;                                                      
  7662                              <1> ;                                                      
  7663                              <1> ;                                                      
  7664                              <1> ;                           ^Q
  7665                              <1> ;
  7666                              <1> 
  7667                              <1> ; 1.  A dynamic set that the processor updates with each switch from the
  7668                              <1> ;      task. This set includes the fields that store:
  7669                              <1> ;
  7670                              <1> ;        The general registers (EAX, ECX, EDX, EBX, ESP, EBP, ESI, EDI).
  7671                              <1> ;
  7672                              <1> ;        The segment registers (ES, CS, SS, DS, FS, GS).
  7673                              <1> ;
  7674                              <1> ;        The flags register (EFLAGS).
  7675                              <1> ;
  7676                              <1> ;        The instruction pointer (EIP).
  7677                              <1> ;
  7678                              <1> ;        The selector of the TSS of the previously executing task (updated
  7679                              <1> ;         only when a return is expected).
  7680                              <1> ;
  7681                              <1> ;  2.  A static set that the processor reads but does not change. This set
  7682                              <1> ;      includes the fields that store:
  7683                              <1> ;
  7684                              <1> ;        The selector of the task's LDT.
  7685                              <1> ;
  7686                              <1> ;        The register (PDBR) that contains the base address of the task's
  7687                              <1> ;         page directory (read only when paging is enabled).
  7688                              <1> ;
  7689                              <1> ;        Pointers to the stacks for privilege levels 0-2.
  7690                              <1> ;
  7691                              <1> ;        The T-bit (debug trap bit) which causes the processor to raise a
  7692                              <1> ;         debug exception when a task switch occurs. (Refer to Chapter 12
  7693                              <1> ;         for more information on debugging.)
  7694                              <1> ;
  7695                              <1> ;        The I/O map base (refer to Chapter 8 for more information on the
  7696                              <1> ;         use of the I/O map).
  7697                              <1> 
  7698                              <1> ;%include "video.inc"
  7699                              <1> ;%include "gdt.inc"
  7700                              <1> ;%include "util.inc"
  7701                              <1> ;%include "keyboard.inc"
  7702                              <1> ;%include "filesystem.inc"
  7703                              <1> 
  7704                              <1> ;The multitasking support is a capability provided by the Intel architecture that the system designer can
  7705                              <1> ;choose not to use. Many of the available multitasking operating systems that run on the Intel
  7706                              <1> ;architecture do not use the hardware multitasking support provided. One of the key reasons is that the
  7707                              <1> ;functionality of the hardware task switch can be completely supported using software task switching.
  7708                              <1> ;Since many of the multitasking operating systems also require additional processing when switching
  7709                              <1> ;tasks, performing the additional work is of little concern. In fact, the task switching may actually be
  7710                              <1> ;faster because of the amount of processor information that must be preserved between task switches.
  7711                              <1> ;For example, if an operating system elects not to use the local descriptor table, page unit or run with
  7712                              <1> ;multiple privilege levels, the amount of information that must be preserved when switching tasks is
  7713                              <1> ;less than what would be saved by using the hardware task-switching.
  7714                              <1> 
  7715                              <1> 
  7716                              <1> tss0:
  7717 00003941 00000000            <1> DW 		0,0		; back link
  7718 00003945 00000000            <1> DD		0		; esp0
  7719 00003949 00000000            <1> DW		0,0		; ss0, RESERVED
  7720 0000394D 00000000            <1> DD		0		; esp1
  7721 00003951 00000000            <1> DW		0,0		; ss1, RESERVED
  7722 00003955 00000000            <1> DD		0		; esp2
  7723 00003959 00000000            <1> DW		0,0		; ss2, RESERVED
  7724 0000395D 00000000            <1> DD		0		; cr3
  7725                              <1> tss0_eip:
  7726 00003961 0000000000020000    <1> DD		0,0x200		; eip, eflags
  7727 00003969 000000000000000000- <1> DD		0,0,0,0		; eax, ecx, edx, ebx
  7728 00003972 00000000000000      <1>
  7729 00003979 FFFF00000000000000- <1> DD		0x0FFFF,0,0,0	; esp, ebp, esi, edi
  7730 00003982 00000000000000      <1>
  7731 00003989 10000000            <1> DW		0x0010,0	; es, RESERVED
  7732 0000398D 08000000            <1> DW		0x0008,0	; cs, RESERVED
  7733 00003991 10000000            <1> DW		0x0010,0	; ss, RESERVED
  7734 00003995 10000000            <1> DW		0x0010,0	; ds, RESERVED
  7735 00003999 10000000            <1> DW		0x0010,0	; fs, RESERVED
  7736 0000399D 10000000            <1> DW		0x0010,0	; gs, RESERVED
  7737 000039A1 00000000            <1> DW		0,0		; ldt, RESERVED
  7738 000039A5 00000000            <1> DW		0,0		; debug, IO perm. bitmap
  7739                              <1> tss0_size	equ 	$-tss0
  7740                              <1> 
  7741                              <1> tss1:
  7742 000039A9 00000000            <1> DW 		0,0		; back link
  7743 000039AD 00000000            <1> DD		0		; esp0
  7744 000039B1 00000000            <1> DW		0,0		; ss0, RESERVED
  7745 000039B5 00000000            <1> DD		0		; esp1
  7746 000039B9 00000000            <1> DW		0,0		; ss1, RESERVED
  7747 000039BD 00000000            <1> DD		0		; esp2
  7748 000039C1 00000000            <1> DW		0,0		; ss2, RESERVED
  7749 000039C5 00000000            <1> DD		0		; cr3
  7750                              <1> tss1_eip:
  7751 000039C9 0000000000020000    <1> DD		0,0x200		; eip, eflags
  7752 000039D1 000000000000000000- <1> DD		0,0,0,0		; eax, ecx, edx, ebx
  7753 000039DA 00000000000000      <1>
  7754 000039E1 FFFF01000000000000- <1> DD		0x1FFFF,0,0,0	; esp, ebp, esi, edi
  7755 000039EA 00000000000000      <1>
  7756 000039F1 10000000            <1> DW		0x0010,0	; es, RESERVED
  7757 000039F5 08000000            <1> DW		0x0008,0	; cs, RESERVED
  7758 000039F9 10000000            <1> DW		0x0010,0	; ss, RESERVED
  7759 000039FD 10000000            <1> DW		0x0010,0	; ds, RESERVED
  7760 00003A01 10000000            <1> DW		0x0010,0	; fs, RESERVED
  7761 00003A05 10000000            <1> DW		0x0010,0	; gs, RESERVED
  7762 00003A09 00000000            <1> DW		0,0		; ldt, RESERVED
  7763 00003A0D 00000000            <1> DW		0,0		; debug, IO perm. bitmap
  7764                              <1> tss1_size	equ 	$-tss1
  7765                              <1> 
  7766                              <1> tss2:
  7767 00003A11 00000000            <1> DW 		0,0		; back link
  7768 00003A15 00000000            <1> DD		0		; esp0
  7769 00003A19 00000000            <1> DW		0,0		; ss0, RESERVED
  7770 00003A1D 00000000            <1> DD		0		; esp1
  7771 00003A21 00000000            <1> DW		0,0		; ss1, RESERVED
  7772 00003A25 00000000            <1> DD		0		; esp2
  7773 00003A29 00000000            <1> DW		0,0		; ss2, RESERVED
  7774 00003A2D 00000000            <1> DD		0		; cr3
  7775                              <1> tss2_eip:
  7776 00003A31 0000000000020000    <1> DD		0,0x200		; eip, eflags
  7777 00003A39 000000000000000000- <1> DD		0,0,0,0		; eax, ecx, edx, ebx
  7778 00003A42 00000000000000      <1>
  7779 00003A49 FFFF02000000000000- <1> DD		0x2FFFF,0,0,0	; esp, ebp, esi, edi
  7780 00003A52 00000000000000      <1>
  7781 00003A59 10000000            <1> DW		0x0010,0	; es, RESERVED
  7782 00003A5D 08000000            <1> DW		0x0008,0	; cs, RESERVED
  7783 00003A61 10000000            <1> DW		0x0010,0	; ss, RESERVED
  7784 00003A65 10000000            <1> DW		0x0010,0	; ds, RESERVED
  7785 00003A69 10000000            <1> DW		0x0010,0	; fs, RESERVED
  7786 00003A6D 10000000            <1> DW		0x0010,0	; gs, RESERVED
  7787 00003A71 00000000            <1> DW		0,0		; ldt, RESERVED
  7788 00003A75 00000000            <1> DW		0,0		; debug, IO perm. bitmap
  7789                              <1> tss2_size	equ 	$-tss2
  7790                              <1> 
  7791                              <1> tss3:
  7792 00003A79 00000000            <1> DW 		0,0		; back link
  7793 00003A7D 00000000            <1> DD		0		; esp0
  7794 00003A81 00000000            <1> DW		0,0		; ss0, RESERVED
  7795 00003A85 00000000            <1> DD		0		; esp1
  7796 00003A89 00000000            <1> DW		0,0		; ss1, RESERVED
  7797 00003A8D 00000000            <1> DD		0		; esp2
  7798 00003A91 00000000            <1> DW		0,0		; ss2, RESERVED
  7799 00003A95 00000000            <1> DD		0		; cr3
  7800                              <1> tss3_eip:
  7801 00003A99 0000000000020000    <1> DD		0,0x200		; eip, eflags
  7802 00003AA1 000000000000000000- <1> DD		0,0,0,0		; eax, ecx, edx, ebx
  7803 00003AAA 00000000000000      <1>
  7804 00003AB1 FFFF03000000000000- <1> DD		0x3FFFF,0,0,0	; esp, ebp, esi, edi
  7805 00003ABA 00000000000000      <1>
  7806 00003AC1 10000000            <1> DW		0x0010,0	; es, RESERVED
  7807 00003AC5 08000000            <1> DW		0x0008,0	; cs, RESERVED
  7808 00003AC9 10000000            <1> DW		0x0010,0	; ss, RESERVED
  7809 00003ACD 10000000            <1> DW		0x0010,0	; ds, RESERVED
  7810 00003AD1 10000000            <1> DW		0x0010,0	; fs, RESERVED
  7811 00003AD5 10000000            <1> DW		0x0010,0	; gs, RESERVED
  7812 00003AD9 00000000            <1> DW		0,0		; ldt, RESERVED
  7813 00003ADD 00000000            <1> DW		0,0		; debug, IO perm. bitmap
  7814                              <1> tss3_size	equ 	$-tss3
  7815                              <1> 
  7816                              <1> tss4:
  7817 00003AE1 00000000            <1> DW 		0,0		; back link
  7818 00003AE5 00000000            <1> DD		0		; esp0
  7819 00003AE9 00000000            <1> DW		0,0		; ss0, RESERVED
  7820 00003AED 00000000            <1> DD		0		; esp1
  7821 00003AF1 00000000            <1> DW		0,0		; ss1, RESERVED
  7822 00003AF5 00000000            <1> DD		0		; esp2
  7823 00003AF9 00000000            <1> DW		0,0		; ss2, RESERVED
  7824 00003AFD 00000000            <1> DD		0		; cr3
  7825                              <1> tss4_eip:
  7826 00003B01 0000000000020000    <1> DD		0,0x200		; eip, eflags
  7827 00003B09 000000000000000000- <1> DD		0,0,0,0		; eax, ecx, edx, ebx
  7828 00003B12 00000000000000      <1>
  7829 00003B19 FFFF04000000000000- <1> DD		0x4FFFF,0,0,0	; esp, ebp, esi, edi
  7830 00003B22 00000000000000      <1>
  7831 00003B29 10000000            <1> DW		0x0010,0	; es, RESERVED
  7832 00003B2D 08000000            <1> DW		0x0008,0	; cs, RESERVED
  7833 00003B31 10000000            <1> DW		0x0010,0	; ss, RESERVED
  7834 00003B35 10000000            <1> DW		0x0010,0	; ds, RESERVED
  7835 00003B39 10000000            <1> DW		0x0010,0	; fs, RESERVED
  7836 00003B3D 10000000            <1> DW		0x0010,0	; gs, RESERVED
  7837 00003B41 00000000            <1> DW		0,0		; ldt, RESERVED
  7838 00003B45 00000000            <1> DW		0,0		; debug, IO perm. bitmap
  7839                              <1> tss4_size	equ 	$-tss4
  7840                              <1> 
  7841 00003B49 00                  <1> tss_number	DB	0
  7842                              <1> tss_address:
  7843 00003B4A [A9390000]          <1> 		DD	tss1		
  7844 00003B4E [113A0000]          <1> 		DD	tss2
  7845 00003B52 [793A0000]          <1> 		DD	tss3
  7846 00003B56 [E13A0000]          <1> 		DD	tss4
  7847                              <1> tss_address_size:
  7848                              <1> 
  7849                              <1> init_tss:
  7850 00003B5A BF[61390000]        <1> mov edi, tss0_eip
  7851 00003B5F 26C78700000000-     <1> mov dword [es:edi], sheduler 
  7852 00003B66 [DF3B0000]          <1>
  7853 00003B6A BF[C9390000]        <1> mov edi, tss1_eip
  7854 00003B6F 26C78700000000-     <1> mov dword [es:edi], task1 
  7855 00003B76 [8B3C0000]          <1>
  7856 00003B7A BF[313A0000]        <1> mov edi, tss2_eip
  7857 00003B7F 26C78700000000-     <1> mov dword [es:edi], task2
  7858 00003B86 [BE4F0000]          <1>
  7859 00003B8A BF[993A0000]        <1> mov edi, tss3_eip
  7860 00003B8F 26C78700000000-     <1> mov dword [es:edi], task3
  7861 00003B96 [A8500000]          <1>
  7862 00003B9A BF[013B0000]        <1> mov edi, tss4_eip
  7863 00003B9F 26C78700000000-     <1> mov dword [es:edi], task4
  7864 00003BA6 [29520000]          <1>
  7865                              <1> 
  7866 00003BAA B8[41390000]        <1> mov eax, tss0
  7867 00003BAF BF[090E0000]        <1> mov edi, sys_tss
  7868 00003BB4 2666894702          <1> mov word [es:edi + 2],ax
  7869 00003BB9 C1E810              <1> shr eax,16
  7870 00003BBC 26884704            <1> mov byte [es:edi + 4],al
  7871 00003BC0 26886707            <1> mov byte [es:edi + 7],ah
  7872 00003BC4 B8[A9390000]        <1> mov eax, tss1
  7873 00003BC9 BF[110E0000]        <1> mov edi, user_tss1
  7874 00003BCE 2666894702          <1> mov word [es:edi + 2],ax
  7875 00003BD3 C1E810              <1> shr eax,16
  7876 00003BD6 26884704            <1> mov byte [es:edi + 4],al
  7877 00003BDA 26886707            <1> mov byte [es:edi + 7],ah
  7878 00003BDE CB                  <1> retf
  7879                              <1> 
  7880                              <1> ;====================================================================;
  7881                              <1> ; Sheduler Task                                                      ;
  7882                              <1> ;====================================================================;
  7883                              <1> sheduler:
  7884 00003BDF 31C0                <1> xor eax, eax
  7885 00003BE1 A0[493B0000]        <1> mov al, [tss_number]
  7886 00003BE6 BB04000000          <1> mov ebx, 4
  7887 00003BEB F7E3                <1> mul ebx
  7888 00003BED BE[4A3B0000]        <1> mov esi, tss_address
  7889 00003BF2 01C6                <1> add esi, eax
  7890 00003BF4 81FE[5A3B0000]      <1> cmp esi, tss_address_size
  7891 00003BFA 750C                <1> jne inc_task1
  7892 00003BFC BE[4A3B0000]        <1> mov esi, tss_address
  7893 00003C01 C605[493B0000]00    <1> mov byte [tss_number], 0
  7894                              <1> inc_task1:
  7895 00003C08 FE05[493B0000]      <1> inc byte [tss_number]
  7896 00003C0E 268B06              <1> mov eax, dword [es:esi]
  7897 00003C11 BF[110E0000]        <1> mov edi, user_tss1
  7898 00003C16 2666894702          <1> mov word [es:edi + 2],ax
  7899 00003C1B C1E810              <1> shr eax,16
  7900 00003C1E 26884704            <1> mov byte [es:edi + 4],al
  7901 00003C22 26C6470589          <1> mov byte [es:edi + 5], 10001001b
  7902 00003C27 26886707            <1> mov byte [es:edi + 7],ah
  7903                              <1> ;;; Show task number on screen
  7904                              <1> VIDEO_TEXTMODE_write_mensage            0x01,0x01,0x08,tasks_string
  7905                              <2> 
  7906                              <2> 
  7907                              <2> 
  7908                              <2> 
  7909                              <2> 
  7910                              <2> 
  7911                              <2> 
  7912                              <2> 
  7913                              <2> 
  7914 00003C2B BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  7915                              <2> 
  7916 00003C30 B8A0000000          <2> mov eax, 160
  7917 00003C35 BB01000000          <2> mov ebx, %1
  7918 00003C3A F7E3                <2> mul ebx
  7919 00003C3C 01C7                <2> add edi, eax
  7920                              <2> 
  7921 00003C3E BE[85540000]        <2> mov esi, %4
  7922 00003C43 B408                <2> mov ah, %3
  7923                              <2> %%next_char:
  7924 00003C45 268A06              <2> mov al, byte [es:esi]
  7925 00003C48 26668907            <2> mov word [es:edi], ax
  7926 00003C4C 47<rept>            <2> times 2 inc edi
  7927 00003C4E 46                  <2> inc esi
  7928 00003C4F 26803E00            <2> cmp byte [es:esi], 0x00
  7929 00003C53 75F0                <2> jne %%next_char
  7930 00003C55 BFAE800B00          <1> mov edi, 0x000B8000 + 160*0x01 + 2*7
  7931 00003C5A B804000000          <1> mov eax, 4
  7932 00003C5F 31DB                <1> xor ebx, ebx
  7933 00003C61 8A1D[493B0000]      <1> mov bl, byte [tss_number] 
  7934 00003C67 F7E3                <1> mul ebx
  7935 00003C69 01C7                <1> add edi, eax
  7936 00003C6B B030                <1> mov al, 48
  7937 00003C6D 0205[493B0000]      <1> add al, byte [tss_number]
  7938 00003C73 B40E                <1> mov ah, 14
  7939 00003C75 26668907            <1> mov word [es:edi], ax
  7940                              <1> ;;; JUMP
  7941 00003C79 EA000000004800      <1> jmp user_tss1-gdt:0	; jump to task, this will enable interrupts
  7942                              <1> ;;; For DELAYS with PIT
  7943                              <1> ;;; add dword [TIMER_PIT_TICKS], 65536
  7944 00003C80 B020                <1> mov al, 0x20
  7945 00003C82 E620                <1> out 0x20, al
  7946 00003C84 EA[DF3B0000]0800    <1> jmp dword 0x0008:sheduler
  7947                              <1> 
  7948                              <1> 
  7949                              <1> ;========================================================================;
  7950                              <1> ;                                  TASKS                                 ;
  7951                              <1> ;========================================================================;
  7952                              <1> task1:
  7953                              <1> ;;; SHELL
  7954                              <1> FILESYSTEM_goto_root
  7955                              <1> VIDEO_TEXTMODE_set_line		     0x03
  7956 00003C8B B003                <2> mov al, %1
  7957 00003C8D A2[A80C0000]        <2> mov [VIDEO_TEXTMODE_LINE], al
  7958                              <1> next_command:
  7959                              <1> clean_str	command_string 
  7960 00003C92 BF[99540000]        <2> mov edi, %1
  7961 00003C97 B020                <2> mov al, 32
  7962                              <2> %%next_clean:
  7963 00003C99 268807              <2> mov byte [es:edi], al
  7964 00003C9C 47                  <2> inc edi
  7965 00003C9D 26803F00            <2> cmp byte [es:edi], 0
  7966 00003CA1 75F6                <2> jne %%next_clean
  7967 00003CA3 B8[99540000]        <1> mov eax, command_string
  7968 00003CA8 A3[C6540000]        <1> mov [command_position], eax
  7969                              <1> VIDEO_TEXTMODE_print_line            0x01,0x03,shell_string
  7970                              <2> 
  7971 00003CAD FE05[A80C0000]      <2> inc byte [VIDEO_TEXTMODE_LINE]
  7972 00003CB3 803D[A80C0000]18    <2> cmp byte [VIDEO_TEXTMODE_LINE], 24
  7973 00003CBA 7C14                <2> jl %%skip_window_up
  7974 00003CBC C605[A90C0000]04    <2> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  7975 00003CC3 9A[04070000]0800    <2> call dword 0x0008:VIDEO_TEXTMODE_window_up
  7976 00003CCA FE0D[A80C0000]      <2> dec byte [VIDEO_TEXTMODE_LINE]
  7977                              <2> %%skip_window_up:
  7978                              <2> 
  7979 00003CD0 BF02800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  7980 00003CD5 B8A0000000          <2> mov eax, 160
  7981 00003CDA 31DB                <2> xor ebx, ebx
  7982 00003CDC 8A1D[A80C0000]      <2> mov bl, [VIDEO_TEXTMODE_LINE]
  7983 00003CE2 F7E3                <2> mul ebx
  7984 00003CE4 01C7                <2> add edi, eax
  7985                              <2> 
  7986 00003CE6 BE[AA530000]        <2> mov esi, %3
  7987 00003CEB B403                <2> mov ah, %2
  7988                              <2> %%next_char1:
  7989 00003CED 268A06              <2> mov al, byte [es:esi]
  7990 00003CF0 26668907            <2> mov word [es:edi], ax
  7991 00003CF4 47<rept>            <2> times 2 inc edi
  7992 00003CF6 46                  <2> inc esi
  7993 00003CF7 26803E00            <2> cmp byte [es:esi], 0x00
  7994 00003CFB 75F0                <2> jne %%next_char1
  7995 00003CFD BF2A800B00          <1> mov edi, 0x000B8000 + 2*21
  7996                              <1> 
  7997 00003D02 B8A0000000          <1> mov eax, 160
  7998 00003D07 31DB                <1> xor ebx, ebx
  7999 00003D09 8A1D[A80C0000]      <1> mov bl, [VIDEO_TEXTMODE_LINE]
  8000 00003D0F F7E3                <1> mul ebx 
  8001 00003D11 01C7                <1> add edi, eax
  8002                              <1> 
  8003 00003D13 893D[49540000]      <1> mov dword [command_input_position], edi
  8004 00003D19 C605[4F540000]07    <1> mov byte [color], 0x07
  8005                              <1> next_ascii:
  8006 00003D20 B05F                <1> mov al, 95
  8007 00003D22 B487                <1> mov ah, 135
  8008 00003D24 26668907            <1> mov word [es:edi], ax
  8009                              <1> KEYBOARD_get_key      	key 
  8010                              <2> %%get_again:
  8011 00003D28 6631C0              <2> xor ax, ax
  8012 00003D2B A0[AE0C0000]        <2> mov al, [KEYBOARD_KEY]
  8013 00003D30 663D8000            <2> cmp ax, KEYBOARD_RELEASE_KEY
  8014 00003D34 7DF2                <2> jge %%get_again
  8015 00003D36 A2[4D540000]        <2> mov byte [%1], al
  8016 00003D3B B080                <2> mov al, KEYBOARD_RELEASE_KEY
  8017 00003D3D A2[AE0C0000]        <2> mov [KEYBOARD_KEY], al
  8018 00003D42 3B3D[49540000]      <1> cmp edi, dword [command_input_position] 
  8019 00003D48 741D                <1> je skip_backspace1
  8020 00003D4A 803D[4D540000]0E    <1> cmp byte [key], KEYBOARD_BACKSPACE_KEY 
  8021 00003D51 7514                <1> jne skip_backspace1
  8022 00003D53 66B80000            <1> mov ax, 0
  8023 00003D57 26668907            <1> mov word [es:edi], ax
  8024 00003D5B 81EF02000000        <1> sub edi, 2
  8025 00003D61 FF0D[C6540000]      <1> dec dword [command_position]
  8026                              <1> skip_backspace1:
  8027 00003D67 A0[4D540000]        <1> mov al, [key] 
  8028 00003D6C A2[4E540000]        <1> mov [ascii], al
  8029                              <1> KEYBOARD_map		ascii
  8030 00003D71 BE[AF0C0000]        <2> mov esi, pt_keys
  8031 00003D76 8A1D[4E540000]      <2> mov bl, [%1]
  8032                              <2> %%try_key:
  8033 00003D7C 46                  <2> inc esi
  8034 00003D7D 3E8A06              <2> mov al, byte [ds:esi]
  8035 00003D80 81C602000000        <2> add esi, 2
  8036 00003D86 38D8                <2> cmp al, bl
  8037 00003D88 7408                <2> je %%skip_keys
  8038 00003D8A 81FE[C30D0000]      <2> cmp esi, end_pt_keys
  8039 00003D90 75EA                <2> jne %%try_key
  8040                              <2> %%skip_keys:
  8041 00003D92 81EE01000000        <2> sub esi, 1
  8042 00003D98 3E8A06              <2> mov al, byte [ds:esi]
  8043 00003D9B A2[4E540000]        <2> mov byte [%1], al
  8044 00003DA0 A0[4E540000]        <1> mov al, [ascii]
  8045 00003DA5 8A25[4F540000]      <1> mov ah, [color]
  8046                              <1> 
  8047 00003DAB 8B35[C6540000]      <1> mov esi, [command_position]
  8048 00003DB1 268806              <1> mov byte [es:esi], al
  8049                              <1> 
  8050 00003DB4 26668907            <1> mov word [es:edi], ax
  8051 00003DB8 803D[4D540000]0E    <1> cmp byte [key], KEYBOARD_BACKSPACE_KEY 
  8052 00003DBF 740C                <1> je skip_backspace2
  8053 00003DC1 81C702000000        <1> add edi, 2
  8054 00003DC7 FF05[C6540000]      <1> inc dword [command_position]
  8055                              <1> skip_backspace2:
  8056 00003DCD 803D[4D540000]1C    <1> cmp byte [key], KEYBOARD_ENTER_KEY 
  8057 00003DD4 0F8546FFFFFF        <1> jne near next_ascii
  8058                              <1> 
  8059                              <1> 
  8060                              <1> %include "shellcmds.inc"
  8061                              <2> 
  8062 00003DDA 8B35[C6540000]      <2> mov esi, [command_position]
  8063 00003DE0 26C60600            <2> mov byte [es:esi], 0
  8064                              <2> ;VIDEO_TEXTMODE_write_mensage            0x03, 0x01, 0x0F, command_string
  8065                              <2> ; "help"
  8066                              <2> cmp_str command_string, COMMAND_HELP_STRING, [COMMAND_TEMP_VALUE]
  8067                              <3> 
  8068                              <3> 
  8069                              <3> 
  8070 00003DE4 C705[BE530000]0000- <3> mov dword %3, 0
  8071 00003DEC 0000                <3>
  8072 00003DEE BF[99540000]        <3> mov edi, %1
  8073 00003DF3 BE[F4530000]        <3> mov esi, %2
  8074                              <3> %%next_cmp:
  8075 00003DF8 3E8A07              <3> mov al, byte [ds:edi]
  8076 00003DFB 268A1E              <3> mov bl, byte [es:esi]
  8077 00003DFE 38D8                <3> cmp al, bl
  8078 00003E00 7510                <3> jne %%no_string
  8079 00003E02 47                  <3> inc edi
  8080 00003E03 46                  <3> inc esi
  8081 00003E04 3C00                <3> cmp al, 0
  8082 00003E06 75F0                <3> jne %%next_cmp
  8083 00003E08 C705[BE530000]0100- <3> mov dword %3, 1
  8084 00003E10 0000                <3>
  8085                              <3> %%no_string
  8086 00003E12 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8087 00003E1A 0000                <2>
  8088 00003E1C 750C                <2> jne skip_help
  8089 00003E1E 9A[66420000]0800    <2> call dword 0x0008:help_info
  8090 00003E25 E968FEFFFF          <2> jmp near next_command
  8091                              <2> skip_help:
  8092                              <2> ; "coders"
  8093                              <2> cmp_str command_string, COMMAND_CODERS_STRING, [COMMAND_TEMP_VALUE]
  8094                              <3> 
  8095                              <3> 
  8096                              <3> 
  8097 00003E2A C705[BE530000]0000- <3> mov dword %3, 0
  8098 00003E32 0000                <3>
  8099 00003E34 BF[99540000]        <3> mov edi, %1
  8100 00003E39 BE[ED530000]        <3> mov esi, %2
  8101                              <3> %%next_cmp:
  8102 00003E3E 3E8A07              <3> mov al, byte [ds:edi]
  8103 00003E41 268A1E              <3> mov bl, byte [es:esi]
  8104 00003E44 38D8                <3> cmp al, bl
  8105 00003E46 7510                <3> jne %%no_string
  8106 00003E48 47                  <3> inc edi
  8107 00003E49 46                  <3> inc esi
  8108 00003E4A 3C00                <3> cmp al, 0
  8109 00003E4C 75F0                <3> jne %%next_cmp
  8110 00003E4E C705[BE530000]0100- <3> mov dword %3, 1
  8111 00003E56 0000                <3>
  8112                              <3> %%no_string
  8113 00003E58 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8114 00003E60 0000                <2>
  8115 00003E62 750C                <2> jne skip_coders
  8116 00003E64 9A[E7440000]0800    <2> call dword 0x0008:coders_info
  8117 00003E6B E922FEFFFF          <2> jmp near next_command
  8118                              <2> skip_coders:
  8119                              <2> ; "quit"
  8120                              <2> cmp_str command_string, COMMAND_REBOOT_STRING, [COMMAND_TEMP_VALUE]
  8121                              <3> 
  8122                              <3> 
  8123                              <3> 
  8124 00003E70 C705[BE530000]0000- <3> mov dword %3, 0
  8125 00003E78 0000                <3>
  8126 00003E7A BF[99540000]        <3> mov edi, %1
  8127 00003E7F BE[E6530000]        <3> mov esi, %2
  8128                              <3> %%next_cmp:
  8129 00003E84 3E8A07              <3> mov al, byte [ds:edi]
  8130 00003E87 268A1E              <3> mov bl, byte [es:esi]
  8131 00003E8A 38D8                <3> cmp al, bl
  8132 00003E8C 7510                <3> jne %%no_string
  8133 00003E8E 47                  <3> inc edi
  8134 00003E8F 46                  <3> inc esi
  8135 00003E90 3C00                <3> cmp al, 0
  8136 00003E92 75F0                <3> jne %%next_cmp
  8137 00003E94 C705[BE530000]0100- <3> mov dword %3, 1
  8138 00003E9C 0000                <3>
  8139                              <3> %%no_string
  8140 00003E9E 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8141 00003EA6 0000                <2>
  8142 00003EA8 750C                <2> jne skip_reboot
  8143 00003EAA 9A[AF400000]0800    <2> call dword 0x0008:reboot
  8144 00003EB1 E9DCFDFFFF          <2> jmp near next_command
  8145                              <2> skip_reboot:
  8146                              <2> ; "dir"
  8147                              <2> ;cmp_str command_string, COMMAND_DIR_STRING, [COMMAND_TEMP_VALUE]
  8148                              <2> ;cmp dword [COMMAND_TEMP_VALUE], 1
  8149                              <2> ;jne skip_dir_info
  8150                              <2> ;call dword 0x0008:dir_info
  8151                              <2> ;jmp near next_command
  8152                              <2> skip_dir_info:
  8153                              <2> ; "cd <directory>"
  8154                              <2> ; "cpu"
  8155                              <2> cmp_str command_string, COMMAND_CPU_STRING, [COMMAND_TEMP_VALUE]
  8156                              <3> 
  8157                              <3> 
  8158                              <3> 
  8159 00003EB6 C705[BE530000]0000- <3> mov dword %3, 0
  8160 00003EBE 0000                <3>
  8161 00003EC0 BF[99540000]        <3> mov edi, %1
  8162 00003EC5 BE[C6530000]        <3> mov esi, %2
  8163                              <3> %%next_cmp:
  8164 00003ECA 3E8A07              <3> mov al, byte [ds:edi]
  8165 00003ECD 268A1E              <3> mov bl, byte [es:esi]
  8166 00003ED0 38D8                <3> cmp al, bl
  8167 00003ED2 7510                <3> jne %%no_string
  8168 00003ED4 47                  <3> inc edi
  8169 00003ED5 46                  <3> inc esi
  8170 00003ED6 3C00                <3> cmp al, 0
  8171 00003ED8 75F0                <3> jne %%next_cmp
  8172 00003EDA C705[BE530000]0100- <3> mov dword %3, 1
  8173 00003EE2 0000                <3>
  8174                              <3> %%no_string
  8175 00003EE4 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8176 00003EEC 0000                <2>
  8177 00003EEE 750C                <2> jne skip_cpu_info
  8178 00003EF0 9A[E8440000]0800    <2> call dword 0x0008:cpu_info
  8179 00003EF7 E996FDFFFF          <2> jmp near next_command
  8180                              <2> skip_cpu_info:
  8181                              <2> ; "ram"
  8182                              <2> cmp_str command_string, COMMAND_RAM_STRING, [COMMAND_TEMP_VALUE]
  8183                              <3> 
  8184                              <3> 
  8185                              <3> 
  8186 00003EFC C705[BE530000]0000- <3> mov dword %3, 0
  8187 00003F04 0000                <3>
  8188 00003F06 BF[99540000]        <3> mov edi, %1
  8189 00003F0B BE[CA530000]        <3> mov esi, %2
  8190                              <3> %%next_cmp:
  8191 00003F10 3E8A07              <3> mov al, byte [ds:edi]
  8192 00003F13 268A1E              <3> mov bl, byte [es:esi]
  8193 00003F16 38D8                <3> cmp al, bl
  8194 00003F18 7510                <3> jne %%no_string
  8195 00003F1A 47                  <3> inc edi
  8196 00003F1B 46                  <3> inc esi
  8197 00003F1C 3C00                <3> cmp al, 0
  8198 00003F1E 75F0                <3> jne %%next_cmp
  8199 00003F20 C705[BE530000]0100- <3> mov dword %3, 1
  8200 00003F28 0000                <3>
  8201                              <3> %%no_string
  8202 00003F2A 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8203 00003F32 0000                <2>
  8204 00003F34 750C                <2> jne skip_ram_info
  8205 00003F36 9A[4B480000]0800    <2> call dword 0x0008:ram_info
  8206 00003F3D E950FDFFFF          <2> jmp near next_command
  8207                              <2> skip_ram_info:
  8208                              <2> ; "pci"
  8209                              <2> cmp_str command_string, COMMAND_PCI_STRING, [COMMAND_TEMP_VALUE]
  8210                              <3> 
  8211                              <3> 
  8212                              <3> 
  8213 00003F42 C705[BE530000]0000- <3> mov dword %3, 0
  8214 00003F4A 0000                <3>
  8215 00003F4C BF[99540000]        <3> mov edi, %1
  8216 00003F51 BE[CE530000]        <3> mov esi, %2
  8217                              <3> %%next_cmp:
  8218 00003F56 3E8A07              <3> mov al, byte [ds:edi]
  8219 00003F59 268A1E              <3> mov bl, byte [es:esi]
  8220 00003F5C 38D8                <3> cmp al, bl
  8221 00003F5E 7510                <3> jne %%no_string
  8222 00003F60 47                  <3> inc edi
  8223 00003F61 46                  <3> inc esi
  8224 00003F62 3C00                <3> cmp al, 0
  8225 00003F64 75F0                <3> jne %%next_cmp
  8226 00003F66 C705[BE530000]0100- <3> mov dword %3, 1
  8227 00003F6E 0000                <3>
  8228                              <3> %%no_string
  8229 00003F70 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8230 00003F78 0000                <2>
  8231 00003F7A 750C                <2> jne skip_pci_info
  8232 00003F7C 9A[29490000]0800    <2> call dword 0x0008:pci_info
  8233 00003F83 E90AFDFFFF          <2> jmp near next_command
  8234                              <2> skip_pci_info:
  8235                              <2> ; "isapnp"
  8236                              <2> cmp_str command_string, COMMAND_ISAPNP_STRING, [COMMAND_TEMP_VALUE]
  8237                              <3> 
  8238                              <3> 
  8239                              <3> 
  8240 00003F88 C705[BE530000]0000- <3> mov dword %3, 0
  8241 00003F90 0000                <3>
  8242 00003F92 BF[99540000]        <3> mov edi, %1
  8243 00003F97 BE[DF530000]        <3> mov esi, %2
  8244                              <3> %%next_cmp:
  8245 00003F9C 3E8A07              <3> mov al, byte [ds:edi]
  8246 00003F9F 268A1E              <3> mov bl, byte [es:esi]
  8247 00003FA2 38D8                <3> cmp al, bl
  8248 00003FA4 7510                <3> jne %%no_string
  8249 00003FA6 47                  <3> inc edi
  8250 00003FA7 46                  <3> inc esi
  8251 00003FA8 3C00                <3> cmp al, 0
  8252 00003FAA 75F0                <3> jne %%next_cmp
  8253 00003FAC C705[BE530000]0100- <3> mov dword %3, 1
  8254 00003FB4 0000                <3>
  8255                              <3> %%no_string
  8256 00003FB6 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8257 00003FBE 0000                <2>
  8258 00003FC0 750C                <2> jne skip_isapnp_info
  8259 00003FC2 9A[534C0000]0800    <2> call dword 0x0008:isapnp_info
  8260 00003FC9 E9C4FCFFFF          <2> jmp near next_command
  8261                              <2> skip_isapnp_info:
  8262                              <2> ; "biospnp"
  8263                              <2> cmp_str command_string, COMMAND_BIOSPNP_STRING, [COMMAND_TEMP_VALUE]
  8264                              <3> 
  8265                              <3> 
  8266                              <3> 
  8267 00003FCE C705[BE530000]0000- <3> mov dword %3, 0
  8268 00003FD6 0000                <3>
  8269 00003FD8 BF[99540000]        <3> mov edi, %1
  8270 00003FDD BE[D2530000]        <3> mov esi, %2
  8271                              <3> %%next_cmp:
  8272 00003FE2 3E8A07              <3> mov al, byte [ds:edi]
  8273 00003FE5 268A1E              <3> mov bl, byte [es:esi]
  8274 00003FE8 38D8                <3> cmp al, bl
  8275 00003FEA 7510                <3> jne %%no_string
  8276 00003FEC 47                  <3> inc edi
  8277 00003FED 46                  <3> inc esi
  8278 00003FEE 3C00                <3> cmp al, 0
  8279 00003FF0 75F0                <3> jne %%next_cmp
  8280 00003FF2 C705[BE530000]0100- <3> mov dword %3, 1
  8281 00003FFA 0000                <3>
  8282                              <3> %%no_string
  8283 00003FFC 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8284 00004004 0000                <2>
  8285 00004006 750C                <2> jne skip_biospnp_info
  8286 00004008 9A[D74D0000]0800    <2> call dword 0x0008:biospnp_info
  8287 0000400F E97EFCFFFF          <2> jmp near next_command
  8288                              <2> skip_biospnp_info:
  8289                              <2> ; "vesa"
  8290                              <2> cmp_str command_string, COMMAND_VESA_STRING, [COMMAND_TEMP_VALUE]
  8291                              <3> 
  8292                              <3> 
  8293                              <3> 
  8294 00004014 C705[BE530000]0000- <3> mov dword %3, 0
  8295 0000401C 0000                <3>
  8296 0000401E BF[99540000]        <3> mov edi, %1
  8297 00004023 BE[DA530000]        <3> mov esi, %2
  8298                              <3> %%next_cmp:
  8299 00004028 3E8A07              <3> mov al, byte [ds:edi]
  8300 0000402B 268A1E              <3> mov bl, byte [es:esi]
  8301 0000402E 38D8                <3> cmp al, bl
  8302 00004030 7510                <3> jne %%no_string
  8303 00004032 47                  <3> inc edi
  8304 00004033 46                  <3> inc esi
  8305 00004034 3C00                <3> cmp al, 0
  8306 00004036 75F0                <3> jne %%next_cmp
  8307 00004038 C705[BE530000]0100- <3> mov dword %3, 1
  8308 00004040 0000                <3>
  8309                              <3> %%no_string
  8310 00004042 813D[BE530000]0100- <2> cmp dword [COMMAND_TEMP_VALUE], 1
  8311 0000404A 0000                <2>
  8312 0000404C 750C                <2> jne skip_vesa_info
  8313 0000404E 9A[CA4E0000]0800    <2> call dword 0x0008:vesa_info
  8314 00004055 E938FCFFFF          <2> jmp near next_command
  8315                              <2> skip_vesa_info:
  8316                              <2> ; "UNKNOWN COMMAND"
  8317                              <2> VIDEO_TEXTMODE_print_line		0x01,0x07, command_error_msg
  8318                              <3> 
  8319 0000405A FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8320 00004060 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8321 00004067 7C14                <3> jl %%skip_window_up
  8322 00004069 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8323 00004070 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8324 00004077 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8325                              <3> %%skip_window_up:
  8326                              <3> 
  8327 0000407D BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8328 00004082 B8A0000000          <3> mov eax, 160
  8329 00004087 31DB                <3> xor ebx, ebx
  8330 00004089 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8331 0000408F F7E3                <3> mul ebx
  8332 00004091 01C7                <3> add edi, eax
  8333                              <3> 
  8334 00004093 BE[CA540000]        <3> mov esi, %3
  8335 00004098 B407                <3> mov ah, %2
  8336                              <3> %%next_char1:
  8337 0000409A 268A06              <3> mov al, byte [es:esi]
  8338 0000409D 26668907            <3> mov word [es:edi], ax
  8339 000040A1 47<rept>            <3> times 2 inc edi
  8340 000040A3 46                  <3> inc esi
  8341 000040A4 26803E00            <3> cmp byte [es:esi], 0x00
  8342 000040A8 75F0                <3> jne %%next_char1
  8343 000040AA E9E3FBFFFF          <2> jmp near next_command
  8344                              <2> 
  8345                              <2> 
  8346                              <2> ;=========================================================================;
  8347                              <2> ;                             SHELL COMMANDS                              ;
  8348                              <2> ;=========================================================================;
  8349                              <2> reboot:
  8350                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,reboot_msg
  8351                              <3> 
  8352 000040AF FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8353 000040B5 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8354 000040BC 7C14                <3> jl %%skip_window_up
  8355 000040BE C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8356 000040C5 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8357 000040CC FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8358                              <3> %%skip_window_up:
  8359                              <3> 
  8360 000040D2 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8361 000040D7 B8A0000000          <3> mov eax, 160
  8362 000040DC 31DB                <3> xor ebx, ebx
  8363 000040DE 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8364 000040E4 F7E3                <3> mul ebx
  8365 000040E6 01C7                <3> add edi, eax
  8366                              <3> 
  8367 000040E8 BE[2F550000]        <3> mov esi, %3
  8368 000040ED B407                <3> mov ah, %2
  8369                              <3> %%next_char1:
  8370 000040EF 268A06              <3> mov al, byte [es:esi]
  8371 000040F2 26668907            <3> mov word [es:edi], ax
  8372 000040F6 47<rept>            <3> times 2 inc edi
  8373 000040F8 46                  <3> inc esi
  8374 000040F9 26803E00            <3> cmp byte [es:esi], 0x00
  8375 000040FD 75F0                <3> jne %%next_char1
  8376 000040FF 31C0                <2> xor eax, eax
  8377 00004101 A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  8378 00004106 A3[10590000]        <2> mov [dword_number], eax
  8379                              <2> VIDEO_TEXTMODE_write_mensage		[dword_number], 23, 0x07, reboot_time
  8380                              <3> 
  8381                              <3> 
  8382                              <3> 
  8383                              <3> 
  8384                              <3> 
  8385                              <3> 
  8386                              <3> 
  8387                              <3> 
  8388                              <3> 
  8389 0000410B BF2E800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  8390                              <3> 
  8391 00004110 B8A0000000          <3> mov eax, 160
  8392 00004115 8B1D[10590000]      <3> mov ebx, %1
  8393 0000411B F7E3                <3> mul ebx
  8394 0000411D 01C7                <3> add edi, eax
  8395                              <3> 
  8396 0000411F BE[46550000]        <3> mov esi, %4
  8397 00004124 B407                <3> mov ah, %3
  8398                              <3> %%next_char:
  8399 00004126 268A06              <3> mov al, byte [es:esi]
  8400 00004129 26668907            <3> mov word [es:edi], ax
  8401 0000412D 47<rept>            <3> times 2 inc edi
  8402 0000412F 46                  <3> inc esi
  8403 00004130 26803E00            <3> cmp byte [es:esi], 0x00
  8404 00004134 75F0                <3> jne %%next_char
  8405                              <2> TIMER_rtc_msdelay        1000
  8406 00004136 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8407 0000413B 31DB                <3> xor ebx, ebx
  8408 0000413D BBE8030000          <3> mov ebx, %1
  8409 00004142 01D8                <3> add eax, ebx
  8410 00004144 93                  <3> xchg eax, ebx
  8411                              <3> 
  8412                              <3> 
  8413                              <3> 
  8414                              <3> %%check_rtc:
  8415 00004145 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8416 0000414A 39D8                <3> cmp eax, ebx
  8417 0000414C 7CF7                <3> jl %%check_rtc
  8418                              <3> 
  8419                              <2> VIDEO_TEXTMODE_write_mensage		[dword_number], 24, 0x07, reboot_time
  8420                              <3> 
  8421                              <3> 
  8422                              <3> 
  8423                              <3> 
  8424                              <3> 
  8425                              <3> 
  8426                              <3> 
  8427                              <3> 
  8428                              <3> 
  8429 0000414E BF30800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  8430                              <3> 
  8431 00004153 B8A0000000          <3> mov eax, 160
  8432 00004158 8B1D[10590000]      <3> mov ebx, %1
  8433 0000415E F7E3                <3> mul ebx
  8434 00004160 01C7                <3> add edi, eax
  8435                              <3> 
  8436 00004162 BE[46550000]        <3> mov esi, %4
  8437 00004167 B407                <3> mov ah, %3
  8438                              <3> %%next_char:
  8439 00004169 268A06              <3> mov al, byte [es:esi]
  8440 0000416C 26668907            <3> mov word [es:edi], ax
  8441 00004170 47<rept>            <3> times 2 inc edi
  8442 00004172 46                  <3> inc esi
  8443 00004173 26803E00            <3> cmp byte [es:esi], 0x00
  8444 00004177 75F0                <3> jne %%next_char
  8445                              <2> TIMER_rtc_msdelay        1000
  8446 00004179 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8447 0000417E 31DB                <3> xor ebx, ebx
  8448 00004180 BBE8030000          <3> mov ebx, %1
  8449 00004185 01D8                <3> add eax, ebx
  8450 00004187 93                  <3> xchg eax, ebx
  8451                              <3> 
  8452                              <3> 
  8453                              <3> 
  8454                              <3> %%check_rtc:
  8455 00004188 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8456 0000418D 39D8                <3> cmp eax, ebx
  8457 0000418F 7CF7                <3> jl %%check_rtc
  8458                              <3> 
  8459                              <2> VIDEO_TEXTMODE_write_mensage		[dword_number], 25, 0x07, reboot_time
  8460                              <3> 
  8461                              <3> 
  8462                              <3> 
  8463                              <3> 
  8464                              <3> 
  8465                              <3> 
  8466                              <3> 
  8467                              <3> 
  8468                              <3> 
  8469 00004191 BF32800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  8470                              <3> 
  8471 00004196 B8A0000000          <3> mov eax, 160
  8472 0000419B 8B1D[10590000]      <3> mov ebx, %1
  8473 000041A1 F7E3                <3> mul ebx
  8474 000041A3 01C7                <3> add edi, eax
  8475                              <3> 
  8476 000041A5 BE[46550000]        <3> mov esi, %4
  8477 000041AA B407                <3> mov ah, %3
  8478                              <3> %%next_char:
  8479 000041AC 268A06              <3> mov al, byte [es:esi]
  8480 000041AF 26668907            <3> mov word [es:edi], ax
  8481 000041B3 47<rept>            <3> times 2 inc edi
  8482 000041B5 46                  <3> inc esi
  8483 000041B6 26803E00            <3> cmp byte [es:esi], 0x00
  8484 000041BA 75F0                <3> jne %%next_char
  8485                              <2> TIMER_rtc_msdelay        1000
  8486 000041BC A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8487 000041C1 31DB                <3> xor ebx, ebx
  8488 000041C3 BBE8030000          <3> mov ebx, %1
  8489 000041C8 01D8                <3> add eax, ebx
  8490 000041CA 93                  <3> xchg eax, ebx
  8491                              <3> 
  8492                              <3> 
  8493                              <3> 
  8494                              <3> %%check_rtc:
  8495 000041CB A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8496 000041D0 39D8                <3> cmp eax, ebx
  8497 000041D2 7CF7                <3> jl %%check_rtc
  8498                              <3> 
  8499                              <2> VIDEO_TEXTMODE_write_mensage		[dword_number], 26, 0x07, reboot_time
  8500                              <3> 
  8501                              <3> 
  8502                              <3> 
  8503                              <3> 
  8504                              <3> 
  8505                              <3> 
  8506                              <3> 
  8507                              <3> 
  8508                              <3> 
  8509 000041D4 BF34800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  8510                              <3> 
  8511 000041D9 B8A0000000          <3> mov eax, 160
  8512 000041DE 8B1D[10590000]      <3> mov ebx, %1
  8513 000041E4 F7E3                <3> mul ebx
  8514 000041E6 01C7                <3> add edi, eax
  8515                              <3> 
  8516 000041E8 BE[46550000]        <3> mov esi, %4
  8517 000041ED B407                <3> mov ah, %3
  8518                              <3> %%next_char:
  8519 000041EF 268A06              <3> mov al, byte [es:esi]
  8520 000041F2 26668907            <3> mov word [es:edi], ax
  8521 000041F6 47<rept>            <3> times 2 inc edi
  8522 000041F8 46                  <3> inc esi
  8523 000041F9 26803E00            <3> cmp byte [es:esi], 0x00
  8524 000041FD 75F0                <3> jne %%next_char
  8525                              <2> TIMER_rtc_msdelay        1000
  8526 000041FF A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8527 00004204 31DB                <3> xor ebx, ebx
  8528 00004206 BBE8030000          <3> mov ebx, %1
  8529 0000420B 01D8                <3> add eax, ebx
  8530 0000420D 93                  <3> xchg eax, ebx
  8531                              <3> 
  8532                              <3> 
  8533                              <3> 
  8534                              <3> %%check_rtc:
  8535 0000420E A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8536 00004213 39D8                <3> cmp eax, ebx
  8537 00004215 7CF7                <3> jl %%check_rtc
  8538                              <3> 
  8539                              <2> VIDEO_TEXTMODE_write_mensage		[dword_number], 27, 0x07, reboot_time
  8540                              <3> 
  8541                              <3> 
  8542                              <3> 
  8543                              <3> 
  8544                              <3> 
  8545                              <3> 
  8546                              <3> 
  8547                              <3> 
  8548                              <3> 
  8549 00004217 BF36800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  8550                              <3> 
  8551 0000421C B8A0000000          <3> mov eax, 160
  8552 00004221 8B1D[10590000]      <3> mov ebx, %1
  8553 00004227 F7E3                <3> mul ebx
  8554 00004229 01C7                <3> add edi, eax
  8555                              <3> 
  8556 0000422B BE[46550000]        <3> mov esi, %4
  8557 00004230 B407                <3> mov ah, %3
  8558                              <3> %%next_char:
  8559 00004232 268A06              <3> mov al, byte [es:esi]
  8560 00004235 26668907            <3> mov word [es:edi], ax
  8561 00004239 47<rept>            <3> times 2 inc edi
  8562 0000423B 46                  <3> inc esi
  8563 0000423C 26803E00            <3> cmp byte [es:esi], 0x00
  8564 00004240 75F0                <3> jne %%next_char
  8565                              <2> TIMER_rtc_msdelay        1000
  8566 00004242 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8567 00004247 31DB                <3> xor ebx, ebx
  8568 00004249 BBE8030000          <3> mov ebx, %1
  8569 0000424E 01D8                <3> add eax, ebx
  8570 00004250 93                  <3> xchg eax, ebx
  8571                              <3> 
  8572                              <3> 
  8573                              <3> 
  8574                              <3> %%check_rtc:
  8575 00004251 A1[E4060000]        <3> mov eax, [TIMER_RTC_TICKS]
  8576 00004256 39D8                <3> cmp eax, ebx
  8577 00004258 7CF7                <3> jl %%check_rtc
  8578                              <3> 
  8579                              <2> 
  8580                              <2> ;KEYBOARD_check_key      KEYBOARD_ENTER_KEY
  8581 0000425A BA[5A420000]        <2> mov edx, $              ; EDX = EIP , for debugging
  8582 0000425F EA[AA0C0000]0800    <2> jmp dword 0x0008:KEYBOARD_system_reset
  8583                              <2> ;jmp dword 0x0008:BIOS_cold_boot
  8584                              <2> 
  8585                              <2> help_info:
  8586                              <2> ;=================================================;
  8587                              <2> ; Help Information                                ;
  8588                              <2> ;=================================================;
  8589                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg0
  8590                              <3> 
  8591 00004266 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8592 0000426C 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8593 00004273 7C14                <3> jl %%skip_window_up
  8594 00004275 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8595 0000427C 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8596 00004283 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8597                              <3> %%skip_window_up:
  8598                              <3> 
  8599 00004289 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8600 0000428E B8A0000000          <3> mov eax, 160
  8601 00004293 31DB                <3> xor ebx, ebx
  8602 00004295 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8603 0000429B F7E3                <3> mul ebx
  8604 0000429D 01C7                <3> add edi, eax
  8605                              <3> 
  8606 0000429F BE[2A560000]        <3> mov esi, %3
  8607 000042A4 B407                <3> mov ah, %2
  8608                              <3> %%next_char1:
  8609 000042A6 268A06              <3> mov al, byte [es:esi]
  8610 000042A9 26668907            <3> mov word [es:edi], ax
  8611 000042AD 47<rept>            <3> times 2 inc edi
  8612 000042AF 46                  <3> inc esi
  8613 000042B0 26803E00            <3> cmp byte [es:esi], 0x00
  8614 000042B4 75F0                <3> jne %%next_char1
  8615                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg1
  8616                              <3> 
  8617 000042B6 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8618 000042BC 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8619 000042C3 7C14                <3> jl %%skip_window_up
  8620 000042C5 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8621 000042CC 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8622 000042D3 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8623                              <3> %%skip_window_up:
  8624                              <3> 
  8625 000042D9 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8626 000042DE B8A0000000          <3> mov eax, 160
  8627 000042E3 31DB                <3> xor ebx, ebx
  8628 000042E5 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8629 000042EB F7E3                <3> mul ebx
  8630 000042ED 01C7                <3> add edi, eax
  8631                              <3> 
  8632 000042EF BE[3D560000]        <3> mov esi, %3
  8633 000042F4 B407                <3> mov ah, %2
  8634                              <3> %%next_char1:
  8635 000042F6 268A06              <3> mov al, byte [es:esi]
  8636 000042F9 26668907            <3> mov word [es:edi], ax
  8637 000042FD 47<rept>            <3> times 2 inc edi
  8638 000042FF 46                  <3> inc esi
  8639 00004300 26803E00            <3> cmp byte [es:esi], 0x00
  8640 00004304 75F0                <3> jne %%next_char1
  8641                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg2
  8642                              <3> 
  8643 00004306 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8644 0000430C 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8645 00004313 7C14                <3> jl %%skip_window_up
  8646 00004315 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8647 0000431C 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8648 00004323 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8649                              <3> %%skip_window_up:
  8650                              <3> 
  8651 00004329 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8652 0000432E B8A0000000          <3> mov eax, 160
  8653 00004333 31DB                <3> xor ebx, ebx
  8654 00004335 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8655 0000433B F7E3                <3> mul ebx
  8656 0000433D 01C7                <3> add edi, eax
  8657                              <3> 
  8658 0000433F BE[4D560000]        <3> mov esi, %3
  8659 00004344 B407                <3> mov ah, %2
  8660                              <3> %%next_char1:
  8661 00004346 268A06              <3> mov al, byte [es:esi]
  8662 00004349 26668907            <3> mov word [es:edi], ax
  8663 0000434D 47<rept>            <3> times 2 inc edi
  8664 0000434F 46                  <3> inc esi
  8665 00004350 26803E00            <3> cmp byte [es:esi], 0x00
  8666 00004354 75F0                <3> jne %%next_char1
  8667                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg3
  8668                              <3> 
  8669 00004356 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8670 0000435C 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8671 00004363 7C14                <3> jl %%skip_window_up
  8672 00004365 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8673 0000436C 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8674 00004373 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8675                              <3> %%skip_window_up:
  8676                              <3> 
  8677 00004379 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8678 0000437E B8A0000000          <3> mov eax, 160
  8679 00004383 31DB                <3> xor ebx, ebx
  8680 00004385 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8681 0000438B F7E3                <3> mul ebx
  8682 0000438D 01C7                <3> add edi, eax
  8683                              <3> 
  8684 0000438F BE[5D560000]        <3> mov esi, %3
  8685 00004394 B407                <3> mov ah, %2
  8686                              <3> %%next_char1:
  8687 00004396 268A06              <3> mov al, byte [es:esi]
  8688 00004399 26668907            <3> mov word [es:edi], ax
  8689 0000439D 47<rept>            <3> times 2 inc edi
  8690 0000439F 46                  <3> inc esi
  8691 000043A0 26803E00            <3> cmp byte [es:esi], 0x00
  8692 000043A4 75F0                <3> jne %%next_char1
  8693                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg4
  8694                              <3> 
  8695 000043A6 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8696 000043AC 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8697 000043B3 7C14                <3> jl %%skip_window_up
  8698 000043B5 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8699 000043BC 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8700 000043C3 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8701                              <3> %%skip_window_up:
  8702                              <3> 
  8703 000043C9 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8704 000043CE B8A0000000          <3> mov eax, 160
  8705 000043D3 31DB                <3> xor ebx, ebx
  8706 000043D5 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8707 000043DB F7E3                <3> mul ebx
  8708 000043DD 01C7                <3> add edi, eax
  8709                              <3> 
  8710 000043DF BE[75560000]        <3> mov esi, %3
  8711 000043E4 B407                <3> mov ah, %2
  8712                              <3> %%next_char1:
  8713 000043E6 268A06              <3> mov al, byte [es:esi]
  8714 000043E9 26668907            <3> mov word [es:edi], ax
  8715 000043ED 47<rept>            <3> times 2 inc edi
  8716 000043EF 46                  <3> inc esi
  8717 000043F0 26803E00            <3> cmp byte [es:esi], 0x00
  8718 000043F4 75F0                <3> jne %%next_char1
  8719                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg5
  8720                              <3> 
  8721 000043F6 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8722 000043FC 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8723 00004403 7C14                <3> jl %%skip_window_up
  8724 00004405 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8725 0000440C 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8726 00004413 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8727                              <3> %%skip_window_up:
  8728                              <3> 
  8729 00004419 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8730 0000441E B8A0000000          <3> mov eax, 160
  8731 00004423 31DB                <3> xor ebx, ebx
  8732 00004425 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8733 0000442B F7E3                <3> mul ebx
  8734 0000442D 01C7                <3> add edi, eax
  8735                              <3> 
  8736 0000442F BE[94560000]        <3> mov esi, %3
  8737 00004434 B407                <3> mov ah, %2
  8738                              <3> %%next_char1:
  8739 00004436 268A06              <3> mov al, byte [es:esi]
  8740 00004439 26668907            <3> mov word [es:edi], ax
  8741 0000443D 47<rept>            <3> times 2 inc edi
  8742 0000443F 46                  <3> inc esi
  8743 00004440 26803E00            <3> cmp byte [es:esi], 0x00
  8744 00004444 75F0                <3> jne %%next_char1
  8745                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg6
  8746                              <3> 
  8747 00004446 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8748 0000444C 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8749 00004453 7C14                <3> jl %%skip_window_up
  8750 00004455 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8751 0000445C 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8752 00004463 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8753                              <3> %%skip_window_up:
  8754                              <3> 
  8755 00004469 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8756 0000446E B8A0000000          <3> mov eax, 160
  8757 00004473 31DB                <3> xor ebx, ebx
  8758 00004475 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8759 0000447B F7E3                <3> mul ebx
  8760 0000447D 01C7                <3> add edi, eax
  8761                              <3> 
  8762 0000447F BE[B5560000]        <3> mov esi, %3
  8763 00004484 B407                <3> mov ah, %2
  8764                              <3> %%next_char1:
  8765 00004486 268A06              <3> mov al, byte [es:esi]
  8766 00004489 26668907            <3> mov word [es:edi], ax
  8767 0000448D 47<rept>            <3> times 2 inc edi
  8768 0000448F 46                  <3> inc esi
  8769 00004490 26803E00            <3> cmp byte [es:esi], 0x00
  8770 00004494 75F0                <3> jne %%next_char1
  8771                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,help_msg7
  8772                              <3> 
  8773 00004496 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8774 0000449C 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8775 000044A3 7C14                <3> jl %%skip_window_up
  8776 000044A5 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8777 000044AC 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8778 000044B3 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8779                              <3> %%skip_window_up:
  8780                              <3> 
  8781 000044B9 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8782 000044BE B8A0000000          <3> mov eax, 160
  8783 000044C3 31DB                <3> xor ebx, ebx
  8784 000044C5 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8785 000044CB F7E3                <3> mul ebx
  8786 000044CD 01C7                <3> add edi, eax
  8787                              <3> 
  8788 000044CF BE[CE560000]        <3> mov esi, %3
  8789 000044D4 B407                <3> mov ah, %2
  8790                              <3> %%next_char1:
  8791 000044D6 268A06              <3> mov al, byte [es:esi]
  8792 000044D9 26668907            <3> mov word [es:edi], ax
  8793 000044DD 47<rept>            <3> times 2 inc edi
  8794 000044DF 46                  <3> inc esi
  8795 000044E0 26803E00            <3> cmp byte [es:esi], 0x00
  8796 000044E4 75F0                <3> jne %%next_char1
  8797 000044E6 CB                  <2> retf
  8798                              <2> 
  8799                              <2> coders_info:
  8800                              <2> ;=================================================;
  8801                              <2> ; Team Information                                ;
  8802                              <2> ;=================================================;
  8803                              <2> ;VIDEO_TEXTMODE_print_line            0x01,0x07,coders_msg1
  8804                              <2> ;inc byte [VIDEO_TEXTMODE_LINE]
  8805 000044E7 CB                  <2> retf
  8806                              <2> 
  8807                              <2> ;dir_info:
  8808                              <2> ;=================================================;
  8809                              <2> ; Directory List                                  ;
  8810                              <2> ;=================================================;
  8811                              <2> ;mov dword [FILE_ENTRY], 0
  8812                              <2> ;next_file:
  8813                              <2> ;mov eax, [FILE_ENTRY]
  8814                              <2> ;mov dword [FILESYSTEM_TEMP_VALUE], eax
  8815                              <2> ;FILESYSTEM_read_dir_entry       [FILESYSTEM_TEMP_VALUE]
  8816                              <2> ;cmp dword [FILESYSTEM_TEMP_VALUE], 0xFFFFFFFF
  8817                              <2> ;je near skip_entry
  8818                              <2> ;;number_to_text  [FILESYSTEM_TEMP_VALUE], 10, file_msg+10 
  8819                              <2> ;;VIDEO_TEXTMODE_print_line            0x01,0x07,file_msg
  8820                              <2> ;FILESYSTEM_read_file_header     [FILESYSTEM_TEMP_VALUE]
  8821                              <2> ;;number_to_text  [FILESYSTEM_TEMP_VALUE], 10, file_msg+30
  8822                              <2> ;;VIDEO_TEXTMODE_print_line            0x01,0x07,file_msg
  8823                              <2> 
  8824                              <2> ;clean_str  	file_msg
  8825                              <2> ;mov esi, FILE_HEADER
  8826                              <2> ;xor eax, eax
  8827                              <2> ;mov al, byte [es:esi]
  8828                              <2> ;mov dword [FILESYSTEM_TEMP_VALUE], eax
  8829                              <2> ;FILESYSTEM_attrib  [FILESYSTEM_TEMP_VALUE], file_msg+10
  8830                              <2> ;mov esi, FILE_HEADER+36
  8831                              <2> ;xor eax, eax
  8832                              <2> ;mov ax, word [es:esi]
  8833                              <2> ;mov dword [FILESYSTEM_TEMP_VALUE], eax
  8834                              <2> ;number_to_text  [FILESYSTEM_TEMP_VALUE], 10, file_msg+22
  8835                              <2> ;copy_str	FILE_HEADER+1, file_msg+24 
  8836                              <2> ;VIDEO_TEXTMODE_print_line            0x01,0x07,file_msg
  8837                              <2> ;skip_entry:
  8838                              <2> ;inc dword [FILE_ENTRY]
  8839                              <2> ;cmp dword [FILE_ENTRY], 10 
  8840                              <2> ;jl near next_file
  8841                              <2> ;retf
  8842                              <2> 
  8843                              <2> cpu_info:
  8844                              <2> ;================================================;
  8845                              <2> ; Checking CPU Family...                         ;
  8846                              <2> ;================================================;
  8847                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,cpu_type_msg
  8848                              <3> 
  8849 000044E8 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8850 000044EE 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8851 000044F5 7C14                <3> jl %%skip_window_up
  8852 000044F7 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8853 000044FE 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8854 00004505 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8855                              <3> %%skip_window_up:
  8856                              <3> 
  8857 0000450B BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8858 00004510 B8A0000000          <3> mov eax, 160
  8859 00004515 31DB                <3> xor ebx, ebx
  8860 00004517 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8861 0000451D F7E3                <3> mul ebx
  8862 0000451F 01C7                <3> add edi, eax
  8863                              <3> 
  8864 00004521 BE[62550000]        <3> mov esi, %3
  8865 00004526 B407                <3> mov ah, %2
  8866                              <3> %%next_char1:
  8867 00004528 268A06              <3> mov al, byte [es:esi]
  8868 0000452B 26668907            <3> mov word [es:edi], ax
  8869 0000452F 47<rept>            <3> times 2 inc edi
  8870 00004531 46                  <3> inc esi
  8871 00004532 26803E00            <3> cmp byte [es:esi], 0x00
  8872 00004536 75F0                <3> jne %%next_char1
  8873 00004538 C705[10590000]0000- <2> mov dword [dword_number], 0
  8874 00004540 0000                <2>
  8875                              <2> CPU_family      dword_number
  8876 00004542 9C                  <3>  pushfd
  8877 00004543 9C                  <3>  pushfd
  8878 00004544 58                  <3>  pop eax
  8879 00004545 0D00002400          <3>  or eax,240000h
  8880 0000454A 50                  <3>  push eax
  8881 0000454B 9D                  <3>  popfd
  8882 0000454C 9C                  <3>  pushfd
  8883 0000454D 58                  <3>  pop eax
  8884 0000454E C1E810              <3>  shr eax,10h
  8885 00004551 2424                <3>  and al,24h
  8886 00004553 7410                <3>  jz %%_3
  8887                              <3> 
  8888 00004555 3C04                <3>  cmp al,4
  8889 00004557 740E                <3>  jz %%_4
  8890 00004559 66B80100            <3>  mov ax,1
  8891 0000455D 0FA2                <3>  CPUID
  8892 0000455F 88E0                <3>  mov al,ah
  8893                              <3> 
  8894 00004561 240F                <3>  and al,0fh
  8895 00004563 EB02                <3>  jmp short %%_4
  8896                              <3> %%_3:
  8897 00004565 B003                <3>  mov al,3
  8898                              <3> %%_4:
  8899 00004567 9D                  <3>  popfd
  8900 00004568 A2[10590000]        <3>  mov byte [%1], al
  8901                              <2> number_to_text  [dword_number], 10, cpu_type+2
  8902                              <3> 
  8903                              <3> 
  8904                              <3> 
  8905 0000456D BF[7B550000]        <3> mov edi, %3
  8906 00004572 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  8907 00004577 A1[10590000]        <3> mov eax, %1
  8908 0000457C BB0A000000          <3> mov ebx, %2
  8909                              <3> %%divide:
  8910 00004581 31D2                <3> xor edx, edx
  8911 00004583 F7F3                <3> div ebx
  8912 00004585 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  8913 00004589 3E880F              <3> mov byte [ds:edi], cl
  8914 0000458C 4F                  <3> dec edi
  8915 0000458D 39D8                <3> cmp eax, ebx
  8916 0000458F 7DF0                <3> jge %%divide
  8917 00004591 3D00000000          <3> cmp eax, 0
  8918 00004596 7407                <3> je %%end
  8919 00004598 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  8920 0000459C 26880F              <3> mov byte [es:edi], cl
  8921                              <3> %%end:
  8922 0000459F 31C0                <2> xor eax, eax
  8923 000045A1 A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  8924 000045A6 A3[95540000]        <2> mov [dd_number], eax
  8925                              <2> VIDEO_TEXTMODE_write_mensage            [dd_number],0x18,0x07,cpu_type
  8926                              <3> 
  8927                              <3> 
  8928                              <3> 
  8929                              <3> 
  8930                              <3> 
  8931                              <3> 
  8932                              <3> 
  8933                              <3> 
  8934                              <3> 
  8935 000045AB BF30800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  8936                              <3> 
  8937 000045B0 B8A0000000          <3> mov eax, 160
  8938 000045B5 8B1D[95540000]      <3> mov ebx, %1
  8939 000045BB F7E3                <3> mul ebx
  8940 000045BD 01C7                <3> add edi, eax
  8941                              <3> 
  8942 000045BF BE[79550000]        <3> mov esi, %4
  8943 000045C4 B407                <3> mov ah, %3
  8944                              <3> %%next_char:
  8945 000045C6 268A06              <3> mov al, byte [es:esi]
  8946 000045C9 26668907            <3> mov word [es:edi], ax
  8947 000045CD 47<rept>            <3> times 2 inc edi
  8948 000045CF 46                  <3> inc esi
  8949 000045D0 26803E00            <3> cmp byte [es:esi], 0x00
  8950 000045D4 75F0                <3> jne %%next_char
  8951                              <2> 
  8952                              <2> ;CPU_check_cpuid        [dword_number]
  8953                              <2> ;cmp dword [dword_number], 0
  8954                              <2> ;je skip_cpu
  8955                              <2> 
  8956 000045D6 813D[10590000]0500- <2> cmp dword [dword_number], 5
  8957 000045DE 0000                <2>
  8958 000045E0 7D07                <2> jge detect_cpu
  8959 000045E2 EA[4A480000]0800    <2> jmp dword 0x0008:skip_cpu
  8960                              <2> detect_cpu:
  8961                              <2> ;===============================================;
  8962                              <2> ; Checking CPU Signature...                     ;
  8963                              <2> ;===============================================;
  8964                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,cpu_sign_msg
  8965                              <3> 
  8966 000045E9 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  8967 000045EF 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  8968 000045F6 7C14                <3> jl %%skip_window_up
  8969 000045F8 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  8970 000045FF 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  8971 00004606 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  8972                              <3> %%skip_window_up:
  8973                              <3> 
  8974 0000460C BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  8975 00004611 B8A0000000          <3> mov eax, 160
  8976 00004616 31DB                <3> xor ebx, ebx
  8977 00004618 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  8978 0000461E F7E3                <3> mul ebx
  8979 00004620 01C7                <3> add edi, eax
  8980                              <3> 
  8981 00004622 BE[48550000]        <3> mov esi, %3
  8982 00004627 B407                <3> mov ah, %2
  8983                              <3> %%next_char1:
  8984 00004629 268A06              <3> mov al, byte [es:esi]
  8985 0000462C 26668907            <3> mov word [es:edi], ax
  8986 00004630 47<rept>            <3> times 2 inc edi
  8987 00004632 46                  <3> inc esi
  8988 00004633 26803E00            <3> cmp byte [es:esi], 0x00
  8989 00004637 75F0                <3> jne %%next_char1
  8990 00004639 9A[76000000]0800    <2> call dword 0x0008:CPU_signature
  8991 00004640 31C0                <2> xor eax, eax
  8992 00004642 A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  8993 00004647 A3[95540000]        <2> mov [dd_number], eax
  8994                              <2> VIDEO_TEXTMODE_write_mensage         [dd_number],0x1B,0x07,CPU_SIGNATURE
  8995                              <3> 
  8996                              <3> 
  8997                              <3> 
  8998                              <3> 
  8999                              <3> 
  9000                              <3> 
  9001                              <3> 
  9002                              <3> 
  9003                              <3> 
  9004 0000464C BF36800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  9005                              <3> 
  9006 00004651 B8A0000000          <3> mov eax, 160
  9007 00004656 8B1D[95540000]      <3> mov ebx, %1
  9008 0000465C F7E3                <3> mul ebx
  9009 0000465E 01C7                <3> add edi, eax
  9010                              <3> 
  9011 00004660 BE[AD000000]        <3> mov esi, %4
  9012 00004665 B407                <3> mov ah, %3
  9013                              <3> %%next_char:
  9014 00004667 268A06              <3> mov al, byte [es:esi]
  9015 0000466A 26668907            <3> mov word [es:edi], ax
  9016 0000466E 47<rept>            <3> times 2 inc edi
  9017 00004670 46                  <3> inc esi
  9018 00004671 26803E00            <3> cmp byte [es:esi], 0x00
  9019 00004675 75F0                <3> jne %%next_char
  9020                              <2> ;===============================================;
  9021                              <2> ; Checking CPU ID...                            ;
  9022                              <2> ;===============================================;
  9023                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,cpu_id_msg
  9024                              <3> 
  9025 00004677 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9026 0000467D 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9027 00004684 7C14                <3> jl %%skip_window_up
  9028 00004686 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9029 0000468D 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9030 00004694 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9031                              <3> %%skip_window_up:
  9032                              <3> 
  9033 0000469A BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9034 0000469F B8A0000000          <3> mov eax, 160
  9035 000046A4 31DB                <3> xor ebx, ebx
  9036 000046A6 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9037 000046AC F7E3                <3> mul ebx
  9038 000046AE 01C7                <3> add edi, eax
  9039                              <3> 
  9040 000046B0 BE[7F550000]        <3> mov esi, %3
  9041 000046B5 B407                <3> mov ah, %2
  9042                              <3> %%next_char1:
  9043 000046B7 268A06              <3> mov al, byte [es:esi]
  9044 000046BA 26668907            <3> mov word [es:edi], ax
  9045 000046BE 47<rept>            <3> times 2 inc edi
  9046 000046C0 46                  <3> inc esi
  9047 000046C1 26803E00            <3> cmp byte [es:esi], 0x00
  9048 000046C5 75F0                <3> jne %%next_char1
  9049 000046C7 9A[8B000000]0800    <2> call dword 0x0008:CPU_id
  9050                              <2> CPU_detect      dword_number2
  9051                              <3> 
  9052 000046CE BE[DA000000]        <3> mov esi, CPU_UNKNOWN_STRING
  9053 000046D3 8935[A9000000]      <3> mov dword [CPU_STRING], esi
  9054 000046D9 BE[BA000000]        <3> mov esi, CPU_AMD_SIGNATURE
  9055 000046DE BF[AD000000]        <3> mov edi, CPU_SIGNATURE
  9056                              <3> %%next_amd:
  9057 000046E3 3E8B1E              <3> mov ebx, dword [ds:esi]
  9058 000046E6 3E8B07              <3> mov eax, dword [ds:edi]
  9059 000046E9 81C604000000        <3> add esi, 4
  9060 000046EF 81C704000000        <3> add edi, 4
  9061 000046F5 39D8                <3> cmp eax, ebx
  9062 000046F7 750F                <3> jne %%skip_amd
  9063 000046F9 81FF[B9000000]      <3> cmp edi, CPU_SIGNATURE+12
  9064 000046FF 75E2                <3> jne %%next_amd
  9065 00004701 BE[F8000000]        <3> mov esi, CPU_AMD_ID
  9066 00004706 EB2D                <3> jmp short %%cpu_find
  9067                              <3> %%skip_amd:
  9068 00004708 BE[C6000000]        <3> mov esi, CPU_INTEL_SIGNATURE
  9069 0000470D BF[AD000000]        <3> mov edi, CPU_SIGNATURE
  9070                              <3> %%next_intel:
  9071 00004712 3E8B1E              <3> mov ebx, dword [ds:esi]
  9072 00004715 3E8B07              <3> mov eax, dword [ds:edi]
  9073 00004718 81C604000000        <3> add esi, 4
  9074 0000471E 81C704000000        <3> add edi, 4
  9075 00004724 39D8                <3> cmp eax, ebx
  9076 00004726 7544                <3> jne %%cpu_end_detect
  9077 00004728 81FF[B9000000]      <3> cmp edi, CPU_SIGNATURE+12
  9078 0000472E 75E2                <3> jne %%next_intel
  9079 00004730 BE[C8020000]        <3> mov esi, CPU_INTEL_ID
  9080                              <3> %%cpu_find
  9081 00004735 8B1D[D2000000]      <3> mov ebx, dword [CPU_ID]
  9082 0000473B B00F                <3> mov al, 00001111b
  9083 0000473D 20D8                <3> and al, bl
  9084 0000473F A2[14590000]        <3> mov byte [%1], al
  9085 00004744 C1EB04              <3> shr ebx, 4
  9086                              <3> %%next_cpu:
  9087 00004747 3E668B06            <3> mov ax, word [ds:esi]
  9088 0000474B 81C621000000        <3> add esi,33
  9089 00004751 6639D8              <3> cmp ax, bx
  9090 00004754 740A                <3> je %%cpu_found
  9091 00004756 3E66813EFFFF        <3> cmp word [ds:esi], 0xFFFF
  9092 0000475C 740E                <3> je %%cpu_end_detect
  9093 0000475E EBE7                <3> jmp short %%next_cpu
  9094                              <3> %%cpu_found:
  9095 00004760 81EE1F000000        <3> sub esi, 31
  9096 00004766 8935[A9000000]      <3> mov dword [CPU_STRING], esi
  9097                              <3> %%cpu_end_detect:
  9098                              <2> number_to_text  [CPU_ID], 2, line_string+15
  9099                              <3> 
  9100                              <3> 
  9101                              <3> 
  9102 0000476C BF[08540000]        <3> mov edi, %3
  9103 00004771 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  9104 00004776 A1[D2000000]        <3> mov eax, %1
  9105 0000477B BB02000000          <3> mov ebx, %2
  9106                              <3> %%divide:
  9107 00004780 31D2                <3> xor edx, edx
  9108 00004782 F7F3                <3> div ebx
  9109 00004784 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  9110 00004788 3E880F              <3> mov byte [ds:edi], cl
  9111 0000478B 4F                  <3> dec edi
  9112 0000478C 39D8                <3> cmp eax, ebx
  9113 0000478E 7DF0                <3> jge %%divide
  9114 00004790 3D00000000          <3> cmp eax, 0
  9115 00004795 7407                <3> je %%end
  9116 00004797 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  9117 0000479B 26880F              <3> mov byte [es:edi], cl
  9118                              <3> %%end:
  9119                              <2> copy_str        [CPU_STRING], line_string+18
  9120 0000479E 8B35[A9000000]      <3> mov esi, %1
  9121 000047A4 BF[0B540000]        <3> mov edi, %2
  9122                              <3> %%next_byte:
  9123 000047A9 268A06              <3> mov al, byte [es:esi]
  9124 000047AC 268807              <3> mov byte [es:edi], al
  9125 000047AF 46                  <3> inc esi
  9126 000047B0 47                  <3> inc edi
  9127 000047B1 26803E00            <3> cmp byte [es:esi], 0
  9128 000047B5 75F2                <3> jne %%next_byte
  9129                              <2> number_to_text  [dword_number2], 10, line_string+55
  9130                              <3> 
  9131                              <3> 
  9132                              <3> 
  9133 000047B7 BF[30540000]        <3> mov edi, %3
  9134 000047BC BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  9135 000047C1 A1[14590000]        <3> mov eax, %1
  9136 000047C6 BB0A000000          <3> mov ebx, %2
  9137                              <3> %%divide:
  9138 000047CB 31D2                <3> xor edx, edx
  9139 000047CD F7F3                <3> div ebx
  9140 000047CF 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  9141 000047D3 3E880F              <3> mov byte [ds:edi], cl
  9142 000047D6 4F                  <3> dec edi
  9143 000047D7 39D8                <3> cmp eax, ebx
  9144 000047D9 7DF0                <3> jge %%divide
  9145 000047DB 3D00000000          <3> cmp eax, 0
  9146 000047E0 7407                <3> je %%end
  9147 000047E2 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  9148 000047E6 26880F              <3> mov byte [es:edi], cl
  9149                              <3> %%end:
  9150                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07, line_string
  9151                              <3> 
  9152 000047E9 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9153 000047EF 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9154 000047F6 7C14                <3> jl %%skip_window_up
  9155 000047F8 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9156 000047FF 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9157 00004806 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9158                              <3> %%skip_window_up:
  9159                              <3> 
  9160 0000480C BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9161 00004811 B8A0000000          <3> mov eax, 160
  9162 00004816 31DB                <3> xor ebx, ebx
  9163 00004818 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9164 0000481E F7E3                <3> mul ebx
  9165 00004820 01C7                <3> add edi, eax
  9166                              <3> 
  9167 00004822 BE[F9530000]        <3> mov esi, %3
  9168 00004827 B407                <3> mov ah, %2
  9169                              <3> %%next_char1:
  9170 00004829 268A06              <3> mov al, byte [es:esi]
  9171 0000482C 26668907            <3> mov word [es:edi], ax
  9172 00004830 47<rept>            <3> times 2 inc edi
  9173 00004832 46                  <3> inc esi
  9174 00004833 26803E00            <3> cmp byte [es:esi], 0x00
  9175 00004837 75F0                <3> jne %%next_char1
  9176                              <2> clean_str       line_string
  9177 00004839 BF[F9530000]        <3> mov edi, %1
  9178 0000483E B020                <3> mov al, 32
  9179                              <3> %%next_clean:
  9180 00004840 268807              <3> mov byte [es:edi], al
  9181 00004843 47                  <3> inc edi
  9182 00004844 26803F00            <3> cmp byte [es:edi], 0
  9183 00004848 75F6                <3> jne %%next_clean
  9184                              <2> ;number_to_text [CPU_FLAGS], 2, line_string+32
  9185                              <2> ;VIDEO_TEXTMODE_print_line           0x01,0x07, line_string
  9186                              <2> ;clean_str      line_string
  9187                              <2> skip_cpu:
  9188 0000484A CB                  <2> retf
  9189                              <2> 
  9190                              <2> ram_info:
  9191                              <2> ;===============================================;
  9192                              <2> ; Checking RAM...                               ;
  9193                              <2> ;===============================================;
  9194                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,pc_ram_msg
  9195                              <3> 
  9196 0000484B FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9197 00004851 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9198 00004858 7C14                <3> jl %%skip_window_up
  9199 0000485A C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9200 00004861 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9201 00004868 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9202                              <3> %%skip_window_up:
  9203                              <3> 
  9204 0000486E BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9205 00004873 B8A0000000          <3> mov eax, 160
  9206 00004878 31DB                <3> xor ebx, ebx
  9207 0000487A 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9208 00004880 F7E3                <3> mul ebx
  9209 00004882 01C7                <3> add edi, eax
  9210                              <3> 
  9211 00004884 BE[92550000]        <3> mov esi, %3
  9212 00004889 B407                <3> mov ah, %2
  9213                              <3> %%next_char1:
  9214 0000488B 268A06              <3> mov al, byte [es:esi]
  9215 0000488E 26668907            <3> mov word [es:edi], ax
  9216 00004892 47<rept>            <3> times 2 inc edi
  9217 00004894 46                  <3> inc esi
  9218 00004895 26803E00            <3> cmp byte [es:esi], 0x00
  9219 00004899 75F0                <3> jne %%next_char1
  9220                              <2> MEMORY_get_ram          [dword_number]
  9221 0000489B BB00001000          <3> mov ebx, 0x00100000
  9222                              <3> %%next_byte:
  9223 000048A0 B0FF                <3> mov al, 0xFF
  9224 000048A2 26C60300            <3> mov byte [es:ebx], 0x00
  9225 000048A6 268A03              <3> mov al, byte [es:ebx]
  9226 000048A9 43                  <3> inc ebx
  9227 000048AA 3C00                <3> cmp al, 0x00
  9228 000048AC 74F2                <3> je %%next_byte
  9229 000048AE 4B                  <3> dec ebx
  9230 000048AF 31D2                <3> xor edx, edx
  9231 000048B1 89D8                <3> mov eax, ebx
  9232 000048B3 BB00001000          <3> mov ebx, 0x00100000
  9233 000048B8 F7F3                <3> div ebx
  9234 000048BA A3[10590000]        <3> mov %1, eax
  9235                              <2> number_to_text  [dword_number], 10, pc_ram+4
  9236                              <3> 
  9237                              <3> 
  9238                              <3> 
  9239 000048BF BF[A6550000]        <3> mov edi, %3
  9240 000048C4 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  9241 000048C9 A1[10590000]        <3> mov eax, %1
  9242 000048CE BB0A000000          <3> mov ebx, %2
  9243                              <3> %%divide:
  9244 000048D3 31D2                <3> xor edx, edx
  9245 000048D5 F7F3                <3> div ebx
  9246 000048D7 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  9247 000048DB 3E880F              <3> mov byte [ds:edi], cl
  9248 000048DE 4F                  <3> dec edi
  9249 000048DF 39D8                <3> cmp eax, ebx
  9250 000048E1 7DF0                <3> jge %%divide
  9251 000048E3 3D00000000          <3> cmp eax, 0
  9252 000048E8 7407                <3> je %%end
  9253 000048EA 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  9254 000048EE 26880F              <3> mov byte [es:edi], cl
  9255                              <3> %%end:
  9256 000048F1 31C0                <2> xor eax, eax
  9257 000048F3 A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  9258 000048F8 A3[95540000]        <2> mov [dd_number], eax
  9259                              <2> VIDEO_TEXTMODE_write_mensage            [dd_number],0x11,0x07,pc_ram
  9260                              <3> 
  9261                              <3> 
  9262                              <3> 
  9263                              <3> 
  9264                              <3> 
  9265                              <3> 
  9266                              <3> 
  9267                              <3> 
  9268                              <3> 
  9269 000048FD BF22800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  9270                              <3> 
  9271 00004902 B8A0000000          <3> mov eax, 160
  9272 00004907 8B1D[95540000]      <3> mov ebx, %1
  9273 0000490D F7E3                <3> mul ebx
  9274 0000490F 01C7                <3> add edi, eax
  9275                              <3> 
  9276 00004911 BE[A2550000]        <3> mov esi, %4
  9277 00004916 B407                <3> mov ah, %3
  9278                              <3> %%next_char:
  9279 00004918 268A06              <3> mov al, byte [es:esi]
  9280 0000491B 26668907            <3> mov word [es:edi], ax
  9281 0000491F 47<rept>            <3> times 2 inc edi
  9282 00004921 46                  <3> inc esi
  9283 00004922 26803E00            <3> cmp byte [es:esi], 0x00
  9284 00004926 75F0                <3> jne %%next_char
  9285 00004928 CB                  <2> retf
  9286                              <2> 
  9287                              <2> pci_info:
  9288                              <2> ;===============================================;
  9289                              <2> ; Checking PCI Devices...                       ;
  9290                              <2> ;===============================================;
  9291                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,pci_devices_msg
  9292                              <3> 
  9293 00004929 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9294 0000492F 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9295 00004936 7C14                <3> jl %%skip_window_up
  9296 00004938 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9297 0000493F 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9298 00004946 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9299                              <3> %%skip_window_up:
  9300                              <3> 
  9301 0000494C BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9302 00004951 B8A0000000          <3> mov eax, 160
  9303 00004956 31DB                <3> xor ebx, ebx
  9304 00004958 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9305 0000495E F7E3                <3> mul ebx
  9306 00004960 01C7                <3> add edi, eax
  9307                              <3> 
  9308 00004962 BE[AA550000]        <3> mov esi, %3
  9309 00004967 B407                <3> mov ah, %2
  9310                              <3> %%next_char1:
  9311 00004969 268A06              <3> mov al, byte [es:esi]
  9312 0000496C 26668907            <3> mov word [es:edi], ax
  9313 00004970 47<rept>            <3> times 2 inc edi
  9314 00004972 46                  <3> inc esi
  9315 00004973 26803E00            <3> cmp byte [es:esi], 0x00
  9316 00004977 75F0                <3> jne %%next_char1
  9317                              <2> PCI_get_type            [pci_type]
  9318 00004979 BB02000000          <3> mov ebx, 2
  9319 0000497E 66B80000            <3> mov ax, 0x0000
  9320 00004982 66BAF80C            <3> mov dx, PCI_ADDRESS_PORT
  9321 00004986 66EF                <3> out dx, ax
  9322 00004988 66ED                <3> in ax, dx
  9323 0000498A 663D0000            <3> cmp ax, 0x0000
  9324 0000498E 7514                <3> jne %%type_1
  9325 00004990 6681C20200          <3> add dx, 2
  9326 00004995 66EF                <3> out dx, ax
  9327 00004997 66ED                <3> in ax, dx
  9328 00004999 6681EA0200          <3> sub dx, 2
  9329 0000499E 663D0000            <3> cmp ax, 0x0000
  9330 000049A2 7418                <3> je %%exit_type
  9331                              <3> %%type_1:
  9332 000049A4 BB01000000          <3> mov ebx, 1
  9333 000049A9 B800000080          <3> mov eax, 0x80000000
  9334 000049AE EF                  <3> out dx, eax
  9335 000049AF ED                  <3> in eax, dx
  9336 000049B0 3D00000080          <3> cmp eax, 0x80000000
  9337 000049B5 7405                <3> je %%exit_type
  9338 000049B7 BB00000000          <3> mov ebx, 0
  9339                              <3> %%exit_type:
  9340 000049BC 891D[96210000]      <3> mov %1, ebx
  9341                              <2> 
  9342 000049C2 66C705[C2550000]00- <2> mov word [device], 0
  9343 000049CA 00                  <2>
  9344 000049CB 813D[96210000]0000- <2> cmp dword [pci_type], 0
  9345 000049D3 0000                <2>
  9346 000049D5 753E                <2> jne next_pci_device
  9347 000049D7 31C0                <2> xor eax, eax
  9348 000049D9 A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  9349 000049DE A3[95540000]        <2> mov [dd_number], eax
  9350                              <2> VIDEO_TEXTMODE_write_mensage         [dd_number],0x19,0x07,notfound_msg
  9351                              <3> 
  9352                              <3> 
  9353                              <3> 
  9354                              <3> 
  9355                              <3> 
  9356                              <3> 
  9357                              <3> 
  9358                              <3> 
  9359                              <3> 
  9360 000049E3 BF32800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  9361                              <3> 
  9362 000049E8 B8A0000000          <3> mov eax, 160
  9363 000049ED 8B1D[95540000]      <3> mov ebx, %1
  9364 000049F3 F7E3                <3> mul ebx
  9365 000049F5 01C7                <3> add edi, eax
  9366                              <3> 
  9367 000049F7 BE[1E560000]        <3> mov esi, %4
  9368 000049FC B407                <3> mov ah, %3
  9369                              <3> %%next_char:
  9370 000049FE 268A06              <3> mov al, byte [es:esi]
  9371 00004A01 26668907            <3> mov word [es:edi], ax
  9372 00004A05 47<rept>            <3> times 2 inc edi
  9373 00004A07 46                  <3> inc esi
  9374 00004A08 26803E00            <3> cmp byte [es:esi], 0x00
  9375 00004A0C 75F0                <3> jne %%next_char
  9376 00004A0E EA[524C0000]0800    <2> jmp dword 0x0008:end_pci
  9377                              <2> next_pci_device:
  9378                              <2> PCI_get_device_info     [pci_type],[device],pci_device
  9379 00004A15 8B1D[96210000]      <3> mov ebx, %1
  9380 00004A1B 81FB01000000        <3> cmp ebx, 1
  9381 00004A21 753C                <3> jne %%type_2
  9382 00004A23 31DB                <3> xor ebx,ebx
  9383 00004A25 668B1D[C2550000]    <3> mov bx, %2
  9384 00004A2C C1E30B              <3> shl ebx, 11
  9385 00004A2F 81CB00000080        <3> or ebx, 0x80000000
  9386 00004A35 66B94000            <3> mov cx, 64
  9387 00004A39 BF[A2210000]        <3> mov edi, %3
  9388                              <3> %%next_info1:
  9389 00004A3E 89D8                <3> mov eax, ebx
  9390 00004A40 66BAF80C            <3> mov dx, PCI_ADDRESS_PORT
  9391 00004A44 EF                  <3> out dx, eax
  9392 00004A45 66BAFC0C            <3> mov dx, PCI_DATA_PORT
  9393 00004A49 ED                  <3> in eax, dx
  9394 00004A4A 268907              <3> mov dword [es:edi], eax
  9395 00004A4D 81C704000000        <3> add edi, 4
  9396 00004A53 81C304000000        <3> add ebx, 4
  9397 00004A59 6649                <3> dec cx
  9398 00004A5B 75E1                <3> jnz %%next_info1
  9399 00004A5D EB55                <3> jmp short %%exit_info
  9400                              <3> %%type_2:
  9401 00004A5F 8B1D[96210000]      <3> mov ebx, %1
  9402 00004A65 81FB02000000        <3> cmp ebx, 2
  9403 00004A6B 7547                <3> jne %%exit_info
  9404 00004A6D 66BAF80C            <3> mov dx, PCI_ADDRESS_PORT
  9405 00004A71 B080                <3> mov al, 0x80
  9406 00004A73 EE                  <3> out dx, al
  9407 00004A74 30C0                <3> xor al, al
  9408 00004A76 6681C20200          <3> add dx, 2
  9409 00004A7B EE                  <3> out dx, al
  9410 00004A7C 6681EA0200          <3> sub dx, 2
  9411 00004A81 668B15[C2550000]    <3> mov dx, %2
  9412 00004A88 66C1E208            <3> shl dx, 8
  9413 00004A8C 6681CA00C0          <3> or dx, 0xC000
  9414 00004A91 66B94000            <3> mov cx, 64
  9415 00004A95 BF[A2210000]        <3> mov edi, %3
  9416                              <3> %%next_info2:
  9417 00004A9A ED                  <3> in eax, dx
  9418 00004A9B 268907              <3> mov dword [es:edi], eax
  9419 00004A9E 81C704000000        <3> add edi, 4
  9420 00004AA4 6681C20400          <3> add dx, 4
  9421 00004AA9 6649                <3> dec cx
  9422 00004AAB 75ED                <3> jnz %%next_info2
  9423 00004AAD 66BAF80C            <3> mov dx, PCI_ADDRESS_PORT
  9424 00004AB1 30C0                <3> xor al, al
  9425 00004AB3 EE                  <3> out dx, al
  9426                              <3> %%exit_info:
  9427 00004AB4 26A1[A2210000]      <2> mov eax, dword [es:pci_device]
  9428 00004ABA 3DFFFFFFFF          <2> cmp eax, 0xFFFFFFFF
  9429 00004ABF 750E                <2> jne show_device
  9430 00004AC1 66FF05[C2550000]    <2> inc word [device]
  9431 00004AC8 EA[154A0000]0800    <2> jmp dword 0x0008:next_pci_device
  9432                              <2> show_device:
  9433 00004ACF A3[C4550000]        <2> mov [device_id], eax
  9434 00004AD4 26A0[AD210000]      <2> mov al, byte [es:pci_device+0x0B]
  9435 00004ADA A2[C8550000]        <2> mov [class_id], al
  9436 00004ADF 26A0[DE210000]      <2> mov al, byte [es:pci_device+0x3C]
  9437 00004AE5 A2[C9550000]        <2> mov byte [int_line], al
  9438                              <2> PCI_detect_device       [device_id], [class_id], [pci_device_string], [pci_class_string]
  9439 00004AEA 8B1D[C4550000]      <3> mov ebx, %1
  9440 00004AF0 BE[52230000]        <3> mov esi, PCI_DEVICES
  9441                              <3> %%next_device:
  9442 00004AF5 268B06              <3> mov eax, dword [es:esi]
  9443 00004AF8 81C623000000        <3> add esi, 35
  9444 00004AFE 39D8                <3> cmp eax, ebx
  9445 00004B00 7408                <3> je %%exit_devices
  9446 00004B02 81FE[CC2B0000]      <3> cmp esi, END_PCI_DEVICES
  9447 00004B08 75EB                <3> jne %%next_device
  9448                              <3> %%exit_devices:
  9449 00004B0A 81EE1F000000        <3> sub esi, 31
  9450 00004B10 8935[9A210000]      <3> mov %3, esi
  9451 00004B16 8A1D[C8550000]      <3> mov bl, %2
  9452 00004B1C BE[A2220000]        <3> mov esi, PCI_CLASSES
  9453                              <3> %%next_class:
  9454 00004B21 268A06              <3> mov al, byte [es:esi]
  9455 00004B24 81C616000000        <3> add esi, 22
  9456 00004B2A 38D8                <3> cmp al, bl
  9457 00004B2C 7408                <3> je %%exit_classes
  9458 00004B2E 81FE[52230000]      <3> cmp esi, END_PCI_CLASSES
  9459 00004B34 75EB                <3> jne %%next_class
  9460                              <3> %%exit_classes:
  9461 00004B36 81EE15000000        <3> sub esi, 21
  9462 00004B3C 8935[9E210000]      <3> mov %4, esi
  9463                              <2> number_to_text  [device_id], 16, line_string+9
  9464                              <3> 
  9465                              <3> 
  9466                              <3> 
  9467 00004B42 BF[02540000]        <3> mov edi, %3
  9468 00004B47 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  9469 00004B4C A1[C4550000]        <3> mov eax, %1
  9470 00004B51 BB10000000          <3> mov ebx, %2
  9471                              <3> %%divide:
  9472 00004B56 31D2                <3> xor edx, edx
  9473 00004B58 F7F3                <3> div ebx
  9474 00004B5A 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  9475 00004B5E 3E880F              <3> mov byte [ds:edi], cl
  9476 00004B61 4F                  <3> dec edi
  9477 00004B62 39D8                <3> cmp eax, ebx
  9478 00004B64 7DF0                <3> jge %%divide
  9479 00004B66 3D00000000          <3> cmp eax, 0
  9480 00004B6B 7407                <3> je %%end
  9481 00004B6D 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  9482 00004B71 26880F              <3> mov byte [es:edi], cl
  9483                              <3> %%end:
  9484                              <2> number_to_text  [int_line], 10, line_string+13
  9485                              <3> 
  9486                              <3> 
  9487                              <3> 
  9488 00004B74 BF[06540000]        <3> mov edi, %3
  9489 00004B79 BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  9490 00004B7E A1[C9550000]        <3> mov eax, %1
  9491 00004B83 BB0A000000          <3> mov ebx, %2
  9492                              <3> %%divide:
  9493 00004B88 31D2                <3> xor edx, edx
  9494 00004B8A F7F3                <3> div ebx
  9495 00004B8C 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  9496 00004B90 3E880F              <3> mov byte [ds:edi], cl
  9497 00004B93 4F                  <3> dec edi
  9498 00004B94 39D8                <3> cmp eax, ebx
  9499 00004B96 7DF0                <3> jge %%divide
  9500 00004B98 3D00000000          <3> cmp eax, 0
  9501 00004B9D 7407                <3> je %%end
  9502 00004B9F 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  9503 00004BA3 26880F              <3> mov byte [es:edi], cl
  9504                              <3> %%end:
  9505                              <2> copy_str        [pci_device_string], line_string+15
  9506 00004BA6 8B35[9A210000]      <3> mov esi, %1
  9507 00004BAC BF[08540000]        <3> mov edi, %2
  9508                              <3> %%next_byte:
  9509 00004BB1 268A06              <3> mov al, byte [es:esi]
  9510 00004BB4 268807              <3> mov byte [es:edi], al
  9511 00004BB7 46                  <3> inc esi
  9512 00004BB8 47                  <3> inc edi
  9513 00004BB9 26803E00            <3> cmp byte [es:esi], 0
  9514 00004BBD 75F2                <3> jne %%next_byte
  9515                              <2> copy_str        [pci_class_string], line_string+50
  9516 00004BBF 8B35[9E210000]      <3> mov esi, %1
  9517 00004BC5 BF[2B540000]        <3> mov edi, %2
  9518                              <3> %%next_byte:
  9519 00004BCA 268A06              <3> mov al, byte [es:esi]
  9520 00004BCD 268807              <3> mov byte [es:edi], al
  9521 00004BD0 46                  <3> inc esi
  9522 00004BD1 47                  <3> inc edi
  9523 00004BD2 26803E00            <3> cmp byte [es:esi], 0
  9524 00004BD6 75F2                <3> jne %%next_byte
  9525                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,line_string
  9526                              <3> 
  9527 00004BD8 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9528 00004BDE 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9529 00004BE5 7C14                <3> jl %%skip_window_up
  9530 00004BE7 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9531 00004BEE 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9532 00004BF5 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9533                              <3> %%skip_window_up:
  9534                              <3> 
  9535 00004BFB BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9536 00004C00 B8A0000000          <3> mov eax, 160
  9537 00004C05 31DB                <3> xor ebx, ebx
  9538 00004C07 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9539 00004C0D F7E3                <3> mul ebx
  9540 00004C0F 01C7                <3> add edi, eax
  9541                              <3> 
  9542 00004C11 BE[F9530000]        <3> mov esi, %3
  9543 00004C16 B407                <3> mov ah, %2
  9544                              <3> %%next_char1:
  9545 00004C18 268A06              <3> mov al, byte [es:esi]
  9546 00004C1B 26668907            <3> mov word [es:edi], ax
  9547 00004C1F 47<rept>            <3> times 2 inc edi
  9548 00004C21 46                  <3> inc esi
  9549 00004C22 26803E00            <3> cmp byte [es:esi], 0x00
  9550 00004C26 75F0                <3> jne %%next_char1
  9551                              <2> clean_str       line_string
  9552 00004C28 BF[F9530000]        <3> mov edi, %1
  9553 00004C2D B020                <3> mov al, 32
  9554                              <3> %%next_clean:
  9555 00004C2F 268807              <3> mov byte [es:edi], al
  9556 00004C32 47                  <3> inc edi
  9557 00004C33 26803F00            <3> cmp byte [es:edi], 0
  9558 00004C37 75F6                <3> jne %%next_clean
  9559 00004C39 66FF05[C2550000]    <2> inc word [device]
  9560 00004C40 66813D[C2550000]00- <2> cmp word [device], 512
  9561 00004C48 02                  <2>
  9562 00004C49 7F07                <2> jg end_pci
  9563 00004C4B EA[154A0000]0800    <2> jmp dword 0x0008:next_pci_device
  9564                              <2> end_pci:
  9565 00004C52 CB                  <2> retf
  9566                              <2> 
  9567                              <2> isapnp_info:
  9568                              <2> ;===============================================;
  9569                              <2> ; Checking ISA PNP Devices...                   ;
  9570                              <2> ;===============================================;
  9571                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,isapnp_devices_msg
  9572                              <3> 
  9573 00004C53 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9574 00004C59 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9575 00004C60 7C14                <3> jl %%skip_window_up
  9576 00004C62 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9577 00004C69 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9578 00004C70 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9579                              <3> %%skip_window_up:
  9580                              <3> 
  9581 00004C76 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9582 00004C7B B8A0000000          <3> mov eax, 160
  9583 00004C80 31DB                <3> xor ebx, ebx
  9584 00004C82 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9585 00004C88 F7E3                <3> mul ebx
  9586 00004C8A 01C7                <3> add edi, eax
  9587                              <3> 
  9588 00004C8C BE[CD550000]        <3> mov esi, %3
  9589 00004C91 B407                <3> mov ah, %2
  9590                              <3> %%next_char1:
  9591 00004C93 268A06              <3> mov al, byte [es:esi]
  9592 00004C96 26668907            <3> mov word [es:edi], ax
  9593 00004C9A 47<rept>            <3> times 2 inc edi
  9594 00004C9C 46                  <3> inc esi
  9595 00004C9D 26803E00            <3> cmp byte [es:esi], 0x00
  9596 00004CA1 75F0                <3> jne %%next_char1
  9597 00004CA3 66B80302            <2> mov ax, ISAPNP_DEVICE_PORT_START+3
  9598 00004CA7 66A3[98300000]      <2> mov [ISAPNP_DEVICE_PORT], ax
  9599 00004CAD 9A[192C0000]0800    <2> call dword 0x0008:ISAPNP_init_isolation
  9600                              <2> 
  9601                              <2> next_port:
  9602 00004CB4 9A[042D0000]0800    <2> call dword 0x0008:ISAPNP_isolation
  9603 00004CBB BE[E8300000]        <2> mov esi, ISAPNP_ENCODED_SIGNATURE
  9604 00004CC0 3E8B06              <2> mov eax, dword [ds:esi]
  9605 00004CC3 3E8B5E04            <2> mov ebx, dword [ds:esi+4]
  9606 00004CC7 3D46464646          <2> cmp eax, dword 'FFFF'
  9607 00004CCC 750F                <2> jne show_isapnp
  9608 00004CCE 81FB46464646        <2> cmp ebx, dword 'FFFF'
  9609 00004CD4 7507                <2> jne show_isapnp
  9610 00004CD6 EA[BC4D0000]0800    <2> jmp dword 0x0008:check_port
  9611                              <2> 
  9612                              <2> show_isapnp:
  9613 00004CDD 9A[312F0000]0800    <2> call dword 0x0008:ISAPNP_detect
  9614                              <2> copy_str        ISAPNP_ENCODED_SIGNATURE, line_string+2
  9615 00004CE4 BE[E8300000]        <3> mov esi, %1
  9616 00004CE9 BF[FB530000]        <3> mov edi, %2
  9617                              <3> %%next_byte:
  9618 00004CEE 268A06              <3> mov al, byte [es:esi]
  9619 00004CF1 268807              <3> mov byte [es:edi], al
  9620 00004CF4 46                  <3> inc esi
  9621 00004CF5 47                  <3> inc edi
  9622 00004CF6 26803E00            <3> cmp byte [es:esi], 0
  9623 00004CFA 75F2                <3> jne %%next_byte
  9624 00004CFC 31C0                <2> xor eax, eax
  9625 00004CFE 66A1[98300000]      <2> mov ax, [ISAPNP_DEVICE_PORT]
  9626 00004D04 A3[10590000]        <2> mov [dword_number], eax
  9627                              <2> number_to_text  [dword_number], 16, line_string+13
  9628                              <3> 
  9629                              <3> 
  9630                              <3> 
  9631 00004D09 BF[06540000]        <3> mov edi, %3
  9632 00004D0E BE[03060000]        <3> mov esi, UTIL_HEX_DIGITS
  9633 00004D13 A1[10590000]        <3> mov eax, %1
  9634 00004D18 BB10000000          <3> mov ebx, %2
  9635                              <3> %%divide:
  9636 00004D1D 31D2                <3> xor edx, edx
  9637 00004D1F F7F3                <3> div ebx
  9638 00004D21 3E8A0C16            <3> mov cl, byte [ds:esi+edx]
  9639 00004D25 3E880F              <3> mov byte [ds:edi], cl
  9640 00004D28 4F                  <3> dec edi
  9641 00004D29 39D8                <3> cmp eax, ebx
  9642 00004D2B 7DF0                <3> jge %%divide
  9643 00004D2D 3D00000000          <3> cmp eax, 0
  9644 00004D32 7407                <3> je %%end
  9645 00004D34 3E8A0C06            <3> mov cl, byte [ds:esi+eax]
  9646 00004D38 26880F              <3> mov byte [es:edi], cl
  9647                              <3> %%end:
  9648                              <2> copy_str        [ISAPNP_CARD_STRING], line_string+15
  9649 00004D3B 8B35[E0300000]      <3> mov esi, %1
  9650 00004D41 BF[08540000]        <3> mov edi, %2
  9651                              <3> %%next_byte:
  9652 00004D46 268A06              <3> mov al, byte [es:esi]
  9653 00004D49 268807              <3> mov byte [es:edi], al
  9654 00004D4C 46                  <3> inc esi
  9655 00004D4D 47                  <3> inc edi
  9656 00004D4E 26803E00            <3> cmp byte [es:esi], 0
  9657 00004D52 75F2                <3> jne %%next_byte
  9658                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,line_string
  9659                              <3> 
  9660 00004D54 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9661 00004D5A 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9662 00004D61 7C14                <3> jl %%skip_window_up
  9663 00004D63 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9664 00004D6A 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9665 00004D71 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9666                              <3> %%skip_window_up:
  9667                              <3> 
  9668 00004D77 BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9669 00004D7C B8A0000000          <3> mov eax, 160
  9670 00004D81 31DB                <3> xor ebx, ebx
  9671 00004D83 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9672 00004D89 F7E3                <3> mul ebx
  9673 00004D8B 01C7                <3> add edi, eax
  9674                              <3> 
  9675 00004D8D BE[F9530000]        <3> mov esi, %3
  9676 00004D92 B407                <3> mov ah, %2
  9677                              <3> %%next_char1:
  9678 00004D94 268A06              <3> mov al, byte [es:esi]
  9679 00004D97 26668907            <3> mov word [es:edi], ax
  9680 00004D9B 47<rept>            <3> times 2 inc edi
  9681 00004D9D 46                  <3> inc esi
  9682 00004D9E 26803E00            <3> cmp byte [es:esi], 0x00
  9683 00004DA2 75F0                <3> jne %%next_char1
  9684                              <2> clean_str       line_string
  9685 00004DA4 BF[F9530000]        <3> mov edi, %1
  9686 00004DA9 B020                <3> mov al, 32
  9687                              <3> %%next_clean:
  9688 00004DAB 268807              <3> mov byte [es:edi], al
  9689 00004DAE 47                  <3> inc edi
  9690 00004DAF 26803F00            <3> cmp byte [es:edi], 0
  9691 00004DB3 75F6                <3> jne %%next_clean
  9692 00004DB5 66FF0D[98300000]    <2> dec word [ISAPNP_DEVICE_PORT]
  9693                              <2> 
  9694                              <2> check_port:
  9695 00004DBC 66FF05[98300000]    <2> inc word [ISAPNP_DEVICE_PORT]
  9696 00004DC3 66A1[98300000]      <2> mov ax, [ISAPNP_DEVICE_PORT]
  9697                              <2> ;;;cmp ax, ISAPNP_DEVICE_PORT_END
  9698 00004DC9 663D0402            <2> cmp ax, 0x204
  9699 00004DCD 7407                <2> je end_isapnp
  9700 00004DCF EA[B44C0000]0800    <2> jmp dword 0x0008:next_port
  9701                              <2> end_isapnp:
  9702 00004DD6 CB                  <2> retf
  9703                              <2> 
  9704                              <2> biospnp_info:
  9705                              <2> ;===============================================;
  9706                              <2> ; Checking PNP BIOS...                          ;
  9707                              <2> ;===============================================;
  9708                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,pnp_bios_msg
  9709                              <3> 
  9710 00004DD7 FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9711 00004DDD 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9712 00004DE4 7C14                <3> jl %%skip_window_up
  9713 00004DE6 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9714 00004DED 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9715 00004DF4 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9716                              <3> %%skip_window_up:
  9717                              <3> 
  9718 00004DFA BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9719 00004DFF B8A0000000          <3> mov eax, 160
  9720 00004E04 31DB                <3> xor ebx, ebx
  9721 00004E06 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9722 00004E0C F7E3                <3> mul ebx
  9723 00004E0E 01C7                <3> add edi, eax
  9724                              <3> 
  9725 00004E10 BE[E9550000]        <3> mov esi, %3
  9726 00004E15 B407                <3> mov ah, %2
  9727                              <3> %%next_char1:
  9728 00004E17 268A06              <3> mov al, byte [es:esi]
  9729 00004E1A 26668907            <3> mov word [es:edi], ax
  9730 00004E1E 47<rept>            <3> times 2 inc edi
  9731 00004E20 46                  <3> inc esi
  9732 00004E21 26803E00            <3> cmp byte [es:esi], 0x00
  9733 00004E25 75F0                <3> jne %%next_char1
  9734                              <2> BIOS_pnp_signature      [dword_number]
  9735 00004E27 BF00000F00          <3> mov edi, 0x000F0000
  9736 00004E2C BEFFFF0F00          <3> mov esi, 0x000FFFFF
  9737                              <3> %%check_pnp:
  9738 00004E31 268B07              <3> mov eax, dword [es:edi]
  9739 00004E34 47                  <3> inc edi
  9740 00004E35 3B05[7A210000]      <3> cmp eax, [BIOS_PNP_STRING]
  9741 00004E3B 740A                <3> je %%end_check
  9742 00004E3D 3B7EFD              <3> cmp edi, [esi-3]
  9743 00004E40 75EF                <3> jne %%check_pnp
  9744 00004E42 BF01000000          <3> mov edi, 1
  9745                              <3> %%end_check:
  9746 00004E47 4F                  <3> dec edi
  9747 00004E48 A3[10590000]        <3> mov %1, eax
  9748 00004E4D 813D[10590000]2450- <2> cmp dword [dword_number], '$PnP'
  9749 00004E55 6E50                <2>
  9750 00004E57 7539                <2> jne not_found
  9751 00004E59 31C0                <2> xor eax, eax
  9752 00004E5B A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  9753 00004E60 A3[95540000]        <2> mov [dd_number], eax
  9754                              <2> VIDEO_TEXTMODE_write_mensage         [dd_number],0x16,0x07,found_msg
  9755                              <3> 
  9756                              <3> 
  9757                              <3> 
  9758                              <3> 
  9759                              <3> 
  9760                              <3> 
  9761                              <3> 
  9762                              <3> 
  9763                              <3> 
  9764 00004E65 BF2C800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  9765                              <3> 
  9766 00004E6A B8A0000000          <3> mov eax, 160
  9767 00004E6F 8B1D[95540000]      <3> mov ebx, %1
  9768 00004E75 F7E3                <3> mul ebx
  9769 00004E77 01C7                <3> add edi, eax
  9770                              <3> 
  9771 00004E79 BE[16560000]        <3> mov esi, %4
  9772 00004E7E B407                <3> mov ah, %3
  9773                              <3> %%next_char:
  9774 00004E80 268A06              <3> mov al, byte [es:esi]
  9775 00004E83 26668907            <3> mov word [es:edi], ax
  9776 00004E87 47<rept>            <3> times 2 inc edi
  9777 00004E89 46                  <3> inc esi
  9778 00004E8A 26803E00            <3> cmp byte [es:esi], 0x00
  9779 00004E8E 75F0                <3> jne %%next_char
  9780 00004E90 EB37                <2> jmp short skip_biospnp
  9781                              <2> not_found:
  9782 00004E92 31C0                <2> xor eax, eax
  9783 00004E94 A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  9784 00004E99 A3[95540000]        <2> mov [dd_number], eax
  9785                              <2> VIDEO_TEXTMODE_write_mensage         [dd_number],0x16,0x07,notfound_msg
  9786                              <3> 
  9787                              <3> 
  9788                              <3> 
  9789                              <3> 
  9790                              <3> 
  9791                              <3> 
  9792                              <3> 
  9793                              <3> 
  9794                              <3> 
  9795 00004E9E BF2C800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  9796                              <3> 
  9797 00004EA3 B8A0000000          <3> mov eax, 160
  9798 00004EA8 8B1D[95540000]      <3> mov ebx, %1
  9799 00004EAE F7E3                <3> mul ebx
  9800 00004EB0 01C7                <3> add edi, eax
  9801                              <3> 
  9802 00004EB2 BE[1E560000]        <3> mov esi, %4
  9803 00004EB7 B407                <3> mov ah, %3
  9804                              <3> %%next_char:
  9805 00004EB9 268A06              <3> mov al, byte [es:esi]
  9806 00004EBC 26668907            <3> mov word [es:edi], ax
  9807 00004EC0 47<rept>            <3> times 2 inc edi
  9808 00004EC2 46                  <3> inc esi
  9809 00004EC3 26803E00            <3> cmp byte [es:esi], 0x00
  9810 00004EC7 75F0                <3> jne %%next_char
  9811                              <2> skip_biospnp:
  9812 00004EC9 CB                  <2> retf
  9813                              <2> 
  9814                              <2> vesa_info:
  9815                              <2> ;===============================================;
  9816                              <2> ; Checking VESA Graphics Card...                ;
  9817                              <2> ;===============================================;
  9818                              <2> VIDEO_TEXTMODE_print_line            0x01,0x07,vesa_card_msg
  9819                              <3> 
  9820 00004ECA FE05[A80C0000]      <3> inc byte [VIDEO_TEXTMODE_LINE]
  9821 00004ED0 803D[A80C0000]18    <3> cmp byte [VIDEO_TEXTMODE_LINE], 24
  9822 00004ED7 7C14                <3> jl %%skip_window_up
  9823 00004ED9 C605[A90C0000]04    <3> mov byte [VIDEO_TEXTMODE_WINDOW_LINE_START], 0x04
  9824 00004EE0 9A[04070000]0800    <3> call dword 0x0008:VIDEO_TEXTMODE_window_up
  9825 00004EE7 FE0D[A80C0000]      <3> dec byte [VIDEO_TEXTMODE_LINE]
  9826                              <3> %%skip_window_up:
  9827                              <3> 
  9828 00004EED BF02800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%1
  9829 00004EF2 B8A0000000          <3> mov eax, 160
  9830 00004EF7 31DB                <3> xor ebx, ebx
  9831 00004EF9 8A1D[A80C0000]      <3> mov bl, [VIDEO_TEXTMODE_LINE]
  9832 00004EFF F7E3                <3> mul ebx
  9833 00004F01 01C7                <3> add edi, eax
  9834                              <3> 
  9835 00004F03 BE[FE550000]        <3> mov esi, %3
  9836 00004F08 B407                <3> mov ah, %2
  9837                              <3> %%next_char1:
  9838 00004F0A 268A06              <3> mov al, byte [es:esi]
  9839 00004F0D 26668907            <3> mov word [es:edi], ax
  9840 00004F11 47<rept>            <3> times 2 inc edi
  9841 00004F13 46                  <3> inc esi
  9842 00004F14 26803E00            <3> cmp byte [es:esi], 0x00
  9843 00004F18 75F0                <3> jne %%next_char1
  9844                              <2> VESA_signature      [dword_number]
  9845 00004F1A BF00000000          <3> mov edi, 0
  9846 00004F1F BE007D0000          <3> mov esi, 32000
  9847                              <3> %%check_vesa:
  9848 00004F24 268B07              <3> mov eax, dword [es:edi]
  9849 00004F27 47                  <3> inc edi
  9850 00004F28 3B05[7E210000]      <3> cmp eax, dword [VESA_STRING]
  9851 00004F2E 740A                <3> je %%end_check_vesa
  9852 00004F30 3B7EFD              <3> cmp edi, [esi-3]
  9853 00004F33 75EF                <3> jne %%check_vesa
  9854 00004F35 BF01000000          <3> mov edi, 1
  9855                              <3> %%end_check_vesa:
  9856 00004F3A 4F                  <3> dec edi
  9857 00004F3B 893D[10590000]      <3> mov %1, edi
  9858                              <3> 
  9859 00004F41 813D[10590000]0000- <2> cmp dword [dword_number], 0
  9860 00004F49 0000                <2>
  9861 00004F4B 7439                <2> je not_found1
  9862 00004F4D 31C0                <2> xor eax, eax
  9863 00004F4F A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  9864 00004F54 A3[95540000]        <2> mov [dd_number], eax
  9865                              <2> VIDEO_TEXTMODE_write_mensage         [dd_number],0x19,0x07,found_msg
  9866                              <3> 
  9867                              <3> 
  9868                              <3> 
  9869                              <3> 
  9870                              <3> 
  9871                              <3> 
  9872                              <3> 
  9873                              <3> 
  9874                              <3> 
  9875 00004F59 BF32800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  9876                              <3> 
  9877 00004F5E B8A0000000          <3> mov eax, 160
  9878 00004F63 8B1D[95540000]      <3> mov ebx, %1
  9879 00004F69 F7E3                <3> mul ebx
  9880 00004F6B 01C7                <3> add edi, eax
  9881                              <3> 
  9882 00004F6D BE[16560000]        <3> mov esi, %4
  9883 00004F72 B407                <3> mov ah, %3
  9884                              <3> %%next_char:
  9885 00004F74 268A06              <3> mov al, byte [es:esi]
  9886 00004F77 26668907            <3> mov word [es:edi], ax
  9887 00004F7B 47<rept>            <3> times 2 inc edi
  9888 00004F7D 46                  <3> inc esi
  9889 00004F7E 26803E00            <3> cmp byte [es:esi], 0x00
  9890 00004F82 75F0                <3> jne %%next_char
  9891 00004F84 EB37                <2> jmp short skip_vesa
  9892                              <2> not_found1:
  9893 00004F86 31C0                <2> xor eax, eax
  9894 00004F88 A0[A80C0000]        <2> mov al, [VIDEO_TEXTMODE_LINE]
  9895 00004F8D A3[95540000]        <2> mov [dd_number], eax
  9896                              <2> VIDEO_TEXTMODE_write_mensage         [dd_number],0x19,0x07,notfound_msg
  9897                              <3> 
  9898                              <3> 
  9899                              <3> 
  9900                              <3> 
  9901                              <3> 
  9902                              <3> 
  9903                              <3> 
  9904                              <3> 
  9905                              <3> 
  9906 00004F92 BF32800B00          <3> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
  9907                              <3> 
  9908 00004F97 B8A0000000          <3> mov eax, 160
  9909 00004F9C 8B1D[95540000]      <3> mov ebx, %1
  9910 00004FA2 F7E3                <3> mul ebx
  9911 00004FA4 01C7                <3> add edi, eax
  9912                              <3> 
  9913 00004FA6 BE[1E560000]        <3> mov esi, %4
  9914 00004FAB B407                <3> mov ah, %3
  9915                              <3> %%next_char:
  9916 00004FAD 268A06              <3> mov al, byte [es:esi]
  9917 00004FB0 26668907            <3> mov word [es:edi], ax
  9918 00004FB4 47<rept>            <3> times 2 inc edi
  9919 00004FB6 46                  <3> inc esi
  9920 00004FB7 26803E00            <3> cmp byte [es:esi], 0x00
  9921 00004FBB 75F0                <3> jne %%next_char
  9922                              <2> skip_vesa:
  9923 00004FBD CB                  <2> retf
  9924                              <2> 
  9925                              <2> 
  9926                              <2> 
  9927                              <1> 
  9928                              <1> task2:
  9929                              <1> ;;; TODO: buffer of 80 chars, SPACES when end of string 
  9930                              <1> repeat_scroll:
  9931                              <1> 
  9932                              <1> ;;;;;;;;;; RIGHT SCROLL
  9933 00004FBE BFE0810B00          <1> mov edi, 0x000B8000 + 160*0x03
  9934 00004FC3 BE[50540000]        <1> mov esi, scroll_mensage
  9935 00004FC8 B40E                <1> mov ah, 0x0E	; COLOR
  9936 00004FCA 60                  <1> pusha
  9937                              <1> next_s:
  9938 00004FCB 61                  <1> popa
  9939 00004FCC 4F<rept>            <1> times 2 dec edi
  9940 00004FCE 60                  <1> pusha
  9941                              <1> next_c:
  9942 00004FCF 268A06              <1> mov al, byte [es:esi]
  9943 00004FD2 26668907            <1> mov word [es:edi], ax
  9944 00004FD6 46                  <1> inc esi
  9945 00004FD7 47<rept>            <1> times 2 inc edi
  9946 00004FD9 81FFE0810B00        <1> cmp edi, 0x000B8000 + 160*0x03
  9947 00004FDF 75EE                <1> jne next_c
  9948                              <1> ;;; TIMER_pit_msdelay        100 
  9949                              <1> TIMER_rtc_msdelay        100 
  9950 00004FE1 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  9951 00004FE6 31DB                <2> xor ebx, ebx
  9952 00004FE8 BB64000000          <2> mov ebx, %1
  9953 00004FED 01D8                <2> add eax, ebx
  9954 00004FEF 93                  <2> xchg eax, ebx
  9955                              <2> 
  9956                              <2> 
  9957                              <2> 
  9958                              <2> %%check_rtc:
  9959 00004FF0 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  9960 00004FF5 39D8                <2> cmp eax, ebx
  9961 00004FF7 7CF7                <2> jl %%check_rtc
  9962                              <2> 
  9963 00004FF9 26803E00            <1> cmp byte [es:esi], 0
  9964 00004FFD 75CC                <1> jne next_s
  9965                              <1> ;;;;;;;;;; CENTER SCROLL
  9966 00004FFF 61                  <1> popa
  9967                              <1> ;mov esi, scroll_mensage
  9968                              <1> ;mov ah, 0x0E	; COLOR
  9969 00005000 60                  <1> pusha
  9970                              <1> next_s1:
  9971 00005001 61                  <1> popa 
  9972 00005002 4F<rept>            <1> times 2 dec edi
  9973 00005004 81FF3E810B00        <1> cmp edi, 0x000B8000 + 160*0x02 - 2*0x01
  9974 0000500A 7436                <1> je skip_next_s1
  9975 0000500C 60                  <1> pusha
  9976                              <1> next_c1:
  9977 0000500D 268A06              <1> mov al, byte [es:esi]
  9978 00005010 26668907            <1> mov word [es:edi], ax
  9979 00005014 46                  <1> inc esi
  9980 00005015 47<rept>            <1> times 2 inc edi
  9981 00005017 26803E00            <1> cmp byte [es:esi], 0
  9982 0000501B 75F0                <1> jne next_c1
  9983 0000501D 2666C7070000        <1> mov word [es:edi], 0
  9984                              <1> ;;; TIMER_pit_msdelay        100 
  9985                              <1> TIMER_rtc_msdelay        100 
  9986 00005023 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  9987 00005028 31DB                <2> xor ebx, ebx
  9988 0000502A BB64000000          <2> mov ebx, %1
  9989 0000502F 01D8                <2> add eax, ebx
  9990 00005031 93                  <2> xchg eax, ebx
  9991                              <2> 
  9992                              <2> 
  9993                              <2> 
  9994                              <2> %%check_rtc:
  9995 00005032 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
  9996 00005037 39D8                <2> cmp eax, ebx
  9997 00005039 7CF7                <2> jl %%check_rtc
  9998                              <2> 
  9999 0000503B EA[01500000]0800    <1> jmp dword 0x0008:next_s1
 10000                              <1> skip_next_s1:
 10001                              <1> ;;;;;;;;;; LEFT SCROLL
 10002 00005042 BF40810B00          <1> mov edi, 0x000B8000 + 160*0x02
 10003 00005047 BE[50540000]        <1> mov esi, scroll_mensage
 10004 0000504C B40E                <1> mov ah, 0x0E	; COLOR
 10005 0000504E 60                  <1> pusha
 10006                              <1> next_s2:
 10007 0000504F 61                  <1> popa
 10008 00005050 46                  <1> inc esi
 10009 00005051 60                  <1> pusha
 10010                              <1> next_c2:
 10011 00005052 268A06              <1> mov al, byte [es:esi]
 10012 00005055 26668907            <1> mov word [es:edi], ax
 10013 00005059 46                  <1> inc esi
 10014 0000505A 47<rept>            <1> times 2 inc edi
 10015 0000505C 26803E00            <1> cmp byte [es:esi], 0
 10016 00005060 75F0                <1> jne next_c2
 10017 00005062 2666C7070000        <1> mov word [es:edi], 0
 10018                              <1> ;;; TIMER_pit_msdelay        100 
 10019                              <1> TIMER_rtc_msdelay        100 
 10020 00005068 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
 10021 0000506D 31DB                <2> xor ebx, ebx
 10022 0000506F BB64000000          <2> mov ebx, %1
 10023 00005074 01D8                <2> add eax, ebx
 10024 00005076 93                  <2> xchg eax, ebx
 10025                              <2> 
 10026                              <2> 
 10027                              <2> 
 10028                              <2> %%check_rtc:
 10029 00005077 A1[E4060000]        <2> mov eax, [TIMER_RTC_TICKS]
 10030 0000507C 39D8                <2> cmp eax, ebx
 10031 0000507E 7CF7                <2> jl %%check_rtc
 10032                              <2> 
 10033 00005080 81FF42810B00        <1> cmp edi, 0x000B8000 + 160*0x02 + 2*0x01 
 10034 00005086 75C7                <1> jne next_s2
 10035 00005088 4F<rept>            <1> times 2 dec edi
 10036 0000508A 2666C7070000        <1> mov word [es:edi], 0
 10037                              <1> 
 10038 00005090 803D[2E550000]01    <1> cmp byte [faded], 1
 10039 00005097 7407                <1> je skip_faded
 10040 00005099 9A[A0080000]0800    <1> call dword 0x0008:VIDEO_VGA_fadein
 10041                              <1> ;;; FADE IN, after all task's had shown their program image
 10042                              <1> skip_faded:
 10043 000050A0 EA[BE4F0000]0800    <1> jmp dword 0x0008:repeat_scroll
 10044 000050A7 CB                  <1> retf
 10045                              <1> 
 10046                              <1> task3:
 10047                              <1> ;;; TIME
 10048                              <1> repeat_time:
 10049                              <1> CMOS_rtc_ready
 10050                              <2> %%rtc_check
 10051                              <2> CMOS_read_address CMOS_RTC_STATUS_REGA_ADDRESS, [CMOS_TEMP_VALUE]
 10052 000050A8 FA                  <3> cli
 10053                              <3> 
 10054                              <3> 
 10055                              <3> 
 10056 000050A9 B00A                <3> mov al, %1
 10057 000050AB E670                <3> out 0x70,al
 10058 000050AD 31C0                <3> xor eax, eax
 10059 000050AF EB00                <3> jmp short $+2
 10060 000050B1 E471                <3> in al,0x71
 10061 000050B3 A3[8D060000]        <3> mov %2, eax
 10062 000050B8 FB                  <3> sti
 10063 000050B9 A1[8D060000]        <2> mov eax, [CMOS_TEMP_VALUE]
 10064 000050BE C1E807              <2> shr eax, 7
 10065 000050C1 2501000000          <2> and eax, 1
 10066 000050C6 3D01000000          <2> cmp eax, 1
 10067 000050CB 74DB                <2> je %%rtc_check
 10068                              <1> CMOS_read_address               CMOS_TIME_HOUR_ADDRESS,dword [dd_number]
 10069 000050CD FA                  <2> cli
 10070                              <2> 
 10071                              <2> 
 10072                              <2> 
 10073 000050CE B004                <2> mov al, %1
 10074 000050D0 E670                <2> out 0x70,al
 10075 000050D2 31C0                <2> xor eax, eax
 10076 000050D4 EB00                <2> jmp short $+2
 10077 000050D6 E471                <2> in al,0x71
 10078 000050D8 A3[95540000]        <2> mov %2, eax
 10079 000050DD FB                  <2> sti
 10080                              <1> number_to_text  [dd_number], 16, time_string+1 
 10081                              <2> 
 10082                              <2> 
 10083                              <2> 
 10084 000050DE BF[74540000]        <2> mov edi, %3
 10085 000050E3 BE[03060000]        <2> mov esi, UTIL_HEX_DIGITS
 10086 000050E8 A1[95540000]        <2> mov eax, %1
 10087 000050ED BB10000000          <2> mov ebx, %2
 10088                              <2> %%divide:
 10089 000050F2 31D2                <2> xor edx, edx
 10090 000050F4 F7F3                <2> div ebx
 10091 000050F6 3E8A0C16            <2> mov cl, byte [ds:esi+edx]
 10092 000050FA 3E880F              <2> mov byte [ds:edi], cl
 10093 000050FD 4F                  <2> dec edi
 10094 000050FE 39D8                <2> cmp eax, ebx
 10095 00005100 7DF0                <2> jge %%divide
 10096 00005102 3D00000000          <2> cmp eax, 0
 10097 00005107 7407                <2> je %%end
 10098 00005109 3E8A0C06            <2> mov cl, byte [ds:esi+eax]
 10099 0000510D 26880F              <2> mov byte [es:edi], cl
 10100                              <2> %%end:
 10101                              <1> CMOS_rtc_ready
 10102                              <2> %%rtc_check
 10103                              <2> CMOS_read_address CMOS_RTC_STATUS_REGA_ADDRESS, [CMOS_TEMP_VALUE]
 10104 00005110 FA                  <3> cli
 10105                              <3> 
 10106                              <3> 
 10107                              <3> 
 10108 00005111 B00A                <3> mov al, %1
 10109 00005113 E670                <3> out 0x70,al
 10110 00005115 31C0                <3> xor eax, eax
 10111 00005117 EB00                <3> jmp short $+2
 10112 00005119 E471                <3> in al,0x71
 10113 0000511B A3[8D060000]        <3> mov %2, eax
 10114 00005120 FB                  <3> sti
 10115 00005121 A1[8D060000]        <2> mov eax, [CMOS_TEMP_VALUE]
 10116 00005126 C1E807              <2> shr eax, 7
 10117 00005129 2501000000          <2> and eax, 1
 10118 0000512E 3D01000000          <2> cmp eax, 1
 10119 00005133 74DB                <2> je %%rtc_check
 10120                              <1> CMOS_read_address               CMOS_TIME_MINUTE_ADDRESS,dword [dd_number]
 10121 00005135 FA                  <2> cli
 10122                              <2> 
 10123                              <2> 
 10124                              <2> 
 10125 00005136 B002                <2> mov al, %1
 10126 00005138 E670                <2> out 0x70,al
 10127 0000513A 31C0                <2> xor eax, eax
 10128 0000513C EB00                <2> jmp short $+2
 10129 0000513E E471                <2> in al,0x71
 10130 00005140 A3[95540000]        <2> mov %2, eax
 10131 00005145 FB                  <2> sti
 10132                              <1> number_to_text  [dd_number], 16, time_string+4
 10133                              <2> 
 10134                              <2> 
 10135                              <2> 
 10136 00005146 BF[77540000]        <2> mov edi, %3
 10137 0000514B BE[03060000]        <2> mov esi, UTIL_HEX_DIGITS
 10138 00005150 A1[95540000]        <2> mov eax, %1
 10139 00005155 BB10000000          <2> mov ebx, %2
 10140                              <2> %%divide:
 10141 0000515A 31D2                <2> xor edx, edx
 10142 0000515C F7F3                <2> div ebx
 10143 0000515E 3E8A0C16            <2> mov cl, byte [ds:esi+edx]
 10144 00005162 3E880F              <2> mov byte [ds:edi], cl
 10145 00005165 4F                  <2> dec edi
 10146 00005166 39D8                <2> cmp eax, ebx
 10147 00005168 7DF0                <2> jge %%divide
 10148 0000516A 3D00000000          <2> cmp eax, 0
 10149 0000516F 7407                <2> je %%end
 10150 00005171 3E8A0C06            <2> mov cl, byte [ds:esi+eax]
 10151 00005175 26880F              <2> mov byte [es:edi], cl
 10152                              <2> %%end:
 10153                              <1> CMOS_rtc_ready
 10154                              <2> %%rtc_check
 10155                              <2> CMOS_read_address CMOS_RTC_STATUS_REGA_ADDRESS, [CMOS_TEMP_VALUE]
 10156 00005178 FA                  <3> cli
 10157                              <3> 
 10158                              <3> 
 10159                              <3> 
 10160 00005179 B00A                <3> mov al, %1
 10161 0000517B E670                <3> out 0x70,al
 10162 0000517D 31C0                <3> xor eax, eax
 10163 0000517F EB00                <3> jmp short $+2
 10164 00005181 E471                <3> in al,0x71
 10165 00005183 A3[8D060000]        <3> mov %2, eax
 10166 00005188 FB                  <3> sti
 10167 00005189 A1[8D060000]        <2> mov eax, [CMOS_TEMP_VALUE]
 10168 0000518E C1E807              <2> shr eax, 7
 10169 00005191 2501000000          <2> and eax, 1
 10170 00005196 3D01000000          <2> cmp eax, 1
 10171 0000519B 74DB                <2> je %%rtc_check
 10172                              <1> CMOS_read_address               CMOS_TIME_SECOND_ADDRESS,dword [dd_number]
 10173 0000519D FA                  <2> cli
 10174                              <2> 
 10175                              <2> 
 10176                              <2> 
 10177 0000519E B000                <2> mov al, %1
 10178 000051A0 E670                <2> out 0x70,al
 10179 000051A2 31C0                <2> xor eax, eax
 10180 000051A4 EB00                <2> jmp short $+2
 10181 000051A6 E471                <2> in al,0x71
 10182 000051A8 A3[95540000]        <2> mov %2, eax
 10183 000051AD FB                  <2> sti
 10184                              <1> number_to_text  [dd_number], 16, time_string+7
 10185                              <2> 
 10186                              <2> 
 10187                              <2> 
 10188 000051AE BF[7A540000]        <2> mov edi, %3
 10189 000051B3 BE[03060000]        <2> mov esi, UTIL_HEX_DIGITS
 10190 000051B8 A1[95540000]        <2> mov eax, %1
 10191 000051BD BB10000000          <2> mov ebx, %2
 10192                              <2> %%divide:
 10193 000051C2 31D2                <2> xor edx, edx
 10194 000051C4 F7F3                <2> div ebx
 10195 000051C6 3E8A0C16            <2> mov cl, byte [ds:esi+edx]
 10196 000051CA 3E880F              <2> mov byte [ds:edi], cl
 10197 000051CD 4F                  <2> dec edi
 10198 000051CE 39D8                <2> cmp eax, ebx
 10199 000051D0 7DF0                <2> jge %%divide
 10200 000051D2 3D00000000          <2> cmp eax, 0
 10201 000051D7 7407                <2> je %%end
 10202 000051D9 3E8A0C06            <2> mov cl, byte [ds:esi+eax]
 10203 000051DD 26880F              <2> mov byte [es:edi], cl
 10204                              <2> %%end:
 10205                              <1> VIDEO_TEXTMODE_write_mensage            0x01,35,0x0F,time_string
 10206                              <2> 
 10207                              <2> 
 10208                              <2> 
 10209                              <2> 
 10210                              <2> 
 10211                              <2> 
 10212                              <2> 
 10213                              <2> 
 10214                              <2> 
 10215 000051E0 BF46800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
 10216                              <2> 
 10217 000051E5 B8A0000000          <2> mov eax, 160
 10218 000051EA BB01000000          <2> mov ebx, %1
 10219 000051EF F7E3                <2> mul ebx
 10220 000051F1 01C7                <2> add edi, eax
 10221                              <2> 
 10222 000051F3 BE[73540000]        <2> mov esi, %4
 10223 000051F8 B40F                <2> mov ah, %3
 10224                              <2> %%next_char:
 10225 000051FA 268A06              <2> mov al, byte [es:esi]
 10226 000051FD 26668907            <2> mov word [es:edi], ax
 10227 00005201 47<rept>            <2> times 2 inc edi
 10228 00005203 46                  <2> inc esi
 10229 00005204 26803E00            <2> cmp byte [es:esi], 0x00
 10230 00005208 75F0                <2> jne %%next_char
 10231 0000520A 66B83030            <1> mov ax, '00'
 10232 0000520E BF[73540000]        <1> mov edi, time_string
 10233 00005213 26668907            <1> mov word [es:edi], ax
 10234 00005217 2666894703          <1> mov word [es:edi+3], ax
 10235 0000521C 2666894706          <1> mov word [es:edi+6], ax
 10236 00005221 EA[A8500000]0800    <1> jmp dword 0x0008:repeat_time
 10237 00005228 CB                  <1> retf
 10238                              <1> 
 10239                              <1> task4:
 10240                              <1> ;;; DATE
 10241                              <1> repeat_date:
 10242                              <1> CMOS_rtc_ready
 10243                              <2> %%rtc_check
 10244                              <2> CMOS_read_address CMOS_RTC_STATUS_REGA_ADDRESS, [CMOS_TEMP_VALUE]
 10245 00005229 FA                  <3> cli
 10246                              <3> 
 10247                              <3> 
 10248                              <3> 
 10249 0000522A B00A                <3> mov al, %1
 10250 0000522C E670                <3> out 0x70,al
 10251 0000522E 31C0                <3> xor eax, eax
 10252 00005230 EB00                <3> jmp short $+2
 10253 00005232 E471                <3> in al,0x71
 10254 00005234 A3[8D060000]        <3> mov %2, eax
 10255 00005239 FB                  <3> sti
 10256 0000523A A1[8D060000]        <2> mov eax, [CMOS_TEMP_VALUE]
 10257 0000523F C1E807              <2> shr eax, 7
 10258 00005242 2501000000          <2> and eax, 1
 10259 00005247 3D01000000          <2> cmp eax, 1
 10260 0000524C 74DB                <2> je %%rtc_check
 10261                              <1> CMOS_read_address       	CMOS_DATE_DAYOFMONTH_ADDRESS,dword [dd_number]
 10262 0000524E FA                  <2> cli
 10263                              <2> 
 10264                              <2> 
 10265                              <2> 
 10266 0000524F B007                <2> mov al, %1
 10267 00005251 E670                <2> out 0x70,al
 10268 00005253 31C0                <2> xor eax, eax
 10269 00005255 EB00                <2> jmp short $+2
 10270 00005257 E471                <2> in al,0x71
 10271 00005259 A3[95540000]        <2> mov %2, eax
 10272 0000525E FB                  <2> sti
 10273                              <1> number_to_text  [dd_number], 16, date_string+1 
 10274                              <2> 
 10275                              <2> 
 10276                              <2> 
 10277 0000525F BF[7D540000]        <2> mov edi, %3
 10278 00005264 BE[03060000]        <2> mov esi, UTIL_HEX_DIGITS
 10279 00005269 A1[95540000]        <2> mov eax, %1
 10280 0000526E BB10000000          <2> mov ebx, %2
 10281                              <2> %%divide:
 10282 00005273 31D2                <2> xor edx, edx
 10283 00005275 F7F3                <2> div ebx
 10284 00005277 3E8A0C16            <2> mov cl, byte [ds:esi+edx]
 10285 0000527B 3E880F              <2> mov byte [ds:edi], cl
 10286 0000527E 4F                  <2> dec edi
 10287 0000527F 39D8                <2> cmp eax, ebx
 10288 00005281 7DF0                <2> jge %%divide
 10289 00005283 3D00000000          <2> cmp eax, 0
 10290 00005288 7407                <2> je %%end
 10291 0000528A 3E8A0C06            <2> mov cl, byte [ds:esi+eax]
 10292 0000528E 26880F              <2> mov byte [es:edi], cl
 10293                              <2> %%end:
 10294                              <1> CMOS_rtc_ready
 10295                              <2> %%rtc_check
 10296                              <2> CMOS_read_address CMOS_RTC_STATUS_REGA_ADDRESS, [CMOS_TEMP_VALUE]
 10297 00005291 FA                  <3> cli
 10298                              <3> 
 10299                              <3> 
 10300                              <3> 
 10301 00005292 B00A                <3> mov al, %1
 10302 00005294 E670                <3> out 0x70,al
 10303 00005296 31C0                <3> xor eax, eax
 10304 00005298 EB00                <3> jmp short $+2
 10305 0000529A E471                <3> in al,0x71
 10306 0000529C A3[8D060000]        <3> mov %2, eax
 10307 000052A1 FB                  <3> sti
 10308 000052A2 A1[8D060000]        <2> mov eax, [CMOS_TEMP_VALUE]
 10309 000052A7 C1E807              <2> shr eax, 7
 10310 000052AA 2501000000          <2> and eax, 1
 10311 000052AF 3D01000000          <2> cmp eax, 1
 10312 000052B4 74DB                <2> je %%rtc_check
 10313                              <1> CMOS_read_address       	CMOS_DATE_MONTH_ADDRESS,dword [dd_number]
 10314 000052B6 FA                  <2> cli
 10315                              <2> 
 10316                              <2> 
 10317                              <2> 
 10318 000052B7 B008                <2> mov al, %1
 10319 000052B9 E670                <2> out 0x70,al
 10320 000052BB 31C0                <2> xor eax, eax
 10321 000052BD EB00                <2> jmp short $+2
 10322 000052BF E471                <2> in al,0x71
 10323 000052C1 A3[95540000]        <2> mov %2, eax
 10324 000052C6 FB                  <2> sti
 10325                              <1> number_to_text  [dd_number], 16, date_string+4
 10326                              <2> 
 10327                              <2> 
 10328                              <2> 
 10329 000052C7 BF[80540000]        <2> mov edi, %3
 10330 000052CC BE[03060000]        <2> mov esi, UTIL_HEX_DIGITS
 10331 000052D1 A1[95540000]        <2> mov eax, %1
 10332 000052D6 BB10000000          <2> mov ebx, %2
 10333                              <2> %%divide:
 10334 000052DB 31D2                <2> xor edx, edx
 10335 000052DD F7F3                <2> div ebx
 10336 000052DF 3E8A0C16            <2> mov cl, byte [ds:esi+edx]
 10337 000052E3 3E880F              <2> mov byte [ds:edi], cl
 10338 000052E6 4F                  <2> dec edi
 10339 000052E7 39D8                <2> cmp eax, ebx
 10340 000052E9 7DF0                <2> jge %%divide
 10341 000052EB 3D00000000          <2> cmp eax, 0
 10342 000052F0 7407                <2> je %%end
 10343 000052F2 3E8A0C06            <2> mov cl, byte [ds:esi+eax]
 10344 000052F6 26880F              <2> mov byte [es:edi], cl
 10345                              <2> %%end:
 10346                              <1> CMOS_rtc_ready
 10347                              <2> %%rtc_check
 10348                              <2> CMOS_read_address CMOS_RTC_STATUS_REGA_ADDRESS, [CMOS_TEMP_VALUE]
 10349 000052F9 FA                  <3> cli
 10350                              <3> 
 10351                              <3> 
 10352                              <3> 
 10353 000052FA B00A                <3> mov al, %1
 10354 000052FC E670                <3> out 0x70,al
 10355 000052FE 31C0                <3> xor eax, eax
 10356 00005300 EB00                <3> jmp short $+2
 10357 00005302 E471                <3> in al,0x71
 10358 00005304 A3[8D060000]        <3> mov %2, eax
 10359 00005309 FB                  <3> sti
 10360 0000530A A1[8D060000]        <2> mov eax, [CMOS_TEMP_VALUE]
 10361 0000530F C1E807              <2> shr eax, 7
 10362 00005312 2501000000          <2> and eax, 1
 10363 00005317 3D01000000          <2> cmp eax, 1
 10364 0000531C 74DB                <2> je %%rtc_check
 10365                              <1> CMOS_read_address               CMOS_DATE_YEAR_ADDRESS,dword [dd_number]
 10366 0000531E FA                  <2> cli
 10367                              <2> 
 10368                              <2> 
 10369                              <2> 
 10370 0000531F B009                <2> mov al, %1
 10371 00005321 E670                <2> out 0x70,al
 10372 00005323 31C0                <2> xor eax, eax
 10373 00005325 EB00                <2> jmp short $+2
 10374 00005327 E471                <2> in al,0x71
 10375 00005329 A3[95540000]        <2> mov %2, eax
 10376 0000532E FB                  <2> sti
 10377                              <1> number_to_text  [dd_number], 16, date_string+7
 10378                              <2> 
 10379                              <2> 
 10380                              <2> 
 10381 0000532F BF[83540000]        <2> mov edi, %3
 10382 00005334 BE[03060000]        <2> mov esi, UTIL_HEX_DIGITS
 10383 00005339 A1[95540000]        <2> mov eax, %1
 10384 0000533E BB10000000          <2> mov ebx, %2
 10385                              <2> %%divide:
 10386 00005343 31D2                <2> xor edx, edx
 10387 00005345 F7F3                <2> div ebx
 10388 00005347 3E8A0C16            <2> mov cl, byte [ds:esi+edx]
 10389 0000534B 3E880F              <2> mov byte [ds:edi], cl
 10390 0000534E 4F                  <2> dec edi
 10391 0000534F 39D8                <2> cmp eax, ebx
 10392 00005351 7DF0                <2> jge %%divide
 10393 00005353 3D00000000          <2> cmp eax, 0
 10394 00005358 7407                <2> je %%end
 10395 0000535A 3E8A0C06            <2> mov cl, byte [ds:esi+eax]
 10396 0000535E 26880F              <2> mov byte [es:edi], cl
 10397                              <2> %%end:
 10398                              <1> VIDEO_TEXTMODE_write_mensage		0x01, 65, 0x0F, date_string
 10399                              <2> 
 10400                              <2> 
 10401                              <2> 
 10402                              <2> 
 10403                              <2> 
 10404                              <2> 
 10405                              <2> 
 10406                              <2> 
 10407                              <2> 
 10408 00005361 BF82800B00          <2> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
 10409                              <2> 
 10410 00005366 B8A0000000          <2> mov eax, 160
 10411 0000536B BB01000000          <2> mov ebx, %1
 10412 00005370 F7E3                <2> mul ebx
 10413 00005372 01C7                <2> add edi, eax
 10414                              <2> 
 10415 00005374 BE[7C540000]        <2> mov esi, %4
 10416 00005379 B40F                <2> mov ah, %3
 10417                              <2> %%next_char:
 10418 0000537B 268A06              <2> mov al, byte [es:esi]
 10419 0000537E 26668907            <2> mov word [es:edi], ax
 10420 00005382 47<rept>            <2> times 2 inc edi
 10421 00005384 46                  <2> inc esi
 10422 00005385 26803E00            <2> cmp byte [es:esi], 0x00
 10423 00005389 75F0                <2> jne %%next_char
 10424 0000538B 66B83030            <1> mov ax, '00'
 10425 0000538F BF[7C540000]        <1> mov edi, date_string
 10426 00005394 26668907            <1> mov word [es:edi], ax
 10427 00005398 2666894703          <1> mov word [es:edi+3], ax
 10428 0000539D 2666894706          <1> mov word [es:edi+6], ax
 10429 000053A2 EA[29520000]0800    <1> jmp dword 0x0008:repeat_date
 10430 000053A9 CB                  <1> retf
 10431                              <1> 
 10432                              <1> 
 10433                              <1> ;=====================================================================
 10434                              <1> ;shell_string		DB '[root@localhost root]$',0
 10435 000053AA 5B726F6F74406C6F63- <1> shell_string		DB '[root@localhost /]$',0
 10436 000053B3 616C686F7374202F5D- <1>
 10437 000053BC 2400                <1>
 10438 000053BE 00000000            <1> COMMAND_TEMP_VALUE	DD 0
 10439 000053C2 64697200            <1> COMMAND_DIR_STRING   	DB 'dir',0
 10440 000053C6 63707500            <1> COMMAND_CPU_STRING   	DB 'cpu',0
 10441 000053CA 72616D00            <1> COMMAND_RAM_STRING   	DB 'ram',0
 10442 000053CE 70636900            <1> COMMAND_PCI_STRING   	DB 'pci',0
 10443 000053D2 62696F73706E7000    <1> COMMAND_BIOSPNP_STRING 	DB 'biospnp',0
 10444 000053DA 7665736100          <1> COMMAND_VESA_STRING   	DB 'vesa',0
 10445 000053DF 697361706E7000      <1> COMMAND_ISAPNP_STRING 	DB 'isapnp',0
 10446 000053E6 7265626F6F7400      <1> COMMAND_REBOOT_STRING 	DB 'reboot',0
 10447 000053ED 636F6465727300      <1> COMMAND_CODERS_STRING 	DB 'coders',0
 10448 000053F4 68656C7000          <1> COMMAND_HELP_STRING 	DB 'help',0
 10449 000053F9 202020202020202020- <1> line_string             DB '                                                   rev                         ',0
 10450 00005402 202020202020202020- <1>
 10451 0000540B 202020202020202020- <1>
 10452 00005414 202020202020202020- <1>
 10453 0000541D 202020202020202020- <1>
 10454 00005426 202020202020726576- <1>
 10455 0000542F 202020202020202020- <1>
 10456 00005438 202020202020202020- <1>
 10457 00005441 2020202020202000    <1>
 10458 00005449 00000000            <1> command_input_position	DD 0
 10459 0000544D 00                  <1> key			DB 0
 10460 0000544E 00                  <1> ascii			DB 0
 10461 0000544F 00                  <1> color			DB 0
 10462 00005450 57656C636F6D652074- <1> scroll_mensage  	DB 'Welcome to Heaven Operating System',0
 10463 00005459 6F2048656176656E20- <1>
 10464 00005462 4F7065726174696E67- <1>
 10465 0000546B 2053797374656D00    <1>
 10466                              <1> scroll_mensage_size 	equ $-scroll_mensage
 10467 00005473 30303A30303A303000  <1> time_string		DB '00:00:00',0
 10468 0000547C 30302D30302D303000  <1> date_string		DB '00-00-00',0
 10469 00005485 5461736B73203A2031- <1> tasks_string		DB 'Tasks : 1 2 3 4',0
 10470 0000548E 20322033203400      <1>
 10471 00005495 00000000            <1> dd_number		DD 0
 10472 00005499 202020202020202020- <1> command_string		DB '                                            ',0
 10473 000054A2 202020202020202020- <1>
 10474 000054AB 202020202020202020- <1>
 10475 000054B4 202020202020202020- <1>
 10476 000054BD 202020202020202000  <1>
 10477 000054C6 00000000            <1> command_position	DD 0
 10478 000054CA 756E6B6E6F776E2063- <1> command_error_msg	DB 'unknown command',0
 10479 000054D3 6F6D6D616E6400      <1>
 10480 000054DA 202020202020202020- <1> file_msg		DB '                                                                               ',0
 10481 000054E3 202020202020202020- <1>
 10482 000054EC 202020202020202020- <1>
 10483 000054F5 202020202020202020- <1>
 10484 000054FE 202020202020202020- <1>
 10485 00005507 202020202020202020- <1>
 10486 00005510 202020202020202020- <1>
 10487 00005519 202020202020202020- <1>
 10488 00005522 2020202020202000    <1>
 10489 0000552A 00000000            <1> FILE_ENTRY		DD 0
 10490 0000552E 00                  <1> faded			DB 0
 10491 0000552F 5265626F6F74696E67- <1> reboot_msg		DB 'Rebooting in 5 seconds',0
 10492 00005538 20696E203520736563- <1>
 10493 00005541 6F6E647300          <1>
 10494 00005546 2E00                <1> reboot_time		DB '.',0
 10495 00005548 436865636B696E6720- <1> cpu_sign_msg            DB 'Checking CPU Signature...',0
 10496 00005551 435055205369676E61- <1>
 10497 0000555A 747572652E2E2E00    <1>
 10498 00005562 436865636B696E6720- <1> cpu_type_msg            DB 'Checking CPU Family...',0
 10499 0000556B 4350552046616D696C- <1>
 10500 00005574 792E2E2E00          <1>
 10501 00005579 383020383600        <1> cpu_type                DB '80 86',0
 10502 0000557F 436865636B696E6720- <1> cpu_id_msg              DB 'Checking CPU ID...',0
 10503 00005588 4350552049442E2E2E- <1>
 10504 00005591 00                  <1>
 10505 00005592 436865636B696E6720- <1> pc_ram_msg              DB 'Checking RAM...',0
 10506 0000559B 52414D2E2E2E00      <1>
 10507 000055A2 20202020204D4200    <1> pc_ram                  DB '     MB',0
 10508 000055AA 436865636B696E6720- <1> pci_devices_msg         DB 'Checking PCI Devices...',0
 10509 000055B3 504349204465766963- <1>
 10510 000055BC 65732E2E2E00        <1>
 10511 000055C2 0000                <1> device                  DW 0
 10512 000055C4 00000000            <1> device_id               DD 0
 10513 000055C8 00                  <1> class_id                DB 0
 10514 000055C9 00000000            <1> int_line                DD 0
 10515 000055CD 436865636B696E6720- <1> isapnp_devices_msg      DB 'Checking ISA PNP Devices...',0
 10516 000055D6 49534120504E502044- <1>
 10517 000055DF 6576696365732E2E2E- <1>
 10518 000055E8 00                  <1>
 10519 000055E9 436865636B696E6720- <1> pnp_bios_msg            DB 'Checking PNP BIOS...',0
 10520 000055F2 504E502042494F532E- <1>
 10521 000055FB 2E2E00              <1>
 10522 000055FE 436865636B696E6720- <1> vesa_card_msg           DB 'Checking VESA Device...',0
 10523 00005607 564553412044657669- <1>
 10524 00005610 63652E2E2E00        <1>
 10525 00005616 466F756E64202100    <1> found_msg          	DB 'Found !',0
 10526 0000561E 4E6F7420466F756E64- <1> notfound_msg       	DB 'Not Found !',0
 10527 00005627 202100              <1>
 10528                              <1> 
 10529 0000562A 7265626F6F74202D20- <1> help_msg0		DB 'reboot - Reboot PC',0
 10530 00005633 5265626F6F74205043- <1>
 10531 0000563C 00                  <1>
 10532 0000563D 637075202D20436865- <1> help_msg1		DB 'cpu - Check CPU',0
 10533 00005646 636B2043505500      <1>
 10534 0000564D 72616D202D20436865- <1> help_msg2		DB 'ram - Check RAM',0
 10535 00005656 636B2052414D00      <1>
 10536 0000565D 706369202D20436865- <1> help_msg3		DB 'pci - Check PCI Devices',0
 10537 00005666 636B20504349204465- <1>
 10538 0000566F 766963657300        <1>
 10539 00005675 697361706E70202D20- <1> help_msg4		DB 'isapnp - Check ISA PNP Devices',0
 10540 0000567E 436865636B20495341- <1>
 10541 00005687 20504E502044657669- <1>
 10542 00005690 63657300            <1>
 10543 00005694 62696F73706E70202D- <1> help_msg5		DB 'biospnp - Check PNP BIOS Devices',0
 10544 0000569D 20436865636B20504E- <1>
 10545 000056A6 502042494F53204465- <1>
 10546 000056AF 766963657300        <1>
 10547 000056B5 76657361202D204368- <1> help_msg6		DB 'vesa - Check VESA Device',0
 10548 000056BE 65636B205645534120- <1>
 10549 000056C7 44657669636500      <1>
 10550 000056CE 636F64657273202D20- <1> help_msg7		DB 'coders - List of Coders',0
 10551 000056D7 4C697374206F662043- <1>
 10552 000056E0 6F6465727300        <1>
 10553                              <1> 
 10554                              <1> 
 10555                                  
 10556                                  %include "filesystem.inc"
 10557                              <1> 
 10558                              <1> ; Read-Only FileSystem
 10559                              <1> ; commands: "dir" and "cd <directory>"
 10560                              <1> 
 10561                              <1> %macro RAMDISK_read     0
 10562                              <1> mov esi, RAMDISK_ADDRESS
 10563                              <1> add esi, 36352 
 10564                              <1> mov edi, RAMDISK_BUFFER
 10565                              <1> %%next_copy:
 10566                              <1> mov eax, dword [es:esi]
 10567                              <1> mov dword [es:edi], eax
 10568                              <1> add esi, 4
 10569                              <1> add edi, 4
 10570                              <1> cmp edi, RAMDISK_BUFFER+41
 10571                              <1> jl %%next_copy
 10572                              <1> %endmacro
 10573                              <1> 
 10574                              <1> %macro FILESYSTEM_goto_root	0
 10575                              <1> mov esi, RAMDISK_ADDRESS+ROOTDIR_START
 10576                              <1> mov [DIRECTORY_POSITION], esi
 10577                              <1> %endmacro
 10578                              <1> 
 10579                              <1> %macro FILESYSTEM_read_dir_entry  1
 10580                              <1> mov esi, [DIRECTORY_POSITION] 
 10581                              <1> add esi, CLUSTER_SIZE
 10582                              <1> mov eax, %1
 10583                              <1> mov ebx, 4
 10584                              <1> mul ebx
 10585                              <1> add esi, eax 
 10586                              <1> mov eax, dword [es:esi]
 10587                              <1> mov dword %1, eax
 10588                              <1> ; %1 = cluster number
 10589                              <1> ; != 0xFFFFFFFF
 10590                              <1> %endmacro
 10591                              <1> 
 10592                              <1> %macro FILESYSTEM_read_file_header 1
 10593                              <1> mov edi, FILE_HEADER
 10594                              <1> mov esi, RAMDISK_ADDRESS+ROOTDIR_START
 10595                              <1> mov eax, %1
 10596                              <1> mov ebx, CLUSTER_SIZE
 10597                              <1> mul ebx
 10598                              <1> add esi, eax
 10599                              <1> ;mov esi, RAMDISK_ADDRESS+ROOTDIR_START+4096
 10600                              <1> mov dword %1, esi 
 10601                              <1> %%next_header_byte:
 10602                              <1> mov al, byte [es:esi]
 10603                              <1> mov byte [es:edi], al
 10604                              <1> inc esi
 10605                              <1> inc edi
 10606                              <1> cmp edi, FILE_HEADER+FILE_HEADER_SIZE
 10607                              <1> jl %%next_header_byte
 10608                              <1> ; %1 = file position
 10609                              <1> ; information is on FILE_HEADER
 10610                              <1> %endmacro
 10611                              <1> 
 10612                              <1> %macro FILESYSTEM_change_dir	1
 10613                              <1> ; %1 = address of the file name!
 10614                              <1> mov dword [FILESYSTEM_TEMP_VALUE], 0
 10615                              <1> %%next_dir:
 10616                              <1> FILESYSTEM_read_dir_entry	[FILESYSTEM_TEMP_VALUE]
 10617                              <1> FILESYSTEM_read_file_header	[FILESYSTEM_TEMP_VALUE]
 10618                              <1> inc dword [FILESYSTEM_TEMP_VALUE]
 10619                              <1> mov esi, FILE_HEADER
 10620                              <1> mov al, byte [es:esi]
 10621                              <1> and al, 0x01
 10622                              <1> cmp al, 0x01
 10623                              <1> jne %%next_dir
 10624                              <1> 
 10625                              <1> cmp_str FILE_HEADER+1, %1, [BOOLEAN_VALUE]
 10626                              <1> 
 10627                              <1> cmp byte [BOOLEAN_VALUE], 1
 10628                              <1> je %%dir_found
 10629                              <1> cmp dword [FILESYSTEM_TEMP_VALUE], 10
 10630                              <1> jl %%next_dir
 10631                              <1> %%dir_found:
 10632                              <1> 
 10633                              <1> %endmacro
 10634                              <1> 
 10635                              <1> %macro FILESYSTEM_attrib	2	
 10636                              <1> ; %1 = number
 10637                              <1> ; %3 = string address
 10638                              <1> mov edi, %2
 10639                              <1> mov esi, FILESYSTEM_ATTRIB_CHAR+7
 10640                              <1> mov eax, %1
 10641                              <1> mov ebx, 2
 10642                              <1> %%divide1:
 10643                              <1> xor edx, edx
 10644                              <1> div ebx
 10645                              <1> mov cl, byte '-'
 10646                              <1> cmp edx, 1
 10647                              <1> jne %%skip_attrib
 10648                              <1> mov cl, byte [ds:esi]
 10649                              <1> %%skip_attrib:
 10650                              <1> mov byte [ds:edi], cl
 10651                              <1> dec edi
 10652                              <1> dec esi
 10653                              <1> cmp eax, ebx
 10654                              <1> jge %%divide1
 10655                              <1> mov cl, byte '-'
 10656                              <1> cmp eax, 1
 10657                              <1> jne %%skip_attrib1
 10658                              <1> mov cl, byte [ds:esi]
 10659                              <1> %%skip_attrib1:
 10660                              <1> mov byte [es:edi], cl
 10661                              <1> cmp esi, FILESYSTEM_ATTRIB_CHAR
 10662                              <1> jne %%divide1
 10663                              <1> %endmacro
 10664                              <1> 
 10665                              <1> 
 10666                              <1> ;============================================================================
 10667                              <1> RAMDISK_ADDRESS         equ     0x90000
 10668                              <1> ; 0x100000
 10669 000056E6 202020202020202020- <1> RAMDISK_BUFFER          DB '                                                           ',0
 10670 000056EF 202020202020202020- <1>
 10671 000056F8 202020202020202020- <1>
 10672 00005701 202020202020202020- <1>
 10673 0000570A 202020202020202020- <1>
 10674 00005713 202020202020202020- <1>
 10675 0000571C 202020202000        <1>
 10676                              <1> ; times 512 0 for read files
 10677                              <1> FLOPPY_SIZE             equ     (512*18*2*80)   ; 1474560
 10678                              <1> CLUSTER_SIZE            equ     2048
 10679                              <1> FS_START                equ     512
 10680                              <1> FS_ENTRIES              equ     (FLOPPY_SIZE / CLUSTER_SIZE)    ; 720
 10681                              <1> ROOTDIR_START           equ     (FS_START+(4*FS_ENTRIES))+192   ; 3584
 10682 00005722 00000000            <1> DIRECTORY_POSITION	DD	0
 10683                              <1> FILE_HEADER:
 10684 00005726 00                  <1> 			DB	0		; attrib
 10685 00005727 00<rept>            <1> 	       times 35 DB 	0		; name (32 char length+endofline and stuff)
 10686 0000574A 00000000            <1> 	       		DD	0		; length
 10687                              <1> FILE_HEADER_SIZE	equ $-FILE_HEADER
 10688 0000574E 00000000            <1> FILESYSTEM_TEMP_VALUE	DD	0
 10689 00005752 00                  <1> BOOLEAN_VALUE		DB	0
 10690 00005753 2D2D2D2D2D2D2D44    <1> FILESYSTEM_ATTRIB_CHAR	DB '-------D'
 10691                              <1> ;============================================================================
 10692                              <1> 
 10693                              <1> 
 10694                                  
 10695                                  
 10696                                  ;---------------------------------------------------------------------------;
 10697                                  ; KERNEL MAIN CODE                                                          ;
 10698                                  ;---------------------------------------------------------------------------;
 10699                                  kernel_start:
 10700                                  
 10701 0000575B 9A[210E0000]0800        call dword 0x0008:fill_idt	; FILL IDT with INT Addresses
 10702 00005762 0F011D[540E0000]        lidt [idt_ptr]                  ; Load IDT into IDTR
 10703                                  
 10704 00005769 9A[3F060000]0800        call dword 0x0008:PIC_setup	; SETUP PIC
 10705                                  
 10706                                  PIC_master_set_irqs     10111001b ; Disable IRQ0 (Timer INT) 
 10707 00005770 B0B9                <1> mov al, %1
 10708                              <1> 
 10709 00005772 E621                <1> out PIC_MASTER_PORT1,al
 10710                                  
 10711 00005774 9A[7A060000]0800        call dword 0x0008:PIT_setup	; SETUP PIT
 10712                                  
 10713                                  KEYBOARD_init			; Initialize Keyboard
 10714                              <1> KEYBOARD_write 0x60, 0xF5
 10715                              <2> %%get_status_write:
 10716 0000577B E464                <2> in al, KEYBOARD_COMMAND_PORT
 10717 0000577D B402                <2> mov ah, 0x02
 10718 0000577F 20C4                <2> and ah, al
 10719 00005781 80FC02              <2> cmp ah, 0x02
 10720 00005784 74F5                <2> je %%get_status_write
 10721 00005786 6631D2              <2> xor dx, dx
 10722 00005789 B260                <2> mov dl, %1
 10723 0000578B B0F5                <2> mov al, %2
 10724 0000578D EE                  <2> out dx, al
 10725                              <1> 
 10726                              <1> KEYBOARD_write 0x64, 0x60
 10727                              <2> %%get_status_write:
 10728 0000578E E464                <2> in al, KEYBOARD_COMMAND_PORT
 10729 00005790 B402                <2> mov ah, 0x02
 10730 00005792 20C4                <2> and ah, al
 10731 00005794 80FC02              <2> cmp ah, 0x02
 10732 00005797 74F5                <2> je %%get_status_write
 10733 00005799 6631D2              <2> xor dx, dx
 10734 0000579C B264                <2> mov dl, %1
 10735 0000579E B060                <2> mov al, %2
 10736 000057A0 EE                  <2> out dx, al
 10737                              <1> KEYBOARD_write 0x60, 01100101b
 10738                              <2> %%get_status_write:
 10739 000057A1 E464                <2> in al, KEYBOARD_COMMAND_PORT
 10740 000057A3 B402                <2> mov ah, 0x02
 10741 000057A5 20C4                <2> and ah, al
 10742 000057A7 80FC02              <2> cmp ah, 0x02
 10743 000057AA 74F5                <2> je %%get_status_write
 10744 000057AC 6631D2              <2> xor dx, dx
 10745 000057AF B260                <2> mov dl, %1
 10746 000057B1 B065                <2> mov al, %2
 10747 000057B3 EE                  <2> out dx, al
 10748                              <1> KEYBOARD_write 0x60, 0xF6
 10749                              <2> %%get_status_write:
 10750 000057B4 E464                <2> in al, KEYBOARD_COMMAND_PORT
 10751 000057B6 B402                <2> mov ah, 0x02
 10752 000057B8 20C4                <2> and ah, al
 10753 000057BA 80FC02              <2> cmp ah, 0x02
 10754 000057BD 74F5                <2> je %%get_status_write
 10755 000057BF 6631D2              <2> xor dx, dx
 10756 000057C2 B260                <2> mov dl, %1
 10757 000057C4 B0F6                <2> mov al, %2
 10758 000057C6 EE                  <2> out dx, al
 10759                              <1> 
 10760                              <1> 
 10761                              <1> 
 10762                              <1> 
 10763                              <1> KEYBOARD_write 0x60, 0xF7
 10764                              <2> %%get_status_write:
 10765 000057C7 E464                <2> in al, KEYBOARD_COMMAND_PORT
 10766 000057C9 B402                <2> mov ah, 0x02
 10767 000057CB 20C4                <2> and ah, al
 10768 000057CD 80FC02              <2> cmp ah, 0x02
 10769 000057D0 74F5                <2> je %%get_status_write
 10770 000057D2 6631D2              <2> xor dx, dx
 10771 000057D5 B260                <2> mov dl, %1
 10772 000057D7 B0F7                <2> mov al, %2
 10773 000057D9 EE                  <2> out dx, al
 10774                              <1> 
 10775                              <1> KEYBOARD_write 0x60, 0xF3
 10776                              <2> %%get_status_write:
 10777 000057DA E464                <2> in al, KEYBOARD_COMMAND_PORT
 10778 000057DC B402                <2> mov ah, 0x02
 10779 000057DE 20C4                <2> and ah, al
 10780 000057E0 80FC02              <2> cmp ah, 0x02
 10781 000057E3 74F5                <2> je %%get_status_write
 10782 000057E5 6631D2              <2> xor dx, dx
 10783 000057E8 B260                <2> mov dl, %1
 10784 000057EA B0F3                <2> mov al, %2
 10785 000057EC EE                  <2> out dx, al
 10786                              <1> 
 10787                              <1> KEYBOARD_write 0x60, 0
 10788                              <2> %%get_status_write:
 10789 000057ED E464                <2> in al, KEYBOARD_COMMAND_PORT
 10790 000057EF B402                <2> mov ah, 0x02
 10791 000057F1 20C4                <2> and ah, al
 10792 000057F3 80FC02              <2> cmp ah, 0x02
 10793 000057F6 74F5                <2> je %%get_status_write
 10794 000057F8 6631D2              <2> xor dx, dx
 10795 000057FB B260                <2> mov dl, %1
 10796 000057FD B000                <2> mov al, %2
 10797 000057FF EE                  <2> out dx, al
 10798                              <1> 
 10799                              <1> KEYBOARD_write 0x60, 0xF4
 10800                              <2> %%get_status_write:
 10801 00005800 E464                <2> in al, KEYBOARD_COMMAND_PORT
 10802 00005802 B402                <2> mov ah, 0x02
 10803 00005804 20C4                <2> and ah, al
 10804 00005806 80FC02              <2> cmp ah, 0x02
 10805 00005809 74F5                <2> je %%get_status_write
 10806 0000580B 6631D2              <2> xor dx, dx
 10807 0000580E B260                <2> mov dl, %1
 10808 00005810 B0F4                <2> mov al, %2
 10809 00005812 EE                  <2> out dx, al
 10810                              <1> 
 10811                                  
 10812                                  RTC_int_enable                  ; Enable RTC Interrupts
 10813                              <1> 
 10814                              <1> 
 10815                              <1> RTC_read_register 0x0A, RTC_VALUE
 10816 00005813 66BA7000            <2> mov dx, 0x70
 10817 00005817 B00A                <2> mov al, %1
 10818 00005819 EE                  <2> out dx, al
 10819 0000581A EB00                <2> jmp short $+2
 10820 0000581C 66BA7100            <2> mov dx, 0x71
 10821 00005820 EC                  <2> in al, dx
 10822 00005821 A2[DD060000]        <2> mov byte [%2], al
 10823 00005826 8025[DD060000]F0    <1> and byte [RTC_VALUE], 0xF0
 10824                              <1> 
 10825 0000582D 800D[DD060000]06    <1> or byte [RTC_VALUE], 0x06
 10826                              <1> RTC_write_register 0x0A, [RTC_VALUE]
 10827 00005834 66BA7000            <2> mov dx, 0x70
 10828 00005838 B00A                <2> mov al, %1
 10829 0000583A EE                  <2> out dx, al
 10830 0000583B EB00                <2> jmp short $+2
 10831 0000583D 66BA7100            <2> mov dx, 0x71
 10832 00005841 A0[DD060000]        <2> mov al, %2
 10833 00005846 EE                  <2> out dx, al
 10834                              <1> 
 10835                              <1> RTC_read_register 0x0B, RTC_VALUE
 10836 00005847 66BA7000            <2> mov dx, 0x70
 10837 0000584B B00B                <2> mov al, %1
 10838 0000584D EE                  <2> out dx, al
 10839 0000584E EB00                <2> jmp short $+2
 10840 00005850 66BA7100            <2> mov dx, 0x71
 10841 00005854 EC                  <2> in al, dx
 10842 00005855 A2[DD060000]        <2> mov byte [%2], al
 10843 0000585A 800D[DD060000]40    <1> or byte [RTC_VALUE], 0x40
 10844                              <1> RTC_write_register 0x0B, [RTC_VALUE]
 10845 00005861 66BA7000            <2> mov dx, 0x70
 10846 00005865 B00B                <2> mov al, %1
 10847 00005867 EE                  <2> out dx, al
 10848 00005868 EB00                <2> jmp short $+2
 10849 0000586A 66BA7100            <2> mov dx, 0x71
 10850 0000586E A0[DD060000]        <2> mov al, %2
 10851 00005873 EE                  <2> out dx, al
 10852                              <1> 
 10853                              <1> 
 10854                              <1> 
 10855                                  
 10856 00005874 FB                      sti				; Enable Interrupts
 10857                                  
 10858                                  ; TESTING DEBUG ON EXCEPTION (REAL COOL! =)
 10859                                  ;dd 0xABCD00DA			; this will run Exception 13	(GENERAL PROTECTION)
 10860                                  
 10861                                  VIDEO_TEXTMODE_write_mensage 		0x03,0x01,0x07,kernel_msg
 10862                              <1> 
 10863                              <1> 
 10864                              <1> 
 10865                              <1> 
 10866                              <1> 
 10867                              <1> 
 10868                              <1> 
 10869                              <1> 
 10870                              <1> 
 10871 00005875 BF02800B00          <1> mov edi, VIDEO_TEXTMODE_ADDRESS + 2*%2
 10872                              <1> 
 10873 0000587A B8A0000000          <1> mov eax, 160
 10874 0000587F BB03000000          <1> mov ebx, %1
 10875 00005884 F7E3                <1> mul ebx
 10876 00005886 01C7                <1> add edi, eax
 10877                              <1> 
 10878 00005888 BE[F1580000]        <1> mov esi, %4
 10879 0000588D B407                <1> mov ah, %3
 10880                              <1> %%next_char:
 10881 0000588F 268A06              <1> mov al, byte [es:esi]
 10882 00005892 26668907            <1> mov word [es:edi], ax
 10883 00005896 47<rept>            <1> times 2 inc edi
 10884 00005898 46                  <1> inc esi
 10885 00005899 26803E00            <1> cmp byte [es:esi], 0x00
 10886 0000589D 75F0                <1> jne %%next_char
 10887                                  KEYBOARD_check_key 0x1C
 10888 0000589F B31C                <1> mov bl, %1
 10889                              <1> %%repeat_check:
 10890                              <1> 
 10891 000058A1 A0[AE0C0000]        <1> mov al, [KEYBOARD_KEY]
 10892 000058A6 38D8                <1> cmp al, bl
 10893 000058A8 75F7                <1> jne %%repeat_check
 10894 000058AA 30C0                <1> xor al, al
 10895 000058AC A2[AE0C0000]        <1> mov [KEYBOARD_KEY], al
 10896                                  ;===============================================;
 10897                                  ; Copying Filesystem from Floppy to Ramdisk...  ;
 10898                                  ;===============================================;
 10899                                  ;VIDEO_TEXTMODE_write_mensage 		0x04,0x01,0x02,copy_filesystem_msg
 10900                                  ;FLOPPY_copy_to_address
 10901                                  
 10902                                  ;RAMDISK_read
 10903                                  ;VIDEO_TEXTMODE_write_mensage            0x05,0x01,0x07,RAMDISK_BUFFER
 10904                                  ;===============================================;
 10905                                  ; Begin Multi-Tasking!
 10906                                  ;===============================================;
 10907                                  TIMER_rtc_msdelay	2000
 10908 000058B1 A1[E4060000]        <1> mov eax, [TIMER_RTC_TICKS]
 10909 000058B6 31DB                <1> xor ebx, ebx
 10910 000058B8 BBD0070000          <1> mov ebx, %1
 10911 000058BD 01D8                <1> add eax, ebx
 10912 000058BF 93                  <1> xchg eax, ebx
 10913                              <1> 
 10914                              <1> 
 10915                              <1> 
 10916                              <1> %%check_rtc:
 10917 000058C0 A1[E4060000]        <1> mov eax, [TIMER_RTC_TICKS]
 10918 000058C5 39D8                <1> cmp eax, ebx
 10919 000058C7 7CF7                <1> jl %%check_rtc
 10920                              <1> 
 10921 000058C9 9A[53070000]0800        call dword 0x0008:VIDEO_VGA_fadeout
 10922 000058D0 9A[E8060000]0800        call dword 0x0008:VIDEO_TEXTMODE_clear_screen
 10923                                  
 10924 000058D7 9A[5A3B0000]0800        call dword 0x0008:init_tss	; Initialize TSS's
 10925                                  
 10926 000058DE 66B84000                mov ax, sys_tss-gdt 
 10927 000058E2 0F00D8                  ltr ax				; Load First TSS Descriptor into TR
 10928 000058E5 FA                      cli
 10929                                  PIC_master_set_irqs     10111000b ; Enable IRQ0 (Timer INT) 
 10930 000058E6 B0B8                <1> mov al, %1
 10931                              <1> 
 10932 000058E8 E621                <1> out PIC_MASTER_PORT1,al
 10933 000058EA EA[DF3B0000]0800        jmp dword 0x0008:sheduler
 10934                                  
 10935                                  ;=============================================================================;
 10936 000058F1 4C6F6164696E672048-     kernel_msg	 	DB 'Loading HeavenOS Kernel V0.1.4',0
 10937 000058FA 656176656E4F53204B-
 10938 00005903 65726E656C2056302E-
 10939 0000590C 312E3400           
 10940 00005910 00000000                dword_number		DD 0
 10941 00005914 00000000                dword_number2		DD 0
 10942 00005918 0000                    word_number		DW 0
 10943 0000591A 00                      bytenumber		DB 0
 10944 0000591B 202020202020202020-     number_string		DB '          ',0
 10945 00005924 2000               
 10946 00005926 436F7079696E672046-     copy_filesystem_msg	DB 'Copying Filesystem from Floppy to Ramdisk...',0
 10947 0000592F 696C6573797374656D-
 10948 00005938 2066726F6D20466C6F-
 10949 00005941 70707920746F205261-
 10950 0000594A 6D6469736B2E2E2E00 
 10951 00005953 202020202020202020-     temp_string		DB '                                                                               ',0
 10952 0000595C 202020202020202020-
 10953 00005965 202020202020202020-
 10954 0000596E 202020202020202020-
 10955 00005977 202020202020202020-
 10956 00005980 202020202020202020-
 10957 00005989 202020202020202020-
 10958 00005992 202020202020202020-
 10959 0000599B 2020202020202000   
 10960                                  ;=============================================================================;
 10961                                  ;times 64000-($-$$) 	DB 0
 10962                                  ;640x1024 = max_kernel_size
 10963                                  
